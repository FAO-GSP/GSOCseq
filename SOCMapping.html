<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq</title>
  <meta name="description" content="The GSOCseq Technical Manual" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The GSOCseq Technical Manual" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq" />
  
  <meta name="twitter:description" content="The GSOCseq Technical Manual" />
  

<meta name="author" content="Food and Agriculture Organization of the United Nations, Rome, 2020" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq</h1>
<p class="author"><em>Food and Agriculture Organization of the United Nations, Rome, 2020</em></p>
<p class="date" style="margin-top: 1.5em;"><em>25/11/2020</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#list-of-contributors">List of contributors</a>
<ul>
<li><a href="#authors">Authors</a></li>
<li><a href="#contributers-and-reviewers">Contributers and Reviewers</a></li>
<li><a href="#special-advisor">Special Advisor</a></li>
<li><a href="#github-page">GitHub Page</a></li>
</ul></li>
<li><a href="#presentation"><span class="toc-section-number">1</span> | Presentation</a>
<ul>
<li><a href="#how-to-use-this-book"><span class="toc-section-number">1.1</span> How to use this book</a></li>
<li><a href="#the-sample-data-set"><span class="toc-section-number">1.2</span> The sample data set</a></li>
</ul></li>
<li><a href="#soil-organic-carbon-soc-sequestration"><span class="toc-section-number">2</span> | Soil Organic Carbon (SOC) sequestration</a>
<ul>
<li><a href="#soil-carbon"><span class="toc-section-number">2.1</span> Soil carbon</a></li>
<li><a href="#soc-sequestration"><span class="toc-section-number">2.2</span> SOC sequestration</a></li>
<li><a href="#factors-affecting-soc-sequestration"><span class="toc-section-number">2.3</span> Factors affecting SOC sequestration</a></li>
<li><a href="#estimating-soc-sequestration-potential"><span class="toc-section-number">2.4</span> Estimating SOC sequestration potential</a></li>
</ul></li>
<li><a href="#soc-modelling"><span class="toc-section-number">3</span> | SOC Modelling</a>
<ul>
<li><a href="#process-oriented-models"><span class="toc-section-number">3.1</span> Process-oriented models</a></li>
<li><a href="#examples-of-process-oriented-models"><span class="toc-section-number">3.2</span> Examples of process-oriented models</a></li>
</ul></li>
<li><a href="#the-rothc-model"><span class="toc-section-number">4</span> | The RothC model</a>
<ul>
<li><a href="#model-description"><span class="toc-section-number">4.1</span> Model description</a></li>
<li><a href="#rothc-general-data-requirements"><span class="toc-section-number">4.2</span> RothC general data requirements</a></li>
</ul></li>
<li><a href="#modelling-approach-for-the-gsocseq"><span class="toc-section-number">5</span> | Modelling approach for the GSOCseq</a>
<ul>
<li><a href="#general-framework"><span class="toc-section-number">5.1</span> General framework</a></li>
<li><a href="#potential-soc-sequestration-estimates-after-the-implementation-of-ssm-practices"><span class="toc-section-number">5.2</span> Potential SOC sequestration estimates after the implementation of SSM practices</a></li>
<li><a href="#business-as-usual-and-sustainable-soil-management-scenarios"><span class="toc-section-number">5.3</span> Business as usual and sustainable soil management scenarios</a></li>
<li><a href="#general-modeling-procedures"><span class="toc-section-number">5.4</span> General modeling procedures</a>
<ul>
<li><a href="#initialization-long-spin-up"><span class="toc-section-number">5.4.1</span> Initialization: Long spin-up</a></li>
<li><a href="#short-spin-up"><span class="toc-section-number">5.4.2</span> Short spin-up</a></li>
<li><a href="#forward-runs"><span class="toc-section-number">5.4.3</span> Forward runs</a></li>
</ul></li>
<li><a href="#summary"><span class="toc-section-number">5.5</span> Summary</a></li>
</ul></li>
<li><a href="#data-sets-and-inputs"><span class="toc-section-number">6</span> | Data sets and inputs</a>
<ul>
<li><a href="#climate-data-sets"><span class="toc-section-number">6.1</span> Climate data sets</a></li>
<li><a href="#soil-data-sets"><span class="toc-section-number">6.2</span> Soil data sets</a>
<ul>
<li><a href="#initial-total-soc-stocks"><span class="toc-section-number">6.2.1</span> Initial total SOC stocks</a></li>
<li><a href="#initial-c-pools"><span class="toc-section-number">6.2.2</span> Initial C pools</a></li>
<li><a href="#soil-texture-clay-content"><span class="toc-section-number">6.2.3</span> Soil texture: clay content</a></li>
</ul></li>
<li><a href="#land-cover-data-sets"><span class="toc-section-number">6.3</span> Land cover data sets</a></li>
<li><a href="#monthly-vegetation-cover"><span class="toc-section-number">6.4</span> Monthly vegetation cover</a></li>
<li><a href="#monthly-carbon-inputs"><span class="toc-section-number">6.5</span> Monthly carbon inputs:</a>
<ul>
<li><a href="#c-inputs-under-bau-practices"><span class="toc-section-number">6.5.1</span> C inputs under BAU practices:</a></li>
<li><a href="#c-inputs-under-ssm-practices"><span class="toc-section-number">6.5.2</span> C inputs under SSM practices:</a></li>
</ul></li>
<li><a href="#residue-decomposability-decomposable-to-resistant-plant-material-ratio-dpmrpm"><span class="toc-section-number">6.6</span> Residue decomposability: decomposable to resistant plant material ratio (DPM/RPM)</a></li>
<li><a href="#required-data-sets-and-global-data-sources.-summary"><span class="toc-section-number">6.7</span> Required data sets and global data sources. Summary</a></li>
</ul></li>
<li><a href="#software-environment"><span class="toc-section-number">7</span> | Software environment</a>
<ul>
<li><a href="#setting-up-the-software-environment-r-rstudio-and-r-packages"><span class="toc-section-number">7.1</span> Setting up the software environment: R, RStudio and R Packages</a>
<ul>
<li><a href="#obtaining-and-installing-r"><span class="toc-section-number">7.1.1</span> Obtaining and installing R</a></li>
<li><a href="#obtaining-and-installing-rstudio"><span class="toc-section-number">7.1.2</span> Obtaining and installing RStudio</a></li>
<li><a href="#getting-started-with-r"><span class="toc-section-number">7.1.3</span> Getting started with R</a></li>
</ul></li>
<li><a href="#r-packages"><span class="toc-section-number">7.2</span> R packages</a>
<ul>
<li><a href="#finding-r-packages"><span class="toc-section-number">7.2.1</span> Finding R packages</a></li>
<li><a href="#some-useful-r-packages-for-the-socseq-maps"><span class="toc-section-number">7.2.2</span> Some useful R-packages for the SOCseq maps</a></li>
<li><a href="#installation-of-r-packages-used-in-this-technical-manual"><span class="toc-section-number">7.2.3</span> Installation of R-Packages used in this technical manual</a></li>
</ul></li>
<li><a href="#considerations-when-using-r"><span class="toc-section-number">7.3</span> Considerations when using R</a></li>
</ul></li>
<li><a href="#running-the-scripts-overview"><span class="toc-section-number">8</span> | Running the scripts: overview</a>
<ul>
<li><a href="#summary-of-steps-and-scripts"><span class="toc-section-number">8.1</span> Summary of steps and scripts</a></li>
<li><a href="#stage-1-preparation-of-data"><span class="toc-section-number">8.2</span> Stage 1: Preparation of data</a></li>
<li><a href="#stage-2-running-the-model"><span class="toc-section-number">8.3</span> Stage 2: Running the model</a></li>
<li><a href="#stage-3-generation-of-the-map"><span class="toc-section-number">8.4</span> Stage 3: generation of the map</a></li>
</ul></li>
<li><a href="#stage-1-preparation-of-input-data"><span class="toc-section-number">9</span> | Stage 1: preparation of input data</a>
<ul>
<li><a href="#preparation-of-soc-layer"><span class="toc-section-number">9.1</span> Preparation of SOC layer</a>
<ul>
<li><a href="#script-number-0.soc_map_aoi.r"><span class="toc-section-number">9.1.1</span> Script Number 0.“SOC_MAP_AOI.R”</a></li>
</ul></li>
<li><a href="#preparation-of-climate-layers"><span class="toc-section-number">9.2</span> Preparation of climate Layers</a>
<ul>
<li><a href="#option-a-preparation-of-the-cru-climatic-variables"><span class="toc-section-number">9.2.1</span> <em>Option A</em> Preparation of the CRU climatic variables</a></li>
<li><a href="#option-b-preparation-of-the-terraclimate-climatic-variables"><span class="toc-section-number">9.2.2</span> <em>Option B</em> Preparation of the TerraClimate climatic variables</a></li>
<li><a href="#script-number-6.-monthly_vegetation_cover-vegetation-cover-from-google-earth-engine."><span class="toc-section-number">9.2.3</span> Script Number 6. “Monthly_vegetation_cover” vegetation cover from Google Earth Engine.</a></li>
<li><a href="#script-number-7.-vegetation_cover_stack.r"><span class="toc-section-number">9.2.4</span> Script Number 7. “Vegetation_Cover_stack.R”</a></li>
</ul></li>
<li><a href="#preparing-the-land-use-layer"><span class="toc-section-number">9.3</span> Preparing the land use layer</a>
<ul>
<li><a href="#script-number-9-land_use_esa_to_fao_classes.r-no-land-use-change"><span class="toc-section-number">9.3.1</span> Script Number 9 “Land_Use_ESA_to_FAO_classes.R” No land use change</a></li>
<li><a href="#script-number-9-land_use_esa_to_fao_classes_lusim.r-land-use-change-simulation"><span class="toc-section-number">9.3.2</span> Script Number 9 “Land_Use_ESA_to_FAO_classes_LUsim.R” Land use change simulation</a></li>
</ul></li>
<li><a href="#harmonization-of-soil-climate-and-vegetation-layers."><span class="toc-section-number">9.4</span> Harmonization of soil, climate and vegetation layers.</a>
<ul>
<li><a href="#script-number-10.-spin_up_stack.v3.r"><span class="toc-section-number">9.4.1</span> Script Number 10. “SPIN_UP_STACK.v3.R”</a></li>
<li><a href="#script-number-11.-warm_up_stack_v5.r-no-land-use-change"><span class="toc-section-number">9.4.2</span> Script Number 11. “WARM_UP_STACK_V5.R” No Land use change</a></li>
<li><a href="#script-number-11.-warm_up_stack_v5_lusim.r-land-use-change-simulation"><span class="toc-section-number">9.4.3</span> Script Number 11. WARM_UP_STACK_V5_LUsim.R Land use change simulation</a></li>
<li><a href="#script-number-12.-forward_stack.r"><span class="toc-section-number">9.4.4</span> Script Number 12. “FORWARD_STACK.R”</a></li>
</ul></li>
<li><a href="#defining-target-points-to-run-the-model"><span class="toc-section-number">9.5</span> Defining target points to run the model</a>
<ul>
<li><a href="#qgis-procedure-number-1-model"><span class="toc-section-number">9.5.1</span> QGIS Procedure number 1 (model)</a></li>
</ul></li>
</ul></li>
<li><a href="#stage-2-running-the-model-1"><span class="toc-section-number">10</span> | Stage 2: running the model</a>
<ul>
<li><a href="#script-number-13.-roth_c_spin_up_v2.r"><span class="toc-section-number">10.1</span> Script Number 13. “ROTH_C_SPIN_UP_v2.R”</a></li>
<li><a href="#script-number-14.-roth_c_warm_up_v4.r-no-land-use-change"><span class="toc-section-number">10.2</span> Script Number 14. “ROTH_C_WARM_UP_v4.R” No Land use change</a></li>
<li><a href="#script-number-14.-roth_c_warm_up_v4.r-land-use-change-simulation"><span class="toc-section-number">10.3</span> Script Number 14. “ROTH_C_WARM_UP_v4.R” Land use change simulation</a></li>
<li><a href="#script-number-15.-roth_c_forward_v2.r"><span class="toc-section-number">10.4</span> Script Number 15. “ROTH_C_forward_v2.R”</a></li>
</ul></li>
<li><a href="#stage-3-map-generation"><span class="toc-section-number">11</span> | Stage 3: Map generation</a>
<ul>
<li><a href="#script-number-16-points_to_raster.r"><span class="toc-section-number">11.1</span> Script Number 16: “Points_to_Raster.R”</a></li>
</ul></li>
<li><a href="#uncertainty-and-validation"><span class="toc-section-number">12</span> | Uncertainty and validation</a></li>
<li><a href="#data-sharing"><span class="toc-section-number">13</span> | Data sharing</a>
<ul>
<li><a href="#general-principles"><span class="toc-section-number">13.1</span> General principles</a></li>
<li><a href="#data-formats-and-integrity"><span class="toc-section-number">13.2</span> Data formats and integrity</a></li>
<li><a href="#data-correctness"><span class="toc-section-number">13.3</span> Data correctness</a></li>
<li><a href="#data-completeness"><span class="toc-section-number">13.4</span> Data completeness</a></li>
<li><a href="#other-modes-of-data-sharing"><span class="toc-section-number">13.5</span> Other modes of data sharing</a></li>
</ul></li>
<li><a href="#limitations-knowledge-gaps-and-way-forward"><span class="toc-section-number">14</span> | Limitations, knowledge gaps and way forward</a></li>
<li><a href="#annex-i-troubleshooting">Annex I Troubleshooting</a>
<ul>
<li><a href="#coastal-and-small-countries-not-fully-covered-by-the-cru-layers">Coastal and small countries not fully covered by the CRU layers</a>
<ul>
<li><a href="#step-1-create-a-single-cru-layer-cropped-and-masked-to-the-extent-of-your-aoi-using-the-following-r-script">Step 1 Create a single CRU layer cropped and masked to the extent of your AOI using the following R script</a></li>
<li><a href="#step-2-open-qgis-and-generate-the-empty-points">Step 2 Open QGIS and generate the empty points</a></li>
<li><a href="#step-3-polygonize-the-raster">Step 3 Polygonize the raster</a></li>
<li><a href="#step-4-select-points-outside-of-the-polygon">Step 4 Select points outside of the polygon</a></li>
<li><a href="#step-5-export-the-extracted-points">Step 5 Export the extracted points</a></li>
<li><a href="#step-6-run-the-spin-up-phase-for-points-outside-the-cru-layer-script-13b">Step 6 Run the Spin up phase for points outside the CRU layer (Script 13B)</a></li>
<li><a href="#step-7-run-the-warm-up-phase-for-points-outside-the-cru-layer-script-14b">Step 7 Run the Warm up phase for points outside the CRU layer (Script 14B)</a></li>
<li><a href="#step-8-run-the-forward-phase-for-points-outside-the-cru-layer-script-15b">Step 8 Run the Forward phase for points outside the CRU layer (Script 15B)</a></li>
</ul></li>
<li><a href="#common-errors-and-considerations">Common errors and considerations</a></li>
</ul></li>
<li><a href="#annex-ii-quality-assurance-and-quality-control">Annex II Quality assurance and quality control</a>
<ul>
<li><a href="#step-1-check-that-29-products-have-been-labeled-appropriately-and-are-in-the-correct-format">Step 1 Check that 29 products have been labeled appropriately and are in the correct format</a></li>
<li><a href="#step-2-check-the-projection-and-resolution-of-all-products">Step 2 Check the projection and resolution of all products</a></li>
<li><a href="#step-3-check-that-the-products-were-generated-for-agricultural-and-grazing-areas-only">Step 3 Check that the products were generated for agricultural and grazing areas only</a></li>
<li><a href="#step-4-check-for-units-range-and-outliers">Step 4 Check for units, range, and outliers</a>
<ul>
<li><a href="#soil-organic-carbon-at-t0-2020">Soil Organic Carbon at T0 (2020)</a></li>
<li><a href="#final-soc-stocks-after-20-simulation-years-for-all-scenarios-bau-ssm1-ssm2-ssm3">Final SOC stocks after 20 simulation years for all scenarios (BAU, SSM1, SSM2, SSM3)</a></li>
<li><a href="#absolute-differences-in-soc-stocks">Absolute differences in SOC stocks</a></li>
<li><a href="#relative-differences-in-soc-stocks">Relative differences in SOC stocks</a></li>
<li><a href="#absolute-sequestration-rates-asr">Absolute sequestration rates (ASR)</a></li>
<li><a href="#relative-sequestration-rates-rsr">Relative sequestration rates (RSR)</a></li>
<li><a href="#uncertainties">Uncertainties</a></li>
</ul></li>
</ul></li>
<li><a href="#references"><span class="toc-section-number">15</span> References</a></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="list-of-contributors" class="section level1 unnumbered">
<h1 class="unnumbered">List of contributors</h1>
<div id="authors" class="section level2 unnumbered">
<h2 class="unnumbered">Authors</h2>
<p>Guillermo Peralta (GSP Secretariat)<br />
Luciano Di Paolo (GSP Secretariat)<br />
Christian Omuto (GSP Secretariat)<br />
Kostiantyn Viatkin (GSP Secretariat)<br />
Isabel Luotto (GSP Secretariat)<br />
Yusuf Yigini (GSP Secretariat)</p>
<p><em>Cover design:</em> Matteo Sala</p>
</div>
<div id="contributers-and-reviewers" class="section level2 unnumbered">
<h2 class="unnumbered">Contributers and Reviewers</h2>
<table>
<colgroup>
<col width="11%" />
<col width="88%" />
</colgroup>
<tbody>
<tr class="odd">
<td>P4WG</td>
<td>(Pillar 4 Working Group Agency)</td>
</tr>
<tr class="even">
<td>INSII</td>
<td>(International Network of Soil Information Institutions)</td>
</tr>
<tr class="odd">
<td>ITPS</td>
<td>(Intergovernmental Technical Panel on Soils)</td>
</tr>
<tr class="even">
<td>4per1000 SCT</td>
<td>(4 per 1000 Scientific and Technical Committee)</td>
</tr>
<tr class="odd">
<td>CIRCASA</td>
<td>(Coordination of International Research Cooperation on Soil Carbon Sequestration in Agriculture)</td>
</tr>
<tr class="even">
<td>UNCCD-SPI</td>
<td>(The UNCCD Science-Policy Interface)</td>
</tr>
</tbody>
</table>
</div>
<div id="special-advisor" class="section level2 unnumbered">
<h2 class="unnumbered">Special Advisor</h2>
<p>Pete Smith (University of Aberdeen)</p>
</div>
<div id="github-page" class="section level2 unnumbered">
<h2 class="unnumbered">GitHub Page</h2>
<p>Isabel Luotto (GSP Secretariat)</p>
<p><strong>Recommended citation:</strong></p>
<blockquote>
<p>FAO. 2020. GSOCseq Global Soil Organic Carbon Sequestration Potential Map
Technical Manual. G. Peralta,L. Di Paolo, C. Omuto, K. Viatkin, I. Luotto, Y. Yigini, 1st Edition, Rome.</p>
</blockquote>
<!--chapter:end:index.rmd-->
</div>
</div>
<div id="presentation" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> | Presentation</h1>
<p>Soils have become one of the world’s most vulnerable resources in the face of climate change, land degradation, biodiversity loss and increased demand for food production. The role of soils and soil organic carbon (SOC) in the climate system and climate change adaptation and mitigation has been recognized widely and validated in various studies, both experimentally and through modelling. Maintaining and increasing SOC stocks is not only crucial for reducing greenhouse gas (GHG) emissions and removing CO<sub>2</sub> from the atmosphere but also for harnessing the benefits of increased SOC (and soil organic matter - SOM) for soil health and fertility by improving water storage and thereby increasing the access of plants to water, food production potential and resilience to drought (FAO, 2017). It may lead to changes in health threat to human beings, and poses a significant challenge to rural communities and to our ability to thrive on our planet. The widespread adoption of site-specific sustainable soil management (SSM) practices in agricultural lands can harness a large C sink capacity at the global scale and its role as an effective strategy to mitigate GHG has been widely documented.
The magnitude and rate of carbon sequestration in soils can vary greatly, depending on the different land uses and practices, soil characteristics, vegetation, topography and climate, among other soil forming factors and processes. It is thus relevant to identify which regions, environments and production systems have a greater potential to increase SOC stocks as well as establishing priorities for research and the implementation of public policies.
Responding to a request for support in addressing the Sustainable Development Goal Indicators, especially indicator 15.3 which includes the restoration of degraded soils, the Global Soil Partnership (GSP) Plenary Assembly in 2020 instructed the Intergovernmental Technical Panel on Soils (ITPS) and the GSP Secretariat to develop the Global Soil Organic Carbon Sequestration Potential map (GSOCseq map), following the same country-driven approach developed for the Global Soil Organic Carbon map (GSOCmap). This ‘bottom-up’ approach is expected to generate a GSOCseq map from national SOCseq maps, developed and validated by local experts, based on the implementation of SOC models using standardized procedures and by leveraging the best available local data.</p>
<p>To this end, members under the International Network of Soil Information Institutions (INSII) umbrella developed general guidelines and technical specifications for the preparation of the GSOCseq map and countries were invited to prepare their national soil organic carbon sequestration potential maps according to these specifications. Given the scientific advances in the tools for modeling and mapping SOC, many countries requested the GSP Secretariat to support them in the process of preparing national SOCseq maps. Hence, an intensive capacity development program on SOC sequestration potential through the use of modelling and mapping techniques is being implemented. Regional and national training sessions are being organized using an on-the-job-training modality to ensure that national experts are trained on the state of the art modeling and mapping techniques using their own data sets to produce reliable SOCseq maps.
This Technical Manual was prepared as a comprehensible reference knowledge base to support the capacity development process. It provides the necessary background knowledge, methodologies and technical steps to produce national SOCseq maps. It includes step-by-step guidance for developing 1 km grids of SOC sequestration potential, as well as for the preparation of local data and the compilation and preprocessing of spatial data sets, using open source software environments and tools.
This Technical Manual supplements the Technical Specifications and Country Guidelines for Global Soil Organic Carbon Sequestration Potential Map (GSOCseq), (FAO and GSP, 2020), and part of its contents is included in the current Manual.
It is our hope that this Technical Manual will fulfill its mandate of easily enabling any user to produce digital SOC sequestration maps using soil legacy data, process oriented SOC models and modern techniques of digital soil mapping and realize the overall aim of improving decision making on soil management.</p>
<div id="how-to-use-this-book" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> How to use this book</h2>
<p>This Manual is organized in 13 Chapters, including this one. Chapter 2 provides scientific background on the importance of SOC sequestration as a GHG mitigation strategy, factors that regulate SOC sequestration and finally how it can be estimated. Chapter 3 provides scientific background on the use of different SOC models to estimate SOC changes and SOC sequestration potential. Chapter 4 describes one of the most used process-oriented SOC models, to be used as a standard to allow comparisons between countries: the RothC model. Chapter 5 describes the general modeling procedures to generate national SOCseq maps using this SOC model. Chapter 6 describes the required data sets, potential data sources and methodologies to estimate modeling inputs for the modeling approach described in Chapter 5. Chapter 7 gives an overview of the steps and software requirements to generate national SOCseq maps using a spatially explicit R-version of the RothC model. Chapters 8 to 11 constitute the core of this document, providing a step by step guide on how to run the R-scripts and generate the final product:</p>
<ul>
<li>Chapter 8 summarizes the different steps and scripts to be used during the complete process;<br />
</li>
<li>Chapter 9 summarizes the procedures and scripts harmonization and preparation of input data;<br />
</li>
<li>Chapter 10 summarizes the procedures for running the model from the prepared data;<br />
</li>
<li>Chapter 11 summarizes the procedures for the generation of the final maps from the modeling runs.</li>
</ul>
<p>Chapter 12 provides an overview for the estimation of uncertainties. Lastly, Chapter 13 summarizes the procedure for the sharing of the national SOCseq maps.</p>
</div>
<div id="the-sample-data-set" class="section level2" number="1.2">
<h2 number="1.2"><span class="header-section-number">1.2</span> The sample data set</h2>
<p>The sample data set provided with this Technical Manual was compiled to model and map the potential soil organic carbon sequestration for the district of Pergamino, Buenos Aires. It covers an area of 2,950 km<sup>2</sup> that is mainly dedicated to agriculture. Pergamino is located in the Corn Belt of Argentina and with its subtropical climate it is favorable for double cropping systems, allowing for two harvests a year. The lowlands of this district are used mainly as pastures for the production of calves.</p>
<p>This Technical Manual used in combination with the provided sample data set and scripts can be used as a step-by-step guide, which covers data preparation and harmonization, modeling potential soil organic carbon sequestration, rasterizing the results, estimating the uncertainty and finally data sharing.</p>
<p>The sample data set and scripts can be found in the following repository:
<a href="https://drive.google.com/drive/folders/1Jonn17LAiCyaUSpUn6W63o16bjTg1P0E?usp=sharing" class="uri">https://drive.google.com/drive/folders/1Jonn17LAiCyaUSpUn6W63o16bjTg1P0E?usp=sharing</a></p>
<p>More information on the necessary data and the provided data set can be found in Chapter 6, while an overview of the different steps and scripts needed is presented in Chapter 8.</p>
<!--chapter:end:01.Presentation.rmd-->
</div>
</div>
<div id="soil-organic-carbon-soc-sequestration" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> | Soil Organic Carbon (SOC) sequestration</h1>
<div id="soil-carbon" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Soil carbon</h2>
<p>Soils constitute the largest terrestrial carbon (C) pool. Total soil carbon (C) stock comprises soil organic C (SOC) and soil inorganic C (SIC) components. SOC is the carbon component of soil organic matter (SOM), a heterogeneous pool of C comprised of diverse materials including fine fragments of litter, roots and soil fauna, microbial biomass C, products of microbial decay and other biotic processes (i.e. such as particulate organic matter), and simple compounds such as sugar and polysaccharides (Jansson et al., 2010). The global SOC stock of ice-free land contains about 1500-2400 Pg C (1 Pg = 1 Gt) in the top 1 m, 2300 Pg C in the top 3 m, and 3000 Pg C in the soil profiles (Batjes et al., 1996; Scharlemann et al., 2014; Tifafi et al., 2018; Lorenz and Lal, 2018). This represents more than the sum of carbon contained in the atmosphere and vegetation (Smith et al., 2019). Soil inorganic C comprises pedogenic carbonates and bicarbonates, which are particularly abundant in arid regions and in alkaline soils. The SIC stock is estimated at 700-1700 Pg C in the top 1-m soil layer (Lorenz and Lal, 2018) and is believed to occur predominantly in the deeper layers of temperate soils
Although soils contribute to a major share of agricultural greenhouse gas emissions (GHGs), due to the size of the soil carbon pool, even small increments in the net soil C storage represent a substantial C sink potential (Paustian et al., 2016). Carbon sequestration implies transferring atmospheric CO<sub>2</sub> into long-lived pools and storing it securely so it is not immediately reemitted (Lal et al., 2018). Thus, soil C sequestration means increasing SOC and SIC stocks through judicious land use and sustainable soil management (SSM) practices. Due to the current knowledge on SOC dynamics, the global distribution, and the current knowledge on size of the SOC pool compared to the SIC pool, this technical manual will focus on SOC sequestration.</p>
</div>
<div id="soc-sequestration" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> SOC sequestration</h2>
<p>The basic process of SOC sequestration in the terrestrial biosphere involves transfer of atmospheric CO<sub>2</sub> into plant biomass and conversion of biomass into stable SOC through formation of organo-mineral complexes (Lal et al., 2018). Thus, soil carbon sequestration relies on plant photosynthesis to carry out the initial step of carbon “removal” from the atmosphere. However, rather than increasing the storage of carbon contained in plant biomass, SOC sequestration relies on management practices that increase the amount of carbon stored as soil organic matter, primarily in cropland and grazing lands. The main advantage of scaling up soil C sequestration as a biological negative emission strategy is that carbon stocks are most depleted on lands currently under agricultural management and thus this approach does not require land use conversions (e.g., to forests) nor it increases the competition for land resources. In addition, increases in SOC stocks are highly beneficial in maintaining and increasing soil health and soil fertility, which provides additional incentives for adopting SOC sequestering practices (Paustian et al., 2019).</p>
</div>
<div id="factors-affecting-soc-sequestration" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Factors affecting SOC sequestration</h2>
<p>SOC sequestration is governed by the balance between the rate of C added to the soil from plant residues (including roots) and organic amendments (e.g., manure, compost), and the rate of C lost from the soils, which is mainly as CO<sub>2</sub> from decomposition processes (i.e., heterotrophic soil respiration). Other forms of organic C can be lost as CH4 from anaerobic (e.g. flooded) reactions and to a lesser extent through leaching of dissolved organic C. Soil erosion can greatly affect C stocks at a particular location, but at larger scales erosion may not represent a loss process per se but rather a redistribution of soil C (Paustian et al., 2019).
Decomposition rates are controlled by a variety of factors including soil temperature and moisture, drainage (impacting soil O2 status) and pH (Paustian et al., 2019). Soil physical characteristics such as texture and clay mineralogy also impact the longevity and persistence (i.e., mean residence time) of soil C, by affecting organic matter stabilization processes, through mineral-organic matter associations (Schmidt et al., 2011; Paustian et al., 2019). In native ecosystems the rate of C inputs is a function of the type (e.g., annual vs. perennial, woody vs. herbaceous) and productivity of the vegetation, largely governed by climate (mainly temperature and precipitation) but also nutrient availability and other growth determining factors. In managed ecosystems such as cropland and grazing land both the rate of C input as well as the rate of soil C loss via decomposition are impacted by the soil and crop management practices applied. There is no one universal management practice to increase SOC sequestration (Lal et al., 2018), but in general, soil C stocks can be increased by: (a) increasing the rate of C addition to the soil, which removes CO<sub>2</sub> from the atmosphere, and/or (b) reducing the relative rate of loss (as CO<sub>2</sub> ) via decomposition, which reduces emissions to the atmosphere that would otherwise occur (Paustian et al., 2019).
Three key aspects need to be considered regarding the pattern of gains or losses of soil C and hence SOC sequestration (Paustian et al., 2019). The first is that with increased C inputs and/or decreased decomposition rates, soil C stocks tend toward a new equilibrium state and thus after a few decades C gains attenuate, becoming increasingly small over time. Secondly, although sequestered SOC can be highly stable, changes in management that lead to C gains are potentially reversible, i.e., if management reverts back to its previous condition, much or all of the gained C can be lost. Thus, practices that led to increased soil C need to be maintained long term. Third, mineral soils (i.e., non-peat soils) have an upper limit or “saturation level” of soil C (Six et al., 2002). While this maximum soil C concentration is well above the observed C concentration of most managed soils, carbon rich mineral soils that already have very high SOC levels (e.g., &gt;5% C by mass) may have a propensity for further C gains.</p>
</div>
<div id="estimating-soc-sequestration-potential" class="section level2" number="2.4">
<h2 number="2.4"><span class="header-section-number">2.4</span> Estimating SOC sequestration potential</h2>
<p>Taking into account the above mentioned factors, SOC sequestration potential after the adoption of SSM practices under specific conditions can be expressed in different ways depending on the definition of SOC baseline stocks and time towards a new equilibrium state. This Technical Manual will refer to two types of SOC sequestration: an ‘absolute SOC sequestration’ (SOCseq abs), expressed as the change in SOC stocks over time relative to a base period (or reference period, t0); and a ‘relative SOC sequestration’ (SOCseq rel), expressed as the change in SOC stocks over time relative to business as usual practices (Fig. 2.1). Thus, the ‘absolute’ attainable SOC sequestration can be determined for business as usual (BAU) and SSM practices (See Chapter 5), and can be either positive, neutral or negative:<br />
<span class="math display">\[\begin{equation}
\tag{2.1}
\Delta SOC_{ABS} t C ha^{-1} = SOC_{SSM/BAU \ t}  -  SOC_{t0}
\end{equation}\]</span></p>
<p>where SOC <span class="math inline">\(SSM/BAU\ t\)</span> refers to the final SOC stocks once a new equilibrium is reached or after a defined period of time (e.g. 20 years), and <span class="math inline">\(SOC\  t0\)</span> refers to the initial or base period SOC stocks (<span class="math inline">\(t\)</span>=0). The ‘relative’ attainable SOC sequestration is either neutral or positive, can be determined as:<br />
<span class="math display">\[\begin{equation}
\tag{2.2}
\Delta SOC t C ha^{-1} = SOC_{SSM \ t} -  SOC_{BAU \ t }
\end{equation}\]</span>
where <span class="math inline">\(SOC_{SSM \ t}\)</span> refers to the final SOC stocks once a new equilibrium is reached or after a defined period of time (e.g. 20 years) after SSM practices are implemented, and <span class="math inline">\(SOC_{BAU \ t}\)</span> refers to the final SOC stocks under business as usual (BAU) practices at the end of the same considered period. Mean annual SOC sequestration rates (t C ha<sup>-1</sup> yr<sup>-1</sup>; absolute or relative) can be determined by dividing SOC changes by the duration of the defined period. For more specifications on the approaches proposed in this manual, see Chapter 5.</p>
<div class="figure">
<img src="images/Figure_2.1.png" alt="" />
<p class="caption"><strong>Figure 2.1.</strong> <em>Soil organic carbon theoretical evolutions under business-as-usual (BAU) practices and after the adoption of sustainable soil management (SSM) practices. This depicts: a) lands where SOC levels have reached equilibrium and it is possible to</em></p>
</div>
<p>Thus, agricultural lands may show potential for improvement in their SOC stock after the adoption of SSM practices (compared to business as usual practices), by either gaining or maintaining SOC levels. Four situations are possible: a) lands where SOC levels have reached equilibrium and it is possible to increase levels through SSM; b) lands where the SOC is increasing but can be further increased through SSM; c) lands where SOC is declining and it is possible to stop or mitigate losses in SOC levels through SSM; and d) lands where SOC is declining and it is possible to reverse this fall through SSM. These situations are depicted in Fig. 2.1.
It has been estimated that the widespread adoption of site/biome-specific SSM practices can harness a large C sink capacity in agricultural systems at a global scale: 0.4-1.2 Pg C yr<sup>-1</sup> (Lal, 2004); 1.0-1.32 Pg C yr<sup>-1</sup> (Smith et al., 2008); 0.4-1.1Pg C yr<sup>-1</sup> (De Vries, 2017); 0.32-1.01 Pg C yr<sup>-1</sup> (Batjes et al., 2019). However, the extent and rates of SOC sequestration in agricultural lands may vary greatly depending on the different land uses and practices, soil characteristics, vegetation, topography and climate, among other soil forming factors and processes (Smith et al., 2008; Minasny et al., 2017; Lal et al., 2018; Batjes et al., 2019). Sequestration rates due to management practices in croplands and grasslands are usually in the range of 0.2 - 0.8 t C ha-1 year -1 (Poepleau and Don, 2015; Kampf et al., 2016; Minasny et al., 2017; Conant et al., 2017; Paustian et al., 2016; Paustian et al., 2019).
It is therefore relevant to identify which regions, environments and systems have a greater potential to increase SOC stocks and establish priorities for research and implementation of private and public policies. In this sense, coupling SOC models to GIS (Geographic Information Systems) platforms enables the transition t from site-specific SOC stocks estimations to spatial simulations and projections (e.g. Smith et al. 2005; Milne et al., 2007; Kamoni et al., 2007; Falloon et al., 2007; Gottschalk et al., 2012; Lugato et al., 2014), allowing for the identification of conditions that increase the SOC sequestration potential.</p>
<!--chapter:end:02.Soil_Organic_Carbon_sequestration.rmd-->
</div>
</div>
<div id="soc-modelling" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> | SOC Modelling</h1>
<p>Modelling is an approach used to infer SOC stocks and distributions in conditions where they have not been measured, such as: under future climatic conditions, at locations or regions where no measurement exists, for management scenarios that have not yet been implemented (FAO, 2019). In the last decades, a number of numerical models have been developed, including mathematical representations that quantitatively describe soil characteristics and processes. The breadth of these approaches can be illustrated by the recent compilation of 90 mathematical models describing SOC changes and biogeochemical related soil processes developed in the last 80 years (Falloon and Smith, 2009; Manzoni and Porporato, 2009; Campbell and Paustian, 2015). However, according to their structure, number of input variables required and temporal and spatial resolution, not all available C models are suitable for all studies (Manzoni and Porporato, 2009).</p>
<div id="process-oriented-models" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Process-oriented models</h2>
<p>Among the different types of SOC models, process-oriented multicompartment models have been dominant in efforts to simulate changes in SOC in agricultural lands, grasslands and other production systems (Stockmann et al., 2013).
Process-oriented models are built considering the processes involved in the transfer of SOC across the soil profile and its transformations (Smith et al., 1998). They are generally used to predict SOC dynamics based on different conceptual C pools or compartments that alter in size via decomposition rates and stabilization mechanisms (each compartment or pool being a fraction of SOC with similar chemical and physical characteristics; Stockmann et al., 2013). Models belonging to this class can potentially have a variable degree of complexity, from one compartment to multiple compartments (Jenkinson et al., 1990). Early models simulated SOC as one homogeneous compartment (Jenny, 1949). Beek and Frisel (1973) and Jenkinson and Rayner (1977) proposed two-compartment models, and as computational tools became more accessible, multi-compartment models were developed (McGill, 1996).</p>
<p>According to Falloon and Smith (2009), decay rates <span class="math inline">\(k\)</span> are usually expressed in this type of models by first-order kinetics with respect to the concentration <span class="math inline">\(C\)</span> of the pool:<br />
<span class="math display">\[\begin{equation}
\tag{3.1}
\frac{dC}{dt} =- kC     
\end{equation}\]</span></p>
<p>The flows of carbon within most models represent a sequence of carbon going from plant and animal debris to the microbial biomass and then, to soil organic pools of increasing stability. The output flow from an organic pool is usually split. It is directed to a microbial biomass pool, another organic pool and, under aerobic conditions, to CO<sub>2</sub> . This split simulates the simultaneous anabolic and catabolic activities and growth of a microbial population feeding on one substrate. Two parameters are generally required to quantify the split flow, often defined as a microbial (utilization) efficiency and a stabilization (humification) factor, which control the flow of decayed carbon to the biomass and humus pools, respectively.</p>
</div>
<div id="examples-of-process-oriented-models" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Examples of process-oriented models</h2>
<p>CENTURY ( Parton, 1996), RothC (Jenkinson et al 1990; Coleman and Jenkinson, 1996), SOCRATES (Grace et al., 2006), DNDC (Li, 1996), CANDY (Franko et al., 1997), DAISY (Hansen et al., 1991), NCSOIL (Hadas et al., 1998) and EPIC (Williams et al., 1983; 1984) are known examples of this kind of process-oriented multicompartment models. They have been developed and tested using long-run data sets, and in general they show a good ability to predict SOC dynamics over decades across a range of land uses, soil types and climatic regions (Smith et al., 1997). As mentioned before, process-oriented models can be combined with GIS software, giving a modelling platform well suited for global, national, and regional scale studies (e.g. Smith et al. 2005; Milne et al., 2007; Kamoni et al., 2007; Falloon et al., 2007; Gottschalk et al., 2013; Lugato et al., 2014).
The review by Campbell and Paustian (2015) emphasizes the fact that among these known process-oriented models, no one clearly outperforms the others. The increase in multi-model comparison publications in the last decades shows the lack of consensus in SOC modelling approaches. It is also noteworthy that among these multi-model comparisons, there was no single model identified with conclusively higher performance capacity. For a detailed comparison between some of the most used SOC models refer to Campbell and Paustian (2015).</p>
<p>However, in order to obtain consistent results in SOC sequestration estimates at a global scale, and to allow comparisons between countries and regions, the use of a standard ‘process-oriented’ SOC model, following standardized procedures is required in this first step.
The Rothamsted soil organic carbon model (RothC; Coleman and Jenkinson, 1996, Chapter 4) is proposed as the standard comparison model in this Technical Manual, for the following reasons:</p>
<ul>
<li>It requires less and more easily obtainable data inputs when compared to other process-oriented models</li>
<li>It has been applied using data from long-term experiments across several ecosystems, climate conditions, soils and land use classes;</li>
<li>It has been successfully applied at national, regional and global scales; e.g. Smith et al. (2005), Smith et al. (2007), Gottschalk et al. (2012), Wiesmeier et al. (2014), Farina et al. (2017), Mondini et al. (2018), Morais et al.(2019);</li>
<li>It (or its modified/derived version) has been used to estimate carbon dioxide emissions and removals in different national GHG inventories as a Tier 3 approach; according to the latest review by Smith et al. (2020): Australia (as part of the FullCam model, Japan (modified RothC), Switzerland, and UK (CARBINE, RothC).</li>
</ul>
<p>The following Chapter describes the RothC model and its general requirements. Users are nevertheless encouraged to use modified versions of the RothC model (e.g. Farina et al., 2013) if it has been demonstrated that these versions improve estimations under local conditions. Users are also encouraged to provide supplementary SOC sequestration maps developed using alternative preferred SOC models and procedures. The use of a multi-model ensemble approach (e.g. Riggers et al, 2019; Lehtonen et al., 2020) with selected models is intended for future versions of the GSOCseq map.</p>
<!--chapter:end:03.SOC_Modelling.rmd-->
</div>
</div>
<div id="the-rothc-model" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> | The RothC model</h1>
<div id="model-description" class="section level2" number="4.1">
<h2 number="4.1"><span class="header-section-number">4.1</span> Model description</h2>
<p>RothC is a model for the turnover of organic carbon in non-waterlogged topsoil that allows for the inclusion of the effects of soil type, temperature, moisture content and plant cover on the turnover process, with a monthly time step (Coleman and Jenkinson, 1996). C sequestration in RothC is quantified solely based on soil processes, and as such it is not linked to a plant production model. The user defines carbon inputs to the soil. SOC is split into four active compartments and one inactive compartment which comprises the inert organic matter (IOM). The four active compartments differ in the mean residence time of organic carbon in the soil and are defined as:</p>
<ul>
<li>Decomposable Plant Material (DPM);</li>
<li>Resistant Plant Material (RPM);</li>
<li>Microbial Biomass (BIO);</li>
<li>Humified Organic Matter (HUM).</li>
</ul>
<p>The structure of the model is shown in Figure 4.1.
The IOM compartment is resistant to decomposition and is calculated using the following equation (Falloon et al., 1998):</p>
<p><span class="math display">\[\begin{equation}
\tag{4.1}
IOM = 0.049 \times SOC^{1.139} 
\end{equation}\]</span></p>
<p>Where <span class="math inline">\(SOC\)</span> is soil organic carbon, t C ha<sup>-1</sup>, and <span class="math inline">\(IOM\)</span> is Inert organic matter, t C ha<sup>-1</sup>.
Incoming carbon inputs are split between DPM and RPM, depending on the DPM/RPM ratio of the particular incoming material. For most agricultural crops and improved grassland, the default DPM/RPM ratio is 1.44, i.e. 59% of the plant material is DPM and 41% is RPM. For unimproved grassland and scrub (including Savanna) a default ratio of 0.67 is used. For a deciduous or tropical woodland a default DPM/RPM ratio of 0.25 is used, i.e. 20% of the plant material is DPM and 80% is RPM.
Both DPM and RPM decompose to form CO2, BIO and HUM. The proportion that goes to CO2 and to BIO + HUM is determined by the clay content of the soil. The BIO + HUM is then split into 46% BIO and 54% HUM. BIO and HUM both decompose to form more CO2, BIO and HUM. Each compartment decomposes by a first-order process with its own characteristic rate. If an active compartment contains Y t C/ha, this declines at the end of the month to:</p>
<p><span class="math display">\[\begin{equation}
\tag{4.2}
Y e^{-abckt} t C ha^-1 
\end{equation}\]</span></p>
<p>where <span class="math inline">\(a\)</span> is the rate-modifying factor for temperature; <span class="math inline">\(b\)</span> is the rate-modifying factor for moisture; <span class="math inline">\(c\)</span> is the soil cover rate-modifying factor; <span class="math inline">\(k\)</span> is the decomposition rate constant for that compartment; and <span class="math inline">\(t\)</span> is 1/12, since <span class="math inline">\(k\)</span> is based on an annual decomposition rate. <span class="math inline">\(Y (1 - e^{-abckt})\)</span> is the amount of the material in a compartment that decomposes in a particular month.
RothC has also been adapted to simulate N and S dynamics (Falloon and Smith, 2009), but nutrient and C dynamics are not interconnected in RothC. It was originally developed and parameterized to model the turnover of organic C in arable topsoil, and it was later extended to model turnover in grasslands, savannas and woodlands, and to operate in different soils and under different climates (Coleman and Jenkinson, 1996).</p>
<div class="figure">
<img src="images/Figure_4.1.png" alt="" />
<p class="caption"><strong>Figure 4.1.</strong> <em>Structure of the pools, and flows of Carbon in the Roth-C model, including major factors controlling the fluxes (a = multiplier for effects of temperature, b = multiplier for effects of moisture, c = multiplier for effects of soil cover; DPM/RPM = Decomposable/resistant plant material ratio). Source: redrawn from Coleman and Jenkinson (1996) and Falloon and Smith (2009).</em></p>
</div>
</div>
<div id="rothc-general-data-requirements" class="section level2" number="4.2">
<h2 number="4.2"><span class="header-section-number">4.2</span> RothC general data requirements</h2>
<p>The model requires climatic, soil and management data that are relatively easy to obtain or estimate. Each modeling unit (e.g. cell of a grid) requires the following minimum data (Table 4.1):</p>
<p><strong>Table 4.1</strong> <em>Roth-C model minimum data requirements</em></p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Climate Data
</th>
<th style="text-align:left;">
Soil Data
</th>
<th style="text-align:left;">
Land Use Management Data
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1.      Monthly rainfall(mm)
</td>
<td style="text-align:left;">
1.      Total initial 0-30cm SOC stocks (t C ha-1)
</td>
<td style="text-align:left;">
1.      Monthly Soil cover (binary: bare vs. vegetated)
</td>
</tr>
<tr>
<td style="text-align:left;">
2.      Average monthly mean air temperature (ºC)
</td>
<td style="text-align:left;">
2.      Initial C stocks of the different pools (t C ha-1): DPM, RPM, BIO, HUM, IOM
</td>
<td style="text-align:left;">
2.      Irrigation (to be added to rainfall amounts)
</td>
</tr>
<tr>
<td style="text-align:left;">
3.      Monthly open pan evaporation (mm)/evapotranspiration (mm)
</td>
<td style="text-align:left;">
3.      Clay content (%) at simulation depth.
</td>
<td style="text-align:left;">
3.      Monthly Carbon inputs from plant residue (aboveground + roots + rhizodeposition), (t C ha-1)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
4.      Monthly Carbon inputs from organic fertilizers and grazing animals’ excretion (t C ha-1)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
5.      DPM/RPM ratio, an estimate of the decomposability of the incoming plant material
</td>
</tr>
</tbody>
</table>
<p>Careful harmonization of modeling procedures, datasets and input estimation methodologies is essential to obtain consistent SOC sequestration results across regions and countries. The general approach and modeling procedures to generate national SOCseq maps using the RothC model are described in Chapter 5. The land use datasets required for the proposed procedures are described in Chapter 6.</p>
<!--chapter:end:04.The_RothC_model.rmd-->
</div>
</div>
<div id="modelling-approach-for-the-gsocseq" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> | Modelling approach for the GSOCseq</h1>
<div id="general-framework" class="section level2" number="5.1">
<h2 number="5.1"><span class="header-section-number">5.1</span> General framework</h2>
<p>SOC sequestration estimates will focus on croplands and grazing lands for the current GSOCseq map version. As defined by IPCC (2006, 2019), croplands include: all annual and perennial crops (cereals, oils seeds, vegetables, root crops and forages); perennial crops (including trees and shrubs, orchards, vineyards and plantations such as cocoa, coffee, tea, oil palm, coconut, rubber trees, bananas, and others), and their combination with herbaceous crops (e.g., agroforestry); arable land which is normally used for cultivation of annual crops, but which is temporarily used for forage crops or grazing as part of an annual crop-pasture rotation (mixed system), is to be included under croplands. Grazing lands include different land uses permanently dedicated to livestock production with a predominant herbaceous cover, including intensively managed permanent pastures and hay land, extensively managed grasslands and rangelands, savannahs, and shrublands.
Since the proposed standardized methodology and the defined model are neither parameterized nor recommended for use on organic, sandy, saline, and waterlogged soils, soils with SOC stocks higher than 200 t C ha<sup>-1</sup>, sand contents higher than 90% and/or electrical conductivity higher than 4 dS m-1 at 0-30 cm depth, paddy rice lands, peatlands and wetlands will be masked out from the global results in this first version.
Excluded conditions and land uses can be included in future versions of the GSOCseq map, as harmonized procedures for specific conditions are developed. Countries are nevertheless encouraged to provide supplementary maps developed using preferred alternative SOC models and methodologies, especially for excluded conditions.</p>
</div>
<div id="potential-soc-sequestration-estimates-after-the-implementation-of-ssm-practices" class="section level2" number="5.2">
<h2 number="5.2"><span class="header-section-number">5.2</span> Potential SOC sequestration estimates after the implementation of SSM practices</h2>
<p>In order to assess the SOC sequestration potential, SOC stocks in 0-30 cm of mineral soils shall be projected using the RothC model over a 20-year period, under business as usual (BAU) land use and management, and after adoption of SSM practices in croplands and grazing lands (See Chapter 2). A 20-year period is assumed to be the default period during which SOC stocks are approaching a new steady state, to be able to compare results among regions and countries, and with other estimation methods (e.g. IPCC, 2006 Tier 1-2; IPCC, 2019). For some systems, it is acknowledged that the new steady state may take much longer, even more than 100 years, depending on soil and climate characteristics (e.g. Poulton et al, 2018). Together with the 20-years projection, countries can project SOC stocks over 50 or 100 years or more, and determine the stocks and the period at which a new steady state is attained according to local conditions, and produce additional sequestration maps (See mandatory and optional products, Technical Specifications, sections 4.1 and 4.2).
As stated in Chapter 2, SOC sequestration potential after the adoption of SSM practices in current agricultural lands shall be estimated by: an ‘absolute SOC sequestration’ (SOCseq abs), expressed as the change in SOC stocks over time relative to a base period (or reference period, t0); and a ‘relative SOC sequestration’ (SOCseq rel), expressed as the change in SOC stocks over time relative to the business as usual scenario. Absolute and relative sequestration and sequestration rates for a 20-year period shall be estimated following the equations described in Chapter 2 (eq. 2.1 and 2.2)</p>
</div>
<div id="business-as-usual-and-sustainable-soil-management-scenarios" class="section level2" number="5.3">
<h2 number="5.3"><span class="header-section-number">5.3</span> Business as usual and sustainable soil management scenarios</h2>
<p>SOC stocks in 0-30 cm of mineral soils in current agricultural lands shall be projected over a 20-year period, under a business as usual scenario (BAU) and under sustainable soil management (SSM) scenarios. The BAU scenario refers to the land use, land management, production practices or technologies that are currently being implemented (as in time = 0, or 2020) in croplands and grazing lands. BAU practices represent typical, prevailing practices in a specific agro-ecological zone and productive system. SSM practices refer to management practices that are expected to remove CO2 from the atmosphere and retain it as SOC, to enhance SOC accumulation, or to mitigate or reverse SOC losses compared to the BAU (See Fig. 2.1). Although there is no universal soil management practice, basic principles are widely applicable, such as those identified in the Voluntary Guidelines for Sustainable Soil Management (VGSSM; FAO, 2017) for increasing soil carbon inputs to soil and enhancing soil organic matter content:</p>
<ul>
<li>increasing biomass production and residue returns to the soil;</li>
<li>using cover crops and/or vegetated fallows;</li>
<li>implementing a balanced and integrated soil fertility management scheme;</li>
<li>implementing crop rotations, combining legumes and pulses with high residue crops, or improving the crop-mix;</li>
<li>effectively using organic amendments, manure, or other carbon-rich wastes (which are not currently applied to soils);</li>
<li>promoting agro-forestry and alley cropping;</li>
<li>managing crop residues and grazing to ensure optimum soil cover; among others.</li>
</ul>
<p>A very wide range of management practices are currently being implemented and can potentially be introduced into the world’s agricultural systems, depending on climatic, soil, socio-cultural and economic conditions. In turn, different SSM C-oriented practices are often combined, making it difficult to dissociate their effects on SOC dynamics. Thus, as a first step, and to harmonize the results on a global map, and because soil carbon turnover models are the most sensitive to carbon inputs (FAO, 2019), these guidelines propose to group SSM practices into three scenarios as a standard method, based on their expected relative effects on C inputs compared to BAU: Low, Medium and High increase in C inputs (referred as SSM1, SSM2, and SSM3 scenarios; for technical procedures, refer to section 5.4). National experts’ opinion and local data are essential to accurately estimate or validate the target areas and carbon input levels for the different SSM scenarios in forthcoming versions.</p>
</div>
<div id="general-modeling-procedures" class="section level2" number="5.4">
<h2 number="5.4"><span class="header-section-number">5.4</span> General modeling procedures</h2>
<p>The modeling approach proposed in the current Technical Manual is based on the studies by Smith et al. (2005; 2006; 2007) and Gottschalk et al. (2012). The following sections describe the different modeling phases of the approach.</p>
<div id="initialization-long-spin-up" class="section level3" number="5.4.1">
<h3 number="5.4.1"><span class="header-section-number">5.4.1</span> Initialization: Long spin-up</h3>
<p>Prior to the simulation of SOC stocks and sequestration under the different scenarios, model initialization is required to set the initial SOC condition (total SOC and partition of the different pools) at the start of the simulation period, and to adjust the C inputs estimates.
In a first initialization step, RothC shall be run iteratively to equilibrium to calculate the size of the SOC pools and the annual plant carbon inputs using constant environmental conditions (Phase 1, Figure 5.1), for each grid cell on the map. A first equilibrium run for a standard 10,000-year period should be performed, considering constant climatic conditions as the average of historic climate data from 1980 to 2000 (see Chapter 6, Climate datasets), clay contents (see Chapter 6, soil datasets), and land use as in year 2000 (see Chapter 6, land use datasets). The duration of the equilibrium run can be reduced if the data suggests that the equilibrium is reached with fewer iterations. The total annual plant C input can be initially assumed to be 1 t C ha<sup>-1</sup> yr<sup>-1</sup>and the proportions of plant material added to the soil for each month are set to describe the typical input pattern for each land use class (Smith et al., 2007; Mondini et al., 2017).
After the first equilibrium run, the annual C input from plant residues needs to be optimized so that the results of the ‘long spin-up’ fit the estimates of total SOC stocks of 0-30 cm provided in the FAO-ITPS GSOCmap. C equilibrium inputs can be adjusted using the following equation (Smith et al., 2005):</p>
<p><span class="math display">\[\begin{equation}
\tag{5.1}
C_{eq}=C_i \times[\frac{SOC_{GSOCmap}-IOM}{(SOC_{sim}-IOM}]                                              
\end{equation}\]</span></p>
<p>where <span class="math inline">\(C_{eq}\)</span> is the estimated annual C input at equilibrium, <span class="math inline">\(C_i\)</span> is the initial annual C addition (the sum of the proportions of the C input in the first equilibrium is 1), <span class="math inline">\(SOC_{GSOCmap}\)</span> is the estimated soil C given in FAO-ITPS GSOC map, <span class="math inline">\(SOC_{sim}\)</span> is the simulated soil C after the first equilibrium run, and <span class="math inline">\(IOM\)</span> is the C content of the inert organic matter fraction in the soil (all in t C ha<sup>-1</sup>). The size of the IOM fraction (t C ha<sup>-1</sup>) can be set according to the equation given by Falloon et al. (1998):</p>
<p><span class="math display">\[\begin{equation}
\tag{5.2}
IOM=0.049 \times SOC_{GSOCmap}^{1.139} 
\end{equation}\]</span></p>
<p>A second long term (minimum 1,000 years) equilibrium run shall be performed using the estimated <span class="math inline">\(C_{eq}\)</span>, (under the same conditions as the first run), in order to obtain the size of the different SOC pools (t C ha<sup>-1</sup>) at year 2000.</p>
</div>
<div id="short-spin-up" class="section level3" number="5.4.2">
<h3 number="5.4.2"><span class="header-section-number">5.4.2</span> Short spin-up</h3>
<p>Since FAO-ITPS GSOC map SOC was generated from individual SOC measurements taken over different decades (i.e. 1960s to 2000s), a temporal harmonization of SOC stocks can be performed as a second initialization step to minimize differences in current SOC stocks at year 0 (i.e. initial SOC stocks at year 2020), and account for climatic variations in the 2000-2020 period:</p>
<ul>
<li>SOC stocks from the GSOC map shall be considered to be the stocks twenty years prior to the simulation (t = -20 yr; i.e. year 2000).</li>
<li>A 20-year ‘short spin-up’ run can be performed to adjust for major deviations among different measurement periods on the GSOC map (figure 5, Phase 2), using year-to-year climatic conditions for the period 2001-2020 (See Chapter 6, Climate datasets), clay contents (See Chapter 6, soil datasets), the stocks in the different SOC pools from the results of the ‘long spin-up’ run, and land use as in year 2020 (land use representative of the period 2001-2020; or yearly land use data shall be used when available).</li>
<li>Year-to-year C inputs over the period 2001-2020 should be adjusted considering year-to-year changes in estimated Net Primary Production (NPP), (details in Chapter 6, monthly carbon inputs). SOC stocks can either increase or decrease during this ‘short spin-up’ stage.</li>
</ul>
<p>This ‘short spin-up’ period is intended to: reduce the effects of different time measurements in the GSOC map (over- or underestimation of current initial SOC stocks); minimize initialization effects (e.g. deviations in the estimation of initial pool sizes); and account for the effects of sub-regional, regional and global climatic and land use changes over the period 2001-2020 and their effects on NPP. If recent (2015-2020) national SOC monitoring campaigns have been undertaken to generate the latest version of the FAO-IPS GSOC map, the SOC stocks from the GSOCmap can be considered as the current stocks (t = 0 y; i.e. year 2020), and the ‘short spin-up’ phase is not required.</p>
</div>
<div id="forward-runs" class="section level3" number="5.4.3">
<h3 number="5.4.3"><span class="header-section-number">5.4.3</span> Forward runs</h3>
<p>After the equilibrium and ‘short spin-up’ runs, SOC sequestration due to SSM practices can be estimated in a forward run (Figure 5.1, phase 3). SOC stocks can be simulated from 2020 (t=0) to 2040 (t = +20) for the BAU and the three SSM scenarios, using average mean monthly climate variables (2001-2020), C inputs adjusted as described in Chapter 6 and land use maps from 2020.
It should be noted that global climatic changes are to be expected over the next 20 years. However, climate change projections diverge significantly in the second half of the century, after the year 2050 (IPCC, 2014; 2018). As there is a lack of consensus over which climate projections to use for future scenarios as well as a significant divergence in terms of climatic trends after 2050, the use of monthly average climatic variables from 2001-2020 for the period 2020-2040 is set as the standard for the forward run. However, the proposed methodology allows for the integration of climate change scenarios, especially for longer-term projections (i.e. + 2050) in future versions.<br />
The absolute SOC sequestration is estimated as the difference between the corresponding SOC stocks from the forward modeling at year +20 (2040) for the different scenarios and the estimated baseline SOC stocks for year 0 (year 2020; refer to equation 2.1). The relative SOC sequestration is to be determined as the difference between the corresponding SOC stocks from the forward at year +20 (2040) for the SSM scenarios and the simulated SOC stocks at year +20 (2020) for the BAU scenario (refer to equation 2.2).</p>
</div>
</div>
<div id="summary" class="section level2" number="5.5">
<h2 number="5.5"><span class="header-section-number">5.5</span> Summary</h2>
<p>The different modeling phases and their data requirements are summarized in in Figure 5.1 and Table 5.1.</p>
<div class="figure">
<img src="images/Figure_5.1.png" alt="" />
<p class="caption"><strong>Figure 5.1.</strong> <em>SOC stocks simulated in the different phases according to the proposed general modeling procedure.</em></p>
</div>
<p><strong>Table 5.1</strong> <em>Summary of the different modeling phases and data requirements.</em></p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Variables
</th>
<th style="text-align:left;">
Phase 1 Long spin up Equilibrium
</th>
<th style="text-align:left;">
Phase 2 Short spin up
</th>
<th style="text-align:left;">
Phase 3 Forward modeling
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Time span
</td>
<td style="text-align:left;">
1,000 years
</td>
<td style="text-align:left;">
20 years
</td>
<td style="text-align:left;">
20 years
</td>
</tr>
<tr>
<td style="text-align:left;">
Climatic inputs
</td>
<td style="text-align:left;">
1980-2000 series monthly average:
</td>
<td style="text-align:left;">
2001-2020 year to year monthly data:
</td>
<td style="text-align:left;">
2001-2020 series monthly average:
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Rain, Temperature, Evaporation/
</td>
<td style="text-align:left;">
Rain, Temperature, Evaporation/
</td>
<td style="text-align:left;">
Rain, Temperature ,Evaporation/
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Evapotranspiration
</td>
<td style="text-align:left;">
Evapotranspiration
</td>
<td style="text-align:left;">
Evapotranspiration
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Soil inputs
</td>
<td style="text-align:left;">
Topsoil clay content
</td>
<td style="text-align:left;">
Topsoil clay content
</td>
<td style="text-align:left;">
Topsoil clay content
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Initial SOC stocks and pools
</td>
<td style="text-align:left;">
Inert organic matter (IOM)  as determined by equation 4
</td>
<td style="text-align:left;">
Inert organic matter (IOM  as determined by equation 4
</td>
<td style="text-align:left;">
Inert organic matter (IOM)  as determined by equation 4
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
“= 0” for all other fractions
</td>
<td style="text-align:left;">
Other fractions equal to the  final SOC pools modeled in  phase 1
</td>
<td style="text-align:left;">
Other fractions equal to the  final SOC pools modeled in  phase 2
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Carbon inputs
</td>
<td style="text-align:left;">
First run : 1tC.ha-1
</td>
<td style="text-align:left;">
NPP
</td>
<td style="text-align:left;">
NPP year-to year
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Second run: Adjusted C inputs from equation 3
</td>
<td style="text-align:left;">
year-to year adjusted C inputs, from equation 7
</td>
<td style="text-align:left;">
adjusted C inputs for the BAU, from equation 7
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Estimated from % increase vs. 
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
BAU for SSM scenarios
</td>
</tr>
<tr>
<td style="text-align:left;">
Vegetation cover
</td>
<td style="text-align:left;">
Monthly cover determined: by expert opinion, NDVI 2000-2020 or preferred spectral index (see section 3.3.4)
</td>
<td style="text-align:left;">
Monthly cover determined: by expert opinion, NDVI 2000-2020 or preferred spectral index (see section 3.3.4)
</td>
<td style="text-align:left;">
Monthly cover determined: by expert opinion, NDVI 2000-2020 or preferred spectral index (see section 3.3.4)
</td>
</tr>
<tr>
<td style="text-align:left;">
Land Use
</td>
<td style="text-align:left;">
Representative land use of the 1980-2000 period (or layer for year 2000; or best available layer)
</td>
<td style="text-align:left;">
Year to year Land use 2000-2020 (or representative land use of the period; or best available layer)
</td>
<td style="text-align:left;">
Last available land use layer (e.g. 2015, 2018; 2020) (or best available layer)
</td>
</tr>
<tr>
<td style="text-align:left;">
Modeled Scenarios
</td>
<td style="text-align:left;">
BAU
</td>
<td style="text-align:left;">
BAU
</td>
<td style="text-align:left;">
BAU
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
SSM Low
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
SSM Medium
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
SSM High
</td>
</tr>
<tr>
<td style="text-align:left;">
Expected Results
</td>
<td style="text-align:left;">
C inputs at equilibrium
</td>
<td style="text-align:left;">
Total SOC and SOC pools at year t=0 (2020)
</td>
<td style="text-align:left;">
Total SOC and SOC pools at year t=+20 (2040) for the BAU, and SSMs scenarios
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Total          SOC and SOC pools at year t= -20 (2000)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Absolute and relative Total Sequestration (3 SSMs)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Absolute and relative Sequestration rates (3 SSMs)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<p>The different datasets required to run the RothC model for the different modeling phases are described in Chapter 6.</p>
<!--chapter:end:05.Modelling_approach_for_the_GSOCseq.rmd-->
</div>
</div>
<div id="data-sets-and-inputs" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> | Data sets and inputs</h1>
<p>A careful harmonization of data sets and input estimation procedures is essential to obtain consistent results across regions and countries. This Chapter describes the required data sets, the potential data sources and the methodologies to estimate required inputs for the modeling approach described in Chapter 5. Procedures for the preparation and harmonization of input data are explained in Chapter 9.</p>
<div id="climate-data-sets" class="section level2" number="6.1">
<h2 number="6.1"><span class="header-section-number">6.1</span> Climate data sets</h2>
<p>Gridded climate data shall be obtained from:</p>
<p>a.) National Sources or a preferred regional data source;<br />
b.) Global data sets, when national or regional gridded historical climate data sets are not available.</p>
<p>The dataset provided by the Climate Research Unit (CRU), developed by the University of East Anglia, United Kingdom (Harris et al., 2014) at a resolution of 0.5<span class="math inline">\(^\circ\)</span> (~50x50 km) was initially recommended to be used as the standard global data set if national or regional gridded data is not available, or if the available national data is at a coarser resolution.
To overcome limitations linked to the coarse resolution of the CRU products, the latest version of this Technical Manual has identified and recommends the TerraClimate dataset as an improved global alternative.
Since the map production phase for the implementation of the GSOCseq was initiated prior to the identification of the TerraClimate data set, this version of the Technical manual still presents both data sets (CRU and TerraClimate) as viable global options.</p>
<p>The CRU 2019 dataset (CRU TS v. 4.03) covers the period 1901-2018, including precipitation (pre), average/minimum and maximum air temperatures (tmp, tmn, tmx), cloud cover percentage (cld), diurnal temperature range (dtr), vapor pressure (vap), number of rainy days (wet), frost days (frs), and potential evapotranspiration (pet); (See Table 6.2, data sets and download sources).<br />
TerraClimate is a data set of monthly climate and climatic water balance for global terrestrial surfaces from 1958-2019. It has a monthly temporal resolution, a ~4x4 km spatial resolution and was created by combining high-spatial resolution climatological normals from the WorldClim data set, with coarser spatial resolution, but time-varying data from CRU Ts4.0 and the Japanese 55-year Reanalysis (JRA55) (Abatzoglou et al., 2018).</p>
<p>The following variables and data sets are required to run the model (See Chapter 5, General modeling procedures):</p>
<ul>
<li>Monthly average air temperature (<span class="math inline">\(^\circ\)</span>C),</li>
<li>Monthly precipitation (mm),</li>
<li>Monthly potential evapotranspiration (Penman-Monteith; mm)</li>
<li>data sets: 1981-1990 (series average); 1991-2000 (series average); 2011-2010 (year to year); 2011-2018 (year to year).</li>
</ul>
<p>The same data sources must be used in all modeling phases.</p>
</div>
<div id="soil-data-sets" class="section level2" number="6.2">
<h2 number="6.2"><span class="header-section-number">6.2</span> Soil data sets</h2>
<div id="initial-total-soc-stocks" class="section level3" number="6.2.1">
<h3 number="6.2.1"><span class="header-section-number">6.2.1</span> Initial total SOC stocks</h3>
<p>Initial total SOC stocks to 30cm depth (in t C ha<sup>-1</sup>) are to be derived from the GSOCmap (30 arc seconds; ~ 1km x 1km resolution grid), latest revised version (FAO-ITPS, 2019). Countries wishing to include an updated or improved estimate of current SOC stocks, compared to the latest version of the GSOCmap, are encouraged to submit their updated national SOCmap to the GSP Secretariat and use it for modeling.
Since the GSOCmap was generated from national measurements taken between the 1960s and the 2000s, and no temporal corrections have been developed in many countries, GSOCmap values will represent SOC stocks for the year 2000. A ‘short spin-up’ model run (20 years) with climate variables and management forcing for the period 2000-2020 shall be performed to reduce the effect of temporal deviations. Thus, the simulated SOC content at 2020 after the ‘short spin-up’ run will represent the initial SOC stocks prior to implementation of SSM practices (See Chapter 6, General modeling procedures). If recent national SOC monitoring campaigns (2015-2020) have been undertaken to generate the latest version of the FAO-IPS GSOC map, the SOC stocks from the GSOCmap can be considered as the current stocks (t = 0 y; i.e. year 2020), and the ‘short spin-up’ phase is not required.</p>
</div>
<div id="initial-c-pools" class="section level3" number="6.2.2">
<h3 number="6.2.2"><span class="header-section-number">6.2.2</span> Initial C pools</h3>
<p>The initial C stocks in the different pools (in t C ha<sup>-1</sup>) considered in the RothC model (DPM, RPM, BIO, HUM and IOM, Fig. 4.1) shall be estimated following the ‘long spin-up’ and ‘short spin-up’ procedure described in Chapter 6.</p>
</div>
<div id="soil-texture-clay-content" class="section level3" number="6.2.3">
<h3 number="6.2.3"><span class="header-section-number">6.2.3</span> Soil texture: clay content</h3>
<p>The average clay contents over 0-30 cm depth is to be obtained from gridded data (raster format) from:</p>
<ul>
<li>national Sources (1 km x 1 km resolution);</li>
<li>global data sets, where national or regional data sets are not available.</li>
</ul>
<p>The topsoil clay content (0-30 cm, % mass fraction; 1 x 1 km resolution) from the Harmonized World Soil Database (HWSD) or SoilGrids developed by the- International Soil Reference and Information Centre (ISRIC) (see Table 6.2) shall be used as the standard global database if national or regional data is not available in the required format or resolution. Clay content can be averaged at finer resolutions to obtain 1 x 1 km grids. However, countries are encouraged to produce their own texture and clay content maps to be used as inputs for the SOCseq map, following the digital soil mapping approaches described in the GSOCmap Cookbook (FAO, 2018).
Average clay contents over a 0-30 cm depth interval can be derived by taking a weighted average of the predictions over the depth interval using numerical integration (Hengl et al., 2017).</p>
<p><span class="math display">\[\begin{equation}
\tag{6.1}
\frac{1}{b-a} \int_{a}^{b} f(x) dx \approx \frac{1}{(b-a)} \frac{1}{2} \sum_{k=1}^{N-1}(x_{k+1} - x_{k})(f(x_{k}) + f(x_{k +1})) 
\end{equation}\]</span></p>
<p>where N is the number of depths; b is 30 cm, a is 0 cm, xk is the k-th depth and f(xk) is the value of the target variable (i.e., clay content) at depth xk. For example, for the 0-30 cm depth interval, with soil clay values at the first four standard depths (0, 5, 15 and 30 cm) equal to 14.5, 25.0, 25.3 and 25.0, clay content 0-30 cm equals:</p>
<p><span class="math display">\[\begin{equation}
\tag{6.2}
    \frac{(5-0) \times(14.5+25.0)+(15-5) \times(25.0 + 25.3) + (30 - 15) \times (25.3 + 25.0)} {30\times 0.5} = 24.25
\end{equation}\]</span></p>
</div>
</div>
<div id="land-cover-data-sets" class="section level2" number="6.3">
<h2 number="6.3"><span class="header-section-number">6.3</span> Land cover data sets</h2>
<p>The gridded land cover data layers shall be obtained from:</p>
<ul>
<li>national or regional sources;</li>
<li>global data sets, where national or regional land use or land cover data sets are not available.</li>
</ul>
<p>Since land cover may vary substantially between data sources and estimates of past and current land cover may have important deviations from real land cover and land use, users should estimate land use from the source that best reflects national and subnational conditions. Land cover data sets should cover the 2000-2020 (or approximate) period.
The ESA (European Space Agency) land cover Global dataset (See Table 6.2), and its reclassification into FAO Global Land Cover - SHARE (GLC-SHARE; See Table 6.2) classes will be provided by the GSP Secretariat, if no national land use dataset is available. However, users should estimate land use from the source that best reflects national and subnational conditions. Other global and regional data sets are provided in Table 6.2 at the end of this Chapter.
The land cover classes will affect the decomposability of the incoming plant material (DPM/RPM ratio; See Section 6.6). A spatialized R-version of RothC is provided by the GSP Secretariat (See Chapter 7, software environment) and runs considering the 13 classes defined in the FAO Global Land Cover - SHARE (GLC-SHARE). A default DPM/RPM value is assigned to each class (Table 6.1). Thus, when using this spatialized R-version of RothC without modifying its scripts, the land use classes from the possible different data sets need to be re-classified into FAO Global Land Cover - SHARE (GLC-SHARE) land use classes. However, users can model alternative land use classes, and modify these default DPM/RPM values. If so, modifications in the R-version must be then introduced (See Chapter 7). Examples of land cover reclassification from the ESA land cover database into the RothC land use categories are presented (Table 6.4) at the end of this Chapter.</p>
<p><strong>Table 6.1</strong> <em>FAO Land cover classes, land cover number and default DPM/RPM ratios. An extra land use class (*Tree-crops) is shown as an example of the disaggregation of a land use class.</em></p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
FAO Land aggregated cover class
</th>
<th style="text-align:right;">
Land Cover code number
</th>
<th style="text-align:left;">
Default DPM RPM ratio
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Artificial surfaces
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
/
</td>
</tr>
<tr>
<td style="text-align:left;">
Cropland
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
1.44
</td>
</tr>
<tr>
<td style="text-align:left;">
Grassland
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree covered
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
0.25
</td>
</tr>
<tr>
<td style="text-align:left;">
Shrub covered
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
Herbaceous vegetation
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
Mangroves
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
/
</td>
</tr>
<tr>
<td style="text-align:left;">
Spare vegetation
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
Bare soil
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
/
</td>
</tr>
<tr>
<td style="text-align:left;">
Snow and Glaciers
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
/
</td>
</tr>
<tr>
<td style="text-align:left;">
Water bodies
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
/
</td>
</tr>
<tr>
<td style="text-align:left;">
Cropland-Tree crops*
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
1.44
</td>
</tr>
<tr>
<td style="text-align:left;">
Paddy fields
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
1.44
</td>
</tr>
</tbody>
</table>
<p>As a minimum, land use for the year 2000 and land use for the year 2020 (or last available year) at 1x1 km resolution shall be defined. The predominant land use category in each cell of the 1x1 km grid shall be selected if finer resolutions are available.</p>
</div>
<div id="monthly-vegetation-cover" class="section level2" number="6.4">
<h2 number="6.4"><span class="header-section-number">6.4</span> Monthly vegetation cover</h2>
<p>It is required to indicate the approximate annual distribution of monthly vegetation cover for the simulations in order to:</p>
<ul>
<li>adjust the topsoil moisture deficit estimations (See Chapter 4, Fig. 4.1);</li>
<li>consider the effects of soil cover on SOC decomposition rates (See Chapter 4, Fig.4.1).</li>
</ul>
<p>The annual distribution of vegetation cover can be derived from:</p>
<ul>
<li>public statistics of national and/or administrative units considering the predominant agricultural systems in a temporal series (2000-2020);</li>
<li>derived from NDVI (normalized difference in vegetation index) values from historic satellite images (See data sets, Table 6.2).</li>
</ul>
<p>The occurrence of plant cover can be assumed to be constant in grasslands, shrublands and savannas and during specific months (e.g. 1-6 months for croplands) (e.g. Smith et al., 2005; Smith et al., 2007). The following coefficients can be set for based on the specific land cover and/or land use:</p>
<ul>
<li>Perennial tree-crops, forests and grasslands (c=0.6);</li>
<li>Months with predominantly bare soil and unvegetated fallows (c=1);</li>
<li>Annual crops (c=0.6).</li>
</ul>
<p>Considering a temporal series (2000-2020), the proportion of images with NDVI values greater than a specified threshold, indicating active vegetation growth, can be estimated (e.g. NDVI &gt; 0.6). The monthly probability of being vegetated (P veg) can be estimated for each cell grid and each month of the year (1-12), as:</p>
<p><span class="math display">\[\begin{equation}
\tag{6.3}
P_{veg} = \frac{Number\ of \ images \ NDVI &gt; 0.6}{Total \ images}  
\end{equation}\]</span></p>
<p>NDVI is proposed as an alternative for estimating vegetation cover when no vegetation cover data or local knowledge is available. The proposed threshold may vary according to local conditions. Global monthly vegetation cover data sets estimated by NDVI (2000-2020) will be provided by the GSP Secretariat. However, NDVI may be a biased indicator in areas with low vegetation cover (e.g. drylands, shrublands), or high nubosity. In these cases, countries are encouraged to use other locally validated spectral indices to accurately estimate monthly vegetation cover (e.g. Multi Sensor Vegetation Index; Moradizadeh and Saradjian, 2016).</p>
</div>
<div id="monthly-carbon-inputs" class="section level2" number="6.5">
<h2 number="6.5"><span class="header-section-number">6.5</span> Monthly carbon inputs:</h2>
<div id="c-inputs-under-bau-practices" class="section level3" number="6.5.1">
<h3 number="6.5.1"><span class="header-section-number">6.5.1</span> C inputs under BAU practices:</h3>
<p>Carbon inputs for the BAU scenarios shall be estimated using the approach proposed by Smith et al. (2005; 2006; 2007) and Gottschalk et al. (2012). Total plant C inputs to the soil, which include plant litter, root exudates and fine root turnover, are rarely known. To overcome this problem, RothC shall be run in ‘equilibrium mode’ to calculate the initial plant carbon inputs to the soil (or ‘equilibrium Carbon inputs’, Ceq), which led to the initial SOC stocks (GSOCmap), under historic forcing conditions. The Ceq thus represents the historical average of annual carbon input of the BAU scenario up to the year 2000. For further details on the equilibrium run and initialization to estimate Ceq, refer to section 3.2 (General modeling procedures).
Once these initial carbon inputs have been established (from the year 2000 onwards), year-to-year changes can be adjusted in accordance with changes in Net Primary Production (NPP), as changes in C inputs to the soil are assumed to be associated with changes in NPP (Smith et al., 2005). Thus, annual C inputs for the BAU scenario can be adjusted as:</p>
<p><span class="math display">\[\begin{equation}
\tag{6.4}
BAU_{Ct} = C_{t-1} \times (NPP_{t-1})-1 \times NPP_t
\end{equation}\]</span></p>
<p>where <span class="math inline">\(BAU_{Ct}\)</span> is the annual carbon input of a specific year <span class="math inline">\(t\)</span>; <span class="math inline">\(C_{t-1}\)</span> is the annual carbon input of the previous year; <span class="math inline">\(NPP_t\)</span> is the net primary production of year <span class="math inline">\(t\)</span>, and <span class="math inline">\(NPP-t\)</span> is the NPP of the previous year (in tC ha<sup>-1</sup>). Thus, the average NPP over the initialization period shall be associated with Ceq and the annual C inputs for the BAU scenario can be adjusted as:
<span class="math display">\[\begin{equation}
\tag{6.5}
BAU_{Ct \ 2001} = C_{eq} \times NPP_{1980-2000}^{-1} \times NPP_{2001}                                                 
\end{equation}\]</span></p>
<p>where <span class="math inline">\(BAU_{Ct \ 2001}\)</span> is the annual carbon input for the first year of the ‘short spin-up’ phase; <span class="math inline">\(C_{eq}\)</span> is the estimated annual C input at equilibrium derived through the ‘long spin-up’ process; <span class="math inline">\(NPP_{1980-2000}\)</span> is the estimated average net primary production over the initialization period (1980-2000); and <span class="math inline">\(NPP_{2001}\)</span> is the estimated annual net primary production for the first year of the ‘short spin-up’ phase. The annual C inputs for the BAU scenario can be then adjusted following equation 7, according to changes in the NPP.
The estimation of NPP using the MIAMI model (Lieth, 1975) is defined as the standard method in this document. It requires little input and is easily applicable worldwide, can be used to estimate NPP under future climatic conditions, and can act as a baseline for different NPP data sets or projections (e.g. Gottschalk et al., 2012). NPP estimated with the MIAMI model is computed with the following equations:</p>
<p><span class="math display">\[\begin{equation}
\tag{6.6}
NPP_{MIAMI}= min(NPP_T , NPP_P)                                                                       
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\tag{6.7}
NPPT_{MIAMI}= \frac{3000}{1 + e^{1.315-0.119} \times T}  
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\tag{6.8}
NPPP_{MIAMI} = 3000 \times 1 - e^{-0.000664P} 
\end{equation}\]</span></p>
<p>where <span class="math inline">\(NPP\)</span> is the climatic net primary production in dry matter (DM; g m<sup>-2</sup> yr<sup>-1</sup>), <span class="math inline">\(NPP_T\)</span> is the temperature dependency term of NPP, where <span class="math inline">\(T\)</span> is the annual mean temperature (<span class="math inline">\(^\circ\)</span>C) and <span class="math inline">\(NPP_P\)</span> is the moisture dependency term of NPP, where P is the mean annual sum of precipitation (mm). NPP is limited by either temperature or precipitation. MIAMI model NPP can be expressed in t C ha<sup>-1</sup> yr<sup>-1</sup> as:</p>
<p><span class="math display">\[\begin{equation}
\tag{6.9}
NPP_{MIAMI} \ tC ha^1 yr^{-1} = NPP_{MIAMI} (DM; g m^{-2} yr^{-1}) \times 0.01 \times 0.48                  
\end{equation}\]</span></p>
<p>The annual NPPMIAMI shall be estimated for each grid cell from the climatic data sets described in section 6.1 for the different simulation periods (1981-1990; 1991-2000; 2001-2010; 2011-2020; 2021-2040). The NPPMIAMI is used to estimate BAU carbon inputs under current and projected climatic conditions.
The change in NPP is used as a surrogate for estimating the change in C input and assumes that a similar proportion remains in the field (e.g. Smith et al., 2005; Gottschalk et al., 2012). In a first instance, countries should focus on C inputs in agricultural lands in 2020, the use of which has not changed since the year 2000. Changes in land use and management over the period 2000-2020 and associated changes in C inputs can nevertheless be taken into account, if trends in biomass removal are known, in order to adjust C inputs (e.g. Schulze et al., 2010; Plutzar et al., 2016; Neumann and Smith, 2018). Thus, the annual changes in C inputs by equations 7 and 8 can be adjusted using annual land cover data. For example, by assuming and approving an NPP of 12, 28 and 47% for forests, grasslands and croplands (Schulze et al., 2010), the annual NPP of a specific year (NPPt) can be adjusted using these coefficients (equations 6.9 to 6.11), and the annual C inputs can then be estimated by equations 6.3 and 6.4:</p>
<p><span class="math display">\[\begin{equation}
\tag{6.10}
NPPt_{forests} = NPP_{MIAMI} \times 0.88                 
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\tag{6.11}
NPPt_{grasslands} = NPP_{MIAMI} \times 0.72 
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\tag{6.12}
NPPt_{croplands} = NPP_{MIAMI} \times 0.53
\end{equation}\]</span></p>
</div>
<div id="c-inputs-under-ssm-practices" class="section level3" number="6.5.2">
<h3 number="6.5.2"><span class="header-section-number">6.5.2</span> C inputs under SSM practices:</h3>
<p>SSM practices shall be grouped into three scenarios as a standard method, based on their expected relative effects on C inputs compared to BAU: Low, Medium and High C inputs. The SSM practices considered in this approach are practices that affect C inputs to the soil, as changes in C inputs have been identified as one of the factors to which models are most sensitive when projecting changes in SOC stocks (FAO, 2019).
As with estimates of BAU C inputs, total plant C inputs to the soil, including plant litter, root exudates and fine root turnover, are rarely known. Thus, C inputs of SSM scenarios will represent a % increase from BAU C inputs:</p>
<p><span class="math display">\[\begin{equation}
\tag{6.13}
    \Delta \% CSSM-BAU = (Cinputs_{SSM} - Cinputs_{BAU}) \times Cinputs_{BAU}
\end{equation}\]</span></p>
<p>As a standard, the expected effects (% increase in C inputs) of 3 scenarios have been conservatively set at:</p>
<ul>
<li>Low: 5 % increase in C inputs</li>
<li>Medium: 10% increase C inputs</li>
<li>High: 20 % increase in C inputs</li>
</ul>
<p>These percentages (based on Smith, 2004; Wiesmeier et al., 2016) shall be used to produce the mandatory maps for the global product. An additional ‘High increase’ scenario, considering a 30% increase in C inputs, can be modeled, to compare results with recent ‘top-down’ modeling approaches (e.g. CIRCASA).
The use of default percentages in C input increase can be applied globally without complex configuration. However, countries should carefully check whether these scenarios are reasonable and under what type of management practices they are achievable. Countries are encouraged to produce and provide additional maps, taking into account their own estimates of the effects of different selected practices or land use changes, based on expert knowledge and local capacities. These effects can be determined on the basis of expert opinion and available information at the country level. A meta-analysis should be conducted based on the latest available local and regional studies to estimate how agricultural practices affect average annual C inputs (and the % increase in C input compared to BAU practices). These practices may include, for example, the use of cover crops, rotation with high residue yielding crops or perennials, residue retention, grazing management, plant nutrition, species introduction, manure or organic amendment application, among others. If no data is directly provided in the compiled studies, carbon inputs and % increase in C inputs relative to BAU practices shall be estimated considering the framework proposed by Bolinder et al. (2007).
The annual C inputs required to model the effects of SSM practices under 3 scenarios (Low, Medium, High) for each modeling unit (i.e. grid cells) shall be estimated from the annual BAU C inputs:</p>
<p><span class="math display">\[\begin{equation}
\tag{6.14}
SSM_{Ct} t C ha^-1 yr^-1 = BAU_{Ct} + \% \Delta CSSM_i - BAU \times  BAU_{Ct}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(SSM_{Ct}\)</span> represents the estimated annual C inputs for a specific scenario (<span class="math inline">\(i\)</span> =Low, Medium, High) for year <span class="math inline">\(t\)</span>; <span class="math inline">\(BAU_{Ct}\)</span> represents the estimated annual C inputs for the BAU scenario for year t (determined from C inputs at equilibrium, as explained at the beginning of this section and in Chapter 5), and
<span class="math inline">\(\% \Delta CSSM_i - BAU\)</span> is the representative % increase in C inputs for a specific scenario (<span class="math inline">\(i\)</span>=Low, Medium, High).</p>
</div>
</div>
<div id="residue-decomposability-decomposable-to-resistant-plant-material-ratio-dpmrpm" class="section level2" number="6.6">
<h2 number="6.6"><span class="header-section-number">6.6</span> Residue decomposability: decomposable to resistant plant material ratio (DPM/RPM)</h2>
<p>Default values for the DPM/RPM ratio (decomposability of incoming plant material) can be used (e.g. 1.44 for crops and improved grasslands; 0.67 for unimproved grasslands and shrublands, and 0.25 for forests, woodlands and tree crops; Falloon and Smith, 2009). Table 6.1 (Land cover data sets) show default DPM/RPM for FAO land use classes. These default values can be modified according to region-specific data and local knowledge.</p>
</div>
<div id="required-data-sets-and-global-data-sources.-summary" class="section level2" number="6.7">
<h2 number="6.7"><span class="header-section-number">6.7</span> Required data sets and global data sources. Summary</h2>
<p>The required data sets described in this chapter are summarized in Table 6.2. The proposed regional and global data sources to obtain the required input data when no quality national or regional data is available are described in Table 6.3.</p>
<strong>Table 6.2</strong> <em>Summary of the input data requirements for the proposed modeling approach to generate national SOCseq maps</em>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Data
</th>
<th style="text-align:left;">
Variables
</th>
<th style="text-align:left;">
Time series
</th>
<th style="text-align:left;">
Units
</th>
<th style="text-align:left;">
Type
</th>
<th style="text-align:left;">
Resolution
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Climatic data
</td>
<td style="text-align:left;">
Monthly air temperature
</td>
<td style="text-align:left;">
1980-2000; 2001-2020
</td>
<td style="text-align:left;">
°C
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
50 x 50 km or finer
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(or until last year available)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Monthly evapotranspiration/pan evaporation
</td>
<td style="text-align:left;">
1980-2000; 2001-2020
</td>
<td style="text-align:left;">
mm
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
50 x 50 km or finer
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(or until last year available)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Monthly precipitation + irrigation
</td>
<td style="text-align:left;">
1980-2000; 2001-2020
</td>
<td style="text-align:left;">
mm
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
50 x 50 km or finer
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(or until last year available)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Soil data
</td>
<td style="text-align:left;">
Topsoil clay content (0-30 cm)
</td>
<td style="text-align:left;">
<ul>
<li></td>
<td style="text-align:left;">
%
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
1 x 1 km
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Current Soil organic carbon stocks (0-30 cm)
</td>
<td style="text-align:left;">
Latest version of national FAO-GSOC map
</td>
<td style="text-align:left;">
tC ha-1
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
1 x 1 km
</td>
</tr>
<tr>
<td style="text-align:left;">
Land use/cover
</td>
<td style="text-align:left;">
Predominant land use/cover, re-classified into:
</td>
<td style="text-align:left;">
Minimum: 2000 and 2020 (or last year available)
</td>
<td style="text-align:left;">
01-mar
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
1 x 1 km
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Minimum: 3 default classes required by model: agricultural crops, grassland/shrubland/savannas and forestry
</td>
<td style="text-align:left;">
Optimum: annual land use 2000 to 2020
</td>
<td style="text-align:left;">
01-nov
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Optimum: 13 classes defined in the FAO Global Land Cover - SHARE (GLC-SHARE)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Monthly vegetation cover.
</td>
<td style="text-align:left;">
Minimum: average 2000- 2020 (or last year available) Optimum: annual land use 2000 to 2020
</td>
<td style="text-align:left;">
0-1
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
1 x 1 km
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Obtained from national statistics/local expert knowledge; or derived from NDVI or spectral indexes (see section 3.3.4)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table></li>
</ul>
<p><strong>Table 6.3</strong> <em>Global and regional data sources to generate national SOCseq maps</em></p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Type
</th>
<th style="text-align:left;">
Source
</th>
<th style="text-align:left;">
Address
</th>
<th style="text-align:left;">
Resolution
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Climatic monthly data
</td>
<td style="text-align:left;">
CRU – Climate Research Unit , University of East Anglia
</td>
<td style="text-align:left;">
<a href="https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.03/cruts.1905011326.v4.03/" class="uri">https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.03/cruts.1905011326.v4.03/</a>
</td>
<td style="text-align:left;">
4 km x 4 km
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
TerraClimate
</td>
<td style="text-align:left;">
<a href="https://developers.google.com/earth-engine/datasets/catalog/IDAHO_EPSCOR_TERRACLIMATE" class="uri">https://developers.google.com/earth-engine/datasets/catalog/IDAHO_EPSCOR_TERRACLIMATE</a>
</td>
<td style="text-align:left;">
51 km x 50 km
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
SOC stocks 0-30 cm
</td>
<td style="text-align:left;">
GSOCmap - FAO-ITPS
</td>
<td style="text-align:left;">
<a href="http://54.229.242.119/GSOCmap/" class="uri">http://54.229.242.119/GSOCmap/</a>
</td>
<td style="text-align:left;">
1 x 1 km
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Soil Texture
</td>
<td style="text-align:left;">
Harmonized World Soil Database v1.2
</td>
<td style="text-align:left;">
<a href="http://www.fao.org/soils-portal/" class="uri">http://www.fao.org/soils-portal/</a>
</td>
<td style="text-align:left;">
1 km (30 arc seconds by 30 arc seconds)
</td>
</tr>
<tr>
<td style="text-align:left;">
Soil Texture
</td>
<td style="text-align:left;">
OpenGeoHub Foundation - OpenLandMap
</td>
<td style="text-align:left;">
<a href="https://doi.org/10.5281/zenodo.1476854" class="uri">https://doi.org/10.5281/zenodo.1476854</a>
</td>
<td style="text-align:left;">
250m
</td>
</tr>
<tr>
<td style="text-align:left;">
Soil texture, including uncertainties
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<a href="http://soilgrids.isric.org" class="uri">http://soilgrids.isric.org</a>
</td>
<td style="text-align:left;">
250 m
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Soil Grids -ISRIC
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
NDVI- Historic images (2001-2020) every 16 days
</td>
<td style="text-align:left;">
MODIS - MOD13A2 datasets
</td>
<td style="text-align:left;">
<a href="https://lpdaac.usgs.gov/products/mod13a2v006/" class="uri">https://lpdaac.usgs.gov/products/mod13a2v006/</a>
</td>
<td style="text-align:left;">
1 x 1km
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Land Cover
</td>
<td style="text-align:left;">
MODIS
</td>
<td style="text-align:left;">
<a href="https://modis.gsfc.nasa.gov/data/dataprod/mod12.php" class="uri">https://modis.gsfc.nasa.gov/data/dataprod/mod12.php</a>
</td>
<td style="text-align:left;">
500 x 500m
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Land Cover Dynamics MCD12Q2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
1 x 1 km
</td>
</tr>
<tr>
<td style="text-align:left;">
Land Cover
</td>
<td style="text-align:left;">
European Space Agency (ESA) Climate Change Initiative (CCI)- Copernicus Climate Change Service (C3S)
</td>
<td style="text-align:left;">
<a href="https://www.esa-landcover-cci.org/" class="uri">https://www.esa-landcover-cci.org/</a>
</td>
<td style="text-align:left;">
300 x 300m
</td>
</tr>
<tr>
<td style="text-align:left;">
Land Cover – Land Use
</td>
<td style="text-align:left;">
FAO. Global Land Cover SHARE
</td>
<td style="text-align:left;">
<a href="http://www.fao.org/land-water/land/land-governance/land-resources-planning-toolbox/category/details/en/c/1036355/" class="uri">http://www.fao.org/land-water/land/land-governance/land-resources-planning-toolbox/category/details/en/c/1036355/</a>
</td>
<td style="text-align:left;">
~1 x 1km
</td>
</tr>
<tr>
<td style="text-align:left;">
Land Cover
</td>
<td style="text-align:left;">
USGS Global Land Survey
</td>
<td style="text-align:left;">
<a href="https://lta.cr.usgs.gov/GLS" class="uri">https://lta.cr.usgs.gov/GLS</a>
</td>
<td style="text-align:left;">
30 x 30m
</td>
</tr>
<tr>
<td style="text-align:left;">
Land Cover
</td>
<td style="text-align:left;">
CORINE land cover (Europe only)
</td>
<td style="text-align:left;">
<a href="https://land.copernicus.eu/pan-european/corine-land-cover" class="uri">https://land.copernicus.eu/pan-european/corine-land-cover</a>
</td>
<td style="text-align:left;">
100 x 100 m
</td>
</tr>
</tbody>
</table>
<strong>Table 6.4</strong> <em>Land cover aggregation schemes into RothC land use classes. Example from ESA</em>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
ESA Land Cover Class
</th>
<th style="text-align:right;">
ESA class Number
</th>
<th style="text-align:left;">
RothC Land Use type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Cropland rainfed
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Agricultural crops/improved grassland
</td>
</tr>
<tr>
<td style="text-align:left;">
Cropland rainfed herbaceous cover
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Agricultural crops/improved grassland
</td>
</tr>
<tr>
<td style="text-align:left;">
Mosaic Cropland &gt; 50%
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
Agricultural crops/improved grassland
</td>
</tr>
<tr>
<td style="text-align:left;">
Cropland - Tree/shrub cover
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Cropland irrigated flooding
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
Waterlogged soils
</td>
</tr>
<tr>
<td style="text-align:left;">
Grasslands
</td>
<td style="text-align:right;">
130
</td>
<td style="text-align:left;">
-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Mosaic Natural vegetation herbaceous &gt; 50% /cropland
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:left;">
Unimproved grassland and scrub (including Savanna)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mosaic herbaceous cover &gt;50%/trees-shrubs
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:left;">
Agricultural crops/improved grassland
</td>
</tr>
<tr>
<td style="text-align:left;">
Shrubland
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:left;">
Unimproved grassland and scrub/ Savanna
</td>
</tr>
<tr>
<td style="text-align:left;">
Shrubland evergreen
</td>
<td style="text-align:right;">
121
</td>
<td style="text-align:left;">
Unimproved grassland and scrub/ Savanna
</td>
</tr>
<tr>
<td style="text-align:left;">
Shrubland deciduous
</td>
<td style="text-align:right;">
122
</td>
<td style="text-align:left;">
Unimproved grassland and scrub/ Savanna
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover broadleaved deciduous open 15-40%
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:left;">
Unimproved grassland and scrub/ Savanna
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover needle leaved deciduous open 15-40%
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:left;">
Unimproved grassland and scrub/ Savanna
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover broadleaved evergreen closed to open &gt;15%
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:left;">
Unimproved grassland and scrub/ Savanna
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover broadleaved deciduous closed to open &gt;15%
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover broadleaved deciduous closed &gt;40%
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover needle leaved evergreen closed to open &gt;15%
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover needle leaved evergreen closed &gt;40%
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover needle leaved evergreen open &gt;40%
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover needle leaved deciduous closed to open &gt;15%
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover needle leaved deciduous closed &gt;40%
</td>
<td style="text-align:right;">
81
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover mixed leave type
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Mosaic tree-shrub &gt;50%/herbaceous cover
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Shrub or herbaceous flooded fresh/saline/brackish water
</td>
<td style="text-align:right;">
180
</td>
<td style="text-align:left;">
Forest/Deciduous/tropical woodland
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover flooded fresh or brackish water
</td>
<td style="text-align:right;">
160
</td>
<td style="text-align:left;">
Waterlogged
</td>
</tr>
<tr>
<td style="text-align:left;">
Tree cover flooded saline water
</td>
<td style="text-align:right;">
170
</td>
<td style="text-align:left;">
-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Urban areas
</td>
<td style="text-align:right;">
190
</td>
<td style="text-align:left;">
-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Lichens and mosses
</td>
<td style="text-align:right;">
140
</td>
<td style="text-align:left;">
-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Bare areas
</td>
<td style="text-align:right;">
200
</td>
<td style="text-align:left;">
Others - No data-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Sparse vegetation tree-shrub-herbaceous (&lt;15%)
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
Others - No data-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Sparse tree (&lt;15%)
</td>
<td style="text-align:right;">
151
</td>
<td style="text-align:left;">
Others - No data-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Sparse Shrub (&lt;15%)
</td>
<td style="text-align:right;">
152
</td>
<td style="text-align:left;">
Others - No data-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Sparse herbaceous (&lt;15%)
</td>
<td style="text-align:right;">
153
</td>
<td style="text-align:left;">
Others - No data-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Consolidated bare areas
</td>
<td style="text-align:right;">
201
</td>
<td style="text-align:left;">
Others - No data-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Unconsolidated bare areas
</td>
<td style="text-align:right;">
202
</td>
<td style="text-align:left;">
Others - No data-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Permanent snow/ice
</td>
<td style="text-align:right;">
220
</td>
<td style="text-align:left;">
Others - No data-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
Water bodies
</td>
<td style="text-align:right;">
210
</td>
<td style="text-align:left;">
Others - No data-9999
</td>
</tr>
<tr>
<td style="text-align:left;">
No data
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Others - No data-9999
</td>
</tr>
</tbody>
</table>
<p><em>cover classes= “-9999” denotes areas to be excluded without local adaptations in the RothC model.</em></p>
<!--chapter:end:06.Datasets_and_inputs.rmd-->
</div>
</div>
<div id="software-environment" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> | Software environment</h1>
<p>A spatially explicit version of the RothC model (e.g. Gottschalk et al., 2012; Mondini et al. 2017; Morais et al.; 2019) is required to generate national SOC sequestration maps. A spatialized version of the model was developed by the GSP Secretariat using an open source R-environment, based on the SoilR package developed by Sierra et al. (2012; downloadable from the Max Planck Institute of Biogeochemistry (<a href="https://www.bgc-jena.mpg.de/TEE/software/soilr/" class="uri">https://www.bgc-jena.mpg.de/TEE/software/soilr/</a>).
Other spatialized versions have been developed in Fortran (e.g. Gottschalk et al., 2012) and MATLAB (e.g. Morais et al., 2019) environments. Users can use these and other alternative local adaptations of a spatialized RothC model by following the general procedures and input data described in Chapter 5 and 6 to obtain consistent results. Users are asked to provide evidence, i.e. .peer-reviewed scientific journal papers university theses etc.,, demonstrating that the use of the modified version and changes in model parameters are appropriate for the selected agro-ecological conditions.
This Chapter summarizes the steps required to set-up the software environment (R, RStudio) to prepare the input data and run the spatialized R-version of the RothC model through scripts provided by the GSP. Additional supplementary scripts for QGIS and Google Earth Engine (GEE) are also provided.
Users are required to download the following open source software:</p>
<ul>
<li>RStudio (latest stable version, <a href="https://rstudio.com/products/rstudio/download/" class="uri">https://rstudio.com/products/rstudio/download/</a>)</li>
<li>QGIS (latest stable version, <a href="https://qgis.org/en/site/forusers/download.html" class="uri">https://qgis.org/en/site/forusers/download.html</a>)</li>
</ul>
<p>In order to use Google Earth Engine users must register an account. The instructions in this Chapter will guide users through installing and manually configuring the software to be used for Microsoft Windows desktop platform. Instructions for the other platforms (e.g. Linux Flavours, Mac OS) can be found through free online resources.</p>
<div id="setting-up-the-software-environment-r-rstudio-and-r-packages" class="section level2" number="7.1">
<h2 number="7.1"><span class="header-section-number">7.1</span> Setting up the software environment: R, RStudio and R Packages</h2>
<p>R is a language and environment for statistical computing. It provides a wide variety of statistical (e.g. linear modeling, statistical tests, time-series, classification, clustering, etc.) and graphical methods. It is highly extensible through packages, which are collections of R functions, data and documentation.</p>
<div id="obtaining-and-installing-r" class="section level3" number="7.1.1">
<h3 number="7.1.1"><span class="header-section-number">7.1.1</span> Obtaining and installing R</h3>
<p>In order to run RStudio, R base needs to be installed according to the user’s environment. Installation files and instructions can be downloaded from the Comprehensive R Archive Network (CRAN) following these steps:</p>
<ol style="list-style-type: decimal">
<li>Go to the following link <a href="https://cloud.r-project.org/index.html" class="uri">https://cloud.r-project.org/index.html</a> to download and install R.</li>
<li>Pick an installation file for your platform.</li>
</ol>
</div>
<div id="obtaining-and-installing-rstudio" class="section level3" number="7.1.2">
<h3 number="7.1.2"><span class="header-section-number">7.1.2</span> Obtaining and installing RStudio</h3>
<p>Since R base does not have a Graphical User Interface (GUI), first time users may encounter some difficulties in running the provided scripts. There are some GUIs which offer some of the functionality of R. RStudio makes R easier to use. It includes a code editor, debugging and visualization tools. Similar steps need to be followed to install RStudio:</p>
<ol style="list-style-type: decimal">
<li>Go to <a href="https://www.rstudio.com/products/rstudio/download/" class="uri">https://www.rstudio.com/products/rstudio/download/</a> to download and install RStudio’s open source edition.</li>
<li>On the download page, RStudio Desktop, Open Source License option should be selected.</li>
<li>Pick an installation file for your platform.</li>
</ol>
</div>
<div id="getting-started-with-r" class="section level3" number="7.1.3">
<h3 number="7.1.3"><span class="header-section-number">7.1.3</span> Getting started with R</h3>
<p>One of the main benefits of using R is that this programming language relies on a wide and active community of developers and end-users. Several manuals, including the one found on CRAN below, guiding material, tutorials and web pages dedicated to debugging errors, such as stackoverflow (listed below) can be found online:</p>
<ul>
<li>R manuals: <a href="http://cran.r-project.org/manuals.html" class="uri">http://cran.r-project.org/manuals.html</a></li>
<li>Contributed documentation: <a href="http://cran.r-project.org/other-docs.html" class="uri">http://cran.r-project.org/other-docs.html</a></li>
<li>Quick-R: <a href="http://www.statmethods.net/index.html" class="uri">http://www.statmethods.net/index.html</a></li>
<li>Stackoverflow R community: <a href="https://stackoverflow.com/questions/tagged/r" class="uri">https://stackoverflow.com/questions/tagged/r</a></li>
</ul>
</div>
</div>
<div id="r-packages" class="section level2" number="7.2">
<h2 number="7.2"><span class="header-section-number">7.2</span> R packages</h2>
<p>As mentioned previously, the main advantage of R is its extensibility. The scope of the possible implementations of R can be greatly increased with the vast collection of packages that extend its basic functionalities. Packages are the equivalent of add-ons that developers can freely write and make available through the open-source platform that constitutes R.</p>
<div id="finding-r-packages" class="section level3" number="7.2.1">
<h3 number="7.2.1"><span class="header-section-number">7.2.1</span> Finding R packages</h3>
<p>The primary source for R packages is CRAN’s official website, where currently about 12,000 available packages are listed. For spatial applications, various packages are available. You can obtain information about the available packages directly on CRAN with the available.packages() function. The function returns a matrix of details corresponding to the packages currently available at one or more repositories. An easier way to browse the list of packages is using the Task Views link, which groups together packages related to a given topic. The following Subsections present some of the most used packages related to digital soil mapping.</p>
</div>
<div id="some-useful-r-packages-for-the-socseq-maps" class="section level3" number="7.2.2">
<h3 number="7.2.2"><span class="header-section-number">7.2.2</span> Some useful R-packages for the SOCseq maps</h3>
<p>R has a large and growing number of spatial data packages. We recommend taking a quick browse on R’s official website to see the spatial packages available: <a href="http://cran.r-project.org/web/views/Spatial.html" class="uri">http://cran.r-project.org/web/views/Spatial.html</a>. Some of these packages that will be useful to generate the national SOCseq maps include:</p>
<ul>
<li><em>raster</em>: Reading, writing, manipulating, analyzing and modeling of gridded spatial data. The package implements basic and high-level functions, processing of very large files is supported.</li>
<li><em>rgdal</em>: Provides bindings to the ‘Geospatial’ Data Abstraction Library (‘GDAL’) (&gt;= 1.11.4) and access to projection/transformation operations from the ‘PROJ’ library. Use is made of classes defined in the ‘sp’ package. Raster and vector map data can be imported into R, and raster and vector ‘sp’ objects exported.</li>
<li><em>ncdf4</em>: Provides a high-level R interface to data files written using unidata’s netCDF library (version 4 or earlier), which are binary data files that are portable across platforms and include metadata information in addition to the data sets. Using this package, netCDF files (either version 4 or ``classic’’ version 3) can be opened and datasets read in easily.</li>
<li><em>SoilR</em>: This package contains functions for modeling Soil Organic Matter decomposition in terrestrial ecosystems. See <a href="https://cran.r-project.org/web/packages/SoilR/SoilR.pdf" class="uri">https://cran.r-project.org/web/packages/SoilR/SoilR.pdf</a>.</li>
<li><em>abind</em>: Combine multidimensional arrays into a single array. This is a generalization of ‘cbind’ and ‘rbind’. Works with vectors, matrices, and higher-dimensional arrays. Also provides functions ‘adrop’, ‘asub’, and ‘afill’ for manipulating, extracting and replacing data in arrays.</li>
<li><em>soilassessment</em>: Soil assessment builds information for improved decision in soil management. It analyzes soil conditions with regard to agriculture crop suitability requirements (such as those given by FAO <a href="http://www.fao.org/land-water/databases-and-software/crop-information/en/" class="uri">http://www.fao.org/land-water/databases-and-software/crop-information/en/</a> soil fertility classes, soil erosion models and soil salinity classification. Suitability requirements are for crops grouped into cereal crops, nuts, legumes, fruits, vegetables, industrial crops, and root crops.</li>
</ul>
</div>
<div id="installation-of-r-packages-used-in-this-technical-manual" class="section level3" number="7.2.3">
<h3 number="7.2.3"><span class="header-section-number">7.2.3</span> Installation of R-Packages used in this technical manual</h3>
<p>The authors of this Technical Manual used a number of different R packages (summarized in Table 7.1). All required packages can be installed using the following code and the install.packages() function when starting a new SOC sequestration mapping project:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Install.packages</span>(<span class="st">&quot;name_of_the_package&quot;</span>)</span></code></pre></div>
<p>Alternatively, the code for the installation of the needed packages is included at the beginning of each Chapter.</p>
<p><strong>Table 7.1</strong> <em>Required R-packages for the national SOC sequestration potential maps using an R-environment</em></p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Protocol application area
</th>
<th style="text-align:left;">
R package
</th>
<th style="text-align:left;">
Reference
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Import and export raster data
</td>
<td style="text-align:left;">
raster
</td>
<td style="text-align:left;">
Hijmans et col. (2020)
</td>
</tr>
<tr>
<td style="text-align:left;">
Import and export raster data
</td>
<td style="text-align:left;">
ncdf4
</td>
<td style="text-align:left;">
David Pierce (2019)
</td>
</tr>
<tr>
<td style="text-align:left;">
Import and export vector data
</td>
<td style="text-align:left;">
rgdal
</td>
<td style="text-align:left;">
Bivand et col (2019)
</td>
</tr>
<tr>
<td style="text-align:left;">
Harmonization
</td>
<td style="text-align:left;">
raster
</td>
<td style="text-align:left;">
Hijmans et col. (2020)
</td>
</tr>
<tr>
<td style="text-align:left;">
Harmonization
</td>
<td style="text-align:left;">
rgdal
</td>
<td style="text-align:left;">
Bivand et col (2019)
</td>
</tr>
<tr>
<td style="text-align:left;">
RothC model
</td>
<td style="text-align:left;">
SoilR
</td>
<td style="text-align:left;">
Sierra and Mueller (2014)
</td>
</tr>
<tr>
<td style="text-align:left;">
Data manipulation
</td>
<td style="text-align:left;">
abind
</td>
<td style="text-align:left;">
Plate (2016)
</td>
</tr>
<tr>
<td style="text-align:left;">
RothC model, NPP MIAMI model
</td>
<td style="text-align:left;">
soilassessment
</td>
<td style="text-align:left;">
Omuto (2020)
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="considerations-when-using-r" class="section level2" number="7.3">
<h2 number="7.3"><span class="header-section-number">7.3</span> Considerations when using R</h2>
<p>It is important to note the following points when using R:</p>
<ul>
<li>As shown in Figure x, R is a case-sensitive scripting software. More than 90% of its commands are scripted in a text-editor and executed by running the line/script.</li>
<li>Hash (#) denotes the beginning of a comment and is not executed by the software. Consequently, it can be used to insert comments in a line. All comments after hash (#) are colored green (like green traffic light) implying “pass” without execution.</li>
<li>With the default editor theme errors and warnings are given in red, while functions and numbers are given in blue and commands and variables are given in black.</li>
<li>When using RStudio text-editor, four panes are available in which the top left pane is the text editing window, top right pane is for the data environment, bottom right pane is for display and help, and the bottom left is the console for executing the scripts.</li>
<li>Implemented scripts and reports (warning or errors) are shown in the console panel.</li>
<li>Some commands may run for some time and patience is recommended to enable the software to progress to completion. During such time, a red icon will be shown at the top left corner of the console panel.</li>
<li>The execution of a line or script can be stopped if necessary by clicking on the “STOP” button from the tools bar.</li>
</ul>
<div class="figure">
<img src="images/Figure_7.1.png" alt="" />
<p class="caption"><strong>Figure 7.1.</strong> <em>Overview of RStudio’s windowpanes and functionalities</em></p>
</div>
<!--chapter:end:07.Software_environment.rmd-->
</div>
</div>
<div id="running-the-scripts-overview" class="section level1" number="8">
<h1 number="8"><span class="header-section-number">8</span> | Running the scripts: overview</h1>
<div id="summary-of-steps-and-scripts" class="section level2" number="8.1">
<h2 number="8.1"><span class="header-section-number">8.1</span> Summary of steps and scripts</h2>
<p>The generation of national SOC sequestration potential maps using the spatially explicit R-version of the RothC model shall be divided in three stages (Figure 8.1.):</p>
<ol style="list-style-type: decimal">
<li>Preparation and Harmonization of data (consists of eleven R scripts, one QGIS model script, and one Google Earth Engine script)</li>
<li>Running the model in three phases (three R scripts),</li>
<li>Transformation of vector data to raster data (map generation, one R script).</li>
</ol>
<div class="figure">
<img src="images/Figure_8.1.png" alt="" />
<p class="caption"><strong>Figure 8.1.</strong> <em>Workflow for generating the national GSOCseq layers.</em></p>
</div>
</div>
<div id="stage-1-preparation-of-data" class="section level2" number="8.2">
<h2 number="8.2"><span class="header-section-number">8.2</span> Stage 1: Preparation of data</h2>
<p>Running the model over an area will require several spatial layers of information (climate, clay content, land use, vegetation cover, NPP layers) and defining target points where the model will be run. So before running the model, we will “harmonize” the different spatial layers, in order to have the same extent, same pixel size and same Coordinate Reference System (CRS). On the other hand, each modeling phase (spin up, short spin-up/warm up, forward runs) will require a different selection of layers for the different time series. So we will create ‘stacks’ of the different layers for the single modeling phases.
Land cover classes need to be re-classified into land use types that the model will recognize. We will reclassify land cover classes (like the ones provided by ESA; European Space Agency) to match the FAO land cover classes.
At this stage, we will also create other input layers (like NPP and vegetation cover layers) which are necessary to run the model.
Finally, we will create target points over the land use classes of interest (agricultural lands). These target points will become the modeling units (where the model is to be run). So, the first step (Fig. 8.1; see Chapter 9) is aimed at:</p>
<ul>
<li>preparing, organizing and harmonizing all the required input data layers to run the model in the different phases</li>
<li>creating supplementary input data layers</li>
<li>creating target points for land use classes of interests</li>
</ul>
<p>Eleven R scripts, one QGIS script and one Google earth engine script are provided to complete these tasks (Table 8.1.).</p>
</div>
<div id="stage-2-running-the-model" class="section level2" number="8.3">
<h2 number="8.3"><span class="header-section-number">8.3</span> Stage 2: Running the model</h2>
<p>Once the input data layers are prepared and stacked, we will run the spatialized RothC model at each target point using three specific scripts (Table 8.1. in the following three phases (Chapter 10):</p>
<ol style="list-style-type: decimal">
<li>Long spin up phase: he equilibrium carbon inputs (carbon inputs in tha<sup>-1</sup> y<sup>-1</sup> required to reach SOC stocks in year 2000) and the initial stocks of the different SOC pools are calculated;</li>
<li>Short spin up or Warm Up phase: SOC stocks are adjusted for the 2000-2020 period;</li>
<li>Forward" phase: SOC stocks are projected (2020 to 2040) under a “business as usual” scenario (no changes in carbon inputs), “low” scenario (5 <span class="math inline">\(\%\)</span> increase in carbon inputs), “medium” scenario (10<span class="math inline">\(\%\)</span> increase in carbon inputs), and “high” scenario (20 <span class="math inline">\(\%\)</span> increase in carbon inputs).</li>
</ol>
</div>
<div id="stage-3-generation-of-the-map" class="section level2" number="8.4">
<h2 number="8.4"><span class="header-section-number">8.4</span> Stage 3: generation of the map</h2>
<p>After the “forward” modeling phase, in the final step we will calculate the average absolute and relative SOC sequestration rates over a 20-years period for each scenario and for each target point. The vector target points will be then rasterized and saved to geotiff format to obtain the final product, using a specific R script. All the provided scripts are summarized in Table 8.1.</p>
<p><strong>Table 8.1</strong> <em>Summary of the scripts for the complete modelling process</em></p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Type of Layer
</th>
<th style="text-align:left;">
Script
</th>
<th style="text-align:left;">
Objective
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
SOC layer
</td>
<td style="text-align:left;">
R- Script number 0
</td>
<td style="text-align:left;">
Cut the SOC layer by the area of interest polygon
</td>
</tr>
<tr>
<td style="text-align:left;">
Climate layers
</td>
<td style="text-align:left;">
R- Script number 1
R- Script number 2
R- Script number 3
</td>
<td style="text-align:left;">
Rearrangement of climate layers (CRU layers from .ncd to .tif)
</td>
</tr>
<tr>
<td style="text-align:left;">
NPP layers
</td>
<td style="text-align:left;">
R- Script number 5
</td>
<td style="text-align:left;">
Creation of NPP layers
</td>
</tr>
<tr>
<td style="text-align:left;">
Vegetation Cover (VC)
</td>
<td style="text-align:left;">
GEE Script number (Google Earth Engine)
R- Script number 7
</td>
<td style="text-align:left;">
Creation of VC layers
</td>
</tr>
<tr>
<td style="text-align:left;">
Clay layers
</td>
<td style="text-align:left;">
R-Script number 8
</td>
<td style="text-align:left;">
Obtaining clay contents 0-30 cm from different depths (ISRIC)
</td>
</tr>
<tr>
<td style="text-align:left;">
Land Use layer
</td>
<td style="text-align:left;">
R-Script number 9
</td>
<td style="text-align:left;">
Re-classification into FAO land cover classes
</td>
</tr>
<tr>
<td style="text-align:left;">
STACK for SPIN UP
</td>
<td style="text-align:left;">
R-Script number 10
</td>
<td style="text-align:left;">
Stack input data layers for the spin up phase
</td>
</tr>
<tr>
<td style="text-align:left;">
STACK for WARM UP
</td>
<td style="text-align:left;">
R-Script number 11
</td>
<td style="text-align:left;">
Stack input data layers for the warm up phase
</td>
</tr>
<tr>
<td style="text-align:left;">
STACK for FORWARD
</td>
<td style="text-align:left;">
R-Script number 12
</td>
<td style="text-align:left;">
Stack input data layers for the forward phase
</td>
</tr>
<tr>
<td style="text-align:left;">
Target points
</td>
<td style="text-align:left;">
QGis model script
</td>
<td style="text-align:left;">
Creation of target points
</td>
</tr>
<tr>
<td style="text-align:left;">
SPIN UP
</td>
<td style="text-align:left;">
R- Script number 13
</td>
<td style="text-align:left;">
Run long spin up phase
</td>
</tr>
<tr>
<td style="text-align:left;">
WARM UP
</td>
<td style="text-align:left;">
R- Script number 14
</td>
<td style="text-align:left;">
Run warm up phase
</td>
</tr>
<tr>
<td style="text-align:left;">
FORWARD
</td>
<td style="text-align:left;">
R- Script number 15
</td>
<td style="text-align:left;">
Run forward phase
</td>
</tr>
<tr>
<td style="text-align:left;">
POINTS TO RASTER
</td>
<td style="text-align:left;">
R- Script number 16
</td>
<td style="text-align:left;">
Rasterize points
</td>
</tr>
</tbody>
</table>
<!--chapter:end:08.Running_the_scripts_overview.rmd-->
</div>
</div>
<div id="stage-1-preparation-of-input-data" class="section level1" number="9">
<h1 number="9"><span class="header-section-number">9</span> | Stage 1: preparation of input data</h1>
<p>This stage is aimed at:</p>
<ul>
<li>preparing, organizing and harmonizing all the required input data layers to run the model in the different phases;</li>
<li>creating supplementary input data layers;</li>
<li>creating target points for land use classes of interests.</li>
</ul>
<p>During this stage we will need to arrange and prepare climate datasets for the different modelling phases, generate NPP estimates for each phase, generate vegetation cover data, prepare clay content data layers, and harmonize and stack all layers for each modelling phase. Finally, we will have to create target points to run the model. This stage requires the most effort and is the most time consuming of the entire process. Eleven R scripts, one QGIS script and one Google earth engine script are provided to complete these tasks.</p>
<div id="preparation-of-soc-layer" class="section level2" number="9.1">
<h2 number="9.1"><span class="header-section-number">9.1</span> Preparation of SOC layer</h2>
<p>As a default option, users are invited to use the GSOCmap to retrieve their SOC data for their area of interest (AOI). This can be achieved easily, by clipping the GSOCmap to the extent of a shapefile making up the borders of the chosen study area or country. All data sources can be found in Table 6.3 of Chapter 6.</p>
<div id="script-number-0.soc_map_aoi.r" class="section level3" number="9.1.1">
<h3 number="9.1.1"><span class="header-section-number">9.1.1</span> Script Number 0.“SOC_MAP_AOI.R”</h3>
<p><strong>Table 9.1</strong> <em>Script Number 0. Preparation of the Soil Organic Carbon SOC layer. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.0.png" /></p>
<p>First, open the scrip SOC_MAP_AOI.R in RStudio. If you haven’t done so previously install the necessary packages. Then create two user-defined variables containing the paths to the two working directories:
* “WD_AOI” which contains the vector polygon of the AOI;
* “WD_GSOC”, which contains the GSOCmap raster layer</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Install all necessary packages</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;raster&quot;</span>,<span class="st">&quot;rgdal&quot;</span>,<span class="st">&quot;SoilR&quot;</span>,<span class="st">&quot;Formula&quot;</span>,<span class="st">&quot;soilassessment&quot;</span>,<span class="st">&quot;abind&quot;</span>,<span class="st">&quot;ncdf4&quot;</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the packages into R</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the path to GSOCmap and Area of interest (AOI) vector.</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>WD_GSOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the AOI (region/country)</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Open FAO GSOC MAP </span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_GSOC)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>SOC_MAP<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;GSOCmap_1.6.1.tif&quot;</span>)</span></code></pre></div>
<p>Finally, we clip the SOC layer with the vector polygon of the AOI and save the result to the WD_SOC folder. This layer will become the master layer of the process.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(SOC_MAP,AOI)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(SOC_MAP_AOI,AOI)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(SOC_MAP_AOI,<span class="at">filename=</span><span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="preparation-of-climate-layers" class="section level2" number="9.2">
<h2 number="9.2"><span class="header-section-number">9.2</span> Preparation of climate Layers</h2>
<p>The climate variables needed for the three modeling phases are:</p>
<ol style="list-style-type: decimal">
<li>Monthly rainfall (mm/month);<br />
</li>
<li>Monthly Evapotranspiration (mm/month);</li>
<li>Average monthly mean air temperature (average <span class="math inline">\(^\circ\)</span>C/month).</li>
</ol>
<p>We will need to arrange these climatic variables into three datasets:</p>
<ul>
<li>1980-2000 (monthly average values for the complete series)</li>
<li>2001-2020 (year to year monthly values)</li>
<li>2001-2020 (monthly average values for the complete series)</li>
</ul>
<p>Gridded climate data shall be obtained from either National Sources or regional or global datasets when national gridded historical climate datasets are not available. The recommended global data source of these layers are:</p>
<ul>
<li>The Climate Research Unit (<a href="http://www.cru.uea.ac.uk/" class="uri">http://www.cru.uea.ac.uk/</a>)</li>
<li>TerraClimate (readily available from the Google Earth Engine catalogue: <a href="https://developers.google.com/earth-engine/datasets/catalog/IDAHO_EPSCOR_TERRACLIMATE#citations" class="uri">https://developers.google.com/earth-engine/datasets/catalog/IDAHO_EPSCOR_TERRACLIMATE#citations</a>)</li>
</ul>
<p>For countries wanting to use the TerraClimate or the CRU data set, several scripts to obtain and to reformat the climate spatial layers to run the three modelling phases, will be presented. Users can prepare the necessary input climate data sets using other data sources. However, these scripts may still be helpful to guide the preparation process of other data sets, and as a guide of the required outputs that will be needed as inputs for the different modeling phases. Due to the coarse resolution of the CRU data set, small and/or coastal countries may encounter issues with the data set.</p>
<p>It is important to note that the CRU layers do not cover countries in their entirety. To overcome this, this revised version of the Technical Manual provides two options:</p>
<ol style="list-style-type: decimal">
<li>Perform the whole procedure with higher resolution climate layers again for every point. We have provided scripts to download and prepare TerraClimate climatic layers.</li>
<li>Re-running the model only for those points that fall outside of the CRU layer using the provided scripts that include a line of code that fills NA values with the average of all surrounding pixel values (Annex).</li>
</ol>
<p>For both cases a detailed step by step guideline is provided.</p>
<p>The preparation of the climate data depending on whether a user selects the CRU (Option A) or TerraClimate (option B) data set is presented in the flowchart below (Figure 9.0). To make use of the TerraClimate dataset, users need to first download the data for the time periods 1980-2000 and 2001-2018 using two scripts for Google Earth Egine (GEE) and subsequently prepare the target climatic variables using two R scripts.</p>
<div class="figure">
<img src="images/Figure_9.0.png" alt="" />
<p class="caption">Figure 9.0 Script order to follow depending on wether CRU or TerraClimate data sets are selected</p>
</div>
<p>Additionally, in the ANNEX a small guide is provided to overcome issues linked to the use of CRU layers in coastal and small countries.</p>
<hr />
<div id="option-a-preparation-of-the-cru-climatic-variables" class="section level3" number="9.2.1">
<h3 number="9.2.1"><span class="header-section-number">9.2.1</span> <em>Option A</em> Preparation of the CRU climatic variables</h3>
<div id="script-number-1.-cru_variables_spin_up.r" class="section level4" number="9.2.1.1">
<h4 number="9.2.1.1"><span class="header-section-number">9.2.1.1</span> Script Number 1. “CRU_variables_SPIN_UP.R”</h4>
<p>For each modelling phase we will need a different selection of climate layers. For phase 1 (“Long Spin up”), we will need to stack 12 spatial layers (the output file will be a multiband raster layer) for each climate variable mentioned above (temperature, precipitation and evapotranspiration). The time series for this initial phase goes from 1981 to 2000. The script number 1 will transform the downloaded CRU files to geotiff raster files and obtain monthly averages (temperature, precipitation, evapotranspiration) for the 1981-2000 series, ready to be used in the spin up modelling phase.</p>
<p><strong>Table 9.2</strong> <em>Script Number 1.1 Preparation of CRU datasets for the “Long Spin Up phase”. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.1.png" /></p>
<p>Open the script CRU_variables_SPIN_UP.R in RStudio.<br />
The first lines begin with “#”, which indicates that these lines are commented. From line 7 to line 10, the script loads the required packages into R.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind)</span></code></pre></div>
<p>From line 15 to line 48 the script opens two nc files (1981-1990 and 1991-2000 periods), from a local directory to be defined with the setwd function and converts them into an internal variable called “tmp”. Here we will have to set the path to the local directory of the two temperature files downloaded from the CRU site. Remember to unzip the CRU files.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Set working directory</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Set working directory</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Open nc temperature file 1981-1990 unzip the cru files</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>nc_temp_81_90<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.tmp.dat.nc&quot;</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>t_81_90 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>tmp_81_90<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#close de nc temperature file</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">nc_close</span>(nc_temp_81_90) </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Open nc temperature file 1991-2000</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>nc_temp_91_00<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.tmp.dat.nc&quot;</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>t_91_00 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>tmp_91_00<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#close de nc temperature file</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">nc_close</span>(nc_temp_91_00) </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>tmp<span class="ot">&lt;-</span><span class="fu">abind</span>(tmp_81_90,tmp_91_00)</span></code></pre></div>
<p>Then the script generates a variable to be used later on called “tmp_Jan_1”:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get one month temperature ( January)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a> tmp_Jan_1<span class="ot">&lt;-</span>tmp[,,<span class="dv">1</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(tmp_Jan_1)</span></code></pre></div>
<p>Now, all the settings for this part of the script are done. The user just has to go on running the rest of the script until the “Precipitation” code begins where “Precipitation” files will be needed.
The code below will generate one temperature file, consisting of a stack of 12 raster files with an average of 20 years for each month. Each raster corresponds to a month.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>tmp_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> tmp[,,k])</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span><span class="dv">20</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Temp_1981_2000_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ra,<span class="at">filename=</span>name, <span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop ends#######</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a> Temp_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>The first line of the “Precipitation” code block will delete all the variables that have been created until that moment. This will free up memory and increase the execution speed of the rest of the script running.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a> <span class="do">#######################################################################################</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#PRECIPITATION</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span></code></pre></div>
<p>From line 106 to line 144, the script operates in the same way as for the initial “Temperature” code block. We must define the path to the CRU precipitation files and run the rest of the code:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc precipitation file 1981-1990</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>nc_pre_81_90<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.pre.dat.nc&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a> pre_81_90<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_81_90) </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open nc precipitation file 1991-2000</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>nc_pre_91_00<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.pre.dat.nc&quot;</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a> pre_91_00<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_91_00) </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a> pre_81_00<span class="ot">&lt;-</span><span class="fu">abind</span>(pre_81_90,pre_91_00)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Have one month Precipitation ( January)</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a> pre_Jan_1<span class="ot">&lt;-</span>pre_81_00[,,<span class="dv">1</span>]</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(pre_Jan_1)</span></code></pre></div>
<p>The following code block is very similar to the one used to create the temperature files, but instead of creating an annual average, the script saves the average of the monthly sum.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pre_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pre_81_00[,,k])</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span><span class="dv">20</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Prec_1981_2000_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from the each average</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ra,<span class="at">filename=</span>name, <span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop ends#######</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>Prec_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>Finally, we must run the “Potential Evapotranspiration” block of the script. First, as we did before, we should delete the variables created in the “Precipitation” code block.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># POTENTIAL EVAPOTRANSPIRATION </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>The same commands are repeated as the ones executed <span class="cf">for</span> the previous code blocks<span class="sc">:</span> <span class="st">&quot;Temperature&quot;</span> and <span class="st">&quot;Precipitation&quot;</span>. </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Open nc temperature file 81 - 90</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>nc_pet_81_90<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.pet.dat.nc&quot;</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_81_90, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_81_90, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_81_90, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a> pet_81_90<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pet_81_90, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pet_81_90) </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 91 - 00</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a> nc_pet_91_00<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.pet.dat.nc&quot;</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_91_00, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_91_00, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_91_00, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a> pet_91_00<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pet_91_00, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pet_91_00) </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a> pet_81_00<span class="ot">&lt;-</span><span class="fu">abind</span>(pet_81_90,pet_91_00)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Have one month ETP ( January)</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a> pet_Jan_1<span class="ot">&lt;-</span>pet_81_90[,,<span class="dv">1</span>]</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(pet_Jan_1) </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 8 years (j)  and 12 months (i) </span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pet_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pet_81_00[,,k])</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">*</span><span class="dv">30</span><span class="sc">/</span><span class="dv">20</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;PET_1981_2000_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from the each average</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ra,<span class="at">filename=</span>name, <span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop ends#######</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a> PET_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(PET_Stack,<span class="at">filename=</span><span class="st">&#39;PET_Stack_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span></code></pre></div>
<p>Script number 1 is completed. The user should have created two files for the Temperature variable, two for the Precipitation variable and one for ETP variable. All these files will be used to create a raster stack of all layers needed to run the “long spin up” phase.</p>
</div>
<div id="script-number-2.-cru_variables_warm_up.r" class="section level4" number="9.2.1.2">
<h4 number="9.2.1.2"><span class="header-section-number">9.2.1.2</span> Script Number 2. “CRU_variables_WARM_UP.R”</h4>
<p>The purpose of the “Warm up” phase is to adjust the initial SOC stock and initial pools for the “forward” phase. Once the input climate layers have been harmonized, the model will run for each year from 2001 to 2018/20, using the monthly climate data of each year of the series (for 216/240 values for each month of the time series). The script number 2 is prepared to arrange the necessary CRU climate files for this phase. We will need to generate one raster stack of 216/240 spatial layers for each climate variable mentioned above (216 spatial layers if we use just 18 years period instead of a 20 year period; from 2001 to 2018, depending on the available climate data). Each stack will have one layer for each month from 2001 to 2018/2020.
For phase number 3, the “Forward” phase, we will need monthly averages of the time series 2001-2018/20. We will use the same arrangement as used in phase number one (one stack of 12 bands for each variable) but instead of using the averages of the 1981-2000 period we will use the climatic data of the 2001-2018/20 period. We will assume that there is no climate change in the next 20 years. Thus, script number 2 will also prepare the climate files for the “forward phase”.</p>
<p><strong>Table 9.3</strong> <em>Overview of the input and output files in script number 1.2 used for the files for Warm Up and Forward Phases.</em></p>
<p><img src="tables/Table_9.2.png" /></p>
<p>First, we must load the required R packages.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind)</span></code></pre></div>
<p>Then we will have to define the path directory to the CRU files.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 2001-2010</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>nc_temp_01_10<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.2001.2010.tmp.dat.nc&quot;</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_01_10, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_01_10, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>t_01_10 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_01_10, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a> tmp_01_10<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_01_10, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_temp_01_10) </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 2010-2018</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>nc_temp_11_18<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.2011.2018.tmp.dat.nc&quot;</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_11_18, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_11_18, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>t_11_18 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_11_18, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a> tmp_11_18<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_11_18, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_temp_11_18) </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 2001-2010 and 2011-2018 data </span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a> tmp<span class="ot">&lt;-</span><span class="fu">abind</span>(tmp_01_10,tmp_11_18)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a> <span class="co"># Have one month temperature ( January)</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a> tmp_Jan_1<span class="ot">&lt;-</span>tmp[,,<span class="dv">1</span>]</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(tmp_Jan_1)</span></code></pre></div>
<p>The next code block will create two raster stacks: a temperature monthly average for the 18/20 year period, and a file with one layer per month per year, summarizing 216 layers in the stack.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop starts###############</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>tmp_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> tmp[,,k])</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Temp_2001_2018_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop ends###############</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a> Temp_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a> Rlist2<span class="sc">-</span>Rlist</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop starts###############</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>])) {</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(q)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>(tmp[,,q])</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a> <span class="co">#Save each month average. </span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a> name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Temp_2001-2018&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>Rlist2[[q]]<span class="ot">&lt;-</span>ra</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop ends###############</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>Temp_Stack_2<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist2)</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack_2,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_216_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a> <span class="co">#PRECIPITATION</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc precipitation file 2001-2010</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>nc_pre_01_10<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.2001.2010.pre.dat.nc&quot;</span>)</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_01_10, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_01_10, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_01_10, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a> pre_01_10<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_01_10, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_01_10) </span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc precipitation file 2011-2018</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>nc_pre_11_18<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.2011.2018.pre.dat.nc&quot;</span>)</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_11_18, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_11_18, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_11_18, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a> pre_11_18<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_11_18, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_11_18) </span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 2001-2010 and 2011-2018 data </span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a> pre_01_18<span class="ot">&lt;-</span><span class="fu">abind</span>(pre_01_10,pre_11_18)</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Have one month Precipitation ( January)</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a> pre_Jan_1<span class="ot">&lt;-</span>pre_01_18[,,<span class="dv">1</span>]</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(pre_Jan_1)  </span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a> Continue running until the end of the block<span class="sc">:</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>Rlist2<span class="ot">&lt;-</span>Rlist</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop starts############</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pre_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pre_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pre_01_18[,,k])</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span>(<span class="fu">dim</span>(pre_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a> name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Prec_2001_2018_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from  each average</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop ends############</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a> Prec_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop starts############</span></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pre_01_18)[<span class="dv">3</span>])) {</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(q)</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>(pre_01_18[,,q])</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a> <span class="co">#Save each month average. </span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a> name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Prec_2001-2018&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>Rlist2[[q]]<span class="ot">&lt;-</span>ra</span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop ends############</span></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>Prec_Stack_2<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist2)</span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack_2,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_216_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span></code></pre></div>
<p>Now we must run the PET block. We will then run the rest of the code to create the necessary tif files.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a> <span class="do">########################################################################</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># POTENTIAL EVAPOTRANSPIRATION </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 01 - 10</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>nc_pet_01_10<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.2001.2010.pet.dat.nc&quot;</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_01_10, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_01_10, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_01_10, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a> pet_01_10<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pet_01_10, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pet_01_10) </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 11 - 18 nc_pet_11_18&lt;-nc_open(&quot;cru_ts4.03.2011.2018.pet.dat.nc&quot;)</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_11_18, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_11_18, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_11_18, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a> pet_11_18<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pet_11_18, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pet_11_18) </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 2001-2010 and 2011-2018 data </span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a> pet_01_18<span class="ot">&lt;-</span><span class="fu">abind</span>(pet_01_10,pet_11_18)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># get one month ETP ( January)</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a> pet_Jan_1<span class="ot">&lt;-</span>pet_01_18[,,<span class="dv">1</span>]</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(pet_Jan_1)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>Rlist2<span class="ot">&lt;-</span>Rlist</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 18 years (j)  and 12 months (i) </span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts##############</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pet_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pet_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pet_01_18[,,k])</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>(<span class="fu">dim</span>(pet_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;PET_2001_2018_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from the each average</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop ends##############</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a> PET_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(PET_Stack,<span class="at">filename=</span><span class="st">&#39;PET_Stack_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts##############</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pet_01_18)[<span class="dv">3</span>])) {</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(q)</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>(pet_01_18[,,q])<span class="sc">*</span><span class="dv">30</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a> <span class="co">#Save each month average. </span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a> name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;PET_2001-2018&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ra,<span class="at">filename=</span>name, <span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>Rlist2[[q]]<span class="ot">&lt;-</span>ra</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts##############</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>PET_Stack_2<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist2)</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(PET_Stack_2,<span class="at">filename=</span><span class="st">&#39;PET_Stack_216_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span></code></pre></div>
</div>
<div id="script-number-3.-preparation-of-cru-files-to-estimate-npp-1981-2000" class="section level4" number="9.2.1.3">
<h4 number="9.2.1.3"><span class="header-section-number">9.2.1.3</span> Script Number 3. Preparation of CRU files to estimate NPP 1981-2000</h4>
<p>We will need to convert the CRU monthly climate data 1981-2000 into annual data to estimate annual NPP 1981-2000.The script number 3 will process the CRU files from the 1981-2000 series to generate the climate inputs files required to estimate NPP by the MIAMI model.</p>
<p><strong>Table 9.4.</strong> <em>Script Number 1.3. CRU files for MIAMI MODEL. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.3.png" /></p>
<p>We will first open the R file: “CRU_variables_for_NPP_MIAMI_MEAN_81-00.R” and load the required packages:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind)</span></code></pre></div>
<p>The first block is the “temperature” block. We must set the path to the CRU files.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 1981-1990</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>nc_temp_81_90<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.tmp.dat.nc&quot;</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>t_81_90 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a> tmp_81_90<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_temp_81_90) </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 1991-2000</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>nc_temp_91_00<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.tmp.dat.nc&quot;</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>t_91_00 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a> tmp_91_00<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_temp_91_00) </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a> tmp<span class="ot">&lt;-</span><span class="fu">abind</span>(tmp_81_90,tmp_91_00)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a> <span class="co"># Get one month temperature ( January)</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>tmp_Jan_1<span class="ot">&lt;-</span>tmp[,,<span class="dv">1</span>]</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(tmp_Jan_1)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a> Rlist2<span class="ot">&lt;-</span>Rlist</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts###########</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>])) {</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>(tmp[,,q])</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a> <span class="co">#Save each month average. </span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a> name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Temp_1981-2000&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>Rlist2[[q]]<span class="ot">&lt;-</span>ra</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop ends###########</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>Temp_Stack_2<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist2)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack_2,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_240_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>After that, the “precipitation” block begins.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#PRECIPITATION</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc precipitation file 1981-1990</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>nc_pre_81_90<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.pre.dat.nc&quot;</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a> pre_81_90<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_81_90) </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc precipitation file 1991-2000</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>nc_pre_91_00<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.pre.dat.nc&quot;</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>pre_91_00<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_91_00) </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a> pre_81_00<span class="ot">&lt;-</span><span class="fu">abind</span>(pre_81_90,pre_91_00) </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>Rlist2<span class="ot">&lt;-</span>Rlist</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="do">##############for loop starts############</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pre_81_00)[<span class="dv">3</span>])) {</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>(pre_81_00[,,q])</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a> <span class="co">#Save each month average. </span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a> <span class="co">#name&lt;-paste0(&#39;Prec_2001-2018&#39;,q,&#39;.tif&#39;)</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>Rlist2[[q]]<span class="ot">&lt;-</span>ra</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="do">##############for loop ends############</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>Prec_Stack_2<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist2)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack_2,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_240_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-5.-cru-miami-model-npp-mean-1981-2000" class="section level4" number="9.2.1.4">
<h4 number="9.2.1.4"><span class="header-section-number">9.2.1.4</span> Script Number 5. CRU MIAMI model NPP mean (1981-2000)</h4>
<p>To adjust yearly C inputs during the warm up phase according to annual NPP values, we will need to estimate an average annual NPP 1981-2000, that will be used as the starting point to adjust C inputs during the “warm up” phase (See chapter 6). Script number 5 uses the climate raster outputs from script number 3 and estimates an annual NPP mean 1981-2000 value.</p>
<p><strong>Table 9.5</strong> <em>Script Number 5. CRU Miami Model 81-00 Mean. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.4.png" /></p>
<p>First, we will need to open the R script: “MIAMI_MODEL_NPP_MIAMI_MEAN_81-00.R”
Analogously to the previous scripts, the first lines load the required packages into R and set the working directories. Then the annual precipitation and annual temperature stacks (1981-2000) that were created in script number 3 are opened:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>WD_NPP<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/NPP&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>WD_GSOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>WD_CRU_LAYERS<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CRU_LAYERS)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Annual Precipitation (mm) and Mean Annual Temperature (degree C) stacks</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Temp_Stack_240_81-00_CRU.tif&quot;</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>Prec<span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;Prec_Stack_240_81-00_CRU.tif&quot;</span>)</span></code></pre></div>
<p>At line 73 the user must set the output directory to save the output files.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="do">#######loop for starts#########</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="do">#######loop for ends##########</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>NPP_Prec<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Save WORLD NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>Then we will need to open the country polygon vector and the latest version of the FAO GSOCmap.</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Open the shapefile of the region/country</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="co">#Open FAO GSOC MAP </span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_GSOC)</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; mask</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>In order to estimate the uncertainty of our predictions, we will create two additional layers, but this time using a minimum and maximum combination of precipitation and temperature variables to generate minimum and maximum NPP layers (See Chapter 12).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#UNCERTAINTIES MINIMUM TEMP , PREC</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Temp_min<span class="ot">&lt;-</span>Temp<span class="sc">*</span><span class="fl">1.02</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>Prec_min<span class="ot">&lt;-</span>Prec<span class="sc">*</span><span class="fl">0.95</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp_min[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec_min[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>NPP_Prec<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Save WORLD NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00_MIN.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; and mask</span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI_MIN.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="co">#UNCERTAINTIES MAXIMUM TEMP , PREC</span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Anual Precipitation (mm) and Mean Anual Temperature (grades C) stacks</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>Temp_max<span class="ot">&lt;-</span>Temp<span class="sc">*</span><span class="fl">0.98</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>Prec_max<span class="ot">&lt;-</span>Prec<span class="sc">*</span><span class="fl">1.05</span></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp_max[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec_max[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>NPP_rain<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Save NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00_MAX.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; and mask</span></span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI_MAX.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<hr />
</div>
</div>
<div id="option-b-preparation-of-the-terraclimate-climatic-variables" class="section level3" number="9.2.2">
<h3 number="9.2.2"><span class="header-section-number">9.2.2</span> <em>Option B</em> Preparation of the TerraClimate climatic variables</h3>
<p>This section presents step by step guidelines on how to download and prepare the required climatic variables from the TerraClimate data set.</p>
<div id="script-number-1.-terraclimate-gee-spin-up-phase" class="section level4" number="9.2.2.1">
<h4 number="9.2.2.1"><span class="header-section-number">9.2.2.1</span> Script Number 1. TerraClimate GEE Spin up phase</h4>
<p>The TerraClimate data set can be downloaded directly from Google Earth Engine, a powerful and free cloud computing platform.
First, the user will need to activate a Google Earth Engine account. To run the Google Earth Engine (GEE) tool, the user will need to copy and paste the script (provided below) into the GEE code editor (central panel, Fig. 9.1).</p>
<div class="figure">
<img src="images/Figure_9.1.png" alt="" />
<p class="caption"><strong>Figure 9.1</strong> <em>Google Earth Engine code editor</em></p>
</div>
<p>To run the script the user can input a new geometry using the geometry tools panel (Figure 9.2) or by uploading a shapefile.</p>
<div class="figure">
<img src="images/Figure_9.2.png" alt="" />
<p class="caption"><strong>Figure 9.2</strong> <em>Drawing a polygon in Google Earth Engine</em></p>
</div>
<p>The following script can be copied and pasted into GEE without any further modifications:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Climate data sets for the Spin Up phase 1980-2001</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">// calculate the average temperature from minimum and maximum temperatures</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">// download the Minimum and Maximum Temperature </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">// download the Average temperature</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">// download the PET </span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">// download the Precipitation</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dataset <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;IDAHO_EPSCOR/TERRACLIMATE&#39;</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;1981-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2001-01-01&#39;</span>))<span class="op">;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> maximumTemperature <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;tmmx&#39;</span>)<span class="op">;</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mxT <span class="op">=</span> maximumTemperature<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> minimumTemperature <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;tmmn&#39;</span>)<span class="op">;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mnT <span class="op">=</span> minimumTemperature<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> precipitation <span class="op">=</span>dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pr&#39;</span>)<span class="op">;</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pre <span class="op">=</span>precipitation<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> evapotranspiration <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pet&#39;</span>)<span class="op">;</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pet <span class="op">=</span>evapotranspiration<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> diff <span class="op">=</span> mxT<span class="op">.</span><span class="fu">add</span>(mnT)<span class="op">;</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> avT <span class="op">=</span> diff<span class="op">.</span><span class="fu">divide</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> avT <span class="op">=</span>avT<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pre <span class="op">=</span>pre<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pet <span class="op">=</span>pet<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(avT<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(pre<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(pet<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(avT<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> avT<span class="op">,</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClimate&quot;</span><span class="op">,</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;AverageTemperature_1981-2001&#39;</span><span class="op">,</span> </span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(pre<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> pre<span class="op">,</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClimate&quot;</span><span class="op">,</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Precipitation_1981-2001&#39;</span><span class="op">,</span> </span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(pet<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> pet<span class="op">,</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClimate&quot;</span><span class="op">,</span></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;PET_1981-2001&#39;</span><span class="op">,</span> </span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<div id="scrip-number-2.-terraclimate-gee-warm-up-and-forward-phase" class="section level4" number="9.2.2.2">
<h4 number="9.2.2.2"><span class="header-section-number">9.2.2.2</span> Scrip Number 2. TerraClimate GEE Warm up and Forward phase</h4>
<p>To retrieve the necessary climatic data (2001-2018/20) to be used as input for the warm up and subsequent forward phase the same steps are repeated as for Script 2.1. After defining a geometry or inputting a shapefile the following code can be copied and pasted into the GEE code editor.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ss">/ Climate data sets for the Warm Up phase and Forward phase 2001 - 2020</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ss">// calculate the average temperature from minimum and maximum temperatures</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ss">// download the Average temperature</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ss">// download the PET </span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ss">// download the Precipitation</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="ss">var dataset = ee.ImageCollection</span><span class="sc">(</span><span class="ss">&#39;IDAHO_EPSCOR/TERRACLIMATE</span><span class="st">&#39;)</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2001-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))<span class="op">;</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> maximumTemperature <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;tmmx&#39;</span>)<span class="op">;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mxT <span class="op">=</span> maximumTemperature<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> minimumTemperature <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;tmmn&#39;</span>)<span class="op">;</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mnT <span class="op">=</span> minimumTemperature<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> precipitation <span class="op">=</span>dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pr&#39;</span>)<span class="op">;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pre <span class="op">=</span>precipitation<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> evapotranspiration <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pet&#39;</span>)<span class="op">;</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pet <span class="op">=</span>evapotranspiration<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> diff <span class="op">=</span> mxT<span class="op">.</span><span class="fu">add</span>(mnT)<span class="op">;</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> avT <span class="op">=</span> diff<span class="op">.</span><span class="fu">divide</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> avT <span class="op">=</span>avT<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pre <span class="op">=</span>pre<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pet <span class="op">=</span>pet<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(avT<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(pre<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(pet<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(avT<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> avT<span class="op">,</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClime&quot;</span><span class="op">,</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;AverageTemperature_2001-2021&#39;</span><span class="op">,</span> </span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(pre<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> pre<span class="op">,</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClime&quot;</span><span class="op">,</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Precipitation_2001-2021&#39;</span><span class="op">,</span> </span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(pet<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> pet<span class="op">,</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClime&quot;</span><span class="op">,</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;PET_2001-2021&#39;</span><span class="op">,</span> </span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<div id="script-number-3.-terraclimate-variables-spin-up-phase" class="section level4" number="9.2.2.3">
<h4 number="9.2.2.3"><span class="header-section-number">9.2.2.3</span> Script Number 3. TerraClimate Variables Spin up phase</h4>
<p>Once the data has been downloaded using GEE for the time period 1981-2000, the necessary target variables for the spin up phase can be prepared using the following scripts. For each modelling phase we will need a different selection of climate layers. For phase 1 (“Long Spin up”), we will need to stack 12 spatial layers (the output file will be a multiband raster layer) for each climate variable mentioned above (temperature, precipitation and evapotranspiration). The time series for this initial phase goes from 1981 to 2000. The script number 3 will transform the downloaded TerraClimate files to obtain monthly averages (temperature, precipitation, evapotranspiration) for the 1981-2000 series, ready to be used in the spin up modelling phase.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>DATE<span class="sc">:</span>  <span class="dv">2</span><span class="sc">/</span><span class="dv">11</span><span class="sc">/</span><span class="dv">2020</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  MSc Ing Agr Luciano E. Di Paolo</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># TerraClimate FROM GOOGLE EARTH ENGINE</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Abatzoglou, J.T., S.Z. Dobrowski, S.A. Parks, K.C. Hegewisch, 2018, Terraclimate, </span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">#a high-resolution global dataset of monthly climate and climatic water balance from 1958-2015, Scientific Data,</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Set working directory</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/TERRA_CLIME&quot;</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the TerraClimate data from GEE</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>tmp<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;AverageTemperature_1981-2001_Pergamino.tif&quot;</span>)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>pre_81_00<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Precipitation_1981-2001_Pergamino.tif&quot;</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>pet_81_00<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;PET_1981-2001_Pergamino.tif&quot;</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Get one month temperature ( January)</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>tmp_Jan_1<span class="ot">&lt;-</span>tmp[[<span class="dv">1</span>]]</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(tmp_Jan_1)</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>tmp_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> tmp[[k]])</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate each month average. </span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span><span class="dv">20</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the average of each month (i)</span></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a><span class="do">#######for loop ends########</span></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>Temp_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>Temp_Stack<span class="ot">&lt;-</span>Temp_Stack<span class="sc">*</span><span class="fl">0.1</span> <span class="co"># rescale to C</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_81-00_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a><span class="co">#PRECIPITATION</span></span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Get one month Precipitation ( January)</span></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>pre_Jan_1<span class="ot">&lt;-</span>pre_81_00[[<span class="dv">1</span>]]</span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(pre_Jan_1)</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pre_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pre_81_00[[k]])</span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span><span class="dv">20</span></span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop ends#######</span></span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>Prec_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_81-00_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a><span class="co"># POTENTIAL EVAPOTRANSPIRATION </span></span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Get one month PET ( January)</span></span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a>pet_Jan_1<span class="ot">&lt;-</span>pet_81_00[[<span class="dv">1</span>]]</span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(pet_Jan_1)</span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pet_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pet_81_00[[k]])</span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span><span class="dv">20</span></span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop ends#######</span></span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a>PET_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a>PET_Stack<span class="ot">&lt;-</span>PET_Stack<span class="sc">*</span><span class="fl">0.1</span></span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(PET_Stack,<span class="at">filename=</span><span class="st">&#39;PET_Stack_81-00_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="script-number-4.-terraclimate-variables-warm-up-phase" class="section level4" number="9.2.2.4">
<h4 number="9.2.2.4"><span class="header-section-number">9.2.2.4</span> Script Number 4. TerraClimate Variables Warm up phase</h4>
<p>Once the data has been downloaded using GEE for the time period 2001-2018/20, the necessary target variables for the warm up and forward phases can be prepared using the following script. The purpose of the “Warm up” phase is to adjust the initial SOC stock and initial pools for the “forward” phase. Once the input climate layers have been harmonized, the model will run for each year from 2001 to 2018/20, using the monthly climate data of each year of the series (for 216/240 values for each month of the time series). The script number 4 is prepared to arrange the necessary TerraClimate files for this phase. We will need to generate one raster stack of 216/240 spatial layers for each climate variable mentioned above (216 spatial layers if we use just 18 years period instead of a 20 year period; from 2001 to 2018, depending on the available climate data). Each stack will have one layer for each month from 2001 to 2018/2020. For phase number 3, the “Forward” phase, we will need monthly averages of the time series 2001-2018/20. We will use the same arrangement as used in phase number one (one stack of 12 bands for each variable) but instead of using the averages of the 1981-2000 period we will use the climatic data of the 2001-2018/20 period. We will assume that there is no climate change in the next 20 years. Thus, script number 2 will also prepare the climate files for the “forward phase”.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>DATE<span class="sc">:</span> <span class="dv">12</span><span class="sc">/</span><span class="dv">02</span><span class="sc">/</span><span class="dv">2021</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  MSc Ing Agr Luciano E. Di Paolo</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># TerraClimate FROM GOOGLE EARTH ENGINE</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Abatzoglou, J.T., S.Z. Dobrowski, S.A. Parks, K.C. Hegewisch, 2018, Terraclimate, </span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#a high-resolution global dataset of monthly climate and climatic water balance from 1958-2015, Scientific Data,</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/TERRA_CLIME&quot;</span>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># OPEN LAYERS</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the TerraClimate data from GEE</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>tmp<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;AverageTemperature_2001-2021_Pergamino.tif&quot;</span>)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>pre_01_18<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Precipitation_2001-2021_Pergamino.tif&quot;</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>pet_01_18<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;PET_2001-2021_Pergamino.tif&quot;</span>)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Get one month temperature ( January)</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>tmp_Jan_1<span class="ot">&lt;-</span>tmp[[<span class="dv">1</span>]]</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(tmp_Jan_1)</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop starts###############</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>tmp_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> tmp[[k]])</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop ends#############</span></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>Temp_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>Temp_Stack<span class="ot">&lt;-</span>Temp_Stack<span class="sc">*</span><span class="fl">0.1</span> <span class="co"># rescale to C</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_01-19_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################################################################################</span></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a><span class="co">#PRECIPITATION</span></span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Have one month Precipitation ( January)</span></span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>pre_Jan_1<span class="ot">&lt;-</span>pre_01_18[[<span class="dv">1</span>]]</span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(pre_Jan_1)</span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop starts############</span></span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pre_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pre_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pre_01_18[[k]])</span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span>(<span class="fu">dim</span>(pre_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;,overwrite=TRUE)</span></span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop ends##########</span></span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a>Prec_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_01-19_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a><span class="co"># POTENTIAL EVAPOTRANSPIRATION </span></span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Have one month ETP ( January)</span></span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a>pet_Jan_1<span class="ot">&lt;-</span>pet_01_18[[<span class="dv">1</span>]]</span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(pet_Jan_1)</span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb25-132"><a href="#cb25-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 18 years (j)  and 12 months (i) </span></span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts##############</span></span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pet_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pet_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pet_01_18[[k]])</span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-149"><a href="#cb25-149" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span>(<span class="fu">dim</span>(pet_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb25-150"><a href="#cb25-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-151"><a href="#cb25-151" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;,overwrite=TRUE)</span></span>
<span id="cb25-152"><a href="#cb25-152" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb25-153"><a href="#cb25-153" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-154"><a href="#cb25-154" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop ends############</span></span>
<span id="cb25-155"><a href="#cb25-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-156"><a href="#cb25-156" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb25-157"><a href="#cb25-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-158"><a href="#cb25-158" aria-hidden="true" tabindex="-1"></a>PET_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb25-159"><a href="#cb25-159" aria-hidden="true" tabindex="-1"></a>PET_Stack<span class="ot">&lt;-</span>PET_Stack<span class="sc">*</span><span class="fl">0.1</span></span>
<span id="cb25-160"><a href="#cb25-160" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(PET_Stack,<span class="at">filename=</span><span class="st">&#39;PET_Stack_01-19_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="script-number-5.-terraclimate-miami-model-npp-mean-1981-2000" class="section level4" number="9.2.2.5">
<h4 number="9.2.2.5"><span class="header-section-number">9.2.2.5</span> Script Number 5. TerraClimate MIAMI model NPP mean 1981-2000</h4>
<p>To adjust yearly C inputs during the warm up phase according to annual NPP values, we will need to estimate an average annual NPP 1981-2000, that will be used as the starting point to adjust C inputs during the “warm up” phase (See chapter 6). Script number 5 uses the TerraClimate climate raster outputs from script number 3 and estimates an annual NPP mean 1981-2000 value.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DATE: 2-12-2020</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># MSc Ing.Agr. Luciano E. DI Paolo</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># PHD Ing.Agr. Guillermo E. Peralta</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MIAMI MODEL</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>WD_NPP<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/NPP&quot;</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>WD_GSOC<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>WD_TC_LAYERS<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/TERRA_CLIME&quot;</span>)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_TC_LAYERS)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Anual Precipitation (mm) and Mean Anual Temperature (grades C) stacks</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;AverageTemperature_1981-2001_Pergamino.tif&quot;</span>)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>Prec<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Precipitation_1981-2001_Pergamino.tif&quot;</span>)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Temp&lt;-crop(Temp,AOI)</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Prec&lt;-crop(Prec,AOI)</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="do">#######loop for starts#########</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(Temp)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)){</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="do">#######loop for ends##########</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span>TempStack<span class="sc">*</span><span class="fl">0.1</span> <span class="co"># rescale to C</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>NPP_Prec<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Save WORLD NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI_tnC_Ha_Year&lt;-stack(&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00.tif&quot;)</span></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a><span class="co">#Open FAO GSOC MAP </span></span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_GSOC)</span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; mask</span></span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a><span class="co">#UNCERTAINTIES MINIMUM TEMP , PREC</span></span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a>Temp_min<span class="ot">&lt;-</span>Temp<span class="sc">*</span><span class="fl">1.02</span></span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a>Prec_min<span class="ot">&lt;-</span>Prec<span class="sc">*</span><span class="fl">0.95</span></span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp_min[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span>TempStack<span class="sc">*</span><span class="fl">0.1</span> <span class="co"># rescale to C</span></span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec_min[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a>NPP_Prec<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb26-167"><a href="#cb26-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Save WORLD NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00_MIN.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; and mask</span></span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb26-207"><a href="#cb26-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI_MIN.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_MIN.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-212"><a href="#cb26-212" aria-hidden="true" tabindex="-1"></a><span class="co">#UNCERTAINTIES MAXIMUM TEMP , PREC</span></span>
<span id="cb26-213"><a href="#cb26-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-214"><a href="#cb26-214" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Anual Precipitation (mm) and Mean Anual Temperature (grades C) stacks</span></span>
<span id="cb26-215"><a href="#cb26-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-216"><a href="#cb26-216" aria-hidden="true" tabindex="-1"></a>Temp_max<span class="ot">&lt;-</span>Temp<span class="sc">*</span><span class="fl">0.98</span></span>
<span id="cb26-217"><a href="#cb26-217" aria-hidden="true" tabindex="-1"></a>Prec_max<span class="ot">&lt;-</span>Prec<span class="sc">*</span><span class="fl">1.05</span></span>
<span id="cb26-218"><a href="#cb26-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-219"><a href="#cb26-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb26-220"><a href="#cb26-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-221"><a href="#cb26-221" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb26-222"><a href="#cb26-222" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-223"><a href="#cb26-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-224"><a href="#cb26-224" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb26-225"><a href="#cb26-225" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb26-226"><a href="#cb26-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-227"><a href="#cb26-227" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp_max[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb26-228"><a href="#cb26-228" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb26-229"><a href="#cb26-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-230"><a href="#cb26-230" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb26-231"><a href="#cb26-231" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-232"><a href="#cb26-232" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb26-233"><a href="#cb26-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-234"><a href="#cb26-234" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb26-235"><a href="#cb26-235" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span>TempStack<span class="sc">*</span><span class="fl">0.1</span> <span class="co"># rescale to C</span></span>
<span id="cb26-236"><a href="#cb26-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-237"><a href="#cb26-237" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb26-238"><a href="#cb26-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-239"><a href="#cb26-239" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb26-240"><a href="#cb26-240" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-241"><a href="#cb26-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-242"><a href="#cb26-242" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb26-243"><a href="#cb26-243" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb26-244"><a href="#cb26-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-245"><a href="#cb26-245" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec_max[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb26-246"><a href="#cb26-246" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb26-247"><a href="#cb26-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-248"><a href="#cb26-248" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb26-249"><a href="#cb26-249" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-250"><a href="#cb26-250" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb26-251"><a href="#cb26-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-252"><a href="#cb26-252" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb26-253"><a href="#cb26-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-254"><a href="#cb26-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb26-255"><a href="#cb26-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-256"><a href="#cb26-256" aria-hidden="true" tabindex="-1"></a>NPP_Prec<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb26-257"><a href="#cb26-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-258"><a href="#cb26-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb26-259"><a href="#cb26-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-260"><a href="#cb26-260" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb26-261"><a href="#cb26-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-262"><a href="#cb26-262" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb26-263"><a href="#cb26-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-264"><a href="#cb26-264" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-265"><a href="#cb26-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-266"><a href="#cb26-266" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb26-267"><a href="#cb26-267" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb26-268"><a href="#cb26-268" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb26-269"><a href="#cb26-269" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-270"><a href="#cb26-270" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb26-271"><a href="#cb26-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-272"><a href="#cb26-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-273"><a href="#cb26-273" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb26-274"><a href="#cb26-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-275"><a href="#cb26-275" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb26-276"><a href="#cb26-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-277"><a href="#cb26-277" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb26-278"><a href="#cb26-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-279"><a href="#cb26-279" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb26-280"><a href="#cb26-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-281"><a href="#cb26-281" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb26-282"><a href="#cb26-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-283"><a href="#cb26-283" aria-hidden="true" tabindex="-1"></a><span class="co"># Save NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb26-284"><a href="#cb26-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-285"><a href="#cb26-285" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb26-286"><a href="#cb26-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-287"><a href="#cb26-287" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00_MAX.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-288"><a href="#cb26-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-289"><a href="#cb26-289" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb26-290"><a href="#cb26-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-291"><a href="#cb26-291" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb26-292"><a href="#cb26-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-293"><a href="#cb26-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; and mask</span></span>
<span id="cb26-294"><a href="#cb26-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-295"><a href="#cb26-295" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb26-296"><a href="#cb26-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-297"><a href="#cb26-297" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb26-298"><a href="#cb26-298" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb26-299"><a href="#cb26-299" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb26-300"><a href="#cb26-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-301"><a href="#cb26-301" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI_MAX.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-302"><a href="#cb26-302" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_MAX.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="script-number-6.-monthly_vegetation_cover-vegetation-cover-from-google-earth-engine." class="section level3" number="9.2.3">
<h3 number="9.2.3"><span class="header-section-number">9.2.3</span> Script Number 6. “Monthly_vegetation_cover” vegetation cover from Google Earth Engine.</h3>
<p>Script number 6 is a Google Earth Engine script. It is aimed at estimating an average vegetation cover status for each month of the year. Therefore, the script should be run twelve times, modifying the month number each time. It estimates, within a specified time series, the probability for each pixel to present NDVI values greater than a specified threshold, over which the soil is vegetated (for example NDVI &gt; 0.6). The result will vary between 0 and 1. Users may modify the time series and NDVI threshold as desired and according to local knowledge.</p>
<p><strong>Table 9.6.</strong> <em>Script Number 6.GEE Monthly Vegetation Cover. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.5.png" /></p>
<p>First, the user will need to activate a Google Earth Engine account. To run the Google Earth Engine (GEE) tool, the user will need to copy and paste the script (provided below) into the GEE code editor (central panel, Fig. 9.1).</p>
<div class="figure">
<img src="images/Figure_9.1.png" alt="" />
<p class="caption"><strong>Figure 9.1</strong> <em>Google Earth Engine code editor</em></p>
</div>
<p>The user will need to draw a polygon that includes the country that is being analyzed, by clicking on “+new layer”. The polygon will contain the country’s boundary or area of interest (Fig. 9.2)</p>
<div class="figure">
<img src="images/Figure_9.2.png" alt="" />
<p class="caption"><strong>Figure 9.2</strong> <em>Drawing a polygon in Google Earth Engine</em></p>
</div>
<p>The script shall be run twelve times, once for each month of the year. The user will need to specify the month, the name of the output folder and the name of the output raster each time the script is run. The following lines need to be edited:</p>
<ul>
<li>Line 10, the month number to be processed, (e.g. for January (1,1,‘month’);</li>
<li>Line 55, the name of the folder where the output raster file is to be saved (in the Google Drive Account);</li>
<li>Line 56, the name of the output raster which coincides with the month number that has been run.</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Google Earth Engine </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Monthly Vegetation Cover for Roth C Model   </span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a> <span class="co">// Provide a polygon geometry</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a> <span class="co">// Select the Modis dataset. MOD13A2 is an NDVI product. Modify the number of the month filter for each month from 1 to 12. </span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a> <span class="kw">var</span> dataset <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;MODIS/006/MOD13A2&#39;</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2015-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2019-12-01&#39;</span>))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">12</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="st">&#39;month&#39;</span>))<span class="op">;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a> <span class="kw">var</span> ndvi <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a> <span class="co">// Masks every pixel greater than 0.6 NDVI</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mask06<span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">.</span><span class="fu">gt</span>(<span class="dv">3000</span>)<span class="op">;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a> <span class="co">// Apply the mask to the dataset (var ndvi)</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi_06<span class="op">=</span>ndvi<span class="op">.</span><span class="fu">map</span>(mask06)<span class="op">;</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a> <span class="co">// Count the number of times a pixel has an NDVI value greater than 0.6</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi_06_nn<span class="op">=</span>ndvi_06<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a> <span class="co">// Count the total number of values per pixel</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi_nn<span class="op">=</span>ndvi<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a> <span class="co">// Calculate the proportion of times the NDVI value is greater than 0.6 per pixel</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_cover<span class="op">=</span> ndvi_06_nn<span class="op">.</span><span class="fu">divide</span>(ndvi_nn)<span class="op">;</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a> <span class="co">// Color palette</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndviVis <span class="op">=</span> {</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="fl">1.0</span><span class="op">,</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">palette</span><span class="op">:</span> [</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;FFFFFF&#39;</span><span class="op">,</span> <span class="st">&#39;CE7E45&#39;</span><span class="op">,</span> <span class="st">&#39;DF923D&#39;</span><span class="op">,</span> <span class="st">&#39;F1B555&#39;</span><span class="op">,</span> <span class="st">&#39;FCD163&#39;</span><span class="op">,</span> <span class="st">&#39;99B718&#39;</span><span class="op">,</span> <span class="st">&#39;74A901&#39;</span><span class="op">,</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;66A000&#39;</span><span class="op">,</span> <span class="st">&#39;529400&#39;</span><span class="op">,</span> <span class="st">&#39;3E8601&#39;</span><span class="op">,</span> <span class="st">&#39;207401&#39;</span><span class="op">,</span> <span class="st">&#39;056201&#39;</span><span class="op">,</span> <span class="st">&#39;004C00&#39;</span><span class="op">,</span> <span class="st">&#39;023B01&#39;</span><span class="op">,</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;012E01&#39;</span><span class="op">,</span> <span class="st">&#39;011D01&#39;</span><span class="op">,</span> <span class="st">&#39;011301&#39;</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a> ]<span class="op">,</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a> <span class="co">// Clip the map with the country geometry</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Recorte <span class="op">=</span> prop_cover<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a> <span class="co">// Add the map to the visualization google earth engine panel</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(Recorte<span class="op">,</span> ndviVis<span class="op">,</span> <span class="st">&#39;Country&#39;</span>)</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a> <span class="co">// This code block needs to be modify for each month and allows the user to save the map into a Google drive account</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(Recorte<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> Recorte<span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;NDVI_count&quot;</span>)<span class="op">,</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;MAPA_ROTH_C&quot;</span><span class="op">,</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;NDVI_2015-2019_prop_gt_06_CR_MES_01&#39;</span><span class="op">,</span> </span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span>geometry<span class="op">,</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>          <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span>     </span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>After running the script for each month, the layer must be saved to the Google Drive account. To accomplish this, the user will need to click on the “task” button and then click the “run” button (Fig. 9.3)</p>
<div class="figure">
<img src="images/Figure_9.3.png" alt="" />
<p class="caption"><strong>Figure 9.3</strong> <em>Saving the task in GEE.</em></p>
</div>
<p>Once the procedure is completed, the layers should be downloaded from the Google Drive and saved into a local folder</p>
</div>
<div id="script-number-7.-vegetation_cover_stack.r" class="section level3" number="9.2.4">
<h3 number="9.2.4"><span class="header-section-number">9.2.4</span> Script Number 7. “Vegetation_Cover_stack.R”</h3>
<p>The script number 7 is an R script that uses the monthly vegetation cover layers (0-1 values) created with the GEE script number 6 to create a raster stack. It also linearly rescales the values from “0 to 1” (proportion of vegetated pixels in a time series) to “1 to 0.6” (being 1 = bare soil and 0.6 = full vegetated pixel). This transformation will allow us to use the calculated values as modifying factors of the decomposition rates in the RothC model.</p>
<p>Table 9.6 Script Number 7. Vegetation Cover Stack. Inputs and Outputs.
<img src="tables/Table_9.6.png" /></p>
<p>Once the monthly vegetation cover layers are downloaded from Google Drive, we will generate a stack of those layers. We will first open script number 7 “Vegetation_Cover_stack.R” and the required packages. Then, we will need to open the country polygon vector and set the working directory for the input and the output layers.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>WD_COV<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/INPUTS/COV&quot;</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP FAO</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Vegetation Cover layer based only in proportion of NDVI pixels grater than 0.6 </span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_COV)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>Cov1<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M01.tif&quot;</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>Cov1[<span class="fu">is.na</span>(Cov1[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>Cov1_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov1,AOI)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>Cov1_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov1_crop,AOI)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>Cov1_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov1_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>Cov2<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M02.tif&quot;</span>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>Cov2[<span class="fu">is.na</span>(Cov2[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>Cov2_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov2,AOI)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>Cov2_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov2_crop,AOI)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>Cov2_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov2_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>Cov3<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M03.tif&quot;</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>Cov3[<span class="fu">is.na</span>(Cov3[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>Cov3_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov3,AOI)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>Cov3_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov3_crop,AOI)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>Cov3_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov3_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>Cov4<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M04.tif&quot;</span>)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>Cov4[<span class="fu">is.na</span>(Cov4[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>Cov4_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov4,AOI)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>Cov4_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov4_crop,AOI)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>Cov4_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov4_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>Cov5<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M05.tif&quot;</span>)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>Cov5[<span class="fu">is.na</span>(Cov5[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>Cov5_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov5,AOI)</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>Cov5_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov5_crop,AOI)</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>Cov5_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov5_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>Cov6<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M06.tif&quot;</span>)</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>Cov6[<span class="fu">is.na</span>(Cov6[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>Cov6_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov6,AOI)</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>Cov6_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov6_crop,AOI)</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>Cov6_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov6_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>Cov7<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M07.tif&quot;</span>)</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>Cov7[<span class="fu">is.na</span>(Cov7[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>Cov7_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov7,AOI)</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>Cov7_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov7_crop,AOI)</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>Cov7_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov7_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>Cov8<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M08.tif&quot;</span>)</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>Cov8[<span class="fu">is.na</span>(Cov8[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>Cov8_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov8,AOI)</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>Cov8_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov8_crop,AOI)</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>Cov8_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov8_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>Cov9<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M09.tif&quot;</span>)</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>Cov9[<span class="fu">is.na</span>(Cov9[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>Cov9_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov9,AOI)</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>Cov9_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov9_crop,AOI)</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>Cov9_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov9_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>Cov10<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M10.tif&quot;</span>)</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>Cov10[<span class="fu">is.na</span>(Cov10[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>Cov10_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov10,AOI)</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>Cov10_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov10_crop,AOI)</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>Cov10_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov10_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>Cov11<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M11.tif&quot;</span>)</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>Cov11[<span class="fu">is.na</span>(Cov11[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>Cov11_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov11,AOI)</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>Cov11_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov11_crop,AOI)</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>Cov11_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov11_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>Cov12<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M12.tif&quot;</span>)</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>Cov12[<span class="fu">is.na</span>(Cov12[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>Cov12_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov12,AOI)</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>Cov12_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov12_crop,AOI)</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>Cov12_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov12_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>Stack_Cov<span class="ot">&lt;-</span><span class="fu">stack</span>(Cov1_res,Cov2_res,Cov3_res,Cov4_res,Cov5_res,Cov6_res,Cov7_res,Cov8_res,Cov9_res,Cov10_res,Cov11_res,Cov12_res)</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a><span class="co"># rescale values to 1 if it is bare soil and 0.6 if it is vegetated.</span></span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>Cov<span class="ot">&lt;-</span>((Stack_Cov)<span class="sc">*</span>(<span class="sc">-</span><span class="fl">0.4</span>))<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Cov,<span class="at">filename=</span><span class="st">&#39;Cov_stack_AOI.tif&#39;</span>,<span class="at">format=</span><span class="st">&#39;GTiff&#39;</span>)</span></code></pre></div>
<p>Once the monthly vegetation cover layers are downloaded from Google Drive, we will generate a stack of those layers. We will first open script number 7 “Vegetation_Cover_stack.R” and the required packages. Then, we will need to open the country polygon vector and set the working directory for the input and the output layers.</p>
<p><strong>Table 9.8</strong> <em>Script Number 8. Clay Layer from ISRIC. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.7.png" /></p>
<p>ISRIC clay layers represent the clay content (0-2 micrometer; in g/100g; w%) at four standard depths (Sl1=0-1cm; Sl2=1-5; Sl3=5-15cm; Sl4=15-30 cm) at a 250m resolution. The objective of this script is to aggregate the different layers into one layer by estimating the weighted average of the four depths:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>WD_ISRIC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/INPUTS/CLAY&quot;</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>WD_CLAY<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CLAY&quot;</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_ISRIC)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>Clay1<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;CLYPPT_M_sl1_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>Clay2<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;CLYPPT_M_sl2_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>Clay3<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;CLYPPT_M_sl3_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>Clay4<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;CLYPPT_M_sl4_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>Clay1_AR<span class="ot">&lt;-</span><span class="fu">crop</span>(Clay1,AOI)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>Clay2_AR<span class="ot">&lt;-</span><span class="fu">crop</span>(Clay2,AOI)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>Clay3_AR<span class="ot">&lt;-</span><span class="fu">crop</span>(Clay3,AOI)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>Clay4_AR<span class="ot">&lt;-</span><span class="fu">crop</span>(Clay4,AOI)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of four depths </span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>WeightedAverage<span class="ot">&lt;-</span><span class="cf">function</span>(r1,r2,r3,r4){<span class="fu">return</span>(r1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">30</span>)<span class="sc">+</span>r2<span class="sc">*</span>(<span class="dv">4</span><span class="sc">/</span><span class="dv">30</span>)<span class="sc">+</span>r3<span class="sc">*</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">30</span>)<span class="sc">+</span>r4<span class="sc">*</span>(<span class="dv">15</span><span class="sc">/</span><span class="dv">30</span>))}</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>Clay_WA<span class="ot">&lt;-</span><span class="fu">overlay</span>(Clay1_AR,Clay2_AR,Clay3_AR,Clay4_AR,<span class="at">fun=</span>WeightedAverage)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(Clay_WA,AOI)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLAY)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Clay_WA_AOI,<span class="at">filename=</span><span class="st">&quot;Clay_WA_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&#39;GTiff&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="preparing-the-land-use-layer" class="section level2" number="9.3">
<h2 number="9.3"><span class="header-section-number">9.3</span> Preparing the land use layer</h2>
<p>The land use layer is one of the most important layers in the process, as it defines the target areas and production systems to be modeled.
The land use layer will be needed:</p>
<ul>
<li>to account for major land use changes during the 2000-2020 period;</li>
<li>to obtain the DPM/RPM ratios required in the RothC model ( See Chapter 4);</li>
<li>to define the modeling units/target points where the model is to be run (agricultural lands in 2020).</li>
</ul>
<p>Each modeling phase will require specific land use layers. For the ‘spin up’ phase, users should use a representative land use layer for the period 1980-2000 (e.g. land use layer as in year 2000), or best available land use layer. For the ‘warm-up’ phase, users can use year to year land use layers (2000 to 2020), or a representative land use layer for the period, depending on the available information. The ‘warm-up’ land use layer accounts for year to year changes in the land use during the period (for example a pixel that changes from forest to cropland). The script will need a stack of land use layers, one layer for each year of the warm up phase. If the user does not want to model changes in the land use layer over the warm up phase, or information is not available, the same land use layer for each year can be used over the warm-up phase. For the ‘forward’ phase, the latest best available land use layer should be used.
As a minimum, the last available land use data at 1x1 km resolution shall be defined. The predominant land use category in each cell of the 1x1 km grid shall be selected if finer resolutions are available.
The land use classes can be derived from land cover classes from different national, regional or global datasets which best correlate with national land use. The land use layers are used in the three modelling phases to generate a decomposition rate DR layer (generated through scripts 10, 11, and 12, See sections 9.8-9.10), that represents the above mentioned DPM/RPM ratios for the different land use classes. In scripts 10,11 and 12, default DPM/RPM values are assigned to each FAO Global Land Cover (GLC-SHARE) class (See Table 6.1 Chapter 6; Section 6.7; and scripts 10,11 and 12). For more information on this classification refer to FAO (2014) and to the FAO Land and Water site: <a href="http://www.fao.org/land-water/land/land-governance/land-resources-planning-toolbox/category/details/en/c/1036355/" class="uri">http://www.fao.org/land-water/land/land-governance/land-resources-planning-toolbox/category/details/en/c/1036355/</a>
Thus, land cover classes obtained from different datasets (e.g. European Space Agency - ESA) need to be re-classified into FAO land cover classes in a Geotiff format if the scripts 10,11 and 12 are to be run with the default land classes and DPM/RPM ratios provided with the training material.
In this section, we provide a script to transform ESA land use cover classes to FAO land use classes (script 9), which can be used as a model to convert and use classes from other datasets. Users can however modify the DPM/RPM default values (See Table 6.1, Chapter 6) based on local knowledge and available information, create additional land use classes or disaggregate the FAO land use classes, and assign DPM/RPM ratios to those new classes by modifying the provided scripts. Users are encouraged to leverage available local knowledge and data to produce the most accurate SOCseq maps possible. With this in mind, if more detailed land use maps, i.e. containing information about the types of cropping systems present, and local data on the DPM/RPM for the specific land use types are easily accessible, the provided script should be edited accordingly.<br />
Finally, the land use layer is also needed to define the target points where the three phases of the protocol will be run. In section 9.7 we provide a Qgis model to generate the target points from the land use layer. Defining the target points out of the land use layer will allow us to run the model just in the pixels with the land use classes of interest.</p>
<p>Depending on whether yearly land use layers are available for the forward phase, this technical manual contains alternative scripts both for the data preparation phase (Scripts 9_Land_Use_ESA_to_FAO_classes_LUsim.R and 11_WARM_UP_STACK_V5_LUsim.R) and the modelling phase (Script 14_ROTH_C_WARM_UP_UNC_v3_LUsim.R). Figure illustrates the script sequence to be followed depending on whether yearly land use change layers are available for the warm up phase.</p>
<p><img src="images/Figure_9.6.png" alt="Figure 9.6 Script sequence based on wether yearly land use change layers for the warm up phase are available" />
***</p>
<div id="script-number-9-land_use_esa_to_fao_classes.r-no-land-use-change" class="section level3" number="9.3.1">
<h3 number="9.3.1"><span class="header-section-number">9.3.1</span> Script Number 9 “Land_Use_ESA_to_FAO_classes.R” No land use change</h3>
<p>Script number 9 transforms the ESA (European Space Agency 2015; 300 m resolution; ESA CCI Land cover website) land cover classes to the FAO land use classes. This script can be modified to be used with any other land use dataset.</p>
<p><strong>Table 9.9</strong> <em>Script Number 9. ESA Land Use to FAO classes. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.8.png" /></p>
<p>First, we will need to open the R packages, open the shapefile of the region/country to be modelled, and open the land use/land cover data set to be re-classified into FAO land use classes:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Land Use Layer (ESA)</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>ESA_LU<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;ESACCI-LC-L4-LCCS-Map-300m-P1Y-2015-v2.0.7_subs.tif&quot;</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ESA_LU)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut the LU layer by the country polygon</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>ESA_LU_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(ESA_LU,AOI)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ESA_LU_AOI)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify ESA LAND USE to FAO LAND USE classes</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     0 = 0   No Data</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   190 = 1 Artificial</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   10 11 20 30 40 = 2 Croplands</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   130 = 3 Grassland</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   50 60 61 62 70 71 72 80 81 82 90 100 110 = 4 Tree Covered</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   120 121 122= 5 Shrubs Covered</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   160 180 = 6 Herbaceous vegetation flooded</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   170 = 7 Mangroves</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   150 151 152 153= 8 Sparse Vegetation</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   200 201 202 = 9 Baresoil</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   220 = 10 Snow and Glaciers</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   210 = 11 Waterbodies</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   12 = 12 Treecrops</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   20 = 13 Paddy fields(rice/ flooded crops)</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify matrix. &quot;Is&quot; to &quot;become&quot;</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>is<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">190</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">130</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">61</span>,<span class="dv">62</span>,<span class="dv">70</span>,<span class="dv">71</span>,<span class="dv">72</span>,<span class="dv">80</span>,<span class="dv">81</span>,<span class="dv">82</span>,<span class="dv">90</span>,<span class="dv">100</span>,<span class="dv">110</span>,<span class="dv">120</span>,<span class="dv">121</span>,<span class="dv">122</span>,<span class="dv">160</span>,<span class="dv">180</span>,<span class="dv">170</span>,<span class="dv">150</span>,<span class="dv">151</span>,<span class="dv">152</span>,<span class="dv">153</span>,<span class="dv">200</span>,<span class="dv">201</span>,<span class="dv">202</span>,<span class="dv">220</span>,<span class="dv">210</span>,<span class="dv">12</span>)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>become<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>recMat<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">c</span>(is,become),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">37</span>)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>ESA_FAO <span class="ot">&lt;-</span> <span class="fu">reclassify</span>(ESA_LU_AOI, recMat)</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to SOC map layer extent and resolution</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>ESA_FAO_res<span class="ot">&lt;-</span><span class="fu">resample</span>(ESA_FAO,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>ESA_FAO_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(ESA_FAO_res,SOC_MAP_AOI) </span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Save Land Use raster</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ESA_FAO_mask,<span class="at">filename=</span><span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&#39;GTiff&#39;</span>)</span></code></pre></div>
</div>
<div id="script-number-9-land_use_esa_to_fao_classes_lusim.r-land-use-change-simulation" class="section level3" number="9.3.2">
<h3 number="9.3.2"><span class="header-section-number">9.3.2</span> Script Number 9 “Land_Use_ESA_to_FAO_classes_LUsim.R” Land use change simulation</h3>
<p>Script number 9 transforms the ESA (European Space Agency 2000 to 2018; 300 m resolution; ESA CCI Land cover website) land cover classes to the FAO land use classes. This script allows for the preparation of a stack with yearly land use layers to simulate land use change during the warm up phase.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DATE: 11-02-2021</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># MSc Ing Agr Luciano E Di Paolo</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="do">#### Prepare Land Use layer </span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>) <span class="co"># change for your own Area of interest</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Land Use Layer (ESA)</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>ESA_LU<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;LU_stack_ESA_2001-2018.tif&quot;</span>)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ESA_LU[[<span class="dv">1</span>]])</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut the LU layer by the country polygon</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>ESA_LU_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(ESA_LU,AOI)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ESA_LU_AOI[[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]])</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify ESA LAND USE to FAO LAND USE classes</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   0 = 0     No Data</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   190 = 1 Artificial</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   10 11 30 40 = 2 Croplands</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   130 = 3 Grassland</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   50 60 61 62 70 71 72 80 81 82 90 100 110 = 4 Tree Covered</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   120 121 122= 5 Shrubs Covered</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   160 180 = 6 Herbaceous vegetation flooded</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   170 = 7 Mangroves</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   150 151 152 153= 8 Sparse Vegetation</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   200 201 202 = 9 Baresoil</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   220 = 10 Snow and Glaciers</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   210 = 11 Waterbodies</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   12  = 12 Treecrops</span></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 = 13 Paddy fields(rice/ flooded crops)</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a reclassification matrix. &quot;Is&quot; to &quot;become&quot;</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>is<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">190</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">130</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">61</span>,<span class="dv">62</span>,<span class="dv">70</span>,<span class="dv">71</span>,<span class="dv">72</span>,<span class="dv">80</span>,<span class="dv">81</span>,<span class="dv">82</span>,<span class="dv">90</span>,<span class="dv">100</span>,<span class="dv">110</span>,<span class="dv">120</span>,<span class="dv">121</span>,<span class="dv">122</span>,<span class="dv">160</span>,<span class="dv">180</span>,</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a><span class="dv">170</span>,<span class="dv">150</span>,<span class="dv">151</span>,<span class="dv">152</span>,<span class="dv">153</span>,<span class="dv">200</span>,<span class="dv">201</span>,<span class="dv">202</span>,<span class="dv">220</span>,<span class="dv">210</span>,<span class="dv">12</span>,<span class="dv">20</span>)</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>become<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>)</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>recMat<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">c</span>(is,become),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">37</span>)</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>ESA_FAO <span class="ot">&lt;-</span> <span class="fu">reclassify</span>(ESA_LU_AOI, recMat)</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to SOC map layer extent and resolution</span></span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>) <span class="co"># change for your own SOC MAP</span></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>ESA_FAO_res<span class="ot">&lt;-</span><span class="fu">resample</span>(ESA_FAO,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>ESA_FAO_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(ESA_FAO_res,SOC_MAP_AOI) </span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Save Land Use raster</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ESA_FAO_mask,<span class="at">filename=</span><span class="st">&quot;ESA_Land_Cover_12clases_FAO_Stack_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&#39;GTiff&#39;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a><span class="co"># We save separately the land use from 2018 to perform the target&#39;s points creation</span></span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ESA_FAO_mask[[<span class="dv">18</span>]],<span class="at">filename=</span><span class="st">&quot;ESA_Land_Cover_12clases_FAO_2018_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&#39;GTiff&#39;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><strong>Table 9.9</strong> <em>Script Number 9. ESA Land Use to FAO classes. Inputs and Outputs</em></p>
</div>
</div>
<div id="harmonization-of-soil-climate-and-vegetation-layers." class="section level2" number="9.4">
<h2 number="9.4"><span class="header-section-number">9.4</span> Harmonization of soil, climate and vegetation layers.</h2>
<p>Once all soil, climate, vegetation and land use layers are created, they need to be harmonized in order to run the model. The harmonization of layers consists of three steps. First, if the model is to be run for an entire country, layers need to be harmonized to the extents of the country boundaries (country polygon layer extents). Second, a resampling process is required in order to match the spatial resolution to the master layer (SOC FAO layer). Finally, a masking process is required to cut the layer with the vector polygon boundaries. After the harmonization of all layers, we will generate a raster stack of all layers needed to run the model. The harmonization/stacking process will be performed three times (scripts 10,11,12), one for each modelling phase.</p>
<div id="script-number-10.-spin_up_stack.v3.r" class="section level3" number="9.4.1">
<h3 number="9.4.1"><span class="header-section-number">9.4.1</span> Script Number 10. “SPIN_UP_STACK.v3.R”</h3>
<p>Script number 10 is intended to harmonize all layers needed to complete phase 1 (long spin-up) of the spatial RothC model. The result of this script is a simple raster stack which contains all the data to perform the spin-up phase. To generate the stack we will need the SOC FAO layer (master layer), the clay layer (from script number 8), the three climate stacks (from script number 1), the land use layer (from script number 9), and the vegetation cover stack (from script number 7).</p>
<p><strong>Table 9.10</strong> <em>Script Number 10. Stack Layers for SPIN UP phase. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.9.png" /></p>
<p>First, we will open the required R-packages and a shapefile (polygon) which represents the country boundary. In the script below we will be using an example but when running it (AR), the user will have to replace the file according to the target country. The user can also modify the names of the variables inside the script. However, as these variables will only exist inside the script, it is not necessary.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Prepare the layers for the SPIN UP process of the Roth C Model. </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>WD_CLAY<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CLAY&quot;</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>WD_CLIM<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>WD_COV<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/COV&quot;</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>WD_STACK<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/STACK&quot;</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>The second step is to load the latest version of FAO Soil Organic Carbon map <span class="fu">layer</span> (Master Layer), created <span class="cf">in</span> script number <span class="fl">0.</span> </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP FAO</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a> Next, we will open the clay content <span class="fu">layer</span> (from script number <span class="dv">8</span>)<span class="sc">:</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Clay layer</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLAY)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>Clay_AR_Avg<span class="ot">&lt;-</span><span class="fu">crop</span>(Clay_AR_Avg,AR)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>Clay_AR_Avg<span class="ot">&lt;-</span><span class="fu">mask</span>(Clay_AR_Avg,AR)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>Clay_AR_Avg_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Clay_AR_Avg,SOC_MAP_AR,<span class="at">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>Next, we will open the climate raster <span class="fu">layers</span> (generated <span class="cf">in</span> script number <span class="dv">1</span>).  These layers come from the CRU database, but the user can choose local layers <span class="cf">if</span> desired, as long as they match the arrangement and format needed <span class="cf">for</span> running the model.</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Precipitation layer </span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLIM)</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>PREC<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Prec_Stack_81-00_CRU.tif&quot;</span>)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(PREC,AOI)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(PREC_AOI,SOC_MAP_AOI)</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(PREC_AOI,AOI)</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(PREC_AOI)</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Temperatures layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>TEMP<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Temp_Stack_81-00_CRU.tif&quot;</span>)</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(TEMP,AOI)</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(TEMP_AOI,SOC_MAP_AOI)</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(TEMP_AOI,AOI)</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(TEMP_AOI)</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Potential Evapotranspiration layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>PET<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;PET_Stack_81-00_CRU.tif&quot;</span>)</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(PET,AOI)</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(PET_AOI,SOC_MAP_AOI)</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(PET_AOI,AOI)</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(PET_AOI)</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>Next, we will open, resample and mask the land use raster layer to be used <span class="cf">in</span> the spin up <span class="fu">phase</span> (representative <span class="dv">1980-2000</span> period).  In this example we will use the ESA land used reclassified into FAO land use <span class="fu">classes</span> (script <span class="dv">9</span>)</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a><span class="co"># OPen Land Use layer reclassify to FAO classes </span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 No Data</span></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 Artificial</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 Croplands</span></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 Grassland</span></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 Tree Covered</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 Shrubs Covered</span></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 Herbaceous vegetation flooded</span></span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 Mangroves</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 8 Sparse Vegetation</span></span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 9 Baresoil</span></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 Snow and Glaciers</span></span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a><span class="co"># 11 Waterbodies</span></span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 12 TreeCrops</span></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 13 Paddy fields</span></span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>Then, we will open the vegetation cover <span class="fu">layers</span> (created <span class="cf">in</span> script number <span class="dv">7</span>)<span class="sc">:</span></span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Vegetation Cover layer </span></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_COV)</span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a>Cov_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span></code></pre></div>
<p>The script then creates a DR layer (DPM/RPM ratio). Here the DR layer is derived from the Land use layer, assigning default DPM/RPM ratios to each FAO land cover class (See Table 9.13). Users can modify these ratios according to local expertise and available local information.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use Land use layer to convert it to DR layer </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#DPM/RPM (decomplosable vs resistant plant material)</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#(1) Most agricultural crops and improved grassland and tree crops 1.44 </span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#(2) Unimproved grassland and schrub 0.67</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span><span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span><span class="fl">1.44</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span><span class="fl">0.25</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span><span class="fl">0.67</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a> Finally, we will create a stack with all the raster layers that have been prepared.</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a> <span class="co"># STACK all layers</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>Stack_Set_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,TEMP_AOI,PREC_AOI,PET_AOI,DR,LU_AOI,Cov_AOI)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_STACK)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Stack_Set_AOI,<span class="at">filename=</span>(<span class="st">&quot;Stack_Set_SPIN_UP_AOI.tif&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-11.-warm_up_stack_v5.r-no-land-use-change" class="section level3" number="9.4.2">
<h3 number="9.4.2"><span class="header-section-number">9.4.2</span> Script Number 11. “WARM_UP_STACK_V5.R” No Land use change</h3>
<p>Script number 11 is intended to harmonize all layers required to run the phase 2 (WARM UP) of the spatial RothC model. The result of this script is a simple raster stack which contains most of the layers needed for the warm-up phase. To generate the stack we will need the latest version of SOC FAO layer (master layer), the clay layer (from script number 8), land use layers (from script number 9), a land use stack (one land use layer per year), a vegetation cover stack (from script number 7) and the NPP stack (from script number 4). The climate layers and the NPP mean are additional layers that will be needed in the WARM UP phase but will not be part of this stack because of the final size of the output file.</p>
<p><strong>Table 9.11</strong> <em>Script Number 11. Stack layers for Warm Up phase. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.10.png" /></p>
<p>First, we will load the packages, set the number of years of the warmup phase and set the directories of each layer. Then we will open the country vector polygon boundaries:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the number of years of the warm up</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>nWUP<span class="ot">&lt;-</span><span class="dv">18</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>WD_CLAY<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/INPUTS/CLAY&quot;</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>WD_CLIM<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>WD_COV<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/COV&quot;</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>WD_STACK<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/STACK&quot;</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>WD_NPP<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/NPP&quot;</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span></code></pre></div>
<p>Then, we will open the harmonized FAO GSOCmap of the country created in script number 0:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP </span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>Then we will open the clay layer created <span class="cf">in</span> script number <span class="dv">8</span><span class="sc">:</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLAY)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;bilinear&#39;</span>) </span></code></pre></div>
<p>Then, we will open the Land Use layers required for the warm up phase (2000-2020). In this example we used the ESA land use (2015) reclassified into to the FAO land use classes.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OPen Land Use layer (ESA)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span></code></pre></div>
<p>We will then open the vegetation cover layer previously created in the script number 7:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Vegetation Cover layer </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_COV)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>Cov_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span></code></pre></div>
<p>If year to year land use layers are available for the warm up phase (2000-2020), we will open the Land Use stack of the annual land use layers. If annual land use layers are not available, we will just replicate a representative land use layer for the warm-up phase, as previously loaded.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Land Use Stack , One Land use layer for each year (in this example we use the same LU for the 18/20 year #period set previously in the nWUP variable</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a> LU_Stack <span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="fu">replicate</span>(nWUP, LU_AOI))</span></code></pre></div>
<p>Then, we will create a “DR” stack layer, one DR layer per year of the WARM UP phase.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DR Layer from LU layer (ESA land use , 14 classes)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#DPM/RPM (decomposable vs resistant plant material)</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#(1) Most agricultural crops and improved grassland or tree crops 1.44 </span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#(2) Unimproved grassland and shrub 0.67</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span><span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span><span class="fl">1.44</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span><span class="fl">0.25</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span><span class="fl">0.67</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>DR_Stack<span class="ot">&lt;-</span>LU_Stack</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(LU_Stack)){</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>DR_Stack[[i]]<span class="ot">&lt;-</span>(LU_Stack[[i]]<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">12</span>)<span class="sc">*</span><span class="fl">1.44</span><span class="sc">+</span> (LU_Stack[[i]]<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span><span class="fl">0.25</span> <span class="sc">+</span> (LU_Stack[[i]]<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span><span class="fl">0.67</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, we will run the rest of the code and save the raster stack containing all the necessary layers to run the ‘warm up’ phase.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># STACK all layers</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>Stack_Set_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,Cov_AOI,LU_Stack,DR_Stack)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_STACK)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Stack_Set_AOI,<span class="at">filename=</span>(<span class="st">&quot;Stack_Set_WARM_UP_AOI.tif&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-11.-warm_up_stack_v5_lusim.r-land-use-change-simulation" class="section level3" number="9.4.3">
<h3 number="9.4.3"><span class="header-section-number">9.4.3</span> Script Number 11. WARM_UP_STACK_V5_LUsim.R Land use change simulation</h3>
<p>The following script is to be used if yearly land use layers to simulate land use change are available. This script uses the output from script numer 9 Land_Use_ESA_to_FAO_classes_LUsim.R</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DATE 11-2-2021</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD NPP_MIN AND NPP_MAX TO THE STACK TO CALCULATE UNCERTAINTIES</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># MSc Ing Agr Luciano E Di Paolo</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="do">#### Prepare the layers for the WARM UP Roth C Model. </span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the number of years of the warm up</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>nWUP<span class="ot">&lt;-</span><span class="dv">18</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>WD_CLAY<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/CLAY&quot;</span>)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>WD_CLIM<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>WD_COV<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/COV&quot;</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>WD_STACK<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/STACK&quot;</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>WD_NPP<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/NPP&quot;</span>)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>) <span class="co"># change the AOI</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP </span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>) <span class="co"># change the SOC_MAP</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLAY)</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="co"># OPen Land Use layer (ESA)</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 No Data</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 Artificial</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 Croplands</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 Grassland</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 Tree Covered</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 Shrubs Covered</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 Herbaceous vegetation flooded</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 Mangroves</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 8 Sparse Vegetation</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 9 Baresoil</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 Snow and Glaciers</span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 11 Waterbodies</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="co"># 12 TreeCrops</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="co"># 13 Paddy fields</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_Stack_AOI.tif&quot;</span>)</span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Vegetation Cover layer </span></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_COV)</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>Cov_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Land Use Stack , One Land use layer for each year (in this example we use the same LU for the 18 year period</span></span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a><span class="co">#LU_Stack &lt;-stack(replicate(nWUP, LU_AOI))</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="co">#LU_Stack &lt;-stack(ESA[2001:2015],2015,2015,2015)</span></span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>LU_Stack<span class="ot">&lt;-</span>LU_AOI</span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert LU layer  to DR layer (ESA land use , 14 classes)</span></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a><span class="co">#DPM/RPM (decomplosable vs resistant plant material)</span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="co">#(1) Most agricultural crops and improved grassland or tree crops 1.44 </span></span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a><span class="co">#(2) Unimproved grassland and schrub 0.67</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a><span class="co">#DR&lt;-(LU_AOI==2 | LU_AOI==12 | LU_AOI==13)*1.44+ (LU_AOI==4)*0.25 + (LU_AOI==3 | LU_AOI==5 | LU_AOI==6 | LU_AOI==8)*0.67</span></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>DR_Stack<span class="ot">&lt;-</span>LU_Stack</span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(LU_Stack)){</span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a>DR_Stack[[i]]<span class="ot">&lt;-</span>(LU_Stack[[i]]<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span><span class="fl">1.44</span><span class="sc">+</span> (LU_Stack[[i]]<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span><span class="fl">0.25</span> <span class="sc">+</span> (LU_Stack[[i]]<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span><span class="fl">0.67</span></span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a><span class="co"># STACK all layers</span></span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a>Stack_Set_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,Cov_AOI,LU_Stack,DR_Stack)</span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_STACK)</span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Stack_Set_AOI,<span class="at">filename=</span>(<span class="st">&quot;Stack_Set_WARM_UP_AOI.tif&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="script-number-12.-forward_stack.r" class="section level3" number="9.4.4">
<h3 number="9.4.4"><span class="header-section-number">9.4.4</span> Script Number 12. “FORWARD_STACK.R”</h3>
<p>Script number 12 harmonizes all layers needed to run phase 3 (forward) of the spatial Roth C model. The result of the script is a simple raster stack which contains the layers needed to perform the forward phase. To generate the stack we will need the SOC FAO layer (master layer), the clay layer (from script number 8), the three climate stacks required for the forward phase (from script number 2), the land use layer or the forward phase (from script number 9), and the vegetation cover stack (from script number 7).</p>
<p><strong>Table 9.12</strong> <em>Script Number 12. Stack layers for forward phase. Inputs and Outputs.</em></p>
<p><img src="tables/Table_9.11.png" /></p>
<p>First, we will load the packages, set path to the files directories and open the country vector polygon boundaries.</p>
<div id="prepare-the-layers-for-the-foward-mode-roth-c-model." class="section level4" number="9.4.4.1">
<h4 number="9.4.4.1"><span class="header-section-number">9.4.4.1</span> Prepare the layers for the FOWARD Mode Roth C Model.</h4>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>WD_CLAY<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CLAY&quot;</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>WD_CLIM<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>WD_COV<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/COV&quot;</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>WD_STACK<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/STACK&quot;</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>Then, we will open the SOC layer and the clay layer.</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP </span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLAY)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>Then we will open the <span class="dv">2000-2020</span> average climate layers <span class="fu">created</span> (as the one created <span class="cf">in</span> script number <span class="dv">2</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Precipitation layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLIM)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>PREC<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Prec_Stack_01-18_CRU.tif&quot;</span>)</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(PREC,AOI)</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(PREC_AOI,SOC_MAP_AOI)</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(PREC_AOI,AOI)</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(PREC_AOI)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Temperatures layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>TEMP<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Temp_Stack_01-18_CRU.tif&quot;</span>)</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(TEMP,AOI)</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(TEMP_AOI,SOC_MAP_AOI)</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(TEMP_AOI,AOI)</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(TEMP_AOI)</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Potential Evapotranspiration layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>PET<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;PET_Stack_01-18_CRU.tif&quot;</span>)</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(PET,AOI)</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(PET_AOI,SOC_MAP_AOI)</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(PET_AOI,AOI)</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(PET_AOI)</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>Then, we will open the land use <span class="fu">layer</span> (latest available year) created <span class="cf">in</span> script number <span class="fl">10.</span></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>Then, we will open the vegetation cover layer created <span class="cf">in</span> script number <span class="fl">7.</span></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Vegetation Cover </span></span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_COV)</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>Cov_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>As <span class="cf">in</span> the previous scripts, this script creates a DR <span class="fu">layer</span> (DPM<span class="sc">/</span>RPM ratio), assigning default DPM<span class="sc">/</span>RPM ratios to each FAO land cover <span class="fu">class</span> (See Table <span class="fl">9.13</span>). Users can modify these ratios according to local expertise and available local information. </span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Land use layer and convert it to DR layer (mod 12 , 14 classes)</span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a><span class="co">#DPM/RPM (decomplosable vs resistant plant material...como se divide los C inputs)</span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a><span class="co">#(1) Most agricultural crops and improved grassland or tree crops 1.44 </span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a><span class="co">#(2) Unimproved grassland and schrub 0.67</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span><span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span><span class="fl">1.44</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span><span class="fl">0.25</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span><span class="fl">0.67</span></span></code></pre></div>
<p>We will create a stack for the forward modelling phase. We will have to define the filename and save the output stack.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># STACK all layers</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>Stack_Set_AR<span class="ot">&lt;-</span><span class="fu">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,TEMP_AOI,PREC_AOI,PET_AOI,DR,LU_AOI,Cov_AOI)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_STACK)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Stack_Set_AR,<span class="at">filename=</span>(<span class="st">&quot;Stack_Set_FOWARD.tif&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="defining-target-points-to-run-the-model" class="section level2" number="9.5">
<h2 number="9.5"><span class="header-section-number">9.5</span> Defining target points to run the model</h2>
<p>At this point we have three raster stacks for the different modelling phases. We need to create the points where those simulations will be run in order to accelerate the modelling process. These points will be the center of the pixels of the master layer (GSOCmap layer, script number 7). Later, we will convert the points containing the modelling output values back to a raster layer format.</p>
<div id="qgis-procedure-number-1-model" class="section level3" number="9.5.1">
<h3 number="9.5.1"><span class="header-section-number">9.5.1</span> QGIS Procedure number 1 (model)</h3>
<p>We will need the land use data of each pixel (we already corregistered the land use layer with the master layer at script number 7). Then we will use the land use layer of the country to generate the points. For this, we can use a QGIS model to create target points.</p>
<p><strong>Table 9.13</strong> <em>QGis procedure number 1. Create target points to run the model. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.12.png" /></p>
<p>We will open the Qgis, then go to the processing toolbox and click on the “open existing model” button. We will have to search for the model in the provided folder, called “4_Points_country”. We will have to load the model called “Qgis_Procedure_number_1.model3”. Once this is done, we can run the model from the processing toolbox.</p>
<div class="figure">
<img src="images/Figure_9.4.png" alt="" />
<p class="caption"><strong>Figure 9.4</strong> <em>Processing toolbox in Qgis</em></p>
</div>
<p>We will click the Empty_Points button and a window will pop up. We will select the Land use layer created in script number 10 (already resampled to match the extent and pixel size of the GSOCmap), set the path and the name of the output file, and click on the Execute button.</p>
<div class="figure">
<img src="images/Figure_9.5.png" alt="" />
<p class="caption"><strong>Figure 9.5</strong> <em>Qgis Window to edit the points generated.</em></p>
</div>
<p>This process will create vector points. Each point will be created in the centroid of each pixel of the land use layer. This vector will contain no fields. The scripts to run the model for each phase (SPIN_UP, WARM_UP, forward) will attach all the necessary data from the stacks (scripts number 10, 11 and 12) to each point.</p>
<!--chapter:end:09.Stage1_Preparation_of_input_data.rmd-->
</div>
</div>
</div>
<div id="stage-2-running-the-model-1" class="section level1" number="10">
<h1 number="10"><span class="header-section-number">10</span> | Stage 2: running the model</h1>
<p>Once all input layers are prepared, harmonized and stacked, we will run the three modeling phases. At this stage, we will run the model three times, once for each phase, so we will need three different scripts (scripts 13, 14 and 15), which use the same RothC function. For each script we will need the created raster stacks (in the case of the warm up phase we will also include the climate stacks), and the created target points. Each script will generate output vector points (containing the modeling results, i.e. SOC stocks of the different carbon pools of the RothC model). The output vector of each phase will be used as an input of the next modeling phase. Finally, after running the ‘forward’ phase, we will obtain an output vector file containing the SOC data for each projected scenario. This output vector will be used in the final script to generate the raster files to build the sequestration potential maps.</p>
<p>In each phase and script we will use the same RothC function. The RothC function is the core of the next three scripts and will be used to simulate the different C pools over the defined time periods. In the following a brief overview of the commands we will be running to perform the RothC calculations.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ROTH C MODEL FUNCTION .</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="do">########## function set up starts############### </span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>Roth_C<span class="ot">&lt;-</span><span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1){</span></code></pre></div>
<p>This function will calculate first the “Temperature factor per month” using a function from the SOILR package called “fT.RothC” :</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Temperature factor per month</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>fT<span class="ot">=</span><span class="fu">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span></code></pre></div>
<p>Then the function will calculate the “Moisture factor per month” (this function was modified from the original SOILR moisture function, to include the soil cover effect, as in the original RothC model (See Chapter 4):</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Moisture effects per month . </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>fw1func<span class="ot">&lt;-</span><span class="cf">function</span>(P, E, <span class="at">S.Thick =</span> <span class="dv">30</span>, <span class="at">pClay =</span> <span class="fl">32.0213</span>, <span class="at">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> P <span class="sc">-</span> E <span class="sc">*</span> pE</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    Acc.TSMD <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    B <span class="ot">=</span> <span class="fu">ifelse</span>(bare[i] <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>     Max.TSMD <span class="ot">=</span> <span class="sc">-</span>(<span class="dv">20</span> <span class="sc">+</span> <span class="fl">1.3</span> <span class="sc">*</span> pClay <span class="sc">-</span> <span class="fl">0.01</span> <span class="sc">*</span> (pClay<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (S.Thick<span class="sc">/</span><span class="dv">23</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>B)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">ifelse</span>(M[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i] <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i]</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> (Acc.TSMD[i] <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="sc">&lt;=</span> Max.TSMD) {</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Max.TSMD</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">ifelse</span>(Acc.TSMD <span class="sc">&gt;</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> ((Max.TSMD <span class="sc">-</span> </span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD)<span class="sc">/</span>(Max.TSMD <span class="sc">-</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD))))</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    b<span class="ot">&lt;-</span><span class="fu">clamp</span>(b,<span class="at">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(Acc.TSMD, b, Max.TSMD))</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>fW_2<span class="ot">&lt;-</span> <span class="fu">fw1func</span>(<span class="at">P=</span>(Precip[,<span class="dv">2</span>]), <span class="at">E=</span>(Evp[,<span class="dv">2</span>]), <span class="at">S.Thick =</span> soil.thick, <span class="at">pClay =</span> clay, <span class="at">pE =</span> <span class="dv">1</span>, <span class="at">bare=</span>bare1)<span class="sc">$</span>b </span></code></pre></div>
<p>Then the function will calculate the “vegetation cover factor” effect:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Vegetation Cover effects </span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>fC<span class="ot">&lt;-</span>Cov2[,<span class="dv">2</span>]</span></code></pre></div>
<p>In each script, we will need to set the factor frame to run the model (500 years for spin up, 18/20 years for the warm-up, 20 years for the forward), and run the model. We will have two options: one from the SoilR package (using “lsoda” function to solve the differential equations) and one from the soilassessment package that allows to change the differential equation solver, by default we will use the “euler” method, which is faster.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>xi.frame<span class="ot">=</span><span class="fu">data.frame</span>(years,<span class="fu">rep</span>(fT<span class="sc">*</span>fW_2<span class="sc">*</span>fC<span class="sc">*</span>fPR,<span class="at">length.out=</span><span class="fu">length</span>(years)))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from soilassessment</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Roth C soilassesment</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>Model3_spin<span class="ot">=</span><span class="fu">carbonTurnover</span>(<span class="at">tt=</span>years,<span class="at">C0=</span><span class="fu">c</span>(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),<span class="at">In=</span>Cinputs,<span class="at">Dr=</span>DR,<span class="at">clay=</span>clay,<span class="at">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>Ct3_spin<span class="ot">=</span>Model3_spin[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL FROM SOILR</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>poolSize3_spin<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(poolSize3_spin)</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="do">########## function set up ends###############</span></span></code></pre></div>
<div id="script-number-13.-roth_c_spin_up_v2.r" class="section level2" number="10.1">
<h2 number="10.1"><span class="header-section-number">10.1</span> Script Number 13. “ROTH_C_SPIN_UP_v2.R”</h2>
<p>Script number 13 implements the first modeling phase (long spin up phase). In this script we will load the stack generated in script number 10 and the target points (Section 9.7, QGIS model number 1). We will obtain an output vector containing our target points. This script runs the RothC model for 500 years to calculate the equilibrium carbon inputs (the carbon inputs needed to reach the 2001 SOC stocks) and the SOC stocks for the different pools. It first runs using a standard C input of 1 tC ha<sup>-1</sup> yr<sup>-1</sup>, and then equilibrium inputs are estimated from the obtained results and GSOCmap stocks (See Chapters 5 and 6). In this script we will use pedotransfer functions to estimate the SOC stocks of the different pools from the total SOC stock (Weiherm&amp;uuller et al., 2013) to accelerate the spin up process. All that information will be saved to the output vector (shapefile file).
Table 10.1 Script Number 13. Spin Up phase. Inputs and Outputs.</p>
<p>The SPIN UP Phase will allow us to calculate two outputs that will be saved to a point vector layer called “C_INPUT_EQ.shp”: equilibrium carbon inputs (Ceq) and the carbon stocks of the different soil C pools to run the
second phase (WARM UP phase).
First, the following packages are loaded into R:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SoilR)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span></code></pre></div>
<p>Then we will set the working directory.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>WD_FOLDER<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020&quot;</span>)</span></code></pre></div>
<p>Then, we need to load the target points created in the “qgis procedure number 1”.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector must be an empty points vector. </span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_FOLDER)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>Vector<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;INPUTS/TARGET_POINTS/Target_Points_sub.shp&quot;</span>)</span></code></pre></div>
<p>Then we need to open the stack with all the spin-up variables to run the model (from script number 7).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack_Set_1 is a stack that contains the spatial variables </span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>Stack_Set_1<span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;INPUTS/STACK/Stack_Set_SPIN_UP_AOI.tif&quot;</span>)</span></code></pre></div>
<p>We will run the next lines of the code and create an empty vector variable to save the outputs results of the model and the pedotransfer functions:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create A vector to save the results</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ<span class="ot">&lt;-</span>Vector</span></code></pre></div>
<p>Now, we need to extract the input variables from the raster stack to the target points (now called “Vector”). This step will allow us to continue working with a “dataframe” instead of a raster stack layer.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract variables to points</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>Vector_variables<span class="ot">&lt;-</span><span class="fu">extract</span>(Stack_Set_1,Vector,<span class="at">df=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>The next lines will define the different variables from the Vector_variables pool. We need to individualize them in separate variables. The last line of this block will set the number of years to run the RothC function.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the layers from the Vector</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>SOC_im<span class="ot">&lt;-</span>Vector_variables[[<span class="dv">2</span>]] <span class="co"># first band of the stack is the second column of the vector</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>clay_im<span class="ot">&lt;-</span>Vector_variables[[<span class="dv">3</span>]]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>DR_im<span class="ot">&lt;-</span>Vector_variables[[<span class="dv">40</span>]]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>LU_im<span class="ot">&lt;-</span>Vector_variables[[<span class="dv">41</span>]]</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Years for Cinputs calculations</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>years<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>,<span class="dv">500</span>,<span class="at">by=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>)</span></code></pre></div>
<p>Once we have defined the variables and time frame, we can start using the the RothC function.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ROTH C MODEL FUNCTION .</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="do">########## function set up starts###############</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>Roth_C<span class="ot">&lt;-</span><span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1,LU)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Paddy fields coefficent fPR = 0.4 if the target point is class = 13 , else fPR=1</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co"># From Shirato and Yukozawa 2004</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>fPR<span class="ot">=</span>(LU <span class="sc">==</span> <span class="dv">13</span>)<span class="sc">*</span><span class="fl">0.4</span> <span class="sc">+</span> (LU<span class="sc">!=</span><span class="dv">13</span>)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Temperature effects per month</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>fT<span class="ot">=</span><span class="fu">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Moisture effects per month . </span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>fw1func<span class="ot">&lt;-</span><span class="cf">function</span>(P, E, <span class="at">S.Thick =</span> <span class="dv">30</span>, <span class="at">pClay =</span> <span class="fl">32.0213</span>, <span class="at">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> P <span class="sc">-</span> E <span class="sc">*</span> pE</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    Acc.TSMD <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    B <span class="ot">=</span> <span class="fu">ifelse</span>(bare[i] <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>     Max.TSMD <span class="ot">=</span> <span class="sc">-</span>(<span class="dv">20</span> <span class="sc">+</span> <span class="fl">1.3</span> <span class="sc">*</span> pClay <span class="sc">-</span> <span class="fl">0.01</span> <span class="sc">*</span> (pClay<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (S.Thick<span class="sc">/</span><span class="dv">23</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>B)</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">ifelse</span>(M[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i] <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i]</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> (Acc.TSMD[i] <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="sc">&lt;=</span> Max.TSMD) {</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Max.TSMD</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">ifelse</span>(Acc.TSMD <span class="sc">&gt;</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> ((Max.TSMD <span class="sc">-</span> </span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD)<span class="sc">/</span>(Max.TSMD <span class="sc">-</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD))))</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    b<span class="ot">&lt;-</span><span class="fu">clamp</span>(b,<span class="at">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(b))   </span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>fW_2<span class="ot">&lt;-</span> <span class="fu">fw1func</span>(<span class="at">P=</span>(Precip[,<span class="dv">2</span>]), <span class="at">E=</span>(Evp[,<span class="dv">2</span>]), <span class="at">S.Thick =</span> soil.thick, <span class="at">pClay =</span> clay, <span class="at">pE =</span> <span class="dv">1</span>, <span class="at">bare=</span>bare1)<span class="sc">$</span>b </span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Vegetation Cover effects </span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>fC<span class="ot">&lt;-</span>Cov2[,<span class="dv">2</span>]</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>xi.frame<span class="ot">=</span><span class="fu">data.frame</span>(years,<span class="fu">rep</span>(fT<span class="sc">*</span>fW_2<span class="sc">*</span>fC<span class="sc">*</span>fPR,<span class="at">length.out=</span><span class="fu">length</span>(years)))</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from soilassessment</span></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a><span class="co">#Roth C soilassesment</span></span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>Model3_spin<span class="ot">=</span><span class="fu">carbonTurnover</span>(<span class="at">tt=</span>years,<span class="at">C0=</span><span class="fu">c</span>(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),<span class="at">In=</span>Cinputs,<span class="at">Dr=</span>DR,<span class="at">clay=</span>clay,<span class="at">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>Ct3_spin<span class="ot">=</span>Model3_spin[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL FROM SOILR</span></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>poolSize3_spin<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(poolSize3_spin)</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a><span class="do">########## function set up ends###############</span></span></code></pre></div>
<p>After setting the RothC function we will iterate it over each one of the target points.<br />
For each target point we extract the climate variables and the monthly vegetation cover values. Each variable will be assigned to an R variable.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterates over the area of interest</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="do">########for loop starts###############</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Vector_variables)[<span class="dv">1</span>]) {</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the variables </span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>Vect<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Vector_variables[i,])</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">4</span><span class="sc">:</span><span class="dv">15</span>]))</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Temp=</span>Temp[,<span class="dv">1</span>])</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">16</span><span class="sc">:</span><span class="dv">27</span>]))</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Precip=</span>Precip[,<span class="dv">1</span>])</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">28</span><span class="sc">:</span><span class="dv">39</span>]))</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Evp=</span>Evp[,<span class="dv">1</span>])</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>Cov<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">42</span><span class="sc">:</span><span class="dv">53</span>]))</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>Cov1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>Cov2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span></code></pre></div>
<p>The next line will avoid running the model over points with unreliable data, that may contain missing values or unrealistic values.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Avoid calculus over Na values </span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(Evp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Temp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(SOC_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(clay_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Precip[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov2[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov1[,<span class="dv">1</span>]))  <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(DR_im[i])) <span class="sc">|</span>  (SOC_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span> (clay_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) ) {C_INPUT_EQ[i,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">0</span>}<span class="cf">else</span>{</span></code></pre></div>
<p>Now we will set the value of each variable (SOC, Clay, DR, and Land Use) needed to run the model. The bare1 variable is used to derive the moisture factor.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the variables from the images</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>soil.thick<span class="ot">=</span><span class="dv">30</span>  <span class="co">#Soil thickness (organic layer topsoil), in cm</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>SOC<span class="ot">&lt;-</span>SOC_im[i]      <span class="co">#Soil organic carbon in Mg/ha </span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>clay<span class="ot">&lt;-</span>clay_im[i]        <span class="co">#Percent clay %</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>DR_im[i]              <span class="co"># DPM/RPM (decomplosable vs resistant plant material.)</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>bare1<span class="ot">&lt;-</span>(Cov1<span class="sc">&gt;</span><span class="fl">0.8</span>)           <span class="co"># If the surface is bare or vegetated</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>LU<span class="ot">&lt;-</span>LU_im[i]</span></code></pre></div>
<p>The next line will calculate the IOM fraction of the SOC, from the SOC value:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#IOM using Falloon method</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>FallIOM<span class="ot">=</span><span class="fl">0.049</span><span class="sc">*</span>SOC<span class="sc">^</span>(<span class="fl">1.139</span>) </span></code></pre></div>
<p>Now there are two options to calculate the uncertainties. One is to use your own SOC uncertainty layer: by loading it into R with the following lines of code:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you use a SOC uncertainty layer turn on this. First open the layer SOC_UNC </span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co">#(it must have the same extent and resolution of the SOC layer)</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SOC_min&lt;-(1-(SOC_UNC/100))*SOC</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SOC_max&lt;-(1+(SOC_UNC/100))*SOC</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define SOC min, max Clay min and max. </span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>SOC_min<span class="ot">&lt;-</span>SOC<span class="sc">*</span><span class="fl">0.8</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>SOC_max<span class="ot">&lt;-</span>SOC<span class="sc">*</span><span class="fl">1.2</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>clay_min<span class="ot">&lt;-</span>clay<span class="sc">*</span><span class="fl">0.9</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>clay_max<span class="ot">&lt;-</span>clay<span class="sc">*</span><span class="fl">1.1</span></span></code></pre></div>
<p>The script then uses the RothC function with the parameters listed below. We want to estimate the annual Carbon inputs needed to reach the actual GSOCmap value (equilibrium C inputs). We will first run the model assuming “Cinputs” equal 1. We can assume that SOC stock values when there are no C inputs (“Cinputs” equal to 0) will be equal to the inert organic carbon stocks (SOC=FallIOM). We can then build a simple linear model to estimate the “Cinputs” value needed to reach SOC FAO actual value (equilibrium C inputs, See modeling approach, Chapter 5 and 6).
b&lt;-1</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># C input equilibrium. (Ceq)</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>fb<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>b,<span class="at">years=</span>years,<span class="at">DPMptf=</span><span class="dv">0</span>, <span class="at">RPMptf=</span><span class="dv">0</span>, <span class="at">BIOptf=</span><span class="dv">0</span>, <span class="at">HUMptf=</span><span class="dv">0</span>, <span class="at">FallIOM=</span>FallIOM,<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>fb_t<span class="ot">&lt;-</span>fb[<span class="dv">1</span>]<span class="sc">+</span>fb[<span class="dv">2</span>]<span class="sc">+</span>fb[<span class="dv">3</span>]<span class="sc">+</span>fb[<span class="dv">4</span>]<span class="sc">+</span>fb[<span class="dv">5</span>]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>m<span class="ot">&lt;-</span>(fb_t<span class="sc">-</span>FallIOM)<span class="sc">/</span>(b)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>Ceq<span class="ot">&lt;-</span>(SOC<span class="sc">-</span>FallIOM)<span class="sc">/</span>m</span></code></pre></div>
<p>We will repeat the “C input eq. code” to calculate minimum and maximum carbon inputs at equilibrium, using the combination of environmental variables listed in chapter 12 (Uncertainties).</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># UNCERTAINTIES C input equilibrium (MINIMUM)</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>FallIOM_min<span class="ot">=</span><span class="fl">0.049</span><span class="sc">*</span>SOC_min<span class="sc">^</span>(<span class="fl">1.139</span>) </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>fb_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>b,<span class="at">years=</span>years,<span class="at">DPMptf=</span><span class="dv">0</span>, <span class="at">RPMptf=</span><span class="dv">0</span>, <span class="at">BIOptf=</span><span class="dv">0</span>, <span class="at">HUMptf=</span><span class="dv">0</span>, <span class="at">FallIOM=</span>FallIOM,<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC_min,<span class="at">clay=</span>clay_min,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>fb_t_MIN<span class="ot">&lt;-</span>fb_min[<span class="dv">1</span>]<span class="sc">+</span>fb_min[<span class="dv">2</span>]<span class="sc">+</span>fb_min[<span class="dv">3</span>]<span class="sc">+</span>fb_min[<span class="dv">4</span>]<span class="sc">+</span>fb_min[<span class="dv">5</span>]</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>m<span class="ot">&lt;-</span>(fb_t_MIN<span class="sc">-</span>FallIOM_min)<span class="sc">/</span>(b)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>Ceq_MIN<span class="ot">&lt;-</span>(SOC_min<span class="sc">-</span>FallIOM_min)<span class="sc">/</span>m</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># UNCERTAINTIES C input equilibrium (MAXIMUM)</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>FallIOM_max<span class="ot">=</span><span class="fl">0.049</span><span class="sc">*</span>SOC_max<span class="sc">^</span>(<span class="fl">1.139</span>) </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>fb_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>b,<span class="at">years=</span>years,<span class="at">DPMptf=</span><span class="dv">0</span>, <span class="at">RPMptf=</span><span class="dv">0</span>, <span class="at">BIOptf=</span><span class="dv">0</span>, <span class="at">HUMptf=</span><span class="dv">0</span>, <span class="at">FallIOM=</span>FallIOM,<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC_max,<span class="at">clay=</span>clay_max,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>fb_t_MAX<span class="ot">&lt;-</span>fb_max[<span class="dv">1</span>]<span class="sc">+</span>fb_max[<span class="dv">2</span>]<span class="sc">+</span>fb_max[<span class="dv">3</span>]<span class="sc">+</span>fb_max[<span class="dv">4</span>]<span class="sc">+</span>fb_max[<span class="dv">5</span>]</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>m<span class="ot">&lt;-</span>(fb_t_MAX<span class="sc">-</span>FallIOM_max)<span class="sc">/</span>(b)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>Ceq_MAX<span class="ot">&lt;-</span>(SOC_max<span class="sc">-</span>FallIOM_max)<span class="sc">/</span>m </span></code></pre></div>
<p>Now for each land use, we will run the “pedotransfer functions” (Weiherm&amp;uuller et al., 2013) to estimate the values of the SOC pools. Here is the example for the croplands land use. Then the same code will be executed for the rest of the land use classes.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SOC POOLS AFTER 500 YEARS RUN WITH C INPUT EQUILIBRIUM</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (LU<span class="sc">==</span><span class="dv">2</span>){</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>RPM_p_2<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">0.9902+0.4788</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>BIO_p_2<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">1.09038+0.04055</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>HUM_p_2<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.9878-0.3818</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>DPM_p_2<span class="ot">&lt;-</span>SOC<span class="sc">-</span>FallIOM<span class="sc">-</span>RPM_p_2<span class="sc">-</span>HUM_p_2<span class="sc">-</span>BIO_p_2</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>feq_t<span class="ot">&lt;-</span>RPM_p_2<span class="sc">+</span>BIO_p_2<span class="sc">+</span>HUM_p_2<span class="sc">+</span>DPM_p_2<span class="sc">+</span>FallIOM</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co">#uncertainties  MIN</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>RPM_p_2_min<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">0.9902+0.4788</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>BIO_p_2_min<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">1.09038+0.04055</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>HUM_p_2_min<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.9878-0.3818</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>DPM_p_2_min<span class="ot">&lt;-</span>SOC_min<span class="sc">-</span>FallIOM_min<span class="sc">-</span>RPM_p_2_min<span class="sc">-</span>HUM_p_2_min<span class="sc">-</span>BIO_p_2_min</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>feq_t_min<span class="ot">&lt;-</span>RPM_p_2_min<span class="sc">+</span>BIO_p_2_min<span class="sc">+</span>HUM_p_2_min<span class="sc">+</span>DPM_p_2_min<span class="sc">+</span>FallIOM_min</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co">#uncertainties  MAX</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>RPM_p_2_max<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">0.9902+0.4788</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>BIO_p_2_max<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">1.09038+0.04055</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>HUM_p_2_max<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.9878-0.3818</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>DPM_p_2_max<span class="ot">&lt;-</span>SOC_max<span class="sc">-</span>FallIOM_max<span class="sc">-</span>RPM_p_2_max<span class="sc">-</span>HUM_p_2_max<span class="sc">-</span>BIO_p_2_max</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>feq_t_max<span class="ot">&lt;-</span>RPM_p_2_max<span class="sc">+</span>BIO_p_2_max<span class="sc">+</span>HUM_p_2_max<span class="sc">+</span>DPM_p_2_max<span class="sc">+</span>FallIOM_max</span></code></pre></div>
<p>Finally, we will save the outputs pools to the variables C_INPUT_EQ :</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">2</span>]<span class="ot">&lt;-</span>SOC</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">3</span>]<span class="ot">&lt;-</span>Ceq</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">4</span>]<span class="ot">&lt;-</span>feq_t</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">5</span>]<span class="ot">&lt;-</span>DPM_p_2</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">6</span>]<span class="ot">&lt;-</span>RPM_p_2</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">7</span>]<span class="ot">&lt;-</span>BIO_p_2</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">8</span>]<span class="ot">&lt;-</span>HUM_p_2</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">9</span>]<span class="ot">&lt;-</span>FallIOM</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">10</span>]<span class="ot">&lt;-</span>Ceq_MIN</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">11</span>]<span class="ot">&lt;-</span>Ceq_MAX</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">12</span>]<span class="ot">&lt;-</span>feq_t_min</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">13</span>]<span class="ot">&lt;-</span>DPM_p_2_min</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">14</span>]<span class="ot">&lt;-</span>RPM_p_2_min</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">15</span>]<span class="ot">&lt;-</span>BIO_p_2_min</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">16</span>]<span class="ot">&lt;-</span>HUM_p_2_min</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">17</span>]<span class="ot">&lt;-</span>FallIOM_min</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">18</span>]<span class="ot">&lt;-</span>feq_t_max</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">19</span>]<span class="ot">&lt;-</span>DPM_p_2_max</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">20</span>]<span class="ot">&lt;-</span>RPM_p_2_max</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">21</span>]<span class="ot">&lt;-</span>BIO_p_2_max</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">22</span>]<span class="ot">&lt;-</span>HUM_p_2_max</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">23</span>]<span class="ot">&lt;-</span>FallIOM_max</span></code></pre></div>
<p>In order to properly save the output vector, we will change the names of the fields:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#rename de columns</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">&quot;SOC_FAO&quot;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">&quot;Cinput_EQ&quot;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">&quot;SOC_pedotransfer&quot;</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">5</span>]<span class="ot">=</span><span class="st">&quot;DPM_pedotransfer&quot;</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">6</span>]<span class="ot">=</span><span class="st">&quot;RPM_pedotransfer&quot;</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">7</span>]<span class="ot">=</span><span class="st">&quot;BIO_pedotransfer&quot;</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">8</span>]<span class="ot">=</span><span class="st">&quot;HUM_pedotransfer&quot;</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">9</span>]<span class="ot">=</span><span class="st">&quot;IOM_pedotransfer&quot;</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">10</span>]<span class="ot">=</span><span class="st">&quot;CIneq_min&quot;</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">11</span>]<span class="ot">=</span><span class="st">&quot;CIneq_max&quot;</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">12</span>]<span class="ot">=</span><span class="st">&quot;SOC_min&quot;</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">13</span>]<span class="ot">=</span><span class="st">&quot;DPM_min&quot;</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">14</span>]<span class="ot">=</span><span class="st">&quot;RPM_min&quot;</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">15</span>]<span class="ot">=</span><span class="st">&quot;BIO_min&quot;</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">16</span>]<span class="ot">=</span><span class="st">&quot;HUM_min&quot;</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">17</span>]<span class="ot">=</span><span class="st">&quot;IOM_min&quot;</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">18</span>]<span class="ot">=</span><span class="st">&quot;SOC_max&quot;</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">19</span>]<span class="ot">=</span><span class="st">&quot;DPM_max&quot;</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">20</span>]<span class="ot">=</span><span class="st">&quot;RPM_max&quot;</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">21</span>]<span class="ot">=</span><span class="st">&quot;BIO_max&quot;</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">22</span>]<span class="ot">=</span><span class="st">&quot;HUM_max&quot;</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">23</span>]<span class="ot">=</span><span class="st">&quot;IOM_max&quot;</span></span></code></pre></div>
<p>Finally, we will set the output directory and save the output vector:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE the Points (shapefile)</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeOGR</span>(C_INPUT_EQ, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;OUTPUTS/1_SPIN_UP/SPIN_UP_County_AOI&quot;</span>, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>) </span></code></pre></div>
</div>
<div id="script-number-14.-roth_c_warm_up_v4.r-no-land-use-change" class="section level2" number="10.2">
<h2 number="10.2"><span class="header-section-number">10.2</span> Script Number 14. “ROTH_C_WARM_UP_v4.R” No Land use change</h2>
<p>Script number 14 implements the second modeling phase (“Warm up” phase). In this script we will load the stack of different layers generated in script number 11 and the target points. We also will load the output vector of the phase 1 (spin up), the climate layers from script number 2, the NPP layer from script number 5, and the land use layer stack from script number 9. This script runs the Roth C model for 18 years (2000-2018) with the possibility to be modified to 20 years if data is available (2000-2020). The final outputs are SOC stocks of the five C pools of the RothC model (DPM, RPM, BIO, HUM and IOM), and the total SOC stock. This information will be saved to a shapefile vector.</p>
<p><strong>Table 10.2</strong> <em>Script Number 14. Warm Up phase. Inputs and Outputs</em></p>
<p><img src="tables/Table_10.2.png" /></p>
<p>This script runs the spatial RothC model for the warm-up period (from 2001 to 2018). We will provide the script the target points (empty vector layer from Qgis procedure number 1), the Stack layer (from script number 11), the three NPP layers (from script number 5) and the three climate layers generated in script number 2. The output vector layer from script number 13 (Spin up phase) will also be needed.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SoilR)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilassessment)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>working_dir<span class="ot">&lt;-</span><span class="fu">setwd</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020&quot;</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Open empty vector</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>Vector<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;INPUTS/TARGET_POINTS/target_points_sub.shp&quot;</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Warm Up Stack</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>Stack_Set_warmup<span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;INPUTS/STACK/Stack_Set_WARM_UP_AOI.tif&quot;</span>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Result from SPIN UP PROCESS. A vector with 5 columns , one for each pool</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>Spin_up<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;OUTPUTS/1_SPIN_UP/SPIN_UP_County_AOI.shp&quot;</span>)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>Spin_up<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Spin_up)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Precipitation , temperature, and EVapotranspiration file 20 anios x 12 = 240 layers x 3</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>PREC<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/Prec_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>TEMP<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/Temp_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>PET<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/PET_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Mean NPP MIAMI 1981 - 2000</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>NPP<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI.tif&quot;</span>)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MIN<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI_MIN.tif&quot;</span>)</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MAX<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI_MAX.tif&quot;</span>)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Open LU layer (year 2000).</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/LAND_USE/ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span></code></pre></div>
<p>As we did in the “spin up” script, we will extract all variables to the target points and create an empty variable to save the results of the “warm up” process.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variables to points</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(Stack_Set_warmup,Vector,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(TEMP,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(PREC,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(PET,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(NPP,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(NPP_MEAN_MIN,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(NPP_MEAN_MAX,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>WARM_UP<span class="ot">&lt;-</span>Vector</span></code></pre></div>
<p>Now, we will set some variables in order to run the model for the number of years according to those set for the climate layers. In this example we are running 18 years, but it can be run for less or more years.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Warm Up number of years simulation </span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>yearsSimulation<span class="ot">&lt;-</span><span class="fu">dim</span>(TEMP)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>clim_layers<span class="ot">&lt;-</span>yearsSimulation<span class="sc">*</span><span class="dv">12</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>nppBand<span class="ot">&lt;-</span><span class="fu">nlayers</span>(Stack_Set_warmup)<span class="sc">+</span>clim_layers<span class="sc">*</span><span class="dv">3</span><span class="sc">+</span><span class="dv">2</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>firstClimLayer<span class="ot">&lt;-</span><span class="fu">nlayers</span>(Stack_Set_warmup)<span class="sc">+</span><span class="dv">2</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>nppBand_min<span class="ot">&lt;-</span>nppBand<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>nppBand_max<span class="ot">&lt;-</span>nppBand<span class="sc">+</span><span class="dv">2</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>nDR_beg<span class="ot">&lt;-</span>(<span class="dv">16</span><span class="sc">+</span>yearsSimulation)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>nDR_end<span class="ot">&lt;-</span>nDR_beg<span class="sc">+</span>(yearsSimulation<span class="dv">-1</span>)</span></code></pre></div>
<p>Then we will set the variables in separate R variables:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the layers from the Vector</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>SOC_im<span class="ot">&lt;-</span>Vector_points[[<span class="dv">2</span>]] </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>clay_im<span class="ot">&lt;-</span>Vector_points[[<span class="dv">3</span>]] </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>LU_im<span class="ot">&lt;-</span>Vector_points[[<span class="dv">16</span>]]</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>NPP_im<span class="ot">&lt;-</span>Vector_points[[nppBand]]</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>NPP_im_MIN<span class="ot">&lt;-</span>Vector_points[[nppBand_min]]</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>NPP_im_MAX<span class="ot">&lt;-</span>Vector_points[[nppBand_max]]</span></code></pre></div>
<p>We need to define the years of the “warm up” phase. Remember that we will run one year at a time with different pools of data for each year.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Year </span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>year<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>)</span></code></pre></div>
<p>We will need to set the RothC function to be ready to be used in the “Warm Up” process.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="do">###########function set up starts################</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>Roth_C<span class="ot">&lt;-</span><span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1,LU)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Paddy fields coefficent fPR = 0.4 if the target point is class = 13 , else fPR=1</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co"># From Shirato and Yukozawa 2004</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>fPR<span class="ot">=</span>(LU <span class="sc">==</span> <span class="dv">13</span>)<span class="sc">*</span><span class="fl">0.4</span> <span class="sc">+</span> (LU<span class="sc">!=</span><span class="dv">13</span>)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Temperature effects per month</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>fT<span class="ot">=</span><span class="fu">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Moisture effects per month . Si se usa evapotranspiracion pE=1</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>fw1func<span class="ot">&lt;-</span><span class="cf">function</span>(P, E, <span class="at">S.Thick =</span> <span class="dv">30</span>, <span class="at">pClay =</span> <span class="fl">32.0213</span>, <span class="at">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> P <span class="sc">-</span> E <span class="sc">*</span> pE</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>    Acc.TSMD <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>    B <span class="ot">=</span> <span class="fu">ifelse</span>(bare[i] <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>     Max.TSMD <span class="ot">=</span> <span class="sc">-</span>(<span class="dv">20</span> <span class="sc">+</span> <span class="fl">1.3</span> <span class="sc">*</span> pClay <span class="sc">-</span> <span class="fl">0.01</span> <span class="sc">*</span> (pClay<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (S.Thick<span class="sc">/</span><span class="dv">23</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>B)</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">ifelse</span>(M[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i] <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i]</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> (Acc.TSMD[i] <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="sc">&lt;=</span> Max.TSMD) {</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Max.TSMD</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">ifelse</span>(Acc.TSMD <span class="sc">&gt;</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> ((Max.TSMD <span class="sc">-</span> </span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD)<span class="sc">/</span>(Max.TSMD <span class="sc">-</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD))))</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>    b<span class="ot">&lt;-</span><span class="fu">clamp</span>(b,<span class="at">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(b))</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a>fW_2<span class="ot">&lt;-</span> <span class="fu">fw1func</span>(<span class="at">P=</span>(Precip[,<span class="dv">2</span>]), <span class="at">E=</span>(Evp[,<span class="dv">2</span>]), <span class="at">S.Thick =</span> soil.thick, <span class="at">pClay =</span> clay, <span class="at">pE =</span> <span class="dv">1</span>, <span class="at">bare=</span>bare1)<span class="sc">$</span>b </span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Vegetation Cover effects  C1: No till Agriculture, C2: Conventional Agriculture, C3: Grasslands and Forests, C4 bareland and Urban</span></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a>fC<span class="ot">&lt;-</span>Cov2[,<span class="dv">2</span>]</span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a>xi.frame<span class="ot">=</span><span class="fu">data.frame</span>(years,<span class="fu">rep</span>(fT<span class="sc">*</span>fW_2<span class="sc">*</span>fC<span class="sc">*</span>fPR,<span class="at">length.out=</span><span class="fu">length</span>(years)))</span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from SoilR</span></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a><span class="co">#Loads the model Si pass=TRUE genera calcula el modelo aunque sea invalido. </span></span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculates stocks for each pool per month</span></span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from soilassesment</span></span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a>Model3_spin<span class="ot">=</span><span class="fu">carbonTurnover</span>(<span class="at">tt=</span>years,<span class="at">C0=</span><span class="fu">c</span>(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),<span class="at">In=</span>Cinputs,<span class="at">Dr=</span>DR,<span class="at">clay=</span>clay,<span class="at">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a>Ct3_spin<span class="ot">=</span>Model3_spin[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a>poolSize3_spin<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(poolSize3_spin)</span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a><span class="do">##############funtion set up ends##########</span></span></code></pre></div>
<p>Then, we will apply the function for each target point 18/20 times according to the number of years of the “warm up” process. We will also create empty variables called “Cinputs”,“Cinputs_min”, “Cinputs_max”,“NPP_M”,</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;NPP_M_MIN&quot;</span>,<span class="st">&quot;NPP_M_MAX&quot;</span>.</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>Cinputs<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>Cinputs_min<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>Cinputs_max<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>NPP_M_MIN<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>NPP_M_MAX<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>NPP_M<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterates over the area of interest and over 18 years </span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="do">###########for loop starts################</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(Vector_points))) {</span></code></pre></div>
<p>At his step, the iteration over the number of years of the warm up process is started:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>gt<span class="ot">&lt;-</span>firstClimLayer</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>gp<span class="ot">&lt;-</span>gt<span class="sc">+</span>clim_layers</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>gevp<span class="ot">&lt;-</span>gp<span class="sc">+</span>clim_layers</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (w <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(TEMP)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co">#print(c(&quot;year:&quot;,w))</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the variables </span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>Vect<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Vector_points[i,])</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[gt<span class="sc">:</span>(gt<span class="sc">+</span><span class="dv">11</span>)]))</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Temp=</span>Temp[,<span class="dv">1</span>])</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[gp<span class="sc">:</span>(gp<span class="sc">+</span><span class="dv">11</span>)]))</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Precip=</span>Precip[,<span class="dv">1</span>])</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[gevp<span class="sc">:</span>(gevp<span class="sc">+</span><span class="dv">11</span>)]))</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Evp=</span>Evp[,<span class="dv">1</span>])</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>Cov<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">4</span><span class="sc">:</span><span class="dv">15</span>]))</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>Cov1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>Cov2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>DR_im<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[nDR_beg<span class="sc">:</span>nDR_end])) <span class="co"># DR one per year according to LU</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>DR_im<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">DR_im=</span>DR_im[,<span class="dv">1</span>])</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>gt<span class="ot">&lt;-</span>gt<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>gp<span class="ot">&lt;-</span>gp<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>gevp<span class="ot">&lt;-</span>gevp<span class="sc">+</span><span class="dv">12</span></span></code></pre></div>
<p>This line will avoid running the model over points with unreliable values:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Avoid calculus over Na values </span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(Evp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Temp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(SOC_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(clay_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Spin_up[i,<span class="dv">3</span>]))  <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(NPP_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Precip[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov2[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov1[,<span class="dv">1</span>]))  <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(DR_im[,<span class="dv">1</span>]))  <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(NPP_M[,<span class="dv">1</span>]))  <span class="sc">|</span>  (SOC_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span> (clay_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span> (Spin_up[i,<span class="dv">3</span>]<span class="sc">&lt;=</span><span class="dv">0</span>) ) {WARM_UP[i,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">0</span>}<span class="cf">else</span>{</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>We will set the rest of the variables <span class="cf">for</span> each target point i and year w<span class="sc">:</span> </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the variables from the vector</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>soil.thick<span class="ot">=</span><span class="dv">30</span>  <span class="co">#Soil thickness (organic layer topsoil), in cm</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>SOC<span class="ot">&lt;-</span>SOC_im[i]      <span class="co">#Soil organic carbon in Mg/ha </span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>clay<span class="ot">&lt;-</span>clay_im[i]        <span class="co">#Percent clay %</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>DR_im[w,<span class="dv">1</span>]              <span class="co"># DPM/RPM (decomposable vs resistant plant material.)</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>bare1<span class="ot">&lt;-</span>(Cov1<span class="sc">&gt;</span><span class="fl">0.8</span>)           <span class="co"># If the surface is bare or vegetated</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>NPP_81_00<span class="ot">&lt;-</span>NPP_im[i]</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>NPP_81_00_MIN<span class="ot">&lt;-</span>NPP_im_MIN[i]</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>NPP_81_00_MAX<span class="ot">&lt;-</span>NPP_im_MAX[i]</span></code></pre></div>
<p>We will calculate the NPP MIAMI value for each point and each year , and adjust the carbon inputs with the NPP values. The first Cinput value corresponds to the Cinput of equilibrium calculated in the Spin Up phase (Spin_up[i,3]).</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cinputs </span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>T<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[,<span class="dv">2</span>])</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>P<span class="ot">&lt;-</span><span class="fu">sum</span>(Precip[,<span class="dv">2</span>])</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>NPP_M[w]<span class="ot">&lt;-</span><span class="fu">NPPmodel</span>(P,T,<span class="st">&quot;miami&quot;</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>NPP_M[w]<span class="ot">&lt;-</span>(LU_im[i]<span class="sc">==</span><span class="dv">2</span>)<span class="sc">*</span>NPP_M[w]<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_M[w]<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_M[w]<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {Cinputs[w]<span class="ot">&lt;-</span>(Spin_up[i,<span class="dv">3</span>]<span class="sc">/</span>NPP_81_00)<span class="sc">*</span>NPP_M[w]} <span class="cf">else</span> {Cinputs[w]<span class="ot">&lt;-</span>(Cinputs[[w<span class="dv">-1</span>]]<span class="sc">/</span> NPP_M[w<span class="dv">-1</span>]) <span class="sc">*</span> NPP_M[w]} </span></code></pre></div>
<p>Then we will repeat the same code but this time changing the environmental variables to match the maximum and minimum values.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cinputs MIN</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>Tmin<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">1.02</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>Pmin<span class="ot">&lt;-</span><span class="fu">sum</span>(Precip[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">0.95</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>NPP_M_MIN[w]<span class="ot">&lt;-</span><span class="fu">NPPmodel</span>(Pmin,Tmin,<span class="st">&quot;miami&quot;</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>NPP_M_MIN[w]<span class="ot">&lt;-</span>(LU_im[i]<span class="sc">==</span><span class="dv">2</span>)<span class="sc">*</span>NPP_M_MIN[w]<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_M_MIN[w]<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_M_MIN[w]<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {Cinputs_min[w]<span class="ot">&lt;-</span>(Spin_up[i,<span class="dv">10</span>]<span class="sc">/</span>NPP_81_00)<span class="sc">*</span>NPP_M_MIN[w]} <span class="cf">else</span> {Cinputs_min[w]<span class="ot">&lt;-</span>(Cinputs_min[[w<span class="dv">-1</span>]]<span class="sc">/</span> NPP_M_MIN[w<span class="dv">-1</span>]) <span class="sc">*</span> NPP_M_MIN[w]} </span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Cinputs MAX</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>Tmax<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">0.98</span>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>Pmax<span class="ot">&lt;-</span><span class="fu">sum</span>(Precip[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">1.05</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>NPP_M_MAX[w]<span class="ot">&lt;-</span><span class="fu">NPPmodel</span>(Pmax,Tmax,<span class="st">&quot;miami&quot;</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>NPP_M_MAX[w]<span class="ot">&lt;-</span>(LU_im[i]<span class="sc">==</span><span class="dv">2</span>)<span class="sc">*</span>NPP_M_MAX[w]<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_M_MAX[w]<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_M_MAX[w]<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {Cinputs_max[w]<span class="ot">&lt;-</span>(Spin_up[i,<span class="dv">11</span>]<span class="sc">/</span>NPP_81_00)<span class="sc">*</span>NPP_M_MAX[w]} <span class="cf">else</span> {Cinputs_max[w]<span class="ot">&lt;-</span>(Cinputs_max[[w<span class="dv">-1</span>]]<span class="sc">/</span> NPP_M_MAX[w<span class="dv">-1</span>]) <span class="sc">*</span> NPP_M_MAX[w]} </span></code></pre></div>
<p>We will then run the RothC function for each point and each year. The first year we will use the equilibrium Cinputs, and the carbon pools obtained from the Spin Up phase. Then we will use the yearly adjusted Cinputs (using NPP) and the pools calculated from the previous iteration.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model for 2001-2018 </span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>f_wp<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs[<span class="dv">1</span>],<span class="at">years=</span>year,<span class="at">DPMptf=</span>Spin_up[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>Spin_up[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>Spin_up[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>Spin_up[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>Spin_up[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>f_wp<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs[w],<span class="at">years=</span>year,<span class="at">DPMptf=</span>f_wp[<span class="dv">1</span>], <span class="at">RPMptf=</span>f_wp[<span class="dv">2</span>], <span class="at">BIOptf=</span>f_wp[<span class="dv">3</span>], <span class="at">HUMptf=</span>f_wp[<span class="dv">4</span>], <span class="at">FallIOM=</span>f_wp[<span class="dv">5</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>f_wp_t<span class="ot">&lt;-</span>f_wp[<span class="dv">1</span>]<span class="sc">+</span>f_wp[<span class="dv">2</span>]<span class="sc">+</span>f_wp[<span class="dv">3</span>]<span class="sc">+</span>f_wp[<span class="dv">4</span>]<span class="sc">+</span>f_wp[<span class="dv">5</span>]</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model for minimum values</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>f_wp_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_min[<span class="dv">1</span>],<span class="at">years=</span>years,<span class="at">DPMptf=</span>Spin_up[i,<span class="dv">13</span>], <span class="at">RPMptf=</span>Spin_up[i,<span class="dv">14</span>], <span class="at">BIOptf=</span>Spin_up[i,<span class="dv">15</span>], <span class="at">HUMptf=</span>Spin_up[i,<span class="dv">16</span>], <span class="at">FallIOM=</span>Spin_up[i,<span class="dv">17</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>f_wp_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_min[w],<span class="at">years=</span>years,<span class="at">DPMptf=</span>f_wp_min[<span class="dv">1</span>], <span class="at">RPMptf=</span>f_wp_min[<span class="dv">2</span>], <span class="at">BIOptf=</span>f_wp_min[<span class="dv">3</span>], <span class="at">HUMptf=</span>f_wp_min[<span class="dv">4</span>], <span class="at">FallIOM=</span>f_wp_min[<span class="dv">5</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>f_wp_t_min<span class="ot">&lt;-</span>f_wp_min[<span class="dv">1</span>]<span class="sc">+</span>f_wp_min[<span class="dv">2</span>]<span class="sc">+</span>f_wp_min[<span class="dv">3</span>]<span class="sc">+</span>f_wp_min[<span class="dv">4</span>]<span class="sc">+</span>f_wp_min[<span class="dv">5</span>]</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model for maximum values</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>f_wp_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_max[<span class="dv">1</span>],<span class="at">years=</span>years,<span class="at">DPMptf=</span>Spin_up[i,<span class="dv">19</span>], <span class="at">RPMptf=</span>Spin_up[i,<span class="dv">20</span>], <span class="at">BIOptf=</span>Spin_up[i,<span class="dv">21</span>], <span class="at">HUMptf=</span>Spin_up[i,<span class="dv">22</span>], <span class="at">FallIOM=</span>Spin_up[i,<span class="dv">23</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1)</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>f_wp_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_max[w],<span class="at">years=</span>years,<span class="at">DPMptf=</span>f_wp_max[<span class="dv">1</span>], <span class="at">RPMptf=</span>f_wp_max[<span class="dv">2</span>], <span class="at">BIOptf=</span>f_wp_max[<span class="dv">3</span>], <span class="at">HUMptf=</span>f_wp_max[<span class="dv">4</span>], <span class="at">FallIOM=</span>f_wp_max[<span class="dv">5</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1)</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>f_wp_t_max<span class="ot">&lt;-</span>f_wp_max[<span class="dv">1</span>]<span class="sc">+</span>f_wp_max[<span class="dv">2</span>]<span class="sc">+</span>f_wp_max[<span class="dv">3</span>]<span class="sc">+</span>f_wp_max[<span class="dv">4</span>]<span class="sc">+</span>f_wp_max[<span class="dv">5</span>]</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w)</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(i,SOC,Spin_up[i,<span class="dv">3</span>],NPP_81_00,NPP_M[w,<span class="dv">1</span>],Cinputs[w],f_wp_t,DR_im[w,<span class="dv">1</span>]))</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>We will save the results from the iteration of the last year to the empty vector. We will also calculate an average of all the Cinputs used in the warm up phase and save it. We will need this “CinputFOWARD” variable in the next phase (Forward) and script (script number 15).</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">mean</span>(Cinputs))){ CinputFOWARD<span class="ot">&lt;-</span><span class="cn">NA</span>} <span class="cf">else</span> { </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>CinputFOWARD<span class="ot">&lt;-</span><span class="fu">mean</span>(Cinputs)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>CinputFOWARD_min<span class="ot">&lt;-</span><span class="fu">mean</span>(Cinputs_min)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>CinputFOWARD_max<span class="ot">&lt;-</span><span class="fu">mean</span>(Cinputs_max)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">2</span>]<span class="ot">&lt;-</span>SOC</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">3</span>]<span class="ot">&lt;-</span>Cinputs[<span class="dv">18</span>]</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">4</span>]<span class="ot">&lt;-</span>f_wp_t</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">5</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">1</span>]</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">6</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">2</span>]</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">7</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">3</span>]</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">8</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">4</span>]</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">9</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">5</span>]</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">10</span>]<span class="ot">&lt;-</span>CinputFOWARD</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">11</span>]<span class="ot">&lt;-</span>f_wp_t_min</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">12</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">1</span>]</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">13</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">2</span>]</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">14</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">3</span>]</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">15</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">4</span>]</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">16</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">5</span>]</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">17</span>]<span class="ot">&lt;-</span>f_wp_t_max</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">18</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">1</span>]</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">19</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">2</span>]</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">20</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">3</span>]</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">21</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">4</span>]</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">22</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">5</span>]</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">23</span>]<span class="ot">&lt;-</span>CinputFOWARD_min</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">24</span>]<span class="ot">&lt;-</span>CinputFOWARD_max</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>Cinputs<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>Cinputs_min<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>Cinputs_max<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(i)</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a><span class="do">###########for loop ends################</span></span></code></pre></div>
<p>We will then run the last code block to change the names to the fields of the vector’s table.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">&quot;SOC_FAO&quot;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">&quot;Cin_2018&quot;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">&quot;SOC_2018&quot;</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">5</span>]<span class="ot">=</span><span class="st">&quot;DPM_w_up&quot;</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">6</span>]<span class="ot">=</span><span class="st">&quot;RPM_w_up&quot;</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">7</span>]<span class="ot">=</span><span class="st">&quot;BIO_w_up&quot;</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">8</span>]<span class="ot">=</span><span class="st">&quot;HUM_w_up&quot;</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">9</span>]<span class="ot">=</span><span class="st">&quot;IOM_w_up&quot;</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">10</span>]<span class="ot">=</span><span class="st">&quot;Cin_mean&quot;</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">11</span>]<span class="ot">=</span><span class="st">&quot;SOC_18min&quot;</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">12</span>]<span class="ot">=</span><span class="st">&quot;DPM_w_min&quot;</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">13</span>]<span class="ot">=</span><span class="st">&quot;RPM_w_min&quot;</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">14</span>]<span class="ot">=</span><span class="st">&quot;BIO_w_min&quot;</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">15</span>]<span class="ot">=</span><span class="st">&quot;HUM_w_min&quot;</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">16</span>]<span class="ot">=</span><span class="st">&quot;IOM_w_min&quot;</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">17</span>]<span class="ot">=</span><span class="st">&quot;SOC_18max&quot;</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">18</span>]<span class="ot">=</span><span class="st">&quot;DPM_w_max&quot;</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">19</span>]<span class="ot">=</span><span class="st">&quot;RPM_w_max&quot;</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">20</span>]<span class="ot">=</span><span class="st">&quot;BIO_w_max&quot;</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">21</span>]<span class="ot">=</span><span class="st">&quot;HUM_w_max&quot;</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">22</span>]<span class="ot">=</span><span class="st">&quot;IOM_w_max&quot;</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">23</span>]<span class="ot">=</span><span class="st">&quot;Cin_min&quot;</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">24</span>]<span class="ot">=</span><span class="st">&quot;Cin_max&quot;</span></span></code></pre></div>
<p>Finally, we will have to save the output vector and the name of that vector.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE the Points (shapefile) </span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeOGR</span>(WARM_UP,<span class="st">&quot;.&quot;</span>, <span class="st">&quot;OUTPUTS/2_WARM_UP/WARM_UP_County_AOI&quot;</span>, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-14.-roth_c_warm_up_v4.r-land-use-change-simulation" class="section level2" number="10.3">
<h2 number="10.3"><span class="header-section-number">10.3</span> Script Number 14. “ROTH_C_WARM_UP_v4.R” Land use change simulation</h2>
<p>This script is provided as an alternative in the case that yearly land use layers are available as input for the the warm up phase to account form land use change.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#12/11/2020</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SPATIAL SOIL R  for VECTORS</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   ROTH C phase 3: WARM UP</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MSc Ing Agr Luciano E Di Paolo</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="co"># SOilR from Sierra, C.A., M. Mueller, S.E. Trumbore (2012). </span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Models of soil organic matter decomposition: the SoilR package, version 1.0 Geoscientific Model Development, 5(4), </span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="co">#1045--1060. URL http://www.geosci-model-dev.net/5/1045/2012/gmd-5-1045-2012.html.</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SoilR)</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilassessment)</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>working_dir<span class="ot">&lt;-</span><span class="fu">setwd</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020&quot;</span>)</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Open empty vector</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>Vector<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;INPUTS/TARGET_POINTS/target_points_sub.shp&quot;</span>)</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Warm Up Stack</span></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>Stack_Set_warmup<span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;INPUTS/STACK/Stack_Set_WARM_UP_AOI.tif&quot;</span>)</span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Result from SPIN UP PROCESS. A vector with 5 columns , one for each pool</span></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>Spin_up<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/OUTPUTS/1_SPIN_UP/SPIN_UP_County_AOI.shp&quot;</span>)</span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>Spin_up<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Spin_up)</span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Precipitation , temperature, and EVapotranspiration file 20 anios x 12 = 240 layers x 3</span></span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>PREC<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/Prec_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a>TEMP<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/Temp_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a>PET<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/PET_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Mean NPP MIAMI 1981 - 2000</span></span>
<span id="cb83-44"><a href="#cb83-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-45"><a href="#cb83-45" aria-hidden="true" tabindex="-1"></a>NPP<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI.tif&quot;</span>)</span>
<span id="cb83-46"><a href="#cb83-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-47"><a href="#cb83-47" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MIN<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI_MIN.tif&quot;</span>)</span>
<span id="cb83-48"><a href="#cb83-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-49"><a href="#cb83-49" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MAX<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI_MAX.tif&quot;</span>)</span>
<span id="cb83-50"><a href="#cb83-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-51"><a href="#cb83-51" aria-hidden="true" tabindex="-1"></a><span class="co">#Open LU layer (year 2000).</span></span>
<span id="cb83-52"><a href="#cb83-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-53"><a href="#cb83-53" aria-hidden="true" tabindex="-1"></a><span class="co">#LU_AOI&lt;-raster(&quot;INPUTS/LAND_USE/ESA_Land_Cover_12clases_FAO_AOI.tif&quot;)</span></span>
<span id="cb83-54"><a href="#cb83-54" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span>Stack_Set_warmup[[<span class="dv">15</span>]]<span class="co"># LU 2001 </span></span>
<span id="cb83-55"><a href="#cb83-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-56"><a href="#cb83-56" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply NPP coeficientes</span></span>
<span id="cb83-57"><a href="#cb83-57" aria-hidden="true" tabindex="-1"></a>NPP<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb83-58"><a href="#cb83-58" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MIN<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP_MEAN_MIN<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_MEAN_MIN<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_MEAN_MIN<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb83-59"><a href="#cb83-59" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MAX<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP_MEAN_MAX<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_MEAN_MAX<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_MEAN_MAX<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb83-60"><a href="#cb83-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-61"><a href="#cb83-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-62"><a href="#cb83-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variables to points</span></span>
<span id="cb83-63"><a href="#cb83-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-64"><a href="#cb83-64" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(Stack_Set_warmup,Vector,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb83-65"><a href="#cb83-65" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(TEMP,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb83-66"><a href="#cb83-66" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(PREC,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb83-67"><a href="#cb83-67" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(PET,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb83-68"><a href="#cb83-68" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(NPP,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb83-69"><a href="#cb83-69" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(NPP_MEAN_MIN,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb83-70"><a href="#cb83-70" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(NPP_MEAN_MAX,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb83-71"><a href="#cb83-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-72"><a href="#cb83-72" aria-hidden="true" tabindex="-1"></a>WARM_UP<span class="ot">&lt;-</span>Vector</span>
<span id="cb83-73"><a href="#cb83-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-74"><a href="#cb83-74" aria-hidden="true" tabindex="-1"></a><span class="co">#use only for backup</span></span>
<span id="cb83-75"><a href="#cb83-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-76"><a href="#cb83-76" aria-hidden="true" tabindex="-1"></a><span class="co">#WARM_UP&lt;-readOGR(&quot;WARM_UP_County_AOI3_97.shp&quot;)</span></span>
<span id="cb83-77"><a href="#cb83-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-78"><a href="#cb83-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Warm Up number of years simulation </span></span>
<span id="cb83-79"><a href="#cb83-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-80"><a href="#cb83-80" aria-hidden="true" tabindex="-1"></a>yearsSimulation<span class="ot">&lt;-</span><span class="fu">dim</span>(TEMP)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span></span>
<span id="cb83-81"><a href="#cb83-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-82"><a href="#cb83-82" aria-hidden="true" tabindex="-1"></a>clim_layers<span class="ot">&lt;-</span>yearsSimulation<span class="sc">*</span><span class="dv">12</span></span>
<span id="cb83-83"><a href="#cb83-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-84"><a href="#cb83-84" aria-hidden="true" tabindex="-1"></a>nppBand<span class="ot">&lt;-</span><span class="fu">nlayers</span>(Stack_Set_warmup)<span class="sc">+</span>clim_layers<span class="sc">*</span><span class="dv">3</span><span class="sc">+</span><span class="dv">2</span></span>
<span id="cb83-85"><a href="#cb83-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-86"><a href="#cb83-86" aria-hidden="true" tabindex="-1"></a>firstClimLayer<span class="ot">&lt;-</span><span class="fu">nlayers</span>(Stack_Set_warmup)<span class="sc">+</span><span class="dv">2</span></span>
<span id="cb83-87"><a href="#cb83-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-88"><a href="#cb83-88" aria-hidden="true" tabindex="-1"></a>nppBand_min<span class="ot">&lt;-</span>nppBand<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb83-89"><a href="#cb83-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-90"><a href="#cb83-90" aria-hidden="true" tabindex="-1"></a>nppBand_max<span class="ot">&lt;-</span>nppBand<span class="sc">+</span><span class="dv">2</span></span>
<span id="cb83-91"><a href="#cb83-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-92"><a href="#cb83-92" aria-hidden="true" tabindex="-1"></a>nDR_beg<span class="ot">&lt;-</span>(<span class="dv">16</span><span class="sc">+</span>yearsSimulation)</span>
<span id="cb83-93"><a href="#cb83-93" aria-hidden="true" tabindex="-1"></a>nDR_end<span class="ot">&lt;-</span>nDR_beg<span class="sc">+</span>(yearsSimulation<span class="dv">-1</span>)</span>
<span id="cb83-94"><a href="#cb83-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-95"><a href="#cb83-95" aria-hidden="true" tabindex="-1"></a>nLU_beg<span class="ot">&lt;-</span><span class="dv">16</span></span>
<span id="cb83-96"><a href="#cb83-96" aria-hidden="true" tabindex="-1"></a>nLU_end<span class="ot">&lt;-</span>nLU_beg<span class="sc">+</span>(yearsSimulation<span class="dv">-1</span>)</span>
<span id="cb83-97"><a href="#cb83-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-98"><a href="#cb83-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the layers from the Vector</span></span>
<span id="cb83-99"><a href="#cb83-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-100"><a href="#cb83-100" aria-hidden="true" tabindex="-1"></a>SOC_im<span class="ot">&lt;-</span>Vector_points[[<span class="dv">2</span>]] </span>
<span id="cb83-101"><a href="#cb83-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-102"><a href="#cb83-102" aria-hidden="true" tabindex="-1"></a>clay_im<span class="ot">&lt;-</span>Vector_points[[<span class="dv">3</span>]] </span>
<span id="cb83-103"><a href="#cb83-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-104"><a href="#cb83-104" aria-hidden="true" tabindex="-1"></a><span class="co">#LU_im&lt;-Vector_points[[16:34]]</span></span>
<span id="cb83-105"><a href="#cb83-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-106"><a href="#cb83-106" aria-hidden="true" tabindex="-1"></a>NPP_im<span class="ot">&lt;-</span>Vector_points[[nppBand]]</span>
<span id="cb83-107"><a href="#cb83-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-108"><a href="#cb83-108" aria-hidden="true" tabindex="-1"></a>NPP_im_MIN<span class="ot">&lt;-</span>Vector_points[[nppBand_min]]</span>
<span id="cb83-109"><a href="#cb83-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-110"><a href="#cb83-110" aria-hidden="true" tabindex="-1"></a>NPP_im_MAX<span class="ot">&lt;-</span>Vector_points[[nppBand_max]]</span>
<span id="cb83-111"><a href="#cb83-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-112"><a href="#cb83-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Years</span></span>
<span id="cb83-113"><a href="#cb83-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-114"><a href="#cb83-114" aria-hidden="true" tabindex="-1"></a>years<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb83-115"><a href="#cb83-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-116"><a href="#cb83-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-117"><a href="#cb83-117" aria-hidden="true" tabindex="-1"></a><span class="co"># ROTH C MODEL FUNCTION . </span></span>
<span id="cb83-118"><a href="#cb83-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-119"><a href="#cb83-119" aria-hidden="true" tabindex="-1"></a><span class="do">###########function set up starts################</span></span>
<span id="cb83-120"><a href="#cb83-120" aria-hidden="true" tabindex="-1"></a>Roth_C<span class="ot">&lt;-</span><span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1,LU)</span>
<span id="cb83-121"><a href="#cb83-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-122"><a href="#cb83-122" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb83-123"><a href="#cb83-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-124"><a href="#cb83-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Paddy fields coefficent fPR = 0.4 if the target point is class = 13 , else fPR=1</span></span>
<span id="cb83-125"><a href="#cb83-125" aria-hidden="true" tabindex="-1"></a><span class="co"># From Shirato and Yukozawa 2004</span></span>
<span id="cb83-126"><a href="#cb83-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-127"><a href="#cb83-127" aria-hidden="true" tabindex="-1"></a>fPR<span class="ot">=</span>(LU <span class="sc">==</span> <span class="dv">13</span>)<span class="sc">*</span><span class="fl">0.4</span> <span class="sc">+</span> (LU<span class="sc">!=</span><span class="dv">13</span>)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb83-128"><a href="#cb83-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-129"><a href="#cb83-129" aria-hidden="true" tabindex="-1"></a><span class="co">#Temperature effects per month</span></span>
<span id="cb83-130"><a href="#cb83-130" aria-hidden="true" tabindex="-1"></a>fT<span class="ot">=</span><span class="fu">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span>
<span id="cb83-131"><a href="#cb83-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-132"><a href="#cb83-132" aria-hidden="true" tabindex="-1"></a><span class="co">#Moisture effects per month . Si se usa evapotranspiracion pE=1</span></span>
<span id="cb83-133"><a href="#cb83-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-134"><a href="#cb83-134" aria-hidden="true" tabindex="-1"></a>fw1func<span class="ot">&lt;-</span><span class="cf">function</span>(P, E, <span class="at">S.Thick =</span> <span class="dv">30</span>, <span class="at">pClay =</span> <span class="fl">32.0213</span>, <span class="at">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb83-135"><a href="#cb83-135" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb83-136"><a href="#cb83-136" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb83-137"><a href="#cb83-137" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> P <span class="sc">-</span> E <span class="sc">*</span> pE</span>
<span id="cb83-138"><a href="#cb83-138" aria-hidden="true" tabindex="-1"></a>    Acc.TSMD <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb83-139"><a href="#cb83-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb83-140"><a href="#cb83-140" aria-hidden="true" tabindex="-1"></a>    B <span class="ot">=</span> <span class="fu">ifelse</span>(bare[i] <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb83-141"><a href="#cb83-141" aria-hidden="true" tabindex="-1"></a>     Max.TSMD <span class="ot">=</span> <span class="sc">-</span>(<span class="dv">20</span> <span class="sc">+</span> <span class="fl">1.3</span> <span class="sc">*</span> pClay <span class="sc">-</span> <span class="fl">0.01</span> <span class="sc">*</span> (pClay<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (S.Thick<span class="sc">/</span><span class="dv">23</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>B)</span>
<span id="cb83-142"><a href="#cb83-142" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">ifelse</span>(M[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb83-143"><a href="#cb83-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i] <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb83-144"><a href="#cb83-144" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i]</span>
<span id="cb83-145"><a href="#cb83-145" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb83-146"><a href="#cb83-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> (Acc.TSMD[i] <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb83-147"><a href="#cb83-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="sc">&lt;=</span> Max.TSMD) {</span>
<span id="cb83-148"><a href="#cb83-148" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Max.TSMD</span>
<span id="cb83-149"><a href="#cb83-149" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb83-150"><a href="#cb83-150" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-151"><a href="#cb83-151" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">ifelse</span>(Acc.TSMD <span class="sc">&gt;</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> ((Max.TSMD <span class="sc">-</span> </span>
<span id="cb83-152"><a href="#cb83-152" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD)<span class="sc">/</span>(Max.TSMD <span class="sc">-</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD))))</span>
<span id="cb83-153"><a href="#cb83-153" aria-hidden="true" tabindex="-1"></a>    b<span class="ot">&lt;-</span><span class="fu">clamp</span>(b,<span class="at">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb83-154"><a href="#cb83-154" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(b))</span>
<span id="cb83-155"><a href="#cb83-155" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-156"><a href="#cb83-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-157"><a href="#cb83-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-158"><a href="#cb83-158" aria-hidden="true" tabindex="-1"></a>fW_2<span class="ot">&lt;-</span> <span class="fu">fw1func</span>(<span class="at">P=</span>(Precip[,<span class="dv">2</span>]), <span class="at">E=</span>(Evp[,<span class="dv">2</span>]), <span class="at">S.Thick =</span> soil.thick, <span class="at">pClay =</span> clay, <span class="at">pE =</span> <span class="dv">1</span>, <span class="at">bare=</span>bare1)<span class="sc">$</span>b </span>
<span id="cb83-159"><a href="#cb83-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-160"><a href="#cb83-160" aria-hidden="true" tabindex="-1"></a><span class="co">#Vegetation Cover effects  C1: No till Agriculture, C2: Conventional Agriculture, C3: Grasslands and Forests, C4 bareland and Urban</span></span>
<span id="cb83-161"><a href="#cb83-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-162"><a href="#cb83-162" aria-hidden="true" tabindex="-1"></a>fC<span class="ot">&lt;-</span>Cov2[,<span class="dv">2</span>]</span>
<span id="cb83-163"><a href="#cb83-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-164"><a href="#cb83-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb83-165"><a href="#cb83-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-166"><a href="#cb83-166" aria-hidden="true" tabindex="-1"></a>xi.frame<span class="ot">=</span><span class="fu">data.frame</span>(years,<span class="fu">rep</span>(fT<span class="sc">*</span>fW_2<span class="sc">*</span>fC<span class="sc">*</span>fPR,<span class="at">length.out=</span><span class="fu">length</span>(years)))</span>
<span id="cb83-167"><a href="#cb83-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-168"><a href="#cb83-168" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from SoilR</span></span>
<span id="cb83-169"><a href="#cb83-169" aria-hidden="true" tabindex="-1"></a><span class="co">#Loads the model Si pass=TRUE genera calcula el modelo aunque sea invalido. </span></span>
<span id="cb83-170"><a href="#cb83-170" aria-hidden="true" tabindex="-1"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb83-171"><a href="#cb83-171" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculates stocks for each pool per month</span></span>
<span id="cb83-172"><a href="#cb83-172" aria-hidden="true" tabindex="-1"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb83-173"><a href="#cb83-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-174"><a href="#cb83-174" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from soilassesment</span></span>
<span id="cb83-175"><a href="#cb83-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-176"><a href="#cb83-176" aria-hidden="true" tabindex="-1"></a>Model3_spin<span class="ot">=</span><span class="fu">carbonTurnover</span>(<span class="at">tt=</span>years,<span class="at">C0=</span><span class="fu">c</span>(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),<span class="at">In=</span>Cinputs,<span class="at">Dr=</span>DR,<span class="at">clay=</span>clay,<span class="at">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb83-177"><a href="#cb83-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-178"><a href="#cb83-178" aria-hidden="true" tabindex="-1"></a>Ct3_spin<span class="ot">=</span>Model3_spin[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb83-179"><a href="#cb83-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-180"><a href="#cb83-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb83-181"><a href="#cb83-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-182"><a href="#cb83-182" aria-hidden="true" tabindex="-1"></a>poolSize3_spin<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb83-183"><a href="#cb83-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-184"><a href="#cb83-184" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(poolSize3_spin)</span>
<span id="cb83-185"><a href="#cb83-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-186"><a href="#cb83-186" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-187"><a href="#cb83-187" aria-hidden="true" tabindex="-1"></a><span class="do">##############funtion set up ends##########</span></span>
<span id="cb83-188"><a href="#cb83-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-189"><a href="#cb83-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterates over the area of interest and over 18 years </span></span>
<span id="cb83-190"><a href="#cb83-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-191"><a href="#cb83-191" aria-hidden="true" tabindex="-1"></a>Cinputs<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb83-192"><a href="#cb83-192" aria-hidden="true" tabindex="-1"></a>Cinputs_min<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb83-193"><a href="#cb83-193" aria-hidden="true" tabindex="-1"></a>Cinputs_max<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb83-194"><a href="#cb83-194" aria-hidden="true" tabindex="-1"></a>NPP_M_MIN<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb83-195"><a href="#cb83-195" aria-hidden="true" tabindex="-1"></a>NPP_M_MAX<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb83-196"><a href="#cb83-196" aria-hidden="true" tabindex="-1"></a>NPP_M<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb83-197"><a href="#cb83-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-198"><a href="#cb83-198" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts################</span></span>
<span id="cb83-199"><a href="#cb83-199" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(Vector_points))) {</span>
<span id="cb83-200"><a href="#cb83-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-201"><a href="#cb83-201" aria-hidden="true" tabindex="-1"></a>gt<span class="ot">&lt;-</span>firstClimLayer</span>
<span id="cb83-202"><a href="#cb83-202" aria-hidden="true" tabindex="-1"></a>gp<span class="ot">&lt;-</span>gt<span class="sc">+</span>clim_layers</span>
<span id="cb83-203"><a href="#cb83-203" aria-hidden="true" tabindex="-1"></a>gevp<span class="ot">&lt;-</span>gp<span class="sc">+</span>clim_layers</span>
<span id="cb83-204"><a href="#cb83-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-205"><a href="#cb83-205" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (w <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(TEMP)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb83-206"><a href="#cb83-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-207"><a href="#cb83-207" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="st">&quot;year:&quot;</span>,w))</span>
<span id="cb83-208"><a href="#cb83-208" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the variables </span></span>
<span id="cb83-209"><a href="#cb83-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-210"><a href="#cb83-210" aria-hidden="true" tabindex="-1"></a>Vect<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Vector_points[i,])</span>
<span id="cb83-211"><a href="#cb83-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-212"><a href="#cb83-212" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[gt<span class="sc">:</span>(gt<span class="sc">+</span><span class="dv">11</span>)]))</span>
<span id="cb83-213"><a href="#cb83-213" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Temp=</span>Temp[,<span class="dv">1</span>])</span>
<span id="cb83-214"><a href="#cb83-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-215"><a href="#cb83-215" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[gp<span class="sc">:</span>(gp<span class="sc">+</span><span class="dv">11</span>)]))</span>
<span id="cb83-216"><a href="#cb83-216" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Precip=</span>Precip[,<span class="dv">1</span>])</span>
<span id="cb83-217"><a href="#cb83-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-218"><a href="#cb83-218" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[gevp<span class="sc">:</span>(gevp<span class="sc">+</span><span class="dv">11</span>)]))</span>
<span id="cb83-219"><a href="#cb83-219" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Evp=</span>Evp[,<span class="dv">1</span>])</span>
<span id="cb83-220"><a href="#cb83-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-221"><a href="#cb83-221" aria-hidden="true" tabindex="-1"></a>Cov<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">4</span><span class="sc">:</span><span class="dv">15</span>]))</span>
<span id="cb83-222"><a href="#cb83-222" aria-hidden="true" tabindex="-1"></a>Cov1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb83-223"><a href="#cb83-223" aria-hidden="true" tabindex="-1"></a>Cov2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb83-224"><a href="#cb83-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-225"><a href="#cb83-225" aria-hidden="true" tabindex="-1"></a>DR_im<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[nDR_beg<span class="sc">:</span>nDR_end])) <span class="co"># DR one per year according to LU</span></span>
<span id="cb83-226"><a href="#cb83-226" aria-hidden="true" tabindex="-1"></a>DR_im<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">DR_im=</span>DR_im[,<span class="dv">1</span>])</span>
<span id="cb83-227"><a href="#cb83-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-228"><a href="#cb83-228" aria-hidden="true" tabindex="-1"></a>LU_im<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[nLU_beg<span class="sc">:</span>nLU_end])) <span class="co"># DR one per year according to LU</span></span>
<span id="cb83-229"><a href="#cb83-229" aria-hidden="true" tabindex="-1"></a>LU_im<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">LU_im=</span>LU_im[,<span class="dv">1</span>])</span>
<span id="cb83-230"><a href="#cb83-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-231"><a href="#cb83-231" aria-hidden="true" tabindex="-1"></a>gt<span class="ot">&lt;-</span>gt<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb83-232"><a href="#cb83-232" aria-hidden="true" tabindex="-1"></a>gp<span class="ot">&lt;-</span>gp<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb83-233"><a href="#cb83-233" aria-hidden="true" tabindex="-1"></a>gevp<span class="ot">&lt;-</span>gevp<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb83-234"><a href="#cb83-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-235"><a href="#cb83-235" aria-hidden="true" tabindex="-1"></a><span class="co">#Avoid calculus over Na values </span></span>
<span id="cb83-236"><a href="#cb83-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-237"><a href="#cb83-237" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(Evp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Temp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(SOC_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(clay_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Spin_up[i,<span class="dv">3</span>]))  <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(NPP_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Precip[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov2[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov1[,<span class="dv">1</span>]))  <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(DR_im[,<span class="dv">1</span>]))    <span class="sc">|</span>  (SOC_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span> (clay_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span> (Spin_up[i,<span class="dv">3</span>]<span class="sc">&lt;=</span><span class="dv">0</span>) ) {WARM_UP[i,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">0</span>}<span class="cf">else</span>{</span>
<span id="cb83-238"><a href="#cb83-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-239"><a href="#cb83-239" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the variables from the vector</span></span>
<span id="cb83-240"><a href="#cb83-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-241"><a href="#cb83-241" aria-hidden="true" tabindex="-1"></a>soil.thick<span class="ot">=</span><span class="dv">30</span>  <span class="co">#Soil thickness (organic layer topsoil), in cm</span></span>
<span id="cb83-242"><a href="#cb83-242" aria-hidden="true" tabindex="-1"></a>SOC<span class="ot">&lt;-</span>SOC_im[i]      <span class="co">#Soil organic carbon in Mg/ha </span></span>
<span id="cb83-243"><a href="#cb83-243" aria-hidden="true" tabindex="-1"></a>clay<span class="ot">&lt;-</span>clay_im[i]        <span class="co">#Percent clay %</span></span>
<span id="cb83-244"><a href="#cb83-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-245"><a href="#cb83-245" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>DR_im[w,<span class="dv">1</span>]              <span class="co"># DPM/RPM (decomplosable vs resistant plant material.)</span></span>
<span id="cb83-246"><a href="#cb83-246" aria-hidden="true" tabindex="-1"></a>LU<span class="ot">&lt;-</span>LU_im[w,<span class="dv">1</span>] </span>
<span id="cb83-247"><a href="#cb83-247" aria-hidden="true" tabindex="-1"></a>bare1<span class="ot">&lt;-</span>(Cov1<span class="sc">&gt;</span><span class="fl">0.8</span>)           <span class="co"># If the surface is bare or vegetated</span></span>
<span id="cb83-248"><a href="#cb83-248" aria-hidden="true" tabindex="-1"></a>NPP_81_00<span class="ot">&lt;-</span>NPP_im[i]</span>
<span id="cb83-249"><a href="#cb83-249" aria-hidden="true" tabindex="-1"></a>NPP_81_00_MIN<span class="ot">&lt;-</span>NPP_im_MIN[i]</span>
<span id="cb83-250"><a href="#cb83-250" aria-hidden="true" tabindex="-1"></a>NPP_81_00_MAX<span class="ot">&lt;-</span>NPP_im_MAX[i]</span>
<span id="cb83-251"><a href="#cb83-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-252"><a href="#cb83-252" aria-hidden="true" tabindex="-1"></a><span class="co"># PHASE 2  : WARM UP .  years (w)</span></span>
<span id="cb83-253"><a href="#cb83-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-254"><a href="#cb83-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Cinputs </span></span>
<span id="cb83-255"><a href="#cb83-255" aria-hidden="true" tabindex="-1"></a>T<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[,<span class="dv">2</span>])</span>
<span id="cb83-256"><a href="#cb83-256" aria-hidden="true" tabindex="-1"></a>P<span class="ot">&lt;-</span><span class="fu">sum</span>(Precip[,<span class="dv">2</span>])</span>
<span id="cb83-257"><a href="#cb83-257" aria-hidden="true" tabindex="-1"></a>NPP_M[w]<span class="ot">&lt;-</span><span class="fu">NPPmodel</span>(P,T,<span class="st">&quot;miami&quot;</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb83-258"><a href="#cb83-258" aria-hidden="true" tabindex="-1"></a>NPP_M[w]<span class="ot">&lt;-</span>(LU<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP_M[w]<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_M[w]<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_M[w]<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb83-259"><a href="#cb83-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-260"><a href="#cb83-260" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {Cinputs[w]<span class="ot">&lt;-</span>(Spin_up[i,<span class="dv">3</span>]<span class="sc">/</span>NPP_81_00)<span class="sc">*</span>NPP_M[w]} <span class="cf">else</span> {Cinputs[w]<span class="ot">&lt;-</span>(Cinputs[[w<span class="dv">-1</span>]]<span class="sc">/</span> NPP_M[w<span class="dv">-1</span>]) <span class="sc">*</span> NPP_M[w]} </span>
<span id="cb83-261"><a href="#cb83-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-262"><a href="#cb83-262" aria-hidden="true" tabindex="-1"></a><span class="co"># Cinputs MIN</span></span>
<span id="cb83-263"><a href="#cb83-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-264"><a href="#cb83-264" aria-hidden="true" tabindex="-1"></a>Tmin<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">1.02</span>)</span>
<span id="cb83-265"><a href="#cb83-265" aria-hidden="true" tabindex="-1"></a>Pmin<span class="ot">&lt;-</span><span class="fu">sum</span>(Precip[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">0.95</span>)</span>
<span id="cb83-266"><a href="#cb83-266" aria-hidden="true" tabindex="-1"></a>NPP_M_MIN[w]<span class="ot">&lt;-</span><span class="fu">NPPmodel</span>(Pmin,Tmin,<span class="st">&quot;miami&quot;</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb83-267"><a href="#cb83-267" aria-hidden="true" tabindex="-1"></a>NPP_M_MIN[w]<span class="ot">&lt;-</span>(LU<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP_M_MIN[w]<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_M_MIN[w]<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_M_MIN[w]<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb83-268"><a href="#cb83-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-269"><a href="#cb83-269" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {Cinputs_min[w]<span class="ot">&lt;-</span>(Spin_up[i,<span class="dv">10</span>]<span class="sc">/</span>NPP_81_00)<span class="sc">*</span>NPP_M_MIN[w]} <span class="cf">else</span> {Cinputs_min[w]<span class="ot">&lt;-</span>(Cinputs_min[[w<span class="dv">-1</span>]]<span class="sc">/</span> NPP_M_MIN[w<span class="dv">-1</span>]) <span class="sc">*</span> NPP_M_MIN[w]} </span>
<span id="cb83-270"><a href="#cb83-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-271"><a href="#cb83-271" aria-hidden="true" tabindex="-1"></a><span class="co"># Cinputs MAX</span></span>
<span id="cb83-272"><a href="#cb83-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-273"><a href="#cb83-273" aria-hidden="true" tabindex="-1"></a>Tmax<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">0.98</span>)</span>
<span id="cb83-274"><a href="#cb83-274" aria-hidden="true" tabindex="-1"></a>Pmax<span class="ot">&lt;-</span><span class="fu">sum</span>(Precip[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">1.05</span>)</span>
<span id="cb83-275"><a href="#cb83-275" aria-hidden="true" tabindex="-1"></a>NPP_M_MAX[w]<span class="ot">&lt;-</span><span class="fu">NPPmodel</span>(Pmax,Tmax,<span class="st">&quot;miami&quot;</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb83-276"><a href="#cb83-276" aria-hidden="true" tabindex="-1"></a>NPP_M_MAX[w]<span class="ot">&lt;-</span>(LU<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP_M_MAX[w]<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_M_MAX[w]<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_M_MAX[w]<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb83-277"><a href="#cb83-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-278"><a href="#cb83-278" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {Cinputs_max[w]<span class="ot">&lt;-</span>(Spin_up[i,<span class="dv">11</span>]<span class="sc">/</span>NPP_81_00)<span class="sc">*</span>NPP_M_MAX[w]} <span class="cf">else</span> {Cinputs_max[w]<span class="ot">&lt;-</span>(Cinputs_max[[w<span class="dv">-1</span>]]<span class="sc">/</span> NPP_M_MAX[w<span class="dv">-1</span>]) <span class="sc">*</span> NPP_M_MAX[w]} </span>
<span id="cb83-279"><a href="#cb83-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-280"><a href="#cb83-280" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model for 2001-2018 </span></span>
<span id="cb83-281"><a href="#cb83-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-282"><a href="#cb83-282" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb83-283"><a href="#cb83-283" aria-hidden="true" tabindex="-1"></a>f_wp<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs[<span class="dv">1</span>],<span class="at">years=</span>years,<span class="at">DPMptf=</span>Spin_up[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>Spin_up[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>Spin_up[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>Spin_up[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>Spin_up[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb83-284"><a href="#cb83-284" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb83-285"><a href="#cb83-285" aria-hidden="true" tabindex="-1"></a>f_wp<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs[w],<span class="at">years=</span>years,<span class="at">DPMptf=</span>f_wp[<span class="dv">1</span>], <span class="at">RPMptf=</span>f_wp[<span class="dv">2</span>], <span class="at">BIOptf=</span>f_wp[<span class="dv">3</span>], <span class="at">HUMptf=</span>f_wp[<span class="dv">4</span>], <span class="at">FallIOM=</span>f_wp[<span class="dv">5</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb83-286"><a href="#cb83-286" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-287"><a href="#cb83-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-288"><a href="#cb83-288" aria-hidden="true" tabindex="-1"></a>f_wp_t<span class="ot">&lt;-</span>f_wp[<span class="dv">1</span>]<span class="sc">+</span>f_wp[<span class="dv">2</span>]<span class="sc">+</span>f_wp[<span class="dv">3</span>]<span class="sc">+</span>f_wp[<span class="dv">4</span>]<span class="sc">+</span>f_wp[<span class="dv">5</span>]</span>
<span id="cb83-289"><a href="#cb83-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-290"><a href="#cb83-290" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model for minimum values</span></span>
<span id="cb83-291"><a href="#cb83-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-292"><a href="#cb83-292" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb83-293"><a href="#cb83-293" aria-hidden="true" tabindex="-1"></a>f_wp_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_min[<span class="dv">1</span>],<span class="at">years=</span>years,<span class="at">DPMptf=</span>Spin_up[i,<span class="dv">13</span>], <span class="at">RPMptf=</span>Spin_up[i,<span class="dv">14</span>], <span class="at">BIOptf=</span>Spin_up[i,<span class="dv">15</span>], <span class="at">HUMptf=</span>Spin_up[i,<span class="dv">16</span>], <span class="at">FallIOM=</span>Spin_up[i,<span class="dv">17</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb83-294"><a href="#cb83-294" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb83-295"><a href="#cb83-295" aria-hidden="true" tabindex="-1"></a>f_wp_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_min[w],<span class="at">years=</span>years,<span class="at">DPMptf=</span>f_wp_min[<span class="dv">1</span>], <span class="at">RPMptf=</span>f_wp_min[<span class="dv">2</span>], <span class="at">BIOptf=</span>f_wp_min[<span class="dv">3</span>], <span class="at">HUMptf=</span>f_wp_min[<span class="dv">4</span>], <span class="at">FallIOM=</span>f_wp_min[<span class="dv">5</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb83-296"><a href="#cb83-296" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-297"><a href="#cb83-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-298"><a href="#cb83-298" aria-hidden="true" tabindex="-1"></a>f_wp_t_min<span class="ot">&lt;-</span>f_wp_min[<span class="dv">1</span>]<span class="sc">+</span>f_wp_min[<span class="dv">2</span>]<span class="sc">+</span>f_wp_min[<span class="dv">3</span>]<span class="sc">+</span>f_wp_min[<span class="dv">4</span>]<span class="sc">+</span>f_wp_min[<span class="dv">5</span>]</span>
<span id="cb83-299"><a href="#cb83-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-300"><a href="#cb83-300" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model for maximum values</span></span>
<span id="cb83-301"><a href="#cb83-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-302"><a href="#cb83-302" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb83-303"><a href="#cb83-303" aria-hidden="true" tabindex="-1"></a>f_wp_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_max[<span class="dv">1</span>],<span class="at">years=</span>years,<span class="at">DPMptf=</span>Spin_up[i,<span class="dv">19</span>], <span class="at">RPMptf=</span>Spin_up[i,<span class="dv">20</span>], <span class="at">BIOptf=</span>Spin_up[i,<span class="dv">21</span>], <span class="at">HUMptf=</span>Spin_up[i,<span class="dv">22</span>], <span class="at">FallIOM=</span>Spin_up[i,<span class="dv">23</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb83-304"><a href="#cb83-304" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb83-305"><a href="#cb83-305" aria-hidden="true" tabindex="-1"></a>f_wp_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_max[w],<span class="at">years=</span>years,<span class="at">DPMptf=</span>f_wp_max[<span class="dv">1</span>], <span class="at">RPMptf=</span>f_wp_max[<span class="dv">2</span>], <span class="at">BIOptf=</span>f_wp_max[<span class="dv">3</span>], <span class="at">HUMptf=</span>f_wp_max[<span class="dv">4</span>], <span class="at">FallIOM=</span>f_wp_max[<span class="dv">5</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb83-306"><a href="#cb83-306" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-307"><a href="#cb83-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-308"><a href="#cb83-308" aria-hidden="true" tabindex="-1"></a>f_wp_t_max<span class="ot">&lt;-</span>f_wp_max[<span class="dv">1</span>]<span class="sc">+</span>f_wp_max[<span class="dv">2</span>]<span class="sc">+</span>f_wp_max[<span class="dv">3</span>]<span class="sc">+</span>f_wp_max[<span class="dv">4</span>]<span class="sc">+</span>f_wp_max[<span class="dv">5</span>]</span>
<span id="cb83-309"><a href="#cb83-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-310"><a href="#cb83-310" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w)</span>
<span id="cb83-311"><a href="#cb83-311" aria-hidden="true" tabindex="-1"></a><span class="co">#print(c(i,SOC,Spin_up[i,3],NPP_81_00,Cinputs[w],f_wp_t))</span></span>
<span id="cb83-312"><a href="#cb83-312" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(NPP_M[w],Cinputs[w]))</span>
<span id="cb83-313"><a href="#cb83-313" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-314"><a href="#cb83-314" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-315"><a href="#cb83-315" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">mean</span>(Cinputs))){ CinputFOWARD<span class="ot">&lt;-</span><span class="cn">NA</span>} <span class="cf">else</span> { </span>
<span id="cb83-316"><a href="#cb83-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-317"><a href="#cb83-317" aria-hidden="true" tabindex="-1"></a>CinputFOWARD<span class="ot">&lt;-</span><span class="fu">mean</span>(Cinputs)</span>
<span id="cb83-318"><a href="#cb83-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-319"><a href="#cb83-319" aria-hidden="true" tabindex="-1"></a>CinputFOWARD_min<span class="ot">&lt;-</span><span class="fu">mean</span>(Cinputs_min)</span>
<span id="cb83-320"><a href="#cb83-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-321"><a href="#cb83-321" aria-hidden="true" tabindex="-1"></a>CinputFOWARD_max<span class="ot">&lt;-</span><span class="fu">mean</span>(Cinputs_max)</span>
<span id="cb83-322"><a href="#cb83-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-323"><a href="#cb83-323" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">2</span>]<span class="ot">&lt;-</span>SOC</span>
<span id="cb83-324"><a href="#cb83-324" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">3</span>]<span class="ot">&lt;-</span>Cinputs[<span class="dv">18</span>]</span>
<span id="cb83-325"><a href="#cb83-325" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">4</span>]<span class="ot">&lt;-</span>f_wp_t</span>
<span id="cb83-326"><a href="#cb83-326" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">5</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">1</span>]</span>
<span id="cb83-327"><a href="#cb83-327" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">6</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">2</span>]</span>
<span id="cb83-328"><a href="#cb83-328" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">7</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">3</span>]</span>
<span id="cb83-329"><a href="#cb83-329" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">8</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">4</span>]</span>
<span id="cb83-330"><a href="#cb83-330" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">9</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">5</span>]</span>
<span id="cb83-331"><a href="#cb83-331" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">10</span>]<span class="ot">&lt;-</span>CinputFOWARD</span>
<span id="cb83-332"><a href="#cb83-332" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">11</span>]<span class="ot">&lt;-</span>f_wp_t_min</span>
<span id="cb83-333"><a href="#cb83-333" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">12</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">1</span>]</span>
<span id="cb83-334"><a href="#cb83-334" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">13</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">2</span>]</span>
<span id="cb83-335"><a href="#cb83-335" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">14</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">3</span>]</span>
<span id="cb83-336"><a href="#cb83-336" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">15</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">4</span>]</span>
<span id="cb83-337"><a href="#cb83-337" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">16</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">5</span>]</span>
<span id="cb83-338"><a href="#cb83-338" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">17</span>]<span class="ot">&lt;-</span>f_wp_t_max</span>
<span id="cb83-339"><a href="#cb83-339" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">18</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">1</span>]</span>
<span id="cb83-340"><a href="#cb83-340" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">19</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">2</span>]</span>
<span id="cb83-341"><a href="#cb83-341" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">20</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">3</span>]</span>
<span id="cb83-342"><a href="#cb83-342" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">21</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">4</span>]</span>
<span id="cb83-343"><a href="#cb83-343" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">22</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">5</span>]</span>
<span id="cb83-344"><a href="#cb83-344" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">23</span>]<span class="ot">&lt;-</span>CinputFOWARD_min</span>
<span id="cb83-345"><a href="#cb83-345" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">24</span>]<span class="ot">&lt;-</span>CinputFOWARD_max</span>
<span id="cb83-346"><a href="#cb83-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-347"><a href="#cb83-347" aria-hidden="true" tabindex="-1"></a>Cinputs<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb83-348"><a href="#cb83-348" aria-hidden="true" tabindex="-1"></a>Cinputs_min<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb83-349"><a href="#cb83-349" aria-hidden="true" tabindex="-1"></a>Cinputs_max<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb83-350"><a href="#cb83-350" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-351"><a href="#cb83-351" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(i)</span>
<span id="cb83-352"><a href="#cb83-352" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-353"><a href="#cb83-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-354"><a href="#cb83-354" aria-hidden="true" tabindex="-1"></a><span class="do">################for loop ends#############</span></span>
<span id="cb83-355"><a href="#cb83-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-356"><a href="#cb83-356" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">&quot;SOC_FAO&quot;</span></span>
<span id="cb83-357"><a href="#cb83-357" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">&quot;Cin_t0&quot;</span></span>
<span id="cb83-358"><a href="#cb83-358" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0&quot;</span></span>
<span id="cb83-359"><a href="#cb83-359" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">5</span>]<span class="ot">=</span><span class="st">&quot;DPM_w_up&quot;</span></span>
<span id="cb83-360"><a href="#cb83-360" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">6</span>]<span class="ot">=</span><span class="st">&quot;RPM_w_up&quot;</span></span>
<span id="cb83-361"><a href="#cb83-361" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">7</span>]<span class="ot">=</span><span class="st">&quot;BIO_w_up&quot;</span></span>
<span id="cb83-362"><a href="#cb83-362" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">8</span>]<span class="ot">=</span><span class="st">&quot;HUM_w_up&quot;</span></span>
<span id="cb83-363"><a href="#cb83-363" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">9</span>]<span class="ot">=</span><span class="st">&quot;IOM_w_up&quot;</span></span>
<span id="cb83-364"><a href="#cb83-364" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">10</span>]<span class="ot">=</span><span class="st">&quot;Cin_mean&quot;</span></span>
<span id="cb83-365"><a href="#cb83-365" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">11</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0min&quot;</span></span>
<span id="cb83-366"><a href="#cb83-366" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">12</span>]<span class="ot">=</span><span class="st">&quot;DPM_w_min&quot;</span></span>
<span id="cb83-367"><a href="#cb83-367" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">13</span>]<span class="ot">=</span><span class="st">&quot;RPM_w_min&quot;</span></span>
<span id="cb83-368"><a href="#cb83-368" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">14</span>]<span class="ot">=</span><span class="st">&quot;BIO_w_min&quot;</span></span>
<span id="cb83-369"><a href="#cb83-369" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">15</span>]<span class="ot">=</span><span class="st">&quot;HUM_w_min&quot;</span></span>
<span id="cb83-370"><a href="#cb83-370" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">16</span>]<span class="ot">=</span><span class="st">&quot;IOM_w_min&quot;</span></span>
<span id="cb83-371"><a href="#cb83-371" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">17</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0max&quot;</span></span>
<span id="cb83-372"><a href="#cb83-372" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">18</span>]<span class="ot">=</span><span class="st">&quot;DPM_w_max&quot;</span></span>
<span id="cb83-373"><a href="#cb83-373" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">19</span>]<span class="ot">=</span><span class="st">&quot;RPM_w_max&quot;</span></span>
<span id="cb83-374"><a href="#cb83-374" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">20</span>]<span class="ot">=</span><span class="st">&quot;BIO_w_max&quot;</span></span>
<span id="cb83-375"><a href="#cb83-375" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">21</span>]<span class="ot">=</span><span class="st">&quot;HUM_w_max&quot;</span></span>
<span id="cb83-376"><a href="#cb83-376" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">22</span>]<span class="ot">=</span><span class="st">&quot;IOM_w_max&quot;</span></span>
<span id="cb83-377"><a href="#cb83-377" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">23</span>]<span class="ot">=</span><span class="st">&quot;Cin_min&quot;</span></span>
<span id="cb83-378"><a href="#cb83-378" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">24</span>]<span class="ot">=</span><span class="st">&quot;Cin_max&quot;</span></span>
<span id="cb83-379"><a href="#cb83-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-380"><a href="#cb83-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-381"><a href="#cb83-381" aria-hidden="true" tabindex="-1"></a><span class="co"># SAVE the Points (shapefile)</span></span>
<span id="cb83-382"><a href="#cb83-382" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/OUTPUTS/2_WARM_UP&quot;</span>)</span>
<span id="cb83-383"><a href="#cb83-383" aria-hidden="true" tabindex="-1"></a><span class="fu">writeOGR</span>(WARM_UP,<span class="st">&quot;.&quot;</span>, <span class="st">&quot;WARM_UP_County_AOI_LUsim&quot;</span>, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="script-number-15.-roth_c_forward_v2.r" class="section level2" number="10.4">
<h2 number="10.4"><span class="header-section-number">10.4</span> Script Number 15. “ROTH_C_forward_v2.R”</h2>
<p>Script number 15 implements the third modeling phase (“forward” phase). We will need to load the stack of layers generated in script number 12 and the target points. We will also need to load the output vector of the phase 2 (“warm up”) as an input. This script will run the Roth C model for 20 years, projecting SOC stocks for the 2020-2040 period under different management scenarios (“BAU” scenario and the three SSM scenarios: low, medium and high input carbon). C inputs will vary according to the SSM scenarios. Standard default values of 5-10-20% increase in C inputs are defined for the three SSM scenarios (low, medium, high, respectively). Users can modify these inputs based on local expertise and available information, and generate alternative maps using this data. The final outputs will be the final SOC stocks after 20 years for the different scenarios. This information will be saved to a shapefile.</p>
<p><strong>Table 10.3</strong> <em>Script Number 15. forward phase. Inputs and Outputs</em></p>
<p><img src="tables/Table_10.3.png" /></p>
<p>The ‘Forward’ modeling phase requires (as in the previous phases) the target points (generated from the Qgis procedure number 1), the stack of layers (from script number 12), and the output vector from the previous phase (warm up). We will need to load the R packages, the target points, the stack for this phase (Stack_Set_forward_[country_code].tif), and vector from the ‘Warm up’ phase (WARM_UP.shp).</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SoilR)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilassessment)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>WD_OUT<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/OUTPUTS/3_FOWARD&quot;</span>)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>working_dir<span class="ot">&lt;-</span><span class="fu">setwd</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020&quot;</span>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co"># OPEN THE VECTOR OF POINTS</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>Vector<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;INPUTS/TARGET_POINTS/target_points_sub.shp&quot;</span>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="co"># OPEN THE RESULT VECTOR FROM THE WARM UP PROCESS</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>WARM_UP<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;OUTPUTS/2_WARM_UP/WARM_UP_County_AOI.shp&quot;</span>)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="co"># OPEN THE STACK WITH THE VARIABLES FOR THE FOWARD PROCESS</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>Stack_Set_1<span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;INPUTS/STACK/Stack_Set_FOWARD.tif&quot;</span>)</span></code></pre></div>
<p>We can set the SSM carbon input increment of each land use class.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the increase in Carbon input for each land use and each scenario</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Crops and Crop trees</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>Low_Crops<span class="ot">&lt;-</span><span class="fl">1.05</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>Med_Crops<span class="ot">&lt;-</span><span class="fl">1.10</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>High_Crops<span class="ot">&lt;-</span><span class="fl">1.2</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Shrublands, Grasslands , Herbaceous vegetation flooded &amp; Sparse Vegetation</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>Low_Grass<span class="ot">&lt;-</span><span class="fl">1.05</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>Med_Grass<span class="ot">&lt;-</span><span class="fl">1.10</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>High_Grass<span class="ot">&lt;-</span><span class="fl">1.2</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Forest</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>Low_Forest<span class="ot">&lt;-</span><span class="fl">1.05</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>Med_Forest<span class="ot">&lt;-</span><span class="fl">1.10</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>High_Forest<span class="ot">&lt;-</span><span class="fl">1.2</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Paddy Fields</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>Low_PaddyFields<span class="ot">&lt;-</span><span class="fl">1.05</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>Med_PaddyFields<span class="ot">&lt;-</span><span class="fl">1.10</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>High_PaddyFields<span class="ot">&lt;-</span><span class="fl">1.2</span></span></code></pre></div>
<p>Next, we will extract the variables contained in the stack to the target points.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract variables to points</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>Variables<span class="ot">&lt;-</span><span class="fu">extract</span>(Stack_Set_1,Vector,<span class="at">sp=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Then we will create a variable to save the results from the simulations.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates an empty vector</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="ot">&lt;-</span>Vector</span></code></pre></div>
<p>We will extract some of the variables needed in the model to individual variables .</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the layers from the Vector</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>SOC_im<span class="ot">&lt;-</span>WARM_UP[[<span class="dv">4</span>]]</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>clay_im<span class="ot">&lt;-</span>Variables[[<span class="dv">3</span>]] </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>Cinputs_im<span class="ot">&lt;-</span>WARM_UP[[<span class="dv">10</span>]] </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>DR_im<span class="ot">&lt;-</span>Variables[[<span class="dv">40</span>]]</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>LU_im<span class="ot">&lt;-</span>Variables[[<span class="dv">41</span>]]</span></code></pre></div>
<p>Next, we will define the number of years for the modeling runs.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the years to run the model</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>years<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>,<span class="dv">20</span>,<span class="at">by=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>)</span></code></pre></div>
<p>Then, we will set the RothC function as we did for the previous modeling phases.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############function set up starts###############</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>Roth_C<span class="ot">&lt;-</span><span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1,LU)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Paddy Fields coefficent fPR = 0.4 if the target point is class = 13 , else fPR=1</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co"># From Shirato and Yukozawa 2004</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>fPR<span class="ot">=</span>(LU <span class="sc">==</span> <span class="dv">13</span>)<span class="sc">*</span><span class="fl">0.4</span> <span class="sc">+</span> (LU<span class="sc">!=</span><span class="dv">13</span>)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Temperature effects per month</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>fT<span class="ot">=</span><span class="fu">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Moisture effects per month . </span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>fw1func<span class="ot">&lt;-</span><span class="cf">function</span>(P, E, <span class="at">S.Thick =</span> <span class="dv">30</span>, <span class="at">pClay =</span> <span class="fl">32.0213</span>, <span class="at">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> P <span class="sc">-</span> E <span class="sc">*</span> pE</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    Acc.TSMD <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    B <span class="ot">=</span> <span class="fu">ifelse</span>(bare[i] <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>     Max.TSMD <span class="ot">=</span> <span class="sc">-</span>(<span class="dv">20</span> <span class="sc">+</span> <span class="fl">1.3</span> <span class="sc">*</span> pClay <span class="sc">-</span> <span class="fl">0.01</span> <span class="sc">*</span> (pClay<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (S.Thick<span class="sc">/</span><span class="dv">23</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>B)</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">ifelse</span>(M[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i] <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i]</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> (Acc.TSMD[i] <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="sc">&lt;=</span> Max.TSMD) {</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Max.TSMD</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">ifelse</span>(Acc.TSMD <span class="sc">&gt;</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> ((Max.TSMD <span class="sc">-</span> </span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD)<span class="sc">/</span>(Max.TSMD <span class="sc">-</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD))))</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>    b<span class="ot">&lt;-</span><span class="fu">clamp</span>(b,<span class="at">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(b))</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>fW_2<span class="ot">&lt;-</span> <span class="fu">fw1func</span>(<span class="at">P=</span>(Precip[,<span class="dv">2</span>]), <span class="at">E=</span>(Evp[,<span class="dv">2</span>]), <span class="at">S.Thick =</span> soil.thick, <span class="at">pClay =</span> clay, <span class="at">pE =</span> <span class="dv">1</span>, <span class="at">bare=</span>bare1)<span class="sc">$</span>b </span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Vegetation Cover effects  </span></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>fC<span class="ot">&lt;-</span>Cov2[,<span class="dv">2</span>]</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>xi.frame<span class="ot">=</span><span class="fu">data.frame</span>(years,<span class="fu">rep</span>(fT<span class="sc">*</span>fW_2<span class="sc">*</span>fC<span class="sc">*</span>fPR,<span class="at">length.out=</span><span class="fu">length</span>(years)))</span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from SoilR</span></span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a><span class="co">#Loads the model </span></span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf[[1]], RPMptf[[1]], BIOptf[[1]], HUMptf[[1]], FallIOM[[1]]),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from soilassesment</span></span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a>Model3_spin<span class="ot">=</span><span class="fu">carbonTurnover</span>(<span class="at">tt=</span>years,<span class="at">C0=</span><span class="fu">c</span>(DPMptf[[<span class="dv">1</span>]], RPMptf[[<span class="dv">1</span>]], BIOptf[[<span class="dv">1</span>]], HUMptf[[<span class="dv">1</span>]], FallIOM[[<span class="dv">1</span>]]),<span class="at">In=</span>Cinputs,<span class="at">Dr=</span>DR,<span class="at">clay=</span>clay,<span class="at">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a>Ct3_spin<span class="ot">=</span>Model3_spin[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb90-59"><a href="#cb90-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a>poolSize3_spin<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-62"><a href="#cb90-62" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(poolSize3_spin)</span>
<span id="cb90-63"><a href="#cb90-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-64"><a href="#cb90-64" aria-hidden="true" tabindex="-1"></a><span class="do">################function set up ends#############</span></span></code></pre></div>
<p>Then we can iterate over the vector variable, running the model for each target point.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterates over the area of interest</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################for loop starts###############</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Variables)[<span class="dv">1</span>]) {</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the variables </span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>Vect<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Variables[i,])</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">4</span><span class="sc">:</span><span class="dv">15</span>]))</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Temp=</span>Temp[,<span class="dv">1</span>])</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">16</span><span class="sc">:</span><span class="dv">27</span>]))</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Precip=</span>Precip[,<span class="dv">1</span>])</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">28</span><span class="sc">:</span><span class="dv">39</span>]))</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Evp=</span>Evp[,<span class="dv">1</span>])</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>Cov<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">42</span><span class="sc">:</span><span class="dv">53</span>]))</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>Cov1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>Cov2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Avoid calculus over Na values </span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(Evp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Temp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(SOC_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(clay_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Precip[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov2[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov1[,<span class="dv">1</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Cinputs_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(DR_im[i])) <span class="sc">|</span> (Cinputs_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span>  (SOC_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span> (clay_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) ) {FOWARD[i,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">0</span>}<span class="cf">else</span>{</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the variables from the images</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>soil.thick<span class="ot">=</span><span class="dv">30</span>  <span class="co">#Soil thickness (organic layer topsoil), in cm</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>SOC<span class="ot">&lt;-</span>SOC_im[i]      <span class="co">#Soil organic carbon in Mg/ha </span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>clay<span class="ot">&lt;-</span>clay_im[i]        <span class="co">#Percent clay %</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>Cinputs<span class="ot">&lt;-</span>Cinputs_im[i]    <span class="co">#Annual C inputs to soil in Mg/ha/yr</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>DR_im[i]              <span class="co"># DPM/RPM (decomplosable vs resistant plant material.)</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>bare1<span class="ot">&lt;-</span>(Cov1<span class="sc">&gt;</span><span class="fl">0.8</span>)           <span class="co"># If the surface is bare or vegetated</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>LU<span class="ot">&lt;-</span>LU_im[i]</span></code></pre></div>
<p>Now we can run the model for the business as usual (BAU) scenario. The “f_bau_t” variable will save the result of the model in each iteration.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Final calculation of SOC  20 years in the future  (Business as usual)</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>f_bau<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs,<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>f_bau_t<span class="ot">&lt;-</span>f_bau[<span class="dv">1</span>]<span class="sc">+</span>f_bau[<span class="dv">2</span>]<span class="sc">+</span>f_bau[<span class="dv">3</span>]<span class="sc">+</span>f_bau[<span class="dv">4</span>]<span class="sc">+</span>f_bau[<span class="dv">5</span>]</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Unc BAU minimum </span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>Cinputs_min<span class="ot">&lt;-</span>WARM_UP<span class="sc">@</span>data[i,<span class="dv">23</span>]</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>Cinputs_max<span class="ot">&lt;-</span>WARM_UP<span class="sc">@</span>data[i,<span class="dv">24</span>]</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>SOC_t0_min<span class="ot">&lt;-</span>WARM_UP<span class="sc">@</span>data[i,<span class="dv">11</span>]</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>SOC_t0_max<span class="ot">&lt;-</span>WARM_UP<span class="sc">@</span>data[i,<span class="dv">17</span>]</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>f_bau_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_min,<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>f_bau_t_min<span class="ot">&lt;-</span>f_bau_min[<span class="dv">1</span>]<span class="sc">+</span>f_bau_min[<span class="dv">2</span>]<span class="sc">+</span>f_bau_min[<span class="dv">3</span>]<span class="sc">+</span>f_bau_min[<span class="dv">4</span>]<span class="sc">+</span>f_bau_min[<span class="dv">5</span>]</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Unc BAU maximum</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>f_bau_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_max,<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>f_bau_t_max<span class="ot">&lt;-</span>f_bau_max[<span class="dv">1</span>]<span class="sc">+</span>f_bau_max[<span class="dv">2</span>]<span class="sc">+</span>f_bau_max[<span class="dv">3</span>]<span class="sc">+</span>f_bau_max[<span class="dv">4</span>]<span class="sc">+</span>f_bau_max[<span class="dv">5</span>]</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Crops and Tree crops</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (LU<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">12</span>){</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>f_low<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Low_Crops),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>f_low_t<span class="ot">&lt;-</span>f_low[<span class="dv">1</span>]<span class="sc">+</span>f_low[<span class="dv">2</span>]<span class="sc">+</span>f_low[<span class="dv">3</span>]<span class="sc">+</span>f_low[<span class="dv">4</span>]<span class="sc">+</span>f_low[<span class="dv">5</span>]</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>f_med<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Med_Crops),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>f_med_t<span class="ot">&lt;-</span>f_med[<span class="dv">1</span>]<span class="sc">+</span>f_med[<span class="dv">2</span>]<span class="sc">+</span>f_med[<span class="dv">3</span>]<span class="sc">+</span>f_med[<span class="dv">4</span>]<span class="sc">+</span>f_med[<span class="dv">5</span>]</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>f_high<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>High_Crops),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>f_high_t<span class="ot">&lt;-</span>f_high[<span class="dv">1</span>]<span class="sc">+</span>f_high[<span class="dv">2</span>]<span class="sc">+</span>f_high[<span class="dv">3</span>]<span class="sc">+</span>f_high[<span class="dv">4</span>]<span class="sc">+</span>f_high[<span class="dv">5</span>]</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a><span class="co"># SSM croplands unc min</span></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>f_med_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_min<span class="sc">*</span>(Med_Crops<span class="fl">-0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>f_med_t_min<span class="ot">&lt;-</span>f_med_min[<span class="dv">1</span>]<span class="sc">+</span>f_med_min[<span class="dv">2</span>]<span class="sc">+</span>f_med_min[<span class="dv">3</span>]<span class="sc">+</span>f_med_min[<span class="dv">4</span>]<span class="sc">+</span>f_med_min[<span class="dv">5</span>]</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a><span class="co"># SSM croplands unc max</span></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>f_med_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_max<span class="sc">*</span>(Med_Crops<span class="fl">+0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>f_med_t_max<span class="ot">&lt;-</span>f_med_max[<span class="dv">1</span>]<span class="sc">+</span>f_med_max[<span class="dv">2</span>]<span class="sc">+</span>f_med_max[<span class="dv">3</span>]<span class="sc">+</span>f_med_max[<span class="dv">4</span>]<span class="sc">+</span>f_med_max[<span class="dv">5</span>]</span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Shrublands, grasslands, and sparce vegetation</span></span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> (LU<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">8</span>) {</span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>f_low<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Low_Grass),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a>f_low_t<span class="ot">&lt;-</span>f_low[<span class="dv">1</span>]<span class="sc">+</span>f_low[<span class="dv">2</span>]<span class="sc">+</span>f_low[<span class="dv">3</span>]<span class="sc">+</span>f_low[<span class="dv">4</span>]<span class="sc">+</span>f_low[<span class="dv">5</span>]</span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>f_med<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Med_Grass),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a>f_med_t<span class="ot">&lt;-</span>f_med[<span class="dv">1</span>]<span class="sc">+</span>f_med[<span class="dv">2</span>]<span class="sc">+</span>f_med[<span class="dv">3</span>]<span class="sc">+</span>f_med[<span class="dv">4</span>]<span class="sc">+</span>f_med[<span class="dv">5</span>]</span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a>f_high<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>High_Grass),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a>f_high_t<span class="ot">&lt;-</span>f_high[<span class="dv">1</span>]<span class="sc">+</span>f_high[<span class="dv">2</span>]<span class="sc">+</span>f_high[<span class="dv">3</span>]<span class="sc">+</span>f_high[<span class="dv">4</span>]<span class="sc">+</span>f_high[<span class="dv">5</span>]</span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a><span class="co">#SSM Shrublands unc min</span></span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a>f_med_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_min<span class="sc">*</span>(Med_Grass<span class="fl">-0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a>f_med_t_min<span class="ot">&lt;-</span>f_med_min[<span class="dv">1</span>]<span class="sc">+</span>f_med_min[<span class="dv">2</span>]<span class="sc">+</span>f_med_min[<span class="dv">3</span>]<span class="sc">+</span>f_med_min[<span class="dv">4</span>]<span class="sc">+</span>f_med_min[<span class="dv">5</span>]</span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a><span class="co">#SSM Shrublands unc max</span></span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a>f_med_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_max<span class="sc">*</span>(Med_Grass<span class="fl">+0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a>f_med_t_max<span class="ot">&lt;-</span>f_med_max[<span class="dv">1</span>]<span class="sc">+</span>f_med_max[<span class="dv">2</span>]<span class="sc">+</span>f_med_max[<span class="dv">3</span>]<span class="sc">+</span>f_med_max[<span class="dv">4</span>]<span class="sc">+</span>f_med_max[<span class="dv">5</span>]</span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Paddy Fields </span></span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> (LU<span class="sc">==</span><span class="dv">13</span>) {</span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a>f_low<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Low_PaddyFields),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a>f_low_t<span class="ot">&lt;-</span>f_low[<span class="dv">1</span>]<span class="sc">+</span>f_low[<span class="dv">2</span>]<span class="sc">+</span>f_low[<span class="dv">3</span>]<span class="sc">+</span>f_low[<span class="dv">4</span>]<span class="sc">+</span>f_low[<span class="dv">5</span>]</span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a>f_med<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Med_PaddyFields),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a>f_med_t<span class="ot">&lt;-</span>f_med[<span class="dv">1</span>]<span class="sc">+</span>f_med[<span class="dv">2</span>]<span class="sc">+</span>f_med[<span class="dv">3</span>]<span class="sc">+</span>f_med[<span class="dv">4</span>]<span class="sc">+</span>f_med[<span class="dv">5</span>]</span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>f_high<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>High_PaddyFields),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a>f_high_t<span class="ot">&lt;-</span>f_high[<span class="dv">1</span>]<span class="sc">+</span>f_high[<span class="dv">2</span>]<span class="sc">+</span>f_high[<span class="dv">3</span>]<span class="sc">+</span>f_high[<span class="dv">4</span>]<span class="sc">+</span>f_high[<span class="dv">5</span>]</span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a><span class="co">#SSM Forest unc min</span></span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a>f_med_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_min<span class="sc">*</span>(Med_PaddyFields<span class="fl">-0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a>f_med_t_min<span class="ot">&lt;-</span>f_med_min[<span class="dv">1</span>]<span class="sc">+</span>f_med_min[<span class="dv">2</span>]<span class="sc">+</span>f_med_min[<span class="dv">3</span>]<span class="sc">+</span>f_med_min[<span class="dv">4</span>]<span class="sc">+</span>f_med_min[<span class="dv">5</span>]</span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a><span class="co">#SSM Forest unc max</span></span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-82"><a href="#cb92-82" aria-hidden="true" tabindex="-1"></a>f_med_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_max<span class="sc">*</span>(Med_PaddyFields<span class="fl">+0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb92-83"><a href="#cb92-83" aria-hidden="true" tabindex="-1"></a>f_med_t_max<span class="ot">&lt;-</span>f_med_max[<span class="dv">1</span>]<span class="sc">+</span>f_med_max[<span class="dv">2</span>]<span class="sc">+</span>f_med_max[<span class="dv">3</span>]<span class="sc">+</span>f_med_max[<span class="dv">4</span>]<span class="sc">+</span>f_med_max[<span class="dv">5</span>]</span>
<span id="cb92-84"><a href="#cb92-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-85"><a href="#cb92-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-86"><a href="#cb92-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-87"><a href="#cb92-87" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>{</span>
<span id="cb92-88"><a href="#cb92-88" aria-hidden="true" tabindex="-1"></a>f_bau_t<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb92-89"><a href="#cb92-89" aria-hidden="true" tabindex="-1"></a>f_low_t<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb92-90"><a href="#cb92-90" aria-hidden="true" tabindex="-1"></a>f_med_t<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb92-91"><a href="#cb92-91" aria-hidden="true" tabindex="-1"></a>f_high_t<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb92-92"><a href="#cb92-92" aria-hidden="true" tabindex="-1"></a>f_bau_t_min<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb92-93"><a href="#cb92-93" aria-hidden="true" tabindex="-1"></a>f_bau_t_max<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb92-94"><a href="#cb92-94" aria-hidden="true" tabindex="-1"></a>f_med_t_min<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb92-95"><a href="#cb92-95" aria-hidden="true" tabindex="-1"></a>f_med_t_max<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb92-96"><a href="#cb92-96" aria-hidden="true" tabindex="-1"></a>SOC_t0_min<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb92-97"><a href="#cb92-97" aria-hidden="true" tabindex="-1"></a>SOC_t0_max<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb92-98"><a href="#cb92-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-99"><a href="#cb92-99" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-100"><a href="#cb92-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-101"><a href="#cb92-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-102"><a href="#cb92-102" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">2</span>]<span class="ot">&lt;-</span>SOC</span>
<span id="cb92-103"><a href="#cb92-103" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">3</span>]<span class="ot">&lt;-</span>f_bau_t</span>
<span id="cb92-104"><a href="#cb92-104" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">4</span>]<span class="ot">&lt;-</span>f_bau[<span class="dv">1</span>]</span>
<span id="cb92-105"><a href="#cb92-105" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">5</span>]<span class="ot">&lt;-</span>f_bau[<span class="dv">2</span>]</span>
<span id="cb92-106"><a href="#cb92-106" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">6</span>]<span class="ot">&lt;-</span>f_bau[<span class="dv">3</span>]</span>
<span id="cb92-107"><a href="#cb92-107" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">7</span>]<span class="ot">&lt;-</span>f_bau[<span class="dv">4</span>]</span>
<span id="cb92-108"><a href="#cb92-108" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">8</span>]<span class="ot">&lt;-</span>f_bau[<span class="dv">5</span>]</span>
<span id="cb92-109"><a href="#cb92-109" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">9</span>]<span class="ot">&lt;-</span>LU</span>
<span id="cb92-110"><a href="#cb92-110" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">10</span>]<span class="ot">&lt;-</span>f_low_t</span>
<span id="cb92-111"><a href="#cb92-111" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">11</span>]<span class="ot">&lt;-</span>f_med_t</span>
<span id="cb92-112"><a href="#cb92-112" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">12</span>]<span class="ot">&lt;-</span>f_high_t</span>
<span id="cb92-113"><a href="#cb92-113" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">13</span>]<span class="ot">&lt;-</span>f_bau_t_min</span>
<span id="cb92-114"><a href="#cb92-114" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">14</span>]<span class="ot">&lt;-</span>f_bau_t_max</span>
<span id="cb92-115"><a href="#cb92-115" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">15</span>]<span class="ot">&lt;-</span>f_med_t_min</span>
<span id="cb92-116"><a href="#cb92-116" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">16</span>]<span class="ot">&lt;-</span>f_med_t_max</span>
<span id="cb92-117"><a href="#cb92-117" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">17</span>]<span class="ot">&lt;-</span>SOC_t0_min</span>
<span id="cb92-118"><a href="#cb92-118" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">18</span>]<span class="ot">&lt;-</span>SOC_t0_max</span>
<span id="cb92-119"><a href="#cb92-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-120"><a href="#cb92-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-121"><a href="#cb92-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-122"><a href="#cb92-122" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(i,SOC,f_bau_t,f_low_t,f_med_t,f_high_t,f_bau_t_min,f_bau_t_max))</span>
<span id="cb92-123"><a href="#cb92-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-124"><a href="#cb92-124" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb92-125"><a href="#cb92-125" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb92-126"><a href="#cb92-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-127"><a href="#cb92-127" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop ends##############</span></span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>Next , we will change the names of the fields <span class="cf">in</span> the output vector layer.</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0&quot;</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">&quot;SOC_BAU_20&quot;</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">&quot;DPM_BAU_20&quot;</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">5</span>]<span class="ot">=</span><span class="st">&quot;RPM_BAU_20&quot;</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">6</span>]<span class="ot">=</span><span class="st">&quot;BIO_BAU_20&quot;</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">7</span>]<span class="ot">=</span><span class="st">&quot;HUM_BAU_20&quot;</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">8</span>]<span class="ot">=</span><span class="st">&quot;IOM_BAU_20&quot;</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">9</span>]<span class="ot">=</span><span class="st">&quot;LandUse&quot;</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">10</span>]<span class="ot">=</span><span class="st">&quot;Low_Scenario&quot;</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">11</span>]<span class="ot">=</span><span class="st">&quot;Med_Scenario&quot;</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">12</span>]<span class="ot">=</span><span class="st">&quot;High_Scenario&quot;</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">13</span>]<span class="ot">=</span><span class="st">&quot;SOC_BAU_20_min&quot;</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">14</span>]<span class="ot">=</span><span class="st">&quot;SOC_BAU_20_max&quot;</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">15</span>]<span class="ot">=</span><span class="st">&quot;Med_Scen_min&quot;</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">16</span>]<span class="ot">=</span><span class="st">&quot;Med_Scen_max&quot;</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">17</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0_min&quot;</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">18</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0_max&quot;</span></span></code></pre></div>
<p>The ‘euler’ method can give some out of range results in some points, under specific combinations of climatic, soil and NPP variables. To avoid including those points in the maps we will remove any “out of range” value.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminate  values out of range</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20[FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Low_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Low_Scenario<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scenario<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>High_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>High_Scenario<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_min[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_min<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_max[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_max<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20[FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Low_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Low_Scenario<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scenario<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>High_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>High_Scenario<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_min[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_min<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_max[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_max<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span></code></pre></div>
<p>Then, we will run the rest of the script, set the working directory, calculate the uncertainties and set the name of the output vector layer.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Set the working directory </span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_OUT)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># UNCERTAINTIES</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>UNC_SOC<span class="ot">&lt;-</span>((FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20_max<span class="sc">-</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20_min)<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>UNC_2018<span class="ot">&lt;-</span>((FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_2018_max<span class="sc">-</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_2018_min)<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_i_2018))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>UNC_SSM<span class="ot">&lt;-</span>((FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_max<span class="sc">-</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_min)<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scenario))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>FOWARD[[<span class="dv">19</span>]]<span class="ot">&lt;-</span>UNC_SOC</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>FOWARD[[<span class="dv">20</span>]]<span class="ot">&lt;-</span>UNC_2018</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>FOWARD[[<span class="dv">21</span>]]<span class="ot">&lt;-</span>UNC_SSM</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">19</span>]<span class="ot">=</span><span class="st">&quot;UNC_BAU&quot;</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">20</span>]<span class="ot">=</span><span class="st">&quot;UNC_2018&quot;</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">21</span>]<span class="ot">=</span><span class="st">&quot;UNC_SSM&quot;</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a><span class="co"># SAVE the Points (shapefile)</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a> <span class="fu">writeOGR</span>(FOWARD, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;FOWARD_County_AOI&quot;</span>, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>) </span></code></pre></div>
<!--chapter:end:10.Stage_2_running_the_model.rmd-->
</div>
</div>
<div id="stage-3-map-generation" class="section level1" number="11">
<h1 number="11"><span class="header-section-number">11</span> | Stage 3: Map generation</h1>
<p>Once the model is run through the three proposed phases, we have all the information required for generating the maps. We need to transform the output vector to raster layers. We will obtain the SOC stocks after 20 years of SSM practices for the three scenarios (low, medium and high carbon inputs increments), and SOC stocks under the business as usual scenario (no carbon input increment). We will estimate four absolute carbon sequestration rates (considering the 2018 or 2020 SOC as a baseline), and three relative carbon sequestration rates (considering the SOC stocks under the business as usual as the baseline).</p>
<div id="script-number-16-points_to_raster.r" class="section level2" number="11.1">
<h2 number="11.1"><span class="header-section-number">11.1</span> Script Number 16: “Points_to_Raster.R”</h2>
<p>We will use script number 16 to transform the output vector from script number 15 to raster layers. The inputs for this script are the output vector from script 15, the FAO SOC layer and the country boundary polygon. The outputs of the script number 16 are the SOC stocks for the future scenarios (20 years): BAU, low, medium and high carbon inputs, three relative sequestration rates (SOC stock SSM scenario - BAU scenario)/20 , and four absolute sequestration rates: (SOC stock SSM or BAU scenario - SOC stocks 2018/20)/20.</p>
<p><strong>Table 11.1</strong> <em>Script Number 16. Target Points to Rasters Products. Inputs and Outputs</em></p>
<p><img src="tables/Table_11.1.png" /></p>
<p>We will open the script “Points_to_Raster.R” and load the required packages; then set the directories of the required files: Forward outputs, SOC, AOI, and the outputs maps folder.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>WD_F<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/OUTPUTS/3_FOWARD&quot;</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>WD_MAPS<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/OUTPUTS/4_MAPS&quot;</span>)</span></code></pre></div>
<p>Now we will define the name of the output area of interest / country or region. In this example, “Pergamino”.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define the name of the Country (&quot;ISO3CountryCode&quot;)</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="st">&quot;Pergamino&quot;</span> </span></code></pre></div>
<p>Then open the layers:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Open FORWARD vector</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_F)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;FOWARD_County_AOI.shp&quot;</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP (master layer)</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>SOC_MAP<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Creates emtpy raster </span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>empty_raster<span class="ot">&lt;-</span>SOC_MAP<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the country vector boundaries</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>Country<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut the raster with the country vector</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>Country_raster<span class="ot">&lt;-</span><span class="fu">crop</span>(empty_raster,Country)</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace Na values for zero values</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data[<span class="fu">is.na</span>(FOWARD<span class="sc">@</span>data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
<p>Next, we will transform the vector points from the FORWARD phase of the model to raster files using the “rasterize” function.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Points to Raster BAU</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_MAPS)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>Country_BAU_2040_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD, Country_raster ,FOWARD<span class="sc">$</span>SOC_BAU_20, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Country_BAU_2040_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_finalSOC_BAU_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Points to Raster Low Scenario</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>Country_Lwr_2040_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD, Country_raster ,FOWARD<span class="sc">$</span>Lw_Sc, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Country_Lwr_2040_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_finalSOC_SSM1_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Points to Raster Med Scenario</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>Country_Med_2040_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD, Country_raster ,FOWARD<span class="sc">$</span>Md_Sc, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Country_Med_2040_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_finalSOC_SSM2_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Points to Raster High Scenario</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>Country_Hgh_2040_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD, Country_raster ,FOWARD<span class="sc">$</span>Hgh_S, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Country_Hgh_2040_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_finalSOC_SSM3_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Points to Raster initial SOC (t0) 2018/2020</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>Country_SOC_2018_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD, Country_raster ,FOWARD<span class="sc">$</span>SOC__, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Country_SOC_2018_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_T0_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>Now, we will calculate the absolute differences and the absolute rates (SSM - SOC 2018).</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference BAU 2040 - SOC 2018</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>Diff_BAU_SOC_2018<span class="ot">&lt;-</span>Country_BAU_2040_Map<span class="sc">-</span>Country_SOC_2018_Map</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_BAU_SOC_2018,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_AbsDiff_BAU_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_BAU_SOC_2018<span class="sc">/</span><span class="dv">20</span>,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_ASR_BAU_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference Low Scenario - SOC 2018</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>Diff_Lw_SOC_2018<span class="ot">&lt;-</span>Country_Lwr_2040_Map<span class="sc">-</span>Country_SOC_2018_Map</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Lw_SOC_2018,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_AbsDiff_SSM1_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Lw_SOC_2018<span class="sc">/</span><span class="dv">20</span>,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_ASR_SSM1_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference Med Scenario - SOC 2018</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>Diff_Md_SOC_2018<span class="ot">&lt;-</span>Country_Med_2040_Map<span class="sc">-</span>Country_SOC_2018_Map</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Md_SOC_2018,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_AbsDiff_SSM2_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Md_SOC_2018<span class="sc">/</span><span class="dv">20</span>,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_ASR_SSM2_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference High Scenario - SOC 2018</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>Diff_Hg_SOC_2018<span class="ot">&lt;-</span>Country_Hgh_2040_Map<span class="sc">-</span>Country_SOC_2018_Map</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Hg_SOC_2018,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_AbsDiff_SSM3_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Hg_SOC_2018<span class="sc">/</span><span class="dv">20</span>,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_ASR_SSM3_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>Next, we will calculate the relative differences and rates (SSM - SOC BAU).</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference Low Scenario - BAU 2040</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>Diff_Lw_BAU_2040<span class="ot">&lt;-</span>Country_Lwr_2040_Map<span class="sc">-</span>Country_BAU_2040_Map</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Lw_BAU_2040,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_RelDiff_SSM1_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Lw_BAU_2040<span class="sc">/</span><span class="dv">20</span>,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_RSR_SSM1_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference Med Scenario - BAU 2040</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>Diff_Md_BAU_2040<span class="ot">&lt;-</span>Country_Med_2040_Map<span class="sc">-</span>Country_BAU_2040_Map</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Md_BAU_2040,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_RelDiff_SSM2_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Md_BAU_2040<span class="sc">/</span><span class="dv">20</span>,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_RSR_SSM2_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference High Scenario - BAU 2040</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>Diff_Hg_BAU_2040<span class="ot">&lt;-</span>Country_Hgh_2040_Map<span class="sc">-</span>Country_BAU_2040_Map</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Hg_BAU_2040,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_RelDiff_SSM3_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Diff_Hg_BAU_2040<span class="sc">/</span><span class="dv">20</span>,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_RSR_SSM3_Map030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>Now, we will rasterize the values of the uncertainties of SOC BAU, SOC 2018 and one SSM (one for the three scenarios).</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncertainties SOC 2018</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>UNC_2018<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD, Country_raster ,FOWARD<span class="sc">$</span>UNC_2, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(UNC_2018,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_T0_UncertaintyMap030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncertainties SOC BAU 2038</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>UNC_BAU<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD, Country_raster ,FOWARD<span class="sc">$</span>UNC_B, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(UNC_BAU,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_BAU_UncertaintyMap030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncertainties SOC SSM </span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>UNC_SSM<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD, Country_raster ,FOWARD<span class="sc">$</span>UNC_S, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(UNC_SSM,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_SSM_UncertaintyMap030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>Now we will calculate the uncertainties for the absolute rates.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncertainties for the Absolute difference SSM_ - SOC2018</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>UNC_abs_rate_BAU<span class="ot">&lt;-</span><span class="fu">sqrt</span>((FOWARD<span class="sc">$</span>UNC_B<span class="sc">*</span>FOWARD<span class="sc">$</span>SOC_BAU_20)<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span> (FOWARD<span class="sc">$</span>UNC_2<span class="sc">*</span>FOWARD<span class="sc">$</span>SOC__)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">abs</span>(FOWARD<span class="sc">$</span>SOC__<span class="sc">+</span>FOWARD<span class="sc">$</span>SOC_BAU_20)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>UNC_abs_rate_BAU_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD,Country_raster,UNC_abs_rate_BAU, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(UNC_abs_rate_BAU_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_ASR_BAU_UncertaintyMap030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>UNC_abs_rate_Lw<span class="ot">&lt;-</span><span class="fu">sqrt</span>((FOWARD<span class="sc">$</span>UNC_S<span class="sc">*</span>FOWARD<span class="sc">$</span>Lw_Sc)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (FOWARD<span class="sc">$</span>UNC_2<span class="sc">*</span>FOWARD<span class="sc">$</span>SOC__)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">abs</span>(FOWARD<span class="sc">$</span>SOC__<span class="sc">+</span>FOWARD<span class="sc">$</span>Lw_Sc)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>UNC_abs_rate_Lw_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD,Country_raster,UNC_abs_rate_Lw, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(UNC_abs_rate_Lw_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_ASR_SSM1_UncertaintyMap030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>UNC_abs_rate_Md<span class="ot">&lt;-</span><span class="fu">sqrt</span>((FOWARD<span class="sc">$</span>UNC_S<span class="sc">*</span>FOWARD<span class="sc">$</span>Md_Sc)<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span> (FOWARD<span class="sc">$</span>UNC_2<span class="sc">*</span>FOWARD<span class="sc">$</span>SOC__)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">abs</span>(FOWARD<span class="sc">$</span>SOC__<span class="sc">+</span>FOWARD<span class="sc">$</span>Md_Sc)</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>UNC_abs_rate_Md_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD,Country_raster,UNC_abs_rate_Md, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(UNC_abs_rate_Md_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_ASR_SSM2_UncertaintyMap030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>UNC_abs_rate_Hg<span class="ot">&lt;-</span><span class="fu">sqrt</span>((FOWARD<span class="sc">$</span>UNC_S<span class="sc">*</span>FOWARD<span class="sc">$</span>Hgh_S)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (FOWARD<span class="sc">$</span>UNC_2<span class="sc">*</span>FOWARD<span class="sc">$</span>SOC__)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">abs</span>(FOWARD<span class="sc">$</span>SOC__<span class="sc">+</span>FOWARD<span class="sc">$</span>Hgh_S)</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>UNC_abs_rate_Hg_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD,Country_raster,UNC_abs_rate_Hg, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(UNC_abs_rate_Hg_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_ASR_SSM3_UncertaintyMap030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>Now we will calculate the uncertainties for the relative rates.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncertainties for the Relative difference  SSM_ - SOCBAU</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>UNC_Rel_rate_Lw<span class="ot">&lt;-</span><span class="fu">sqrt</span>((FOWARD<span class="sc">$</span>UNC_S<span class="sc">*</span>FOWARD<span class="sc">$</span>Lw_Sc)<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span> (FOWARD<span class="sc">$</span>UNC_B<span class="sc">*</span>FOWARD<span class="sc">$</span>SOC_BAU_20)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">abs</span>(FOWARD<span class="sc">$</span>SOC_BAU_20<span class="sc">+</span>FOWARD<span class="sc">$</span>Lw_Sc)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>UNC_Rel_rate_Lw_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD,Country_raster,UNC_Rel_rate_Lw, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(UNC_Rel_rate_Lw_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_RSR_SSM1_UncertaintyMap030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>UNC_Rel_rate_Md<span class="ot">&lt;-</span><span class="fu">sqrt</span>((FOWARD<span class="sc">$</span>UNC_S<span class="sc">*</span>FOWARD<span class="sc">$</span>Md_Sc)<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span> (FOWARD<span class="sc">$</span>UNC_B<span class="sc">*</span>FOWARD<span class="sc">$</span>SOC_BAU_20)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">abs</span>(FOWARD<span class="sc">$</span>SOC_BAU_20<span class="sc">+</span>FOWARD<span class="sc">$</span>Md_Sc)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>UNC_Rel_rate_Md_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD,Country_raster,UNC_Rel_rate_Md, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(UNC_Rel_rate_Md_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_RSR_SSM2_UncertaintyMap030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>UNC_Rel_rate_Hg<span class="ot">&lt;-</span><span class="fu">sqrt</span>((FOWARD<span class="sc">$</span>UNC_S<span class="sc">*</span>FOWARD<span class="sc">$</span>Hgh_S)<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span> (FOWARD<span class="sc">$</span>UNC_B<span class="sc">*</span>FOWARD<span class="sc">$</span>SOC_BAU_20)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">abs</span>(FOWARD<span class="sc">$</span>SOC_BAU_20<span class="sc">+</span>FOWARD<span class="sc">$</span>Hgh_S)</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>UNC_Rel_rate_Hg_Map<span class="ot">&lt;-</span><span class="fu">rasterize</span>(FOWARD,Country_raster,UNC_Rel_rate_Hg, <span class="at">updateValue=</span><span class="st">&#39;all&#39;</span>)</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(UNC_Rel_rate_Hg_Map,<span class="at">filename=</span><span class="fu">paste0</span>(name,<span class="st">&quot;_GSOCseq_RSR_SSM3_UncertaintyMap030&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<!--chapter:end:11.Stage3_map_generation.rmd-->
</div>
</div>
<div id="uncertainty-and-validation" class="section level1" number="12">
<h1 number="12"><span class="header-section-number">12</span> | Uncertainty and validation</h1>
<p>Ideally, model prediction uncertainty provided in the GSOCseq map should include all sources of uncertainty that affect predictions, including model structural uncertainty, model parameters’ and input data uncertainties. As a minimum, uncertainty should include input data uncertainties (e.g. Morais et al., 2019).
There are different methods to estimate uncertainties in the results. Monte Carlo methods, that draw random values from the probability distribution functions for inputs and parameters, are an efficient way to estimate the whole uncertainty of the modeled estimation (Ogle et al., 2010; FAO, 2019b; Morais et al., 2019). In Monte Carlo simulation methods, parameter values of the model and input data (e.g. mean temperature, clay content, carbon inputs) shall be randomly chosen from hypothetical normal distributions with mean equal to the parameter value and the measured standard error around that mean. Once all the different parameter values for the model are generated from the hypothetical distributions, a model run shall be made. This process is to be repeated 100 or more times to produce a mean model prediction with a 95 percent confidence interval. The Monte Carlo simulation would generate an expected value of SOC stocks for the different scenarios and a 95 percent confidence interval.
Uncertainty (U) shall be expressed as a percentage: half of the 95% confidence interval divided by the mean (Ogle et al., 2010). Thus, uncertainty can be estimated for each simulated scenario as:</p>
<p><span class="math display">\[\begin{equation}
\tag{12.1}
U \% = \frac{100 \times (ULCI-LLC)}{2 \times SOC_{av}}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(UL\)</span> corresponds to the upper limit of the 95% confidence interval of the estimated SOC at the end of the simulation (in t C ha<sup>-1</sup>), LL corresponds to the lower limit of the 95% confidence interval of the estimated SOC at the end of the simulation (in t C ha<sup>-1</sup>); and <span class="math inline">\(SOC_{av}\)</span> the average of the estimated SOC at the end of the simulation (t C ha<sup>-1</sup>), after 20 years of the forward modelling, for each scenario.
To estimate uncertainties of the sequestration rates (uncertain quantities are combined by subtraction, e.g. <span class="math inline">\(\Delta\)</span> SOC = Stocks SSM - SOC stocks BAU), the uncertainty can be expressed in percentage terms was estimated by the following equation (IPCC, 2019):</p>
<p><span class="math display">\[\begin{equation}
\tag{12.2}
Ut = \sqrt((U1X1)^2 + ... + (UnXn)^2) \\
|X1+ ... +Xn|
\end{equation}\]</span></p>
<p>where <span class="math inline">\(Ut\)</span> is the percentage uncertainty in the subtraction of the quantities (half the 95 percent confidence interval divided by the total, i.e. mean, and expressed as a percentage), <span class="math inline">\(x1\)</span> - <span class="math inline">\(n\)</span> represent the quantities to be combined (e.g. Stocks SSM and SOC stocks BAU at the end of the forward simulation), and <span class="math inline">\(U1\)</span> to <span class="math inline">\(n\)</span> is the percentage uncertainties associated with each of the quantities (as estimated from equation 12.1).
However, Monte Carlo and related simulations (e.g. Markov Chain-Monte Carlo method, as in Hararuk et al., 2014; GLUE method, as in Salazar et al., 2011) usually require considerable computational capacity and may be time demanding, especially for long spin-up runs (&gt;500 years), as multiple (&gt;100) runs should be made for each modeling unit.
An alternative is to calculate uncertainties of the input data considering minimum and maximum values (corresponding to the limits of a 95% confidence interval) of a set of predefined input parameters, considered to have the greatest influence in RothC modeling results (initial SOC, Carbon inputs, and soil and climatic variables). Thus, uncertainties can be estimated for each modeling unit and for each scenario by estimating first the minimum and maximum SOC simulated values (similarly to VCS, 2012) using a predefined arrangement of inputs:
<span class="math display">\[\begin{equation}
\tag{12.3}
SOC max = Model(SOC_{FAO \ max}, Ci_{max}, Temp_{min}, Pp_{max}, Clay_{max})       
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\tag{12.4}
  SOC min = Model(SOC_{FAO \ min}, Ci_{min}, Temp_{max}, Pp_{min}, Clay_{min})          
\end{equation}\]</span></p>
<p>where <span class="math inline">\(SOC_{FAO \ min}\)</span> and <span class="math inline">\(SOC_{FAO \ max}\)</span> are respectively the minimum and maximum value for the simulated SOC stocks; <span class="math inline">\(SOC_{FAO \ min}\)</span> and <span class="math inline">\(SOC_{FAO \ max}\)</span> are the minimum and maximum value for the initial SOC GSCOCmap stocks estimated at the 95% confidence interval are the <span class="math inline">\(Ci_{min}\)</span> and <span class="math inline">\(Ci_{max}\)</span> are respectively the minimum and the maximum value for the annual carbon inputs estimated at the 95% confidence interval; <span class="math inline">\(Temp_{min}\)</span> and <span class="math inline">\(Temp_{max}\)</span> are respectively the minimum and maximum value for the average monthly air temperature estimated at the 95% confidence interval; <span class="math inline">\(Pp_{min}\)</span> and <span class="math inline">\(Pp_{max}\)</span> are respectively the minimum and maximum value for the average monthly precipitation estimated at the 95% confidence interval; and Clay min and Clay max are respectively the minimum and maximum value for the soil clay content (0-30 cm) estimated at the 95% confidence interval. The arrangement of variables to generate minimum and maximum SOC stocks are to be generated considering the effects of each variable on NPP, decomposition rates, and overall carbon dynamics (Chapters 4 and 5).
If information is available, the minimum and maximum value of each parameter (C input, Temp, Pp and Clay) that define de 95% confidence interval can be estimated from its variation and mean value, assuming that values of the parameter are normally distributed about the mean:</p>
<p><span class="math display">\[\begin{equation}
\tag{12.5}
P_{min} = Xp - 1.96 \times SEp 
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\tag{12.6}
P_{max} = Xp - 1.96 \times SEp 
\end{equation}\]</span></p>
<p>where <span class="math inline">\(P_{min}\)</span> and <span class="math inline">\(P_{max}\)</span> are respectively the minimum and maximum value for parameter P (C input, Temp, Pp or Clay) estimated at the 95% confidence interval; <span class="math inline">\(Xp\)</span> is the average value of that parameter; and <span class="math inline">\(SEp\)</span> is the standard error of the mean of that parameter.
Uncertainties already generated in the latest GSOCmap can be used to obtain the min and max SOC FAO values. Uncertainties in C inputs and thus Ci max and min can be estimated from available data (e.g. meta-analysis). Temp max and Temp and PP max and PPmin can be estimated from the average monthly values and confidence intervals of the climatic series to be modeled. Uncertainties in clay contents can be directly obtained from SOIL GRIDS (<a href="https://soilgrids.org/" class="uri">https://soilgrids.org/</a>) if the ISRIC database is to be used for the clay content layers. If no estimate of clay variation is available for the used database, Clay max and clay min can be determined from clay content variation within the 1km x 1km grid cells (i.e. considering the values from 250 m x 250m resolution grids).
If no estimate of the SE or CI is available for these parameters, a maximum and minimum value can be estimated for these parameters, using general uncertainty coefficients, as those reported from global modelling exercises by Gottschalk et al. (2007) and Hastings et al. (2010). Average uncertainties for these parameters are summarized in Table 12.1.
Input data layers (SOC FAO, temperature, precipitation, clay content, and C inputs) need to be re-prepared for the different modelling phases considering the maximum and minimum values for each data input outlined in equations 12.3 and 12.4.
General uncertainties in SOC sequestration can be then estimated for all scenarios. The model is to be run 2 two more times for each modelling unit and scenario in the different modelling phases: once using the selection of values to obtain a maximum expected SOC (eq 12.2), and once using the selection of input values to obtain a minimum expected SOC change (eq 12.3). SOC stocks are then modelled for each modelling unit. Uncertainties can be then expressed in % as in equation 12.1 for each scenario (considering the average SOC values as the ones obtained in the first modelling run for each scenario):</p>
<p><span class="math display">\[\begin{equation}
\tag{12.7}
U \%=\frac{100 \times (SOC_{max} - SOC_{min})}{2 \times SOC}    
\end{equation}\]</span></p>
<p>where <span class="math inline">\(SOC_{max}\)</span> corresponds to the upper limit of simulated the SOC stocks (in tC ha<sup>-1</sup>) at the end of the forward modelling phase using the combination of inputs in equation 12.3, <span class="math inline">\(SOC_{min}\)</span> corresponds to the lower limit of the simulated SOC stocks ( in tC ha<sup>-1</sup>) at the end of the forward modelling phase using the combination of inputs in equation 12.4; and SOC the average simulated SOC stocks (tC ha<sup>-1</sup>), for each scenario, after 20 years of the forward modeling phase. Uncertainties for the absolute and relative sequestration rates can be then estimated using equation 12.2, for each scenario.</p>
<p><strong>Table 12.1</strong> <em>General uncertainties of main parameters affecting SOC dynamics. Derived from Gottschalk et al. (2007) and Hastings et al. (2010).</em></p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:left;">
Uncertainty in the input
</th>
<th style="text-align:left;">
Minimum value
</th>
<th style="text-align:left;">
Maximum value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Temperature
</td>
<td style="text-align:left;">
± 2 %
</td>
<td style="text-align:left;">
Monthly Temp * 0.98
</td>
<td style="text-align:left;">
Monthly Temp * 1.02
</td>
</tr>
<tr>
<td style="text-align:left;">
Precipitation
</td>
<td style="text-align:left;">
± 5 %
</td>
<td style="text-align:left;">
Monthly PP * 0.95
</td>
<td style="text-align:left;">
Monthly PP * 1.05
</td>
</tr>
<tr>
<td style="text-align:left;">
Clay content
</td>
<td style="text-align:left;">
± 10 %
</td>
<td style="text-align:left;">
Clay * 0.90
</td>
<td style="text-align:left;">
Clay * 1.10
</td>
</tr>
<tr>
<td style="text-align:left;">
FAO SOC
</td>
<td style="text-align:left;">
± 20 %
</td>
<td style="text-align:left;">
SOC FAO *0.8
</td>
<td style="text-align:left;">
SOC FAO * 1.2
</td>
</tr>
<tr>
<td style="text-align:left;">
C input increase in SSM scenario
</td>
<td style="text-align:left;">
± 15 %
</td>
<td style="text-align:left;">
C eq * (SSM1 % increase - 15%)
</td>
<td style="text-align:left;">
C eq * (SSM % increase + 15%)
</td>
</tr>
</tbody>
</table>
<p>The model should be validated for the conditions in which it will be applied when possible. The use of models for prediction involves a series of problems for validation, as data required to quantify the accuracy of the estimates do not yet exist. Nonetheless, predictive models can be validated if they explain past events (ex-post validation). If local results from different SSM practices on SOC stocks are available (a meta-analysis of local SSM practices can be conducted), and the collected activity data allow to perform simulations with these records, model-produced estimates shall be compared with the observed results. The RMSE shall be used to compare the divergence between model estimates and field observations. The RMSE can be expressed as:</p>
<p><span class="math display">\[\begin{equation}
\tag{12.8}
RMSE = \frac{\sqrt(\sum_{i=1}^n (0_i - P_i)^2)}{n}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(Pi\)</span> is the predicted (modelled) value, <span class="math inline">\(Oi\)</span> is the observed value, <span class="math inline">\(n\)</span> is the number of measured
Relative <span class="math inline">\(RMSE\)</span> can be expressed as a % of the observed mean. These results should be specified in the report accompanying the mapping product.</p>
<!--chapter:end:12.Uncertainty_and_validation.rmd-->
</div>
<div id="data-sharing" class="section level1" number="13">
<h1 number="13"><span class="header-section-number">13</span> | Data sharing</h1>
<div id="general-principles" class="section level2" number="13.1">
<h2 number="13.1"><span class="header-section-number">13.1</span> General principles</h2>
<p>Sharing of the national GSOCseq products will follow the same approach as other GSP global mapping products such as the Global Soil Organic Carbon Map (GSOCmap - 2017) and Global Map of Salt-Affected Soils (GSSmap - 2020). The GSP Secretariat will provide an online data submission facility.
Data sharing is governed by the GSP Data Policy (<a href="http://www.fao.org/3/a-bs975e.pdf" class="uri">http://www.fao.org/3/a-bs975e.pdf</a>). When delivering national data to the GSP, countries need to ensure that:</p>
<ol style="list-style-type: decimal">
<li>The data shared contain the relevant soil information representative for the country.</li>
<li>The shared datasets contain the best available information for a given area and topic, however, subject to potential restrictions based on the institutions’ or countries’ data policy.</li>
<li>The data shared are reliable and quality controlled which means that the data have passed a technical routine to ensure data integrity, correctness, and completeness; errors and omissions are identified and, if possible, addressed.</li>
</ol>
<p>Data providers will retain the ownership of national datasets. The final global dataset will be distributed under Creative Commons license.</p>
</div>
<div id="data-formats-and-integrity" class="section level2" number="13.2">
<h2 number="13.2"><span class="header-section-number">13.2</span> Data formats and integrity</h2>
<p>All GIS files should be delivered in correct format according to the Technical Specifications and Country Guidelines for the GSOCseq map.
GIS files shall be delivered in GeoTIFF format with embedded additional georeferencing information, including spatial extent, coordinate reference system, resolution, no data values. Pixel values should contain numeric values of the target parameter, estimated for the topsoil layer (0-30cm depth).
World Geodetic System 1984 (WGS84) geographic (latitude/longitude) projection should be preferred for all submitted maps. The map shall be produced at regular fixed horizontal dimensions of 30 by 30 arc-seconds grid (approximately only 1x1km) at the equator. Countries will be expected to deliver their datasets using the standard 30 arc-second grids prepared and shared by the GSP.
Each data layer should be provided as a single continuous surface. Data providers should not attempt to mask out the excluded areas from the grid (e.g. saline soils, organic soils, wetlands). The GSP Secretariat will mask excluded areas using standard spatialized layers. Values in the excluded grid cells will be identified as no data (NA) in the final global product.</p>
</div>
<div id="data-correctness" class="section level2" number="13.3">
<h2 number="13.3"><span class="header-section-number">13.3</span> Data correctness</h2>
<p>Each country will be responsible for carrying out basic Quality Assurance/Quality Control (QA/QC) of all data before providing it to the GSP Secretariat. Quality Assurance can be described as the process of preventing errors from entering the datasets, while Quality Control can be described as the process of identifying and correcting existing errors in the datasets.
All datasets should be checked for:</p>
<ul>
<li>Erroneous or unrealistic predictions</li>
<li>Spatial errors (extent, projection)</li>
<li>Units (t C ha<sup>-1</sup> yr<sup>-1</sup>)</li>
<li>Completeness and integrity of data</li>
<li>Consistency with data shown in any accompanying documents (such as reports or drawings)</li>
<li>Validation (if possible) and consistency of reported validation results with the provided data.</li>
</ul>
<p>Final QA/QC for the global datasets will be facilitated by the GSP Secretariat through its technical networks (INSII, P4WG, and Intergovernmental Technical Panel on Soils (ITPS) will give final clearance to the global dataset prior to public release).</p>
</div>
<div id="data-completeness" class="section level2" number="13.4">
<h2 number="13.4"><span class="header-section-number">13.4</span> Data completeness</h2>
<p>A complete set of mandatory data layers should be provided. This complete set of SOC sequestration maps includes country-level predicted topsoil (0-30 cm) SOC stocks and mean annual sequestration rates after the implementation of SSM practices, for a 20-year period, estimated with the spatialized version of the RothC carbon model. Each pixel shall contain:</p>
<ol style="list-style-type: decimal">
<li>Absolute average (vs. initial SOC stock) sequestration rates for 20 years (t C ha<sup>-1</sup> yr<sup>-1</sup> ), for BAU, SSM1, SSM2 and SSM3 scenarios</li>
<li>Mean relative (vs. business as usual) sequestration rates for 20 years (t C ha<sup>-1</sup> yr<sup>-1</sup> ), for SSM1, SSM2 and SSM3 scenarios</li>
<li>Initial SOC stocks (t C ha-1)</li>
<li>SOC sequestration uncertainty maps (absolute and relative sequestration rates) for 3 SSM Scenarios (in %)</li>
</ol>
<p>The set of data layers should be supplemented by a country report (electronic document) according to the submission form provided by GSP-FAO.</p>
<p>Country members are also encouraged to deliver the following products and supplementary data (optional):</p>
<ul>
<li>final SOC stocks at 2040 (t C ha<sup>-1</sup>), for BAU, SSM1, SSM2 and SSM3 scenarios;</li>
<li>SOC sequestration maps using alternative modeling procedures: Includes country-level topsoil (0-30 cm) predicted SOC stocks and mean annual sequestration rates after implementation of SSM practices, for a 20-year period (2020-2040), estimated using;</li>
<li>alternative SSM scenarios (e.g. alternative C % increase based on local data analysis);</li>
<li>alternative local preferred, process-oriented and peer-reviewed models (e.g. CENTURY/DAYCENT, DNDC, YASSO, ICBM, or their derived models);</li>
<li>meta-analysis on the local impact of SSM management practices on SOC sequestration;</li>
<li>validation dataset (results from predicted vs. observed SOC stocks/SOC sequestration rates from meta-analysis and RMSE; validation dataset in table format; shapefile/points if georeferenced data is available).</li>
</ul>
</div>
<div id="other-modes-of-data-sharing" class="section level2" number="13.5">
<h2 number="13.5"><span class="header-section-number">13.5</span> Other modes of data sharing</h2>
<p>Apart from sharing national data with the GSP for the development of the Global Soil Organic Carbon Sequestration Potential Map, countries are encouraged to share and use their maps in a number of ways, including:</p>
<ul>
<li>scientific publications;</li>
<li>inclusion in national soil information systems;</li>
<li>using the maps for the development of national policy regarding; sustainable and country-smart agriculture;</li>
<li>using the maps for identifying key areas for governmental, non-governmental, commercial, national or international projects, related to promoting sustainable soil management and carbon sequestration;</li>
<li>using the maps for awareness raising on the topics of climate change and soil health;</li>
<li>using the maps for educational purposes at schools and universities for subjects related to geography, climate, soils, agriculture, etc.</li>
</ul>
<p>GSP encourages data providers to apply open licensing and free data sharing of their products to ensure broad distribution of knowledge and high impact towards sustainable management of our soils.</p>
<!--chapter:end:13.Data_sharing.rmd-->
</div>
</div>
<div id="limitations-knowledge-gaps-and-way-forward" class="section level1" number="14">
<h1 number="14"><span class="header-section-number">14</span> | Limitations, knowledge gaps and way forward</h1>
<p>It is of most importance to identify which regions, environments and production systems present greater potential to increase SOC stocks and mitigate GHG emissions and establish priorities for research and implementation of public policies. In this document, we provided an approach and the procedures to produce digital SOC sequestration maps using soil legacy data, process oriented SOC models and modern techniques of digital soil mapping, that would allow covering as many conditions and productive systems worldwide as possible, in a relatively simple, transparent and standardized way, without complex configuration and computational capacities. Nonetheless, the estimation of SOC sequestration potential in a harmonized way among countries, regions, and productive systems is not an easy task and there are different contentious issues and limitations that must be outlined.</p>
<p>Firstly, agricultural lands (croplands and grazing lands) are selected as target areas to estimate SOC sequestration potential in this first instance, since they are managed at least on a yearly basis, and management practices could be used to increase soil organic carbon content. These lands have been identified as the options with greater potential to accumulate SOC and mitigate GHG emissions through improved management practices (Smith et al., 2008; Lal et al., 2018). Furthermore, most of the information regarding the SOC dynamics has been developed in these productive systems, and most SOC carbon models have been successfully tested under these conditions. Countries can nevertheless assess SOC sequestration potential of different land uses and deliver additional maps including other land use (other than agricultural lands). Future versions of the GSOCseq map may include other land uses, depending on national demands.</p>
<p>Secondly, most SOC models are parameterized under land use, land management, soil or climatic regions. Ideally, SOC models should account for all major SOC-controlling factors, such as soil mineralogy, climate conditions, litter quality, biota activity, land use and management. These factors have extremely complex interactions, and separate analysis of controls could limit predictions of their effects on SOC (Falloon and Smith, 2009). Even the full multidimensional development of a single element of a model can rarely, if ever, be predicted precisely, and the actual consequence is that it is impossible to create “universal” models (Sinclair and Seligman, 1996). The review by Campbell and Paustian (2015) emphasizes the fact that among the different known process-oriented models used to estimate SOC changes, no one clearly outperforms the others. However, in order to obtain consistent and harmonized results, and allow comparisons between countries and regions, due to potential differences in computational, technical capacities and data availability, the use of RothC as a standard ‘process-oriented’ SOC model, following the proposed methodology, is requested as a first step. Nevertheless, users are encouraged to provide supplementary alternative maps developed using alternative preferred SOC models and/or methods or approaches to estimate C inputs and compare results with the proposed methodology. The use of a multi-model ensemble approach (e.g. Riggers et al, 2019; Lehtonen et al., 2020) with selected models is intended for future versions of the GSOCseq map. Moreover, the SoilR package (Sierra et al., 2012) used in the current approach already includes other SOC models like CENTURY and ICBM, that can be used to estimate results using a multi-model ensemble approach.</p>
<p>It must be also outlined that at some level of analysis all known process-oriented SOC models including RothC (see Chapter 2; see FAO, 2019), include empirical functions, so they are expected to perform best when operating in situations similar to those for which they were originally parameterized, which tend to be croplands and grasslands from the temperate zone (Jenkinson et al., 1990; Petri et al., 2010). There is relatively less available data of the performance of SOC models under tropical and arid conditions. Current SOC models, including RothC, may be limited in their applicability to these systems, due to differences in soil fauna and their effects on SOC dynamics, the much faster turnover of slow and passive SOM, different temperature and moisture relationships with microbial activity, and differences in mineralogy (Shang and Tiessen, 1998; Tiessen et al., 1998) and solution chemistry (Parton et al., 1989) in tropical soils, or water dynamics under arid environments (Farina et al., 2013). The inability to account for cation availability or aluminium (Al) toxicity may also limit SOC model predictions (Parton et al., 1989; Shang and Tiessen, 1998). Most well-known models may be limited by failing to account for pH effects on soil carbon turnover (Jenkinson, 1988; 1996; Falloon and Smith, 2009). Soil organic carbon models generally predict faster carbon turnover than the ones observed in very acid soils (Motavalli et al., 1995), and few models can predict SOC changes in allophanic soils or soils developed on recent volcanic ash (Jenkinson et al., 1991; Motavalli et al., 1995; Falloon et al., 1998; Falloon and Smith, 2000; Falloon and Smith., 2009).</p>
<p>Additionally, RothC does not accurately simulate SOC dynamics in waterlogged soils such as paddy rice. Countries are encouraged to use local adaptations or modified versions of the RothC model which have shown to improve estimations under the above mentioned conditions (e.g. Parshotam and Hewitt, 1995; Saggar et al., 1996 for volcanic soils; Shirato et al., 2004; Shirato and Yokozawa, 2005 for paddy rice; and ROTHC10 developed by Farina et al., 2013 in arid conditions). Local adaptations should be implemented following the general procedures and input data described in Chapter 5 and 6 to obtain consistent results, and/or to use their preferred model (e.g. Gilhespy et al., 2014) under these conditions, and deliver additional maps to contrast results. Further developments of the GSOCseq will include specific and standardized methods for SOC estimations in paddy rice and other specific conditions.</p>
<p>The proposed approach estimates SOC changes in the first 0-30 cm. Although SOC at deeper soil layers is responsive to land management changes (e.g. Follett et al., 2013; Poeplau and Don, 2013; Schmer et al., 2014), the 0-30 cm is selected because: it is most responsive to land management changes; allows the use of GSOCmap as a baseline for SOC stocks; allows for better harmonization with national greenhouse gas inventories, and allows validation of selected models with available ground data (mostly generated at 0-30cm depth). New models and adaptations of known models have been developed to account for SOC dynamics in deep layers with different approaches (see Campbell and Paustian, 2015). For example, the DAYCENT model was modified to simulate deeper soil C dynamics by slowing SOC pool turnover and increasing allocation to passive soil C, without separating soil layers (Wieder et al., 2014). Jenkinson and Coleman (2008) modified RothC to RothPC-1 to predict the turnover of organic C in subsoils up to 1 m of depth using multiple layers and introduced two additional parameters, one that transports organic C down the soil profile by an advective process, and one that reduces decomposition processes of SOC with depth. However, there is still a strong necessity for additional data to confirm or refute hypotheses suggested by the different modelling approaches of SOC in deep layers (Campbell and Paustian, 2015). As new information is generated, future versions of the GSOC and GSOCseq maps will be able to incorporate SOC stocks and SOC changes at deeper layers.
There is also still need for a better understanding of spatial heterogeneity in SOC in the landscape and for a better prediction of potential changes in SOC dynamics on the landscape scale (Stockmann et al., 2013). Differences in drainage that may be linked to landscape position are often not accounted for in SOC models (Falloon and Smith, 2009). In this sense, three gaps in knowledge have been identified (Stockmann et al., 2013): (1) the development of optimal, but still simple, 3-dimensional representations of landscapes (vertically and horizontally), (2) the implementation of functional interactions and SOC transfers (i.e. the redistribution of SOC to different parts in the landscape due to erosion, transport and deposition) and (3) the availability of adequate datasets for model validations (especially the representation of fluxes between different landscape elements).</p>
<p>It should be also outlined that the temperature is expected to increase in the next 20-50 years, especially after 2050 (IPCC, 2018) and this may impact SOC dynamics. The proposed approach considers a 2000-2020 climate average for SOC projections after 2020. Using a 20-year average removes the year-to-year variation. However, there is no consensus over which climate projections are the most appropriate for 2020-2040, and prior agreement between countries is required. The proposed methodology allows climate change scenarios for longer-term projections to be incorporated in future versions.</p>
<p>It should be also noted that a very wide range of management practices are currently being implemented and can potentially be introduced into the world’s agricultural systems, depending on climatic, soil, socio-cultural and economic conditions. In turn, different SSM C-oriented practices are often combined, making it difficult to dissociate their effects on SOC dynamics. Thus, as a first step, and to harmonize the results on a global map, and because soil carbon turnover models are the most sensitive to carbon inputs (FAO, 2019), this manual proposed to group SSM practices into three scenarios as a standard method, based on their expected relative effects on C inputs compared to business as usual management: Low, Medium and High increase in C inputs (referred as SSM1, SSM2, and SSM3 scenarios). A 5%-10%-20% increase in C input is suggested as default values to test potential. This increase in C-inputs will not always be possible where C-inputs are already high. On the other hand, this increase in C inputs can be low in regions or productive systems with current low C inputs. However, to obtain consistent and harmonized results, and allow comparisons between countries and regions the use of standard SSM scenarios and 5-10-20 % is kindly requested in this first stage. National experts’ opinion and local data are essential in order to accurately estimate or validate the target areas and carbon input levels for the different SSM scenarios in forthcoming versions. Countries are encouraged to provide supplementary alternative maps developed using alternative % increases in C inputs or specific absolute increases in C inputs of specific SSM practices in the different agro-ecological regions and productive systems of the country, based on local knowledge or obtained from a literature search of local studies. We believe the comparison of results will greatly enrich the final product. The information generated by the different countries will allow us to select and model specific practices in forthcoming versions.</p>
<p>Finally, the precision of models relies heavily on the quality and quantity of data used in executing and validating them (FAO, 2019). Often, the datasets for running models are not collected for that specific purpose but are taken from previous or ongoing studies. In many cases the format and amount of data may be inappropriate for the models. There may be several potential pitfalls for the integration of data to calibrate, drive and evaluate a SOC model. Careful harmonization of datasets and input estimation methodologies is essential to obtain consistent results across regions and countries. Ideally, calibration and driving data should match the scale of the model simulation. However, data limitations will prompt the use of data of coarser resolution and/or mixing data of varying quality from different sources. The 1x1 km scale for the GSOCseq is required in the final product to allow comparisons among countries. However, input datasets from different resolutions will be probably used, and this may introduce uncertainties (e.g. climate data that usually occurs at coarser resolutions). In the proposed approach, global sources are proposed (same resolution and quality) but countries are encouraged to develop and deliver SOCseq maps using the best available national climatic, soil, and land use data.</p>
<p>Data availability for model evaluation will also affect the assessment of model accuracy, as well as its ability to support hypothesis testing. Although there is a wealth of measured data from carefully monitored long-term agronomic experiments to evaluate SOC models, especially in the northern hemisphere and temperate climate conditions, there are comparatively few similar datasets from natural ecosystems (Falloon and Smith, 2009). The suite of datasets may then become sources of uncertainty in SOC model predictions (Keenan et al 2011; Palosuo et al 2012). Datasets are also often difficult to identify or compare between SOC models, particularly in large-scale ecosystem or global analyses. Furthermore, soil carbon measurements from available experiments are rarely available in replicate and hence attributing uncertainty to these measurements, and ultimately confidence in SOC model predictions is limited (Falloon and Smith, 2003). Data availability to validate model performance will be a limitation for many countries.</p>
<p>A meta-analysis should be conducted on the basis of the latest available local and regional studies to estimate how agricultural practices affect average annual C inputs, SOC sequestration rates and SOC stocks. However, meta-analyses and comparisons have often suffered from datasets based on diverging definitions (e.g. concerning definitions of sample depth, baselines for comparisons, or the components of soil respiration), (Bahn, 2009). We hope that this exercise, together with other GSP activities, will also be an opportunity for the different countries to establish long-term observatories that will allow us to monitor the effect of different management practices on SOC stocks under different environments, and this will in turn allow us to improve model estimations.
We acknowledge that consistency among input datasets and results would be improved if there was only one actor involved in the entire process. However, it is of most importance that information is locally generated, involving local experts and institutions, building technical capacities in the process, as this will encourage countries to implement national and subnational policies, and to get involved in regional and global policies. Moreover, we believe that a ‘bottom-up’, country-driven approach, using country specific data and expert knowledge, is a fundamental step for iterative improvements. As it is the case of other GSP documents, this manual constitutes a living document, which will be continuously improved and refined after its use and implementation.</p>
<!--chapter:end:14.Limitations_knowledge_gaps_and_way_forward.rmd-->
</div>
<div id="annex-i-troubleshooting" class="section level1 unnumbered">
<h1 class="unnumbered">Annex I Troubleshooting</h1>
<div id="coastal-and-small-countries-not-fully-covered-by-the-cru-layers" class="section level2 unnumbered">
<h2 class="unnumbered">Coastal and small countries not fully covered by the CRU layers</h2>
<p>Due to the coarse resolution of the CRU layers a lot of points close to the country boarders can be lost (Figure 15.1).</p>
<div class="figure">
<img src="images/Figure_9.7.png" alt="" />
<p class="caption">Figure 15.1 Points outside of a given CRU layer for Panama.</p>
</div>
<p>To overcome this, we provided two options:</p>
<ol style="list-style-type: decimal">
<li>Perform the whole procedure with higher resolution climate layers again for every point. We have provided scripts to download and prepare TerraClimate climatic layers.</li>
<li>Prepare the CRU layers with the newly provided scripts that include a line of code that fills NA values with the average of the three nearest pixel values. If you have already completed all steps, you can repeat the procedure solely for points that fall outside the CRU layer.</li>
</ol>
<p>In the following a small guide for option 2 on how to select and run the model for points that fall outside the CRU layers is provided:</p>
<div id="step-1-create-a-single-cru-layer-cropped-and-masked-to-the-extent-of-your-aoi-using-the-following-r-script" class="section level3 unnumbered">
<h3 class="unnumbered">Step 1 Create a single CRU layer cropped and masked to the extent of your AOI using the following R script</h3>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#+++++++++++++++++++++++++++++++++++++++++</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  DATE:  02/03/2021                     #</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        #</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  Isabel Luotto                         #</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        #</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This script can be used to clip        #</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co"># one of the CRU layers                  #</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="co"># to the shape of the AOI                #</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        #</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="co">#+++++++++++++++++++++++++++++++++++++++++</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Empty environment</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Load libraries</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Define paths to the single folder locations</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>WD_CRU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Load any of the CRU tif layers created with script N. 1</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CRU)</span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>CRU <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;PET_Stack_01-18_CRU.tif&quot;</span>)</span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Load your AOI shapefile</span></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>AOI <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="st">&quot;PAN_adm0.shp&quot;</span>)</span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Crop and mask CRU layer</span></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>CRU<span class="ot">&lt;-</span><span class="fu">crop</span>(CRU,AOI)</span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>CRU<span class="ot">&lt;-</span><span class="fu">mask</span>(CRU,AOI)</span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a><span class="co">#Save cropped masked raster layer</span></span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CRU)</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(CRU, <span class="st">&quot;CRU_AOI_QGIS.tif&quot;</span> )</span></code></pre></div>
</div>
<div id="step-2-open-qgis-and-generate-the-empty-points" class="section level3 unnumbered">
<h3 class="unnumbered">Step 2 Open QGIS and generate the empty points</h3>
<ul>
<li>Repeat section 9.5.1 QGIS Procedure number 1 (model) in the technical manual to generate the empty points</li>
<li>Load the cropped CRU layer created previously</li>
</ul>
</div>
<div id="step-3-polygonize-the-raster" class="section level3 unnumbered">
<h3 class="unnumbered">Step 3 Polygonize the raster</h3>
<ul>
<li>Go to.. Raster/Conversion/Polygonize (Raster to Vector)</li>
<li>Select CRU layer as input and click on Run (Figure 15.2)</li>
</ul>
<div class="figure">
<img src="images/Figure_11.png" alt="" />
<p class="caption">Figure 15.2 Raster to Vector</p>
</div>
</div>
<div id="step-4-select-points-outside-of-the-polygon" class="section level3 unnumbered">
<h3 class="unnumbered">Step 4 Select points outside of the polygon</h3>
<ul>
<li>Type: “select by location” in the processing toolbox search bar and open the Select by Location tool</li>
<li>Select the Points as input and click on the disjoint check box and click on Run (Figure 15.3)</li>
</ul>
<div class="figure">
<img src="images/Figure_12.png" alt="" />
<p class="caption">Figure 15.3 Select points outside a polygon</p>
</div>
</div>
<div id="step-5-export-the-extracted-points" class="section level3 unnumbered">
<h3 class="unnumbered">Step 5 Export the extracted points</h3>
<ul>
<li>Right click on the newly created layer. Got to Export/Save Features As “AOI_Empty_points_borders” (Figure 15.3)</li>
</ul>
<div class="figure">
<img src="images/Figure_13.png" alt="" />
<p class="caption">Figure 15.3 Export the extracted points</p>
</div>
</div>
<div id="step-6-run-the-spin-up-phase-for-points-outside-the-cru-layer-script-13b" class="section level3 unnumbered">
<h3 class="unnumbered">Step 6 Run the Spin up phase for points outside the CRU layer (Script 13B)</h3>
<p>Scripts 13B, 14B and 15B are modified versions of script 13 (Spin up phase), 14 (Warm up phase) and 15 (Forward phase) which include lines of code that fill NA pixel values from the CRU layers with the average of all surrounding pixel values. The same raster stacks created for the original map can be used as input to run the model over the points that fall outside the CRU layers.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#12/11/2020</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SPATIAL SOIL R  for VECTORS</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="do">###### SPIN UP ################</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MSc Ing Agr Luciano E Di Paolo</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co"># SOilR from Sierra, C.A., M. Mueller, S.E. Trumbore (2012). </span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Models of soil organic matter decomposition: the SoilR package, version 1.0 Geoscientific Model Development, 5(4), </span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="co">#1045--1060. URL http://www.geosci-model-dev.net/5/1045/2012/gmd-5-1045-2012.html.</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SoilR)</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilassessment)</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory </span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>WD_FOLDER<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020&quot;</span>)</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector must be an empty points vector. </span></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_FOLDER)</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>Vector<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;INPUTS/TARGET_POINTS/AOI_Empty_points_borders.shp&quot;</span>)</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack_Set_1 is a stack that contains the spatial variables </span></span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>Stack_Set_1<span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;INPUTS/STACK/Stack_Set_SPIN_UP_AOI.tif&quot;</span>)</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Add pixels to the borders to avoid removing coastal areas</span></span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(Stack_Set_1)){</span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>  Stack_Set_1[[i]]<span class="ot">&lt;-</span><span class="fu">focal</span>(Stack_Set_1[[i]], <span class="at">w =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="dv">25</span>,<span class="dv">25</span>), <span class="at">fun=</span> mean,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">NAonly=</span><span class="cn">TRUE</span> , <span class="at">pad=</span><span class="cn">TRUE</span>)</span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Create A vector to save the results</span></span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ<span class="ot">&lt;-</span>Vector</span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a><span class="co"># use this only for backup</span></span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-48"><a href="#cb106-48" aria-hidden="true" tabindex="-1"></a><span class="co"># C_INPUT_EQ&lt;-readOGR(&quot;OUTPUTS/1_SPIN_UP/SPIN_UP_BSAS_27-03-2020_332376.shp&quot;)</span></span>
<span id="cb106-49"><a href="#cb106-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-50"><a href="#cb106-50" aria-hidden="true" tabindex="-1"></a><span class="co"># extract variables to points</span></span>
<span id="cb106-51"><a href="#cb106-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-52"><a href="#cb106-52" aria-hidden="true" tabindex="-1"></a>Vector_variables<span class="ot">&lt;-</span><span class="fu">extract</span>(Stack_Set_1,Vector,<span class="at">df=</span><span class="cn">TRUE</span>)</span>
<span id="cb106-53"><a href="#cb106-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-54"><a href="#cb106-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the layers from the Vector</span></span>
<span id="cb106-55"><a href="#cb106-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-56"><a href="#cb106-56" aria-hidden="true" tabindex="-1"></a>SOC_im<span class="ot">&lt;-</span>Vector_variables[[<span class="dv">2</span>]] <span class="co"># primera banda del stack</span></span>
<span id="cb106-57"><a href="#cb106-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-58"><a href="#cb106-58" aria-hidden="true" tabindex="-1"></a>clay_im<span class="ot">&lt;-</span>Vector_variables[[<span class="dv">3</span>]] <span class="co"># segunda banda del stack </span></span>
<span id="cb106-59"><a href="#cb106-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-60"><a href="#cb106-60" aria-hidden="true" tabindex="-1"></a>DR_im<span class="ot">&lt;-</span>Vector_variables[[<span class="dv">40</span>]]</span>
<span id="cb106-61"><a href="#cb106-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-62"><a href="#cb106-62" aria-hidden="true" tabindex="-1"></a>LU_im<span class="ot">&lt;-</span>Vector_variables[[<span class="dv">41</span>]]</span>
<span id="cb106-63"><a href="#cb106-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-64"><a href="#cb106-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Years for Cinputs calculations</span></span>
<span id="cb106-65"><a href="#cb106-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-66"><a href="#cb106-66" aria-hidden="true" tabindex="-1"></a>years<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>,<span class="dv">500</span>,<span class="at">by=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb106-67"><a href="#cb106-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-68"><a href="#cb106-68" aria-hidden="true" tabindex="-1"></a><span class="co"># ROTH C MODEL FUNCTION . </span></span>
<span id="cb106-69"><a href="#cb106-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-70"><a href="#cb106-70" aria-hidden="true" tabindex="-1"></a><span class="do">########## function set up starts###############</span></span>
<span id="cb106-71"><a href="#cb106-71" aria-hidden="true" tabindex="-1"></a>Roth_C<span class="ot">&lt;-</span><span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1,LU)</span>
<span id="cb106-72"><a href="#cb106-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-73"><a href="#cb106-73" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb106-74"><a href="#cb106-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-75"><a href="#cb106-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Paddy fields coefficent fPR = 0.4 if the target point is class = 13 , else fPR=1</span></span>
<span id="cb106-76"><a href="#cb106-76" aria-hidden="true" tabindex="-1"></a><span class="co"># From Shirato and Yukozawa 2004</span></span>
<span id="cb106-77"><a href="#cb106-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-78"><a href="#cb106-78" aria-hidden="true" tabindex="-1"></a>fPR<span class="ot">=</span>(LU <span class="sc">==</span> <span class="dv">13</span>)<span class="sc">*</span><span class="fl">0.4</span> <span class="sc">+</span> (LU<span class="sc">!=</span><span class="dv">13</span>)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb106-79"><a href="#cb106-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-80"><a href="#cb106-80" aria-hidden="true" tabindex="-1"></a><span class="co">#Temperature effects per month</span></span>
<span id="cb106-81"><a href="#cb106-81" aria-hidden="true" tabindex="-1"></a>fT<span class="ot">=</span><span class="fu">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span>
<span id="cb106-82"><a href="#cb106-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-83"><a href="#cb106-83" aria-hidden="true" tabindex="-1"></a><span class="co">#Moisture effects per month . </span></span>
<span id="cb106-84"><a href="#cb106-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-85"><a href="#cb106-85" aria-hidden="true" tabindex="-1"></a>fw1func<span class="ot">&lt;-</span><span class="cf">function</span>(P, E, <span class="at">S.Thick =</span> <span class="dv">30</span>, <span class="at">pClay =</span> <span class="fl">32.0213</span>, <span class="at">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb106-86"><a href="#cb106-86" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb106-87"><a href="#cb106-87" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb106-88"><a href="#cb106-88" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> P <span class="sc">-</span> E <span class="sc">*</span> pE</span>
<span id="cb106-89"><a href="#cb106-89" aria-hidden="true" tabindex="-1"></a>    Acc.TSMD <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb106-90"><a href="#cb106-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb106-91"><a href="#cb106-91" aria-hidden="true" tabindex="-1"></a>    B <span class="ot">=</span> <span class="fu">ifelse</span>(bare[i] <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb106-92"><a href="#cb106-92" aria-hidden="true" tabindex="-1"></a>     Max.TSMD <span class="ot">=</span> <span class="sc">-</span>(<span class="dv">20</span> <span class="sc">+</span> <span class="fl">1.3</span> <span class="sc">*</span> pClay <span class="sc">-</span> <span class="fl">0.01</span> <span class="sc">*</span> (pClay<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (S.Thick<span class="sc">/</span><span class="dv">23</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>B)</span>
<span id="cb106-93"><a href="#cb106-93" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">ifelse</span>(M[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb106-94"><a href="#cb106-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i] <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb106-95"><a href="#cb106-95" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i]</span>
<span id="cb106-96"><a href="#cb106-96" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb106-97"><a href="#cb106-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> (Acc.TSMD[i] <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb106-98"><a href="#cb106-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="sc">&lt;=</span> Max.TSMD) {</span>
<span id="cb106-99"><a href="#cb106-99" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Max.TSMD</span>
<span id="cb106-100"><a href="#cb106-100" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb106-101"><a href="#cb106-101" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb106-102"><a href="#cb106-102" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">ifelse</span>(Acc.TSMD <span class="sc">&gt;</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> ((Max.TSMD <span class="sc">-</span> </span>
<span id="cb106-103"><a href="#cb106-103" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD)<span class="sc">/</span>(Max.TSMD <span class="sc">-</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD))))</span>
<span id="cb106-104"><a href="#cb106-104" aria-hidden="true" tabindex="-1"></a>    b<span class="ot">&lt;-</span><span class="fu">clamp</span>(b,<span class="at">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb106-105"><a href="#cb106-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(b))   </span>
<span id="cb106-106"><a href="#cb106-106" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-107"><a href="#cb106-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-108"><a href="#cb106-108" aria-hidden="true" tabindex="-1"></a>fW_2<span class="ot">&lt;-</span> <span class="fu">fw1func</span>(<span class="at">P=</span>(Precip[,<span class="dv">2</span>]), <span class="at">E=</span>(Evp[,<span class="dv">2</span>]), <span class="at">S.Thick =</span> soil.thick, <span class="at">pClay =</span> clay, <span class="at">pE =</span> <span class="dv">1</span>, <span class="at">bare=</span>bare1)<span class="sc">$</span>b </span>
<span id="cb106-109"><a href="#cb106-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-110"><a href="#cb106-110" aria-hidden="true" tabindex="-1"></a><span class="co">#Vegetation Cover effects </span></span>
<span id="cb106-111"><a href="#cb106-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-112"><a href="#cb106-112" aria-hidden="true" tabindex="-1"></a>fC<span class="ot">&lt;-</span>Cov2[,<span class="dv">2</span>]</span>
<span id="cb106-113"><a href="#cb106-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-114"><a href="#cb106-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb106-115"><a href="#cb106-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-116"><a href="#cb106-116" aria-hidden="true" tabindex="-1"></a>xi.frame<span class="ot">=</span><span class="fu">data.frame</span>(years,<span class="fu">rep</span>(fT<span class="sc">*</span>fW_2<span class="sc">*</span>fC<span class="sc">*</span>fPR,<span class="at">length.out=</span><span class="fu">length</span>(years)))</span>
<span id="cb106-117"><a href="#cb106-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-118"><a href="#cb106-118" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from soilassessment</span></span>
<span id="cb106-119"><a href="#cb106-119" aria-hidden="true" tabindex="-1"></a><span class="co">#Roth C soilassesment</span></span>
<span id="cb106-120"><a href="#cb106-120" aria-hidden="true" tabindex="-1"></a>Model3_spin<span class="ot">=</span><span class="fu">carbonTurnover</span>(<span class="at">tt=</span>years,<span class="at">C0=</span><span class="fu">c</span>(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),<span class="at">In=</span>Cinputs,<span class="at">Dr=</span>DR,<span class="at">clay=</span>clay,<span class="at">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb106-121"><a href="#cb106-121" aria-hidden="true" tabindex="-1"></a>Ct3_spin<span class="ot">=</span>Model3_spin[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb106-122"><a href="#cb106-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-123"><a href="#cb106-123" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL FROM SOILR</span></span>
<span id="cb106-124"><a href="#cb106-124" aria-hidden="true" tabindex="-1"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb106-125"><a href="#cb106-125" aria-hidden="true" tabindex="-1"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb106-126"><a href="#cb106-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-127"><a href="#cb106-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb106-128"><a href="#cb106-128" aria-hidden="true" tabindex="-1"></a>poolSize3_spin<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb106-129"><a href="#cb106-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-130"><a href="#cb106-130" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(poolSize3_spin)</span>
<span id="cb106-131"><a href="#cb106-131" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-132"><a href="#cb106-132" aria-hidden="true" tabindex="-1"></a><span class="do">########## function set up ends###############</span></span>
<span id="cb106-133"><a href="#cb106-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-134"><a href="#cb106-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterates over the area of interest</span></span>
<span id="cb106-135"><a href="#cb106-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-136"><a href="#cb106-136" aria-hidden="true" tabindex="-1"></a><span class="do">########for loop starts###############3</span></span>
<span id="cb106-137"><a href="#cb106-137" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Vector_variables)[<span class="dv">1</span>]) {</span>
<span id="cb106-138"><a href="#cb106-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-139"><a href="#cb106-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the variables </span></span>
<span id="cb106-140"><a href="#cb106-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-141"><a href="#cb106-141" aria-hidden="true" tabindex="-1"></a>Vect<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Vector_variables[i,])</span>
<span id="cb106-142"><a href="#cb106-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-143"><a href="#cb106-143" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">4</span><span class="sc">:</span><span class="dv">15</span>]))</span>
<span id="cb106-144"><a href="#cb106-144" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Temp=</span>Temp[,<span class="dv">1</span>])</span>
<span id="cb106-145"><a href="#cb106-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-146"><a href="#cb106-146" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">16</span><span class="sc">:</span><span class="dv">27</span>]))</span>
<span id="cb106-147"><a href="#cb106-147" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Precip=</span>Precip[,<span class="dv">1</span>])</span>
<span id="cb106-148"><a href="#cb106-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-149"><a href="#cb106-149" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">28</span><span class="sc">:</span><span class="dv">39</span>]))</span>
<span id="cb106-150"><a href="#cb106-150" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Evp=</span>Evp[,<span class="dv">1</span>])</span>
<span id="cb106-151"><a href="#cb106-151" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-152"><a href="#cb106-152" aria-hidden="true" tabindex="-1"></a>Cov<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">42</span><span class="sc">:</span><span class="dv">53</span>]))</span>
<span id="cb106-153"><a href="#cb106-153" aria-hidden="true" tabindex="-1"></a>Cov1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb106-154"><a href="#cb106-154" aria-hidden="true" tabindex="-1"></a>Cov2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb106-155"><a href="#cb106-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-156"><a href="#cb106-156" aria-hidden="true" tabindex="-1"></a><span class="co">#Avoid calculus over Na values </span></span>
<span id="cb106-157"><a href="#cb106-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-158"><a href="#cb106-158" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(Evp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Temp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(SOC_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(clay_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Precip[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov2[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov1[,<span class="dv">1</span>]))  <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(DR_im[i])) <span class="sc">|</span>  (SOC_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span> (clay_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) ) {C_INPUT_EQ[i,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">0</span>}<span class="cf">else</span>{</span>
<span id="cb106-159"><a href="#cb106-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-160"><a href="#cb106-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the variables from the images</span></span>
<span id="cb106-161"><a href="#cb106-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-162"><a href="#cb106-162" aria-hidden="true" tabindex="-1"></a>soil.thick<span class="ot">=</span><span class="dv">30</span>  <span class="co">#Soil thickness (organic layer topsoil), in cm</span></span>
<span id="cb106-163"><a href="#cb106-163" aria-hidden="true" tabindex="-1"></a>SOC<span class="ot">&lt;-</span>SOC_im[i]      <span class="co">#Soil organic carbon in Mg/ha </span></span>
<span id="cb106-164"><a href="#cb106-164" aria-hidden="true" tabindex="-1"></a>clay<span class="ot">&lt;-</span>clay_im[i]        <span class="co">#Percent clay %</span></span>
<span id="cb106-165"><a href="#cb106-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-166"><a href="#cb106-166" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>DR_im[i]              <span class="co"># DPM/RPM (decomplosable vs resistant plant material.)</span></span>
<span id="cb106-167"><a href="#cb106-167" aria-hidden="true" tabindex="-1"></a>bare1<span class="ot">&lt;-</span>(Cov1<span class="sc">&gt;</span><span class="fl">0.8</span>)           <span class="co"># If the surface is bare or vegetated</span></span>
<span id="cb106-168"><a href="#cb106-168" aria-hidden="true" tabindex="-1"></a>LU<span class="ot">&lt;-</span>LU_im[i]</span>
<span id="cb106-169"><a href="#cb106-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-170"><a href="#cb106-170" aria-hidden="true" tabindex="-1"></a><span class="co">#IOM using Falloon method</span></span>
<span id="cb106-171"><a href="#cb106-171" aria-hidden="true" tabindex="-1"></a>FallIOM<span class="ot">=</span><span class="fl">0.049</span><span class="sc">*</span>SOC<span class="sc">^</span>(<span class="fl">1.139</span>) </span>
<span id="cb106-172"><a href="#cb106-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-173"><a href="#cb106-173" aria-hidden="true" tabindex="-1"></a><span class="co"># If you use a SOC uncertainty layer turn on this. First open the layer SOC_UNC </span></span>
<span id="cb106-174"><a href="#cb106-174" aria-hidden="true" tabindex="-1"></a><span class="co">#(it must have the same extent and resolution of the SOC layer)</span></span>
<span id="cb106-175"><a href="#cb106-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-176"><a href="#cb106-176" aria-hidden="true" tabindex="-1"></a><span class="co">#SOC_min&lt;-(1-(SOC_UNC/100))*SOC</span></span>
<span id="cb106-177"><a href="#cb106-177" aria-hidden="true" tabindex="-1"></a><span class="co">#SOC_max&lt;-(1+(SOC_UNC/100))*SOC</span></span>
<span id="cb106-178"><a href="#cb106-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-179"><a href="#cb106-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Define SOC min, max Clay min and max. </span></span>
<span id="cb106-180"><a href="#cb106-180" aria-hidden="true" tabindex="-1"></a>SOC_min<span class="ot">&lt;-</span>SOC<span class="sc">*</span><span class="fl">0.8</span></span>
<span id="cb106-181"><a href="#cb106-181" aria-hidden="true" tabindex="-1"></a>SOC_max<span class="ot">&lt;-</span>SOC<span class="sc">*</span><span class="fl">1.2</span></span>
<span id="cb106-182"><a href="#cb106-182" aria-hidden="true" tabindex="-1"></a>clay_min<span class="ot">&lt;-</span>clay<span class="sc">*</span><span class="fl">0.9</span></span>
<span id="cb106-183"><a href="#cb106-183" aria-hidden="true" tabindex="-1"></a>clay_max<span class="ot">&lt;-</span>clay<span class="sc">*</span><span class="fl">1.1</span></span>
<span id="cb106-184"><a href="#cb106-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-185"><a href="#cb106-185" aria-hidden="true" tabindex="-1"></a>b<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb106-186"><a href="#cb106-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-187"><a href="#cb106-187" aria-hidden="true" tabindex="-1"></a><span class="co"># C input equilibrium. (Ceq)</span></span>
<span id="cb106-188"><a href="#cb106-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-189"><a href="#cb106-189" aria-hidden="true" tabindex="-1"></a>fb<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>b,<span class="at">years=</span>years,<span class="at">DPMptf=</span><span class="dv">0</span>, <span class="at">RPMptf=</span><span class="dv">0</span>, <span class="at">BIOptf=</span><span class="dv">0</span>, <span class="at">HUMptf=</span><span class="dv">0</span>, <span class="at">FallIOM=</span>FallIOM,<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb106-190"><a href="#cb106-190" aria-hidden="true" tabindex="-1"></a>fb_t<span class="ot">&lt;-</span>fb[<span class="dv">1</span>]<span class="sc">+</span>fb[<span class="dv">2</span>]<span class="sc">+</span>fb[<span class="dv">3</span>]<span class="sc">+</span>fb[<span class="dv">4</span>]<span class="sc">+</span>fb[<span class="dv">5</span>]</span>
<span id="cb106-191"><a href="#cb106-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-192"><a href="#cb106-192" aria-hidden="true" tabindex="-1"></a>m<span class="ot">&lt;-</span>(fb_t<span class="sc">-</span>FallIOM)<span class="sc">/</span>(b)</span>
<span id="cb106-193"><a href="#cb106-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-194"><a href="#cb106-194" aria-hidden="true" tabindex="-1"></a>Ceq<span class="ot">&lt;-</span>(SOC<span class="sc">-</span>FallIOM)<span class="sc">/</span>m</span>
<span id="cb106-195"><a href="#cb106-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-196"><a href="#cb106-196" aria-hidden="true" tabindex="-1"></a><span class="co"># UNCERTAINTIES C input equilibrium (MINIMUM)</span></span>
<span id="cb106-197"><a href="#cb106-197" aria-hidden="true" tabindex="-1"></a>FallIOM_min<span class="ot">=</span><span class="fl">0.049</span><span class="sc">*</span>SOC_min<span class="sc">^</span>(<span class="fl">1.139</span>) </span>
<span id="cb106-198"><a href="#cb106-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-199"><a href="#cb106-199" aria-hidden="true" tabindex="-1"></a>fb_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>b,<span class="at">years=</span>years,<span class="at">DPMptf=</span><span class="dv">0</span>, <span class="at">RPMptf=</span><span class="dv">0</span>, <span class="at">BIOptf=</span><span class="dv">0</span>, <span class="at">HUMptf=</span><span class="dv">0</span>, <span class="at">FallIOM=</span>FallIOM,<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC_min,<span class="at">clay=</span>clay_min,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb106-200"><a href="#cb106-200" aria-hidden="true" tabindex="-1"></a>fb_t_MIN<span class="ot">&lt;-</span>fb_min[<span class="dv">1</span>]<span class="sc">+</span>fb_min[<span class="dv">2</span>]<span class="sc">+</span>fb_min[<span class="dv">3</span>]<span class="sc">+</span>fb_min[<span class="dv">4</span>]<span class="sc">+</span>fb_min[<span class="dv">5</span>]</span>
<span id="cb106-201"><a href="#cb106-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-202"><a href="#cb106-202" aria-hidden="true" tabindex="-1"></a>m<span class="ot">&lt;-</span>(fb_t_MIN<span class="sc">-</span>FallIOM_min)<span class="sc">/</span>(b)</span>
<span id="cb106-203"><a href="#cb106-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-204"><a href="#cb106-204" aria-hidden="true" tabindex="-1"></a>Ceq_MIN<span class="ot">&lt;-</span>(SOC_min<span class="sc">-</span>FallIOM_min)<span class="sc">/</span>m</span>
<span id="cb106-205"><a href="#cb106-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-206"><a href="#cb106-206" aria-hidden="true" tabindex="-1"></a><span class="co"># UNCERTAINTIES C input equilibrium (MAXIMUM)</span></span>
<span id="cb106-207"><a href="#cb106-207" aria-hidden="true" tabindex="-1"></a>FallIOM_max<span class="ot">=</span><span class="fl">0.049</span><span class="sc">*</span>SOC_max<span class="sc">^</span>(<span class="fl">1.139</span>) </span>
<span id="cb106-208"><a href="#cb106-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-209"><a href="#cb106-209" aria-hidden="true" tabindex="-1"></a>fb_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>b,<span class="at">years=</span>years,<span class="at">DPMptf=</span><span class="dv">0</span>, <span class="at">RPMptf=</span><span class="dv">0</span>, <span class="at">BIOptf=</span><span class="dv">0</span>, <span class="at">HUMptf=</span><span class="dv">0</span>, <span class="at">FallIOM=</span>FallIOM,<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC_max,<span class="at">clay=</span>clay_max,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb106-210"><a href="#cb106-210" aria-hidden="true" tabindex="-1"></a>fb_t_MAX<span class="ot">&lt;-</span>fb_max[<span class="dv">1</span>]<span class="sc">+</span>fb_max[<span class="dv">2</span>]<span class="sc">+</span>fb_max[<span class="dv">3</span>]<span class="sc">+</span>fb_max[<span class="dv">4</span>]<span class="sc">+</span>fb_max[<span class="dv">5</span>]</span>
<span id="cb106-211"><a href="#cb106-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-212"><a href="#cb106-212" aria-hidden="true" tabindex="-1"></a>m<span class="ot">&lt;-</span>(fb_t_MAX<span class="sc">-</span>FallIOM_max)<span class="sc">/</span>(b)</span>
<span id="cb106-213"><a href="#cb106-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-214"><a href="#cb106-214" aria-hidden="true" tabindex="-1"></a>Ceq_MAX<span class="ot">&lt;-</span>(SOC_max<span class="sc">-</span>FallIOM_max)<span class="sc">/</span>m</span>
<span id="cb106-215"><a href="#cb106-215" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb106-216"><a href="#cb106-216" aria-hidden="true" tabindex="-1"></a><span class="co"># SOC POOLS AFTER 500 YEARS RUN WITH C INPUT EQUILIBRIUM</span></span>
<span id="cb106-217"><a href="#cb106-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-218"><a href="#cb106-218" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (LU<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">13</span>){</span>
<span id="cb106-219"><a href="#cb106-219" aria-hidden="true" tabindex="-1"></a>RPM_p_2<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">0.9902+0.4788</span></span>
<span id="cb106-220"><a href="#cb106-220" aria-hidden="true" tabindex="-1"></a>BIO_p_2<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">1.09038+0.04055</span></span>
<span id="cb106-221"><a href="#cb106-221" aria-hidden="true" tabindex="-1"></a>HUM_p_2<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.9878-0.3818</span></span>
<span id="cb106-222"><a href="#cb106-222" aria-hidden="true" tabindex="-1"></a>DPM_p_2<span class="ot">&lt;-</span>SOC<span class="sc">-</span>FallIOM<span class="sc">-</span>RPM_p_2<span class="sc">-</span>HUM_p_2<span class="sc">-</span>BIO_p_2</span>
<span id="cb106-223"><a href="#cb106-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-224"><a href="#cb106-224" aria-hidden="true" tabindex="-1"></a>feq_t<span class="ot">&lt;-</span>RPM_p_2<span class="sc">+</span>BIO_p_2<span class="sc">+</span>HUM_p_2<span class="sc">+</span>DPM_p_2<span class="sc">+</span>FallIOM</span>
<span id="cb106-225"><a href="#cb106-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-226"><a href="#cb106-226" aria-hidden="true" tabindex="-1"></a><span class="co">#uncertainties  MIN</span></span>
<span id="cb106-227"><a href="#cb106-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-228"><a href="#cb106-228" aria-hidden="true" tabindex="-1"></a>RPM_p_2_min<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">0.9902+0.4788</span></span>
<span id="cb106-229"><a href="#cb106-229" aria-hidden="true" tabindex="-1"></a>BIO_p_2_min<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">1.09038+0.04055</span></span>
<span id="cb106-230"><a href="#cb106-230" aria-hidden="true" tabindex="-1"></a>HUM_p_2_min<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.9878-0.3818</span></span>
<span id="cb106-231"><a href="#cb106-231" aria-hidden="true" tabindex="-1"></a>DPM_p_2_min<span class="ot">&lt;-</span>SOC_min<span class="sc">-</span>FallIOM_min<span class="sc">-</span>RPM_p_2_min<span class="sc">-</span>HUM_p_2_min<span class="sc">-</span>BIO_p_2_min</span>
<span id="cb106-232"><a href="#cb106-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-233"><a href="#cb106-233" aria-hidden="true" tabindex="-1"></a>feq_t_min<span class="ot">&lt;-</span>RPM_p_2_min<span class="sc">+</span>BIO_p_2_min<span class="sc">+</span>HUM_p_2_min<span class="sc">+</span>DPM_p_2_min<span class="sc">+</span>FallIOM_min</span>
<span id="cb106-234"><a href="#cb106-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-235"><a href="#cb106-235" aria-hidden="true" tabindex="-1"></a><span class="co">#uncertainties  MAX</span></span>
<span id="cb106-236"><a href="#cb106-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-237"><a href="#cb106-237" aria-hidden="true" tabindex="-1"></a>RPM_p_2_max<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">0.9902+0.4788</span></span>
<span id="cb106-238"><a href="#cb106-238" aria-hidden="true" tabindex="-1"></a>BIO_p_2_max<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">1.09038+0.04055</span></span>
<span id="cb106-239"><a href="#cb106-239" aria-hidden="true" tabindex="-1"></a>HUM_p_2_max<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.9878-0.3818</span></span>
<span id="cb106-240"><a href="#cb106-240" aria-hidden="true" tabindex="-1"></a>DPM_p_2_max<span class="ot">&lt;-</span>SOC_max<span class="sc">-</span>FallIOM_max<span class="sc">-</span>RPM_p_2_max<span class="sc">-</span>HUM_p_2_max<span class="sc">-</span>BIO_p_2_max</span>
<span id="cb106-241"><a href="#cb106-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-242"><a href="#cb106-242" aria-hidden="true" tabindex="-1"></a>feq_t_max<span class="ot">&lt;-</span>RPM_p_2_max<span class="sc">+</span>BIO_p_2_max<span class="sc">+</span>HUM_p_2_max<span class="sc">+</span>DPM_p_2_max<span class="sc">+</span>FallIOM_max</span>
<span id="cb106-243"><a href="#cb106-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-244"><a href="#cb106-244" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">2</span>]<span class="ot">&lt;-</span>SOC</span>
<span id="cb106-245"><a href="#cb106-245" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">3</span>]<span class="ot">&lt;-</span>Ceq</span>
<span id="cb106-246"><a href="#cb106-246" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">4</span>]<span class="ot">&lt;-</span>feq_t</span>
<span id="cb106-247"><a href="#cb106-247" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">5</span>]<span class="ot">&lt;-</span>DPM_p_2</span>
<span id="cb106-248"><a href="#cb106-248" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">6</span>]<span class="ot">&lt;-</span>RPM_p_2</span>
<span id="cb106-249"><a href="#cb106-249" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">7</span>]<span class="ot">&lt;-</span>BIO_p_2</span>
<span id="cb106-250"><a href="#cb106-250" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">8</span>]<span class="ot">&lt;-</span>HUM_p_2</span>
<span id="cb106-251"><a href="#cb106-251" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">9</span>]<span class="ot">&lt;-</span>FallIOM</span>
<span id="cb106-252"><a href="#cb106-252" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">10</span>]<span class="ot">&lt;-</span>Ceq_MIN</span>
<span id="cb106-253"><a href="#cb106-253" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">11</span>]<span class="ot">&lt;-</span>Ceq_MAX</span>
<span id="cb106-254"><a href="#cb106-254" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">12</span>]<span class="ot">&lt;-</span>feq_t_min</span>
<span id="cb106-255"><a href="#cb106-255" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">13</span>]<span class="ot">&lt;-</span>DPM_p_2_min</span>
<span id="cb106-256"><a href="#cb106-256" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">14</span>]<span class="ot">&lt;-</span>RPM_p_2_min</span>
<span id="cb106-257"><a href="#cb106-257" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">15</span>]<span class="ot">&lt;-</span>BIO_p_2_min</span>
<span id="cb106-258"><a href="#cb106-258" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">16</span>]<span class="ot">&lt;-</span>HUM_p_2_min</span>
<span id="cb106-259"><a href="#cb106-259" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">17</span>]<span class="ot">&lt;-</span>FallIOM_min</span>
<span id="cb106-260"><a href="#cb106-260" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">18</span>]<span class="ot">&lt;-</span>feq_t_max</span>
<span id="cb106-261"><a href="#cb106-261" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">19</span>]<span class="ot">&lt;-</span>DPM_p_2_max</span>
<span id="cb106-262"><a href="#cb106-262" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">20</span>]<span class="ot">&lt;-</span>RPM_p_2_max</span>
<span id="cb106-263"><a href="#cb106-263" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">21</span>]<span class="ot">&lt;-</span>BIO_p_2_max</span>
<span id="cb106-264"><a href="#cb106-264" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">22</span>]<span class="ot">&lt;-</span>HUM_p_2_max</span>
<span id="cb106-265"><a href="#cb106-265" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">23</span>]<span class="ot">&lt;-</span>FallIOM_max</span>
<span id="cb106-266"><a href="#cb106-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-267"><a href="#cb106-267" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(LU<span class="sc">==</span><span class="dv">4</span>){</span>
<span id="cb106-268"><a href="#cb106-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-269"><a href="#cb106-269" aria-hidden="true" tabindex="-1"></a>RPM_p_4<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">1.7631+0.4043</span></span>
<span id="cb106-270"><a href="#cb106-270" aria-hidden="true" tabindex="-1"></a>BIO_p_4<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">0.9757+0.0209</span></span>
<span id="cb106-271"><a href="#cb106-271" aria-hidden="true" tabindex="-1"></a>HUM_p_4<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.8712-0.2904</span></span>
<span id="cb106-272"><a href="#cb106-272" aria-hidden="true" tabindex="-1"></a>DPM_p_4<span class="ot">&lt;-</span>SOC<span class="sc">-</span>FallIOM<span class="sc">-</span>RPM_p_4<span class="sc">-</span>HUM_p_4<span class="sc">-</span>BIO_p_4</span>
<span id="cb106-273"><a href="#cb106-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-274"><a href="#cb106-274" aria-hidden="true" tabindex="-1"></a>feq_t<span class="ot">&lt;-</span>RPM_p_4<span class="sc">+</span>BIO_p_4<span class="sc">+</span>HUM_p_4<span class="sc">+</span>DPM_p_4<span class="sc">+</span>FallIOM</span>
<span id="cb106-275"><a href="#cb106-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-276"><a href="#cb106-276" aria-hidden="true" tabindex="-1"></a><span class="co">#uncertainties min</span></span>
<span id="cb106-277"><a href="#cb106-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-278"><a href="#cb106-278" aria-hidden="true" tabindex="-1"></a>RPM_p_4_min<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">1.7631+0.4043</span></span>
<span id="cb106-279"><a href="#cb106-279" aria-hidden="true" tabindex="-1"></a>BIO_p_4_min<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">0.9757+0.0209</span></span>
<span id="cb106-280"><a href="#cb106-280" aria-hidden="true" tabindex="-1"></a>HUM_p_4_min<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.8712-0.2904</span></span>
<span id="cb106-281"><a href="#cb106-281" aria-hidden="true" tabindex="-1"></a>DPM_p_4_min<span class="ot">&lt;-</span>SOC_min<span class="sc">-</span>FallIOM_min<span class="sc">-</span>RPM_p_4_min<span class="sc">-</span>HUM_p_4_min<span class="sc">-</span>BIO_p_4_min</span>
<span id="cb106-282"><a href="#cb106-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-283"><a href="#cb106-283" aria-hidden="true" tabindex="-1"></a>feq_t_min<span class="ot">&lt;-</span>RPM_p_4_min<span class="sc">+</span>BIO_p_4_min<span class="sc">+</span>HUM_p_4_min<span class="sc">+</span>DPM_p_4_min<span class="sc">+</span>FallIOM_min</span>
<span id="cb106-284"><a href="#cb106-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-285"><a href="#cb106-285" aria-hidden="true" tabindex="-1"></a><span class="co">#uncertainties max</span></span>
<span id="cb106-286"><a href="#cb106-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-287"><a href="#cb106-287" aria-hidden="true" tabindex="-1"></a>RPM_p_4_max<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">1.7631+0.4043</span></span>
<span id="cb106-288"><a href="#cb106-288" aria-hidden="true" tabindex="-1"></a>BIO_p_4_max<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">0.9757+0.0209</span></span>
<span id="cb106-289"><a href="#cb106-289" aria-hidden="true" tabindex="-1"></a>HUM_p_4_max<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.8712-0.2904</span></span>
<span id="cb106-290"><a href="#cb106-290" aria-hidden="true" tabindex="-1"></a>DPM_p_4_max<span class="ot">&lt;-</span>SOC_max<span class="sc">-</span>FallIOM_max<span class="sc">-</span>RPM_p_4_max<span class="sc">-</span>HUM_p_4_max<span class="sc">-</span>BIO_p_4_max</span>
<span id="cb106-291"><a href="#cb106-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-292"><a href="#cb106-292" aria-hidden="true" tabindex="-1"></a>feq_t_max<span class="ot">&lt;-</span>RPM_p_4_max<span class="sc">+</span>BIO_p_4_max<span class="sc">+</span>HUM_p_4_max<span class="sc">+</span>DPM_p_4_max<span class="sc">+</span>FallIOM_max</span>
<span id="cb106-293"><a href="#cb106-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-294"><a href="#cb106-294" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">2</span>]<span class="ot">&lt;-</span>SOC</span>
<span id="cb106-295"><a href="#cb106-295" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">3</span>]<span class="ot">&lt;-</span>Ceq</span>
<span id="cb106-296"><a href="#cb106-296" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">4</span>]<span class="ot">&lt;-</span>feq_t</span>
<span id="cb106-297"><a href="#cb106-297" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">5</span>]<span class="ot">&lt;-</span>DPM_p_4</span>
<span id="cb106-298"><a href="#cb106-298" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">6</span>]<span class="ot">&lt;-</span>RPM_p_4</span>
<span id="cb106-299"><a href="#cb106-299" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">7</span>]<span class="ot">&lt;-</span>BIO_p_4</span>
<span id="cb106-300"><a href="#cb106-300" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">8</span>]<span class="ot">&lt;-</span>HUM_p_4</span>
<span id="cb106-301"><a href="#cb106-301" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">9</span>]<span class="ot">&lt;-</span>FallIOM</span>
<span id="cb106-302"><a href="#cb106-302" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">10</span>]<span class="ot">&lt;-</span>Ceq_MIN</span>
<span id="cb106-303"><a href="#cb106-303" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">11</span>]<span class="ot">&lt;-</span>Ceq_MAX</span>
<span id="cb106-304"><a href="#cb106-304" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">12</span>]<span class="ot">&lt;-</span>feq_t_min</span>
<span id="cb106-305"><a href="#cb106-305" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">13</span>]<span class="ot">&lt;-</span>DPM_p_4_min</span>
<span id="cb106-306"><a href="#cb106-306" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">14</span>]<span class="ot">&lt;-</span>RPM_p_4_min</span>
<span id="cb106-307"><a href="#cb106-307" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">15</span>]<span class="ot">&lt;-</span>BIO_p_4_min</span>
<span id="cb106-308"><a href="#cb106-308" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">16</span>]<span class="ot">&lt;-</span>HUM_p_4_min</span>
<span id="cb106-309"><a href="#cb106-309" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">17</span>]<span class="ot">&lt;-</span>FallIOM_min</span>
<span id="cb106-310"><a href="#cb106-310" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">18</span>]<span class="ot">&lt;-</span>feq_t_max</span>
<span id="cb106-311"><a href="#cb106-311" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">19</span>]<span class="ot">&lt;-</span>DPM_p_4_max</span>
<span id="cb106-312"><a href="#cb106-312" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">20</span>]<span class="ot">&lt;-</span>RPM_p_4_max</span>
<span id="cb106-313"><a href="#cb106-313" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">21</span>]<span class="ot">&lt;-</span>BIO_p_4_max</span>
<span id="cb106-314"><a href="#cb106-314" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">22</span>]<span class="ot">&lt;-</span>HUM_p_4_max</span>
<span id="cb106-315"><a href="#cb106-315" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">23</span>]<span class="ot">&lt;-</span>FallIOM_max</span>
<span id="cb106-316"><a href="#cb106-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-317"><a href="#cb106-317" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (LU<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">8</span>){</span>
<span id="cb106-318"><a href="#cb106-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-319"><a href="#cb106-319" aria-hidden="true" tabindex="-1"></a>RPM_p_3<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">1.3837+0.4692</span></span>
<span id="cb106-320"><a href="#cb106-320" aria-hidden="true" tabindex="-1"></a>BIO_p_3<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">1.03401+0.02531</span></span>
<span id="cb106-321"><a href="#cb106-321" aria-hidden="true" tabindex="-1"></a>HUM_p_3<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.9316-0.5243</span></span>
<span id="cb106-322"><a href="#cb106-322" aria-hidden="true" tabindex="-1"></a>DPM_p_3<span class="ot">&lt;-</span>SOC<span class="sc">-</span>FallIOM<span class="sc">-</span>RPM_p_3<span class="sc">-</span>HUM_p_3<span class="sc">-</span>BIO_p_3</span>
<span id="cb106-323"><a href="#cb106-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-324"><a href="#cb106-324" aria-hidden="true" tabindex="-1"></a>feq_t<span class="ot">&lt;-</span>RPM_p_3<span class="sc">+</span>BIO_p_3<span class="sc">+</span>HUM_p_3<span class="sc">+</span>DPM_p_3<span class="sc">+</span>FallIOM</span>
<span id="cb106-325"><a href="#cb106-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-326"><a href="#cb106-326" aria-hidden="true" tabindex="-1"></a><span class="co">#uncertainties min</span></span>
<span id="cb106-327"><a href="#cb106-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-328"><a href="#cb106-328" aria-hidden="true" tabindex="-1"></a>RPM_p_3_min<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">1.3837+0.4692</span></span>
<span id="cb106-329"><a href="#cb106-329" aria-hidden="true" tabindex="-1"></a>BIO_p_3_min<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">1.03401+0.02531</span></span>
<span id="cb106-330"><a href="#cb106-330" aria-hidden="true" tabindex="-1"></a>HUM_p_3_min<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC_min <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay_min <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.9316-0.5243</span></span>
<span id="cb106-331"><a href="#cb106-331" aria-hidden="true" tabindex="-1"></a>DPM_p_3_min<span class="ot">&lt;-</span>SOC_min<span class="sc">-</span>FallIOM_min<span class="sc">-</span>RPM_p_3_min<span class="sc">-</span>HUM_p_3_min<span class="sc">-</span>BIO_p_3_min</span>
<span id="cb106-332"><a href="#cb106-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-333"><a href="#cb106-333" aria-hidden="true" tabindex="-1"></a>feq_t_min<span class="ot">&lt;-</span>RPM_p_3_min<span class="sc">+</span>BIO_p_3_min<span class="sc">+</span>HUM_p_3_min<span class="sc">+</span>DPM_p_3_min<span class="sc">+</span>FallIOM_min</span>
<span id="cb106-334"><a href="#cb106-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-335"><a href="#cb106-335" aria-hidden="true" tabindex="-1"></a><span class="co">#uncertainties max</span></span>
<span id="cb106-336"><a href="#cb106-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-337"><a href="#cb106-337" aria-hidden="true" tabindex="-1"></a>RPM_p_3_max<span class="ot">&lt;-</span>((<span class="fl">0.184</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.1555</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">1.275</span>)<span class="sc">^</span>(<span class="sc">-</span><span class="fl">0.1158</span>))<span class="sc">*</span><span class="fl">1.3837+0.4692</span></span>
<span id="cb106-338"><a href="#cb106-338" aria-hidden="true" tabindex="-1"></a>BIO_p_3_max<span class="ot">&lt;-</span>((<span class="fl">0.014</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.0075</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">8.8473</span>)<span class="sc">^</span>(<span class="fl">0.0567</span>))<span class="sc">*</span><span class="fl">1.03401+0.02531</span></span>
<span id="cb106-339"><a href="#cb106-339" aria-hidden="true" tabindex="-1"></a>HUM_p_3_max<span class="ot">&lt;-</span>((<span class="fl">0.7148</span><span class="sc">*</span>SOC_max <span class="sc">+</span> <span class="fl">0.5069</span>)<span class="sc">*</span>(clay_max <span class="sc">+</span> <span class="fl">0.3421</span>)<span class="sc">^</span>(<span class="fl">0.0184</span>))<span class="sc">*</span><span class="fl">0.9316-0.5243</span></span>
<span id="cb106-340"><a href="#cb106-340" aria-hidden="true" tabindex="-1"></a>DPM_p_3_max<span class="ot">&lt;-</span>SOC_max<span class="sc">-</span>FallIOM_max<span class="sc">-</span>RPM_p_3_max<span class="sc">-</span>HUM_p_3_max<span class="sc">-</span>BIO_p_3_max</span>
<span id="cb106-341"><a href="#cb106-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-342"><a href="#cb106-342" aria-hidden="true" tabindex="-1"></a>feq_t_max<span class="ot">&lt;-</span>RPM_p_3_max<span class="sc">+</span>BIO_p_3_max<span class="sc">+</span>HUM_p_3_max<span class="sc">+</span>DPM_p_3_max<span class="sc">+</span>FallIOM_max</span>
<span id="cb106-343"><a href="#cb106-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-344"><a href="#cb106-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-345"><a href="#cb106-345" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">2</span>]<span class="ot">&lt;-</span>SOC</span>
<span id="cb106-346"><a href="#cb106-346" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">3</span>]<span class="ot">&lt;-</span>Ceq</span>
<span id="cb106-347"><a href="#cb106-347" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">4</span>]<span class="ot">&lt;-</span>feq_t</span>
<span id="cb106-348"><a href="#cb106-348" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">5</span>]<span class="ot">&lt;-</span>DPM_p_3</span>
<span id="cb106-349"><a href="#cb106-349" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">6</span>]<span class="ot">&lt;-</span>RPM_p_3</span>
<span id="cb106-350"><a href="#cb106-350" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">7</span>]<span class="ot">&lt;-</span>BIO_p_3</span>
<span id="cb106-351"><a href="#cb106-351" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">8</span>]<span class="ot">&lt;-</span>HUM_p_3</span>
<span id="cb106-352"><a href="#cb106-352" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">9</span>]<span class="ot">&lt;-</span>FallIOM</span>
<span id="cb106-353"><a href="#cb106-353" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">10</span>]<span class="ot">&lt;-</span>Ceq_MIN</span>
<span id="cb106-354"><a href="#cb106-354" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">11</span>]<span class="ot">&lt;-</span>Ceq_MAX</span>
<span id="cb106-355"><a href="#cb106-355" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">12</span>]<span class="ot">&lt;-</span>feq_t_min</span>
<span id="cb106-356"><a href="#cb106-356" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">13</span>]<span class="ot">&lt;-</span>DPM_p_3_min</span>
<span id="cb106-357"><a href="#cb106-357" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">14</span>]<span class="ot">&lt;-</span>RPM_p_3_min</span>
<span id="cb106-358"><a href="#cb106-358" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">15</span>]<span class="ot">&lt;-</span>BIO_p_3_min</span>
<span id="cb106-359"><a href="#cb106-359" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">16</span>]<span class="ot">&lt;-</span>HUM_p_3_min</span>
<span id="cb106-360"><a href="#cb106-360" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">17</span>]<span class="ot">&lt;-</span>FallIOM_min</span>
<span id="cb106-361"><a href="#cb106-361" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">18</span>]<span class="ot">&lt;-</span>feq_t_max</span>
<span id="cb106-362"><a href="#cb106-362" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">19</span>]<span class="ot">&lt;-</span>DPM_p_3_max</span>
<span id="cb106-363"><a href="#cb106-363" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">20</span>]<span class="ot">&lt;-</span>RPM_p_3_max</span>
<span id="cb106-364"><a href="#cb106-364" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">21</span>]<span class="ot">&lt;-</span>BIO_p_3_max</span>
<span id="cb106-365"><a href="#cb106-365" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">22</span>]<span class="ot">&lt;-</span>HUM_p_3_max</span>
<span id="cb106-366"><a href="#cb106-366" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">23</span>]<span class="ot">&lt;-</span>FallIOM_max</span>
<span id="cb106-367"><a href="#cb106-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-368"><a href="#cb106-368" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> {</span>
<span id="cb106-369"><a href="#cb106-369" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">2</span>]<span class="ot">&lt;-</span>SOC</span>
<span id="cb106-370"><a href="#cb106-370" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">3</span>]<span class="ot">&lt;-</span>Ceq</span>
<span id="cb106-371"><a href="#cb106-371" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">4</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-372"><a href="#cb106-372" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-373"><a href="#cb106-373" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-374"><a href="#cb106-374" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">7</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-375"><a href="#cb106-375" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">8</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-376"><a href="#cb106-376" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">9</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-377"><a href="#cb106-377" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">10</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-378"><a href="#cb106-378" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">11</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-379"><a href="#cb106-379" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">12</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-380"><a href="#cb106-380" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">13</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-381"><a href="#cb106-381" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">14</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-382"><a href="#cb106-382" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">15</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-383"><a href="#cb106-383" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">16</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-384"><a href="#cb106-384" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">17</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-385"><a href="#cb106-385" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">18</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-386"><a href="#cb106-386" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">19</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-387"><a href="#cb106-387" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">20</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-388"><a href="#cb106-388" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">21</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-389"><a href="#cb106-389" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">22</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-390"><a href="#cb106-390" aria-hidden="true" tabindex="-1"></a>C_INPUT_EQ[i,<span class="dv">23</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb106-391"><a href="#cb106-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-392"><a href="#cb106-392" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-393"><a href="#cb106-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-394"><a href="#cb106-394" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(i,SOC,Ceq))</span>
<span id="cb106-395"><a href="#cb106-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-396"><a href="#cb106-396" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-397"><a href="#cb106-397" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-398"><a href="#cb106-398" aria-hidden="true" tabindex="-1"></a><span class="do">###############for loop ends##############</span></span>
<span id="cb106-399"><a href="#cb106-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-400"><a href="#cb106-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-401"><a href="#cb106-401" aria-hidden="true" tabindex="-1"></a><span class="co">#rename de columns</span></span>
<span id="cb106-402"><a href="#cb106-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-403"><a href="#cb106-403" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">&quot;SOC_FAO&quot;</span></span>
<span id="cb106-404"><a href="#cb106-404" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">&quot;Cinput_EQ&quot;</span></span>
<span id="cb106-405"><a href="#cb106-405" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">&quot;SOC_pedotransfer&quot;</span></span>
<span id="cb106-406"><a href="#cb106-406" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">5</span>]<span class="ot">=</span><span class="st">&quot;DPM_pedotransfer&quot;</span></span>
<span id="cb106-407"><a href="#cb106-407" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">6</span>]<span class="ot">=</span><span class="st">&quot;RPM_pedotransfer&quot;</span></span>
<span id="cb106-408"><a href="#cb106-408" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">7</span>]<span class="ot">=</span><span class="st">&quot;BIO_pedotransfer&quot;</span></span>
<span id="cb106-409"><a href="#cb106-409" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">8</span>]<span class="ot">=</span><span class="st">&quot;HUM_pedotransfer&quot;</span></span>
<span id="cb106-410"><a href="#cb106-410" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">9</span>]<span class="ot">=</span><span class="st">&quot;IOM_pedotransfer&quot;</span></span>
<span id="cb106-411"><a href="#cb106-411" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">10</span>]<span class="ot">=</span><span class="st">&quot;CIneq_min&quot;</span></span>
<span id="cb106-412"><a href="#cb106-412" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">11</span>]<span class="ot">=</span><span class="st">&quot;CIneq_max&quot;</span></span>
<span id="cb106-413"><a href="#cb106-413" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">12</span>]<span class="ot">=</span><span class="st">&quot;SOC_min&quot;</span></span>
<span id="cb106-414"><a href="#cb106-414" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">13</span>]<span class="ot">=</span><span class="st">&quot;DPM_min&quot;</span></span>
<span id="cb106-415"><a href="#cb106-415" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">14</span>]<span class="ot">=</span><span class="st">&quot;RPM_min&quot;</span></span>
<span id="cb106-416"><a href="#cb106-416" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">15</span>]<span class="ot">=</span><span class="st">&quot;BIO_min&quot;</span></span>
<span id="cb106-417"><a href="#cb106-417" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">16</span>]<span class="ot">=</span><span class="st">&quot;HUM_min&quot;</span></span>
<span id="cb106-418"><a href="#cb106-418" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">17</span>]<span class="ot">=</span><span class="st">&quot;IOM_min&quot;</span></span>
<span id="cb106-419"><a href="#cb106-419" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">18</span>]<span class="ot">=</span><span class="st">&quot;SOC_max&quot;</span></span>
<span id="cb106-420"><a href="#cb106-420" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">19</span>]<span class="ot">=</span><span class="st">&quot;DPM_max&quot;</span></span>
<span id="cb106-421"><a href="#cb106-421" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">20</span>]<span class="ot">=</span><span class="st">&quot;RPM_max&quot;</span></span>
<span id="cb106-422"><a href="#cb106-422" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">21</span>]<span class="ot">=</span><span class="st">&quot;BIO_max&quot;</span></span>
<span id="cb106-423"><a href="#cb106-423" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">22</span>]<span class="ot">=</span><span class="st">&quot;HUM_max&quot;</span></span>
<span id="cb106-424"><a href="#cb106-424" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(C_INPUT_EQ<span class="sc">@</span>data)[<span class="dv">23</span>]<span class="ot">=</span><span class="st">&quot;IOM_max&quot;</span></span>
<span id="cb106-425"><a href="#cb106-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-426"><a href="#cb106-426" aria-hidden="true" tabindex="-1"></a><span class="co"># SAVE the Points (shapefile)</span></span>
<span id="cb106-427"><a href="#cb106-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-428"><a href="#cb106-428" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/OUTPUTS/1_SPIN_UP&quot;</span>)</span>
<span id="cb106-429"><a href="#cb106-429" aria-hidden="true" tabindex="-1"></a><span class="fu">writeOGR</span>(C_INPUT_EQ, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;SPIN_UP_County_AOI&quot;</span>, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>) </span></code></pre></div>
</div>
<div id="step-7-run-the-warm-up-phase-for-points-outside-the-cru-layer-script-14b" class="section level3 unnumbered">
<h3 class="unnumbered">Step 7 Run the Warm up phase for points outside the CRU layer (Script 14B)</h3>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#12/11/2020</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SPATIAL SOIL R  for VECTORS</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   ROTH C phase 3: WARM UP</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MSc Ing Agr Luciano E Di Paolo</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="co"># SOilR from Sierra, C.A., M. Mueller, S.E. Trumbore (2012). </span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Models of soil organic matter decomposition: the SoilR package, version 1.0 Geoscientific Model Development, 5(4), </span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="co">#1045--1060. URL http://www.geosci-model-dev.net/5/1045/2012/gmd-5-1045-2012.html.</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SoilR)</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilassessment)</span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>working_dir<span class="ot">&lt;-</span><span class="fu">setwd</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020&quot;</span>)</span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Open empty vector</span></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>Vector<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;INPUTS/TARGET_POINTS/AOI_Empty_points_borders.shp&quot;</span>)</span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Warm Up Stack</span></span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>Stack_Set_warmup<span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;INPUTS/STACK/Stack_Set_WARM_UP_AOI.tif&quot;</span>)</span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Add pixels to the borders to avoid removing costal areas</span></span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(Stack_Set_warmup)){</span>
<span id="cb107-35"><a href="#cb107-35" aria-hidden="true" tabindex="-1"></a>  Stack_Set_warmup[[i]]<span class="ot">&lt;-</span><span class="fu">focal</span>(Stack_Set_warmup[[i]], <span class="at">w =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="dv">25</span>,<span class="dv">25</span>), <span class="at">fun=</span> mean,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">NAonly=</span><span class="cn">TRUE</span> , <span class="at">pad=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-36"><a href="#cb107-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-37"><a href="#cb107-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-38"><a href="#cb107-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Result from SPIN UP PROCESS. A vector with 5 columns , one for each pool</span></span>
<span id="cb107-39"><a href="#cb107-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-40"><a href="#cb107-40" aria-hidden="true" tabindex="-1"></a>Spin_up<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/OUTPUTS/1_SPIN_UP/SPIN_UP_County_AOI.shp&quot;</span>)</span>
<span id="cb107-41"><a href="#cb107-41" aria-hidden="true" tabindex="-1"></a>Spin_up<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Spin_up)</span>
<span id="cb107-42"><a href="#cb107-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-43"><a href="#cb107-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Precipitation , temperature, and EVapotranspiration file 20 anios x 12 = 240 layers x 3</span></span>
<span id="cb107-44"><a href="#cb107-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-45"><a href="#cb107-45" aria-hidden="true" tabindex="-1"></a><span class="co"># CRU LAYERS</span></span>
<span id="cb107-46"><a href="#cb107-46" aria-hidden="true" tabindex="-1"></a>PREC<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/Prec_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb107-47"><a href="#cb107-47" aria-hidden="true" tabindex="-1"></a>TEMP<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/Temp_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb107-48"><a href="#cb107-48" aria-hidden="true" tabindex="-1"></a>PET<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/PET_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb107-49"><a href="#cb107-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-50"><a href="#cb107-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(PREC)){</span>
<span id="cb107-51"><a href="#cb107-51" aria-hidden="true" tabindex="-1"></a>  PREC[[i]]<span class="ot">&lt;-</span><span class="fu">focal</span>(PREC[[i]], <span class="at">w =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">fun=</span> mean,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">NAonly=</span><span class="cn">TRUE</span> , <span class="at">pad=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-52"><a href="#cb107-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-53"><a href="#cb107-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(TEMP)){</span>
<span id="cb107-54"><a href="#cb107-54" aria-hidden="true" tabindex="-1"></a>  TEMP[[i]]<span class="ot">&lt;-</span><span class="fu">focal</span>(TEMP[[i]], <span class="at">w =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">fun=</span> mean,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">NAonly=</span><span class="cn">TRUE</span> , <span class="at">pad=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-55"><a href="#cb107-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-56"><a href="#cb107-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-57"><a href="#cb107-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(PET)){</span>
<span id="cb107-58"><a href="#cb107-58" aria-hidden="true" tabindex="-1"></a>  PET[[i]]<span class="ot">&lt;-</span><span class="fu">focal</span>(PET[[i]], <span class="at">w =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">fun=</span> mean,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">NAonly=</span><span class="cn">TRUE</span> , <span class="at">pad=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-59"><a href="#cb107-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-60"><a href="#cb107-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-61"><a href="#cb107-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-62"><a href="#cb107-62" aria-hidden="true" tabindex="-1"></a><span class="co"># TERRA CLIMATE LAYERS</span></span>
<span id="cb107-63"><a href="#cb107-63" aria-hidden="true" tabindex="-1"></a><span class="co">#PREC&lt;-stack(&quot;INPUTS/TERRA_CLIME/Precipitation_2001-2021_Pergamino.tif&quot;)</span></span>
<span id="cb107-64"><a href="#cb107-64" aria-hidden="true" tabindex="-1"></a><span class="co">#TEMP&lt;-stack(&quot;INPUTS/TERRA_CLIME/AverageTemperature_2001-2021_Pergamino.tif&quot;)*0.1</span></span>
<span id="cb107-65"><a href="#cb107-65" aria-hidden="true" tabindex="-1"></a><span class="co">#PET&lt;-stack(&quot;INPUTS/TERRA_CLIME/PET_2001-2021_Pergamino.tif&quot;)*0.1</span></span>
<span id="cb107-66"><a href="#cb107-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-67"><a href="#cb107-67" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Mean NPP MIAMI 1981 - 2000</span></span>
<span id="cb107-68"><a href="#cb107-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-69"><a href="#cb107-69" aria-hidden="true" tabindex="-1"></a>NPP<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI.tif&quot;</span>)</span>
<span id="cb107-70"><a href="#cb107-70" aria-hidden="true" tabindex="-1"></a>NPP<span class="ot">&lt;-</span><span class="fu">focal</span>(NPP, <span class="at">w =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">fun=</span> mean,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">NAonly=</span><span class="cn">TRUE</span> , <span class="at">pad=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-71"><a href="#cb107-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-72"><a href="#cb107-72" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MIN<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI_MIN.tif&quot;</span>)</span>
<span id="cb107-73"><a href="#cb107-73" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MIN<span class="ot">&lt;-</span><span class="fu">focal</span>(NPP_MEAN_MIN, <span class="at">w =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">fun=</span> mean,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">NAonly=</span><span class="cn">TRUE</span> , <span class="at">pad=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-74"><a href="#cb107-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-75"><a href="#cb107-75" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MAX<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI_MAX.tif&quot;</span>)</span>
<span id="cb107-76"><a href="#cb107-76" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MAX<span class="ot">&lt;-</span><span class="fu">focal</span>(NPP_MEAN_MAX, <span class="at">w =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">fun=</span> mean,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">NAonly=</span><span class="cn">TRUE</span> , <span class="at">pad=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-77"><a href="#cb107-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-78"><a href="#cb107-78" aria-hidden="true" tabindex="-1"></a><span class="co">#Open LU layer (year 2000).</span></span>
<span id="cb107-79"><a href="#cb107-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-80"><a href="#cb107-80" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;INPUTS/LAND_USE/ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span>
<span id="cb107-81"><a href="#cb107-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-82"><a href="#cb107-82" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply NPP coeficientes</span></span>
<span id="cb107-83"><a href="#cb107-83" aria-hidden="true" tabindex="-1"></a>NPP<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb107-84"><a href="#cb107-84" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MIN<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP_MEAN_MIN<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_MEAN_MIN<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_MEAN_MIN<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb107-85"><a href="#cb107-85" aria-hidden="true" tabindex="-1"></a>NPP_MEAN_MAX<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP_MEAN_MAX<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_MEAN_MAX<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_MEAN_MAX<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb107-86"><a href="#cb107-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-87"><a href="#cb107-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-88"><a href="#cb107-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variables to points</span></span>
<span id="cb107-89"><a href="#cb107-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-90"><a href="#cb107-90" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(Stack_Set_warmup,Vector,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-91"><a href="#cb107-91" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(TEMP,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-92"><a href="#cb107-92" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(PREC,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-93"><a href="#cb107-93" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(PET,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-94"><a href="#cb107-94" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(NPP,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-95"><a href="#cb107-95" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(NPP_MEAN_MIN,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-96"><a href="#cb107-96" aria-hidden="true" tabindex="-1"></a>Vector_points<span class="ot">&lt;-</span><span class="fu">extract</span>(NPP_MEAN_MAX,Vector_points,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-97"><a href="#cb107-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-98"><a href="#cb107-98" aria-hidden="true" tabindex="-1"></a>WARM_UP<span class="ot">&lt;-</span>Vector</span>
<span id="cb107-99"><a href="#cb107-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-100"><a href="#cb107-100" aria-hidden="true" tabindex="-1"></a><span class="co">#use only for backup</span></span>
<span id="cb107-101"><a href="#cb107-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-102"><a href="#cb107-102" aria-hidden="true" tabindex="-1"></a><span class="co">#WARM_UP&lt;-readOGR(&quot;WARM_UP_County_AOI3_97.shp&quot;)</span></span>
<span id="cb107-103"><a href="#cb107-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-104"><a href="#cb107-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Warm Up number of years simulation </span></span>
<span id="cb107-105"><a href="#cb107-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-106"><a href="#cb107-106" aria-hidden="true" tabindex="-1"></a>yearsSimulation<span class="ot">&lt;-</span><span class="fu">dim</span>(TEMP)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span></span>
<span id="cb107-107"><a href="#cb107-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-108"><a href="#cb107-108" aria-hidden="true" tabindex="-1"></a>clim_layers<span class="ot">&lt;-</span>yearsSimulation<span class="sc">*</span><span class="dv">12</span></span>
<span id="cb107-109"><a href="#cb107-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-110"><a href="#cb107-110" aria-hidden="true" tabindex="-1"></a>nppBand<span class="ot">&lt;-</span><span class="fu">nlayers</span>(Stack_Set_warmup)<span class="sc">+</span>clim_layers<span class="sc">*</span><span class="dv">3</span><span class="sc">+</span><span class="dv">2</span></span>
<span id="cb107-111"><a href="#cb107-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-112"><a href="#cb107-112" aria-hidden="true" tabindex="-1"></a>firstClimLayer<span class="ot">&lt;-</span><span class="fu">nlayers</span>(Stack_Set_warmup)<span class="sc">+</span><span class="dv">2</span></span>
<span id="cb107-113"><a href="#cb107-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-114"><a href="#cb107-114" aria-hidden="true" tabindex="-1"></a>nppBand_min<span class="ot">&lt;-</span>nppBand<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb107-115"><a href="#cb107-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-116"><a href="#cb107-116" aria-hidden="true" tabindex="-1"></a>nppBand_max<span class="ot">&lt;-</span>nppBand<span class="sc">+</span><span class="dv">2</span></span>
<span id="cb107-117"><a href="#cb107-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-118"><a href="#cb107-118" aria-hidden="true" tabindex="-1"></a>nDR_beg<span class="ot">&lt;-</span>(<span class="dv">16</span><span class="sc">+</span>yearsSimulation)</span>
<span id="cb107-119"><a href="#cb107-119" aria-hidden="true" tabindex="-1"></a>nDR_end<span class="ot">&lt;-</span>nDR_beg<span class="sc">+</span>(yearsSimulation<span class="dv">-1</span>)</span>
<span id="cb107-120"><a href="#cb107-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-121"><a href="#cb107-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the layers from the Vector</span></span>
<span id="cb107-122"><a href="#cb107-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-123"><a href="#cb107-123" aria-hidden="true" tabindex="-1"></a>SOC_im<span class="ot">&lt;-</span>Vector_points[[<span class="dv">2</span>]] </span>
<span id="cb107-124"><a href="#cb107-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-125"><a href="#cb107-125" aria-hidden="true" tabindex="-1"></a>clay_im<span class="ot">&lt;-</span>Vector_points[[<span class="dv">3</span>]] </span>
<span id="cb107-126"><a href="#cb107-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-127"><a href="#cb107-127" aria-hidden="true" tabindex="-1"></a>LU_im<span class="ot">&lt;-</span>Vector_points[[<span class="dv">16</span>]]</span>
<span id="cb107-128"><a href="#cb107-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-129"><a href="#cb107-129" aria-hidden="true" tabindex="-1"></a>NPP_im<span class="ot">&lt;-</span>Vector_points[[nppBand]]</span>
<span id="cb107-130"><a href="#cb107-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-131"><a href="#cb107-131" aria-hidden="true" tabindex="-1"></a>NPP_im_MIN<span class="ot">&lt;-</span>Vector_points[[nppBand_min]]</span>
<span id="cb107-132"><a href="#cb107-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-133"><a href="#cb107-133" aria-hidden="true" tabindex="-1"></a>NPP_im_MAX<span class="ot">&lt;-</span>Vector_points[[nppBand_max]]</span>
<span id="cb107-134"><a href="#cb107-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-135"><a href="#cb107-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Years</span></span>
<span id="cb107-136"><a href="#cb107-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-137"><a href="#cb107-137" aria-hidden="true" tabindex="-1"></a>years<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb107-138"><a href="#cb107-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-139"><a href="#cb107-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-140"><a href="#cb107-140" aria-hidden="true" tabindex="-1"></a><span class="co"># ROTH C MODEL FUNCTION . </span></span>
<span id="cb107-141"><a href="#cb107-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-142"><a href="#cb107-142" aria-hidden="true" tabindex="-1"></a><span class="do">###########function set up starts################</span></span>
<span id="cb107-143"><a href="#cb107-143" aria-hidden="true" tabindex="-1"></a>Roth_C<span class="ot">&lt;-</span><span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1,LU)</span>
<span id="cb107-144"><a href="#cb107-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-145"><a href="#cb107-145" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb107-146"><a href="#cb107-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-147"><a href="#cb107-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Paddy fields coefficent fPR = 0.4 if the target point is class = 13 , else fPR=1</span></span>
<span id="cb107-148"><a href="#cb107-148" aria-hidden="true" tabindex="-1"></a><span class="co"># From Shirato and Yukozawa 2004</span></span>
<span id="cb107-149"><a href="#cb107-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-150"><a href="#cb107-150" aria-hidden="true" tabindex="-1"></a>fPR<span class="ot">=</span>(LU <span class="sc">==</span> <span class="dv">13</span>)<span class="sc">*</span><span class="fl">0.4</span> <span class="sc">+</span> (LU<span class="sc">!=</span><span class="dv">13</span>)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb107-151"><a href="#cb107-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-152"><a href="#cb107-152" aria-hidden="true" tabindex="-1"></a><span class="co">#Temperature effects per month</span></span>
<span id="cb107-153"><a href="#cb107-153" aria-hidden="true" tabindex="-1"></a>fT<span class="ot">=</span><span class="fu">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span>
<span id="cb107-154"><a href="#cb107-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-155"><a href="#cb107-155" aria-hidden="true" tabindex="-1"></a><span class="co">#Moisture effects per month . Si se usa evapotranspiracion pE=1</span></span>
<span id="cb107-156"><a href="#cb107-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-157"><a href="#cb107-157" aria-hidden="true" tabindex="-1"></a>fw1func<span class="ot">&lt;-</span><span class="cf">function</span>(P, E, <span class="at">S.Thick =</span> <span class="dv">30</span>, <span class="at">pClay =</span> <span class="fl">32.0213</span>, <span class="at">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb107-158"><a href="#cb107-158" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb107-159"><a href="#cb107-159" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb107-160"><a href="#cb107-160" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> P <span class="sc">-</span> E <span class="sc">*</span> pE</span>
<span id="cb107-161"><a href="#cb107-161" aria-hidden="true" tabindex="-1"></a>    Acc.TSMD <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb107-162"><a href="#cb107-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb107-163"><a href="#cb107-163" aria-hidden="true" tabindex="-1"></a>    B <span class="ot">=</span> <span class="fu">ifelse</span>(bare[i] <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb107-164"><a href="#cb107-164" aria-hidden="true" tabindex="-1"></a>     Max.TSMD <span class="ot">=</span> <span class="sc">-</span>(<span class="dv">20</span> <span class="sc">+</span> <span class="fl">1.3</span> <span class="sc">*</span> pClay <span class="sc">-</span> <span class="fl">0.01</span> <span class="sc">*</span> (pClay<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (S.Thick<span class="sc">/</span><span class="dv">23</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>B)</span>
<span id="cb107-165"><a href="#cb107-165" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">ifelse</span>(M[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb107-166"><a href="#cb107-166" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i] <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb107-167"><a href="#cb107-167" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i]</span>
<span id="cb107-168"><a href="#cb107-168" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb107-169"><a href="#cb107-169" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> (Acc.TSMD[i] <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb107-170"><a href="#cb107-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="sc">&lt;=</span> Max.TSMD) {</span>
<span id="cb107-171"><a href="#cb107-171" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Max.TSMD</span>
<span id="cb107-172"><a href="#cb107-172" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb107-173"><a href="#cb107-173" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb107-174"><a href="#cb107-174" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">ifelse</span>(Acc.TSMD <span class="sc">&gt;</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> ((Max.TSMD <span class="sc">-</span> </span>
<span id="cb107-175"><a href="#cb107-175" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD)<span class="sc">/</span>(Max.TSMD <span class="sc">-</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD))))</span>
<span id="cb107-176"><a href="#cb107-176" aria-hidden="true" tabindex="-1"></a>    b<span class="ot">&lt;-</span><span class="fu">clamp</span>(b,<span class="at">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb107-177"><a href="#cb107-177" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(b))</span>
<span id="cb107-178"><a href="#cb107-178" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-179"><a href="#cb107-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-180"><a href="#cb107-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-181"><a href="#cb107-181" aria-hidden="true" tabindex="-1"></a>fW_2<span class="ot">&lt;-</span> <span class="fu">fw1func</span>(<span class="at">P=</span>(Precip[,<span class="dv">2</span>]), <span class="at">E=</span>(Evp[,<span class="dv">2</span>]), <span class="at">S.Thick =</span> soil.thick, <span class="at">pClay =</span> clay, <span class="at">pE =</span> <span class="dv">1</span>, <span class="at">bare=</span>bare1)<span class="sc">$</span>b </span>
<span id="cb107-182"><a href="#cb107-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-183"><a href="#cb107-183" aria-hidden="true" tabindex="-1"></a><span class="co">#Vegetation Cover effects  C1: No till Agriculture, C2: Conventional Agriculture, C3: Grasslands and Forests, C4 bareland and Urban</span></span>
<span id="cb107-184"><a href="#cb107-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-185"><a href="#cb107-185" aria-hidden="true" tabindex="-1"></a>fC<span class="ot">&lt;-</span>Cov2[,<span class="dv">2</span>]</span>
<span id="cb107-186"><a href="#cb107-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-187"><a href="#cb107-187" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb107-188"><a href="#cb107-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-189"><a href="#cb107-189" aria-hidden="true" tabindex="-1"></a>xi.frame<span class="ot">=</span><span class="fu">data.frame</span>(years,<span class="fu">rep</span>(fT<span class="sc">*</span>fW_2<span class="sc">*</span>fC<span class="sc">*</span>fPR,<span class="at">length.out=</span><span class="fu">length</span>(years)))</span>
<span id="cb107-190"><a href="#cb107-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-191"><a href="#cb107-191" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from SoilR</span></span>
<span id="cb107-192"><a href="#cb107-192" aria-hidden="true" tabindex="-1"></a><span class="co">#Loads the model Si pass=TRUE genera calcula el modelo aunque sea invalido. </span></span>
<span id="cb107-193"><a href="#cb107-193" aria-hidden="true" tabindex="-1"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb107-194"><a href="#cb107-194" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculates stocks for each pool per month</span></span>
<span id="cb107-195"><a href="#cb107-195" aria-hidden="true" tabindex="-1"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb107-196"><a href="#cb107-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-197"><a href="#cb107-197" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from soilassesment</span></span>
<span id="cb107-198"><a href="#cb107-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-199"><a href="#cb107-199" aria-hidden="true" tabindex="-1"></a>Model3_spin<span class="ot">=</span><span class="fu">carbonTurnover</span>(<span class="at">tt=</span>years,<span class="at">C0=</span><span class="fu">c</span>(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),<span class="at">In=</span>Cinputs,<span class="at">Dr=</span>DR,<span class="at">clay=</span>clay,<span class="at">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb107-200"><a href="#cb107-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-201"><a href="#cb107-201" aria-hidden="true" tabindex="-1"></a>Ct3_spin<span class="ot">=</span>Model3_spin[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb107-202"><a href="#cb107-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-203"><a href="#cb107-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb107-204"><a href="#cb107-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-205"><a href="#cb107-205" aria-hidden="true" tabindex="-1"></a>poolSize3_spin<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb107-206"><a href="#cb107-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-207"><a href="#cb107-207" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(poolSize3_spin)</span>
<span id="cb107-208"><a href="#cb107-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-209"><a href="#cb107-209" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-210"><a href="#cb107-210" aria-hidden="true" tabindex="-1"></a><span class="do">##############funtion set up ends##########</span></span>
<span id="cb107-211"><a href="#cb107-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-212"><a href="#cb107-212" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterates over the area of interest and over 18 years </span></span>
<span id="cb107-213"><a href="#cb107-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-214"><a href="#cb107-214" aria-hidden="true" tabindex="-1"></a>Cinputs<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb107-215"><a href="#cb107-215" aria-hidden="true" tabindex="-1"></a>Cinputs_min<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb107-216"><a href="#cb107-216" aria-hidden="true" tabindex="-1"></a>Cinputs_max<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb107-217"><a href="#cb107-217" aria-hidden="true" tabindex="-1"></a>NPP_M_MIN<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb107-218"><a href="#cb107-218" aria-hidden="true" tabindex="-1"></a>NPP_M_MAX<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb107-219"><a href="#cb107-219" aria-hidden="true" tabindex="-1"></a>NPP_M<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb107-220"><a href="#cb107-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-221"><a href="#cb107-221" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts################</span></span>
<span id="cb107-222"><a href="#cb107-222" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(Vector_points))) {</span>
<span id="cb107-223"><a href="#cb107-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-224"><a href="#cb107-224" aria-hidden="true" tabindex="-1"></a>gt<span class="ot">&lt;-</span>firstClimLayer</span>
<span id="cb107-225"><a href="#cb107-225" aria-hidden="true" tabindex="-1"></a>gp<span class="ot">&lt;-</span>gt<span class="sc">+</span>clim_layers</span>
<span id="cb107-226"><a href="#cb107-226" aria-hidden="true" tabindex="-1"></a>gevp<span class="ot">&lt;-</span>gp<span class="sc">+</span>clim_layers</span>
<span id="cb107-227"><a href="#cb107-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-228"><a href="#cb107-228" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (w <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(TEMP)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb107-229"><a href="#cb107-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-230"><a href="#cb107-230" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="st">&quot;year:&quot;</span>,w))</span>
<span id="cb107-231"><a href="#cb107-231" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the variables </span></span>
<span id="cb107-232"><a href="#cb107-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-233"><a href="#cb107-233" aria-hidden="true" tabindex="-1"></a>Vect<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Vector_points[i,])</span>
<span id="cb107-234"><a href="#cb107-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-235"><a href="#cb107-235" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[gt<span class="sc">:</span>(gt<span class="sc">+</span><span class="dv">11</span>)]))</span>
<span id="cb107-236"><a href="#cb107-236" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Temp=</span>Temp[,<span class="dv">1</span>])</span>
<span id="cb107-237"><a href="#cb107-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-238"><a href="#cb107-238" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[gp<span class="sc">:</span>(gp<span class="sc">+</span><span class="dv">11</span>)]))</span>
<span id="cb107-239"><a href="#cb107-239" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Precip=</span>Precip[,<span class="dv">1</span>])</span>
<span id="cb107-240"><a href="#cb107-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-241"><a href="#cb107-241" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[gevp<span class="sc">:</span>(gevp<span class="sc">+</span><span class="dv">11</span>)]))</span>
<span id="cb107-242"><a href="#cb107-242" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Evp=</span>Evp[,<span class="dv">1</span>])</span>
<span id="cb107-243"><a href="#cb107-243" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-244"><a href="#cb107-244" aria-hidden="true" tabindex="-1"></a>Cov<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">4</span><span class="sc">:</span><span class="dv">15</span>]))</span>
<span id="cb107-245"><a href="#cb107-245" aria-hidden="true" tabindex="-1"></a>Cov1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb107-246"><a href="#cb107-246" aria-hidden="true" tabindex="-1"></a>Cov2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb107-247"><a href="#cb107-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-248"><a href="#cb107-248" aria-hidden="true" tabindex="-1"></a>DR_im<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[nDR_beg<span class="sc">:</span>nDR_end])) <span class="co"># DR one per year according to LU</span></span>
<span id="cb107-249"><a href="#cb107-249" aria-hidden="true" tabindex="-1"></a>DR_im<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">DR_im=</span>DR_im[,<span class="dv">1</span>])</span>
<span id="cb107-250"><a href="#cb107-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-251"><a href="#cb107-251" aria-hidden="true" tabindex="-1"></a>gt<span class="ot">&lt;-</span>gt<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb107-252"><a href="#cb107-252" aria-hidden="true" tabindex="-1"></a>gp<span class="ot">&lt;-</span>gp<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb107-253"><a href="#cb107-253" aria-hidden="true" tabindex="-1"></a>gevp<span class="ot">&lt;-</span>gevp<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb107-254"><a href="#cb107-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-255"><a href="#cb107-255" aria-hidden="true" tabindex="-1"></a><span class="co">#Avoid calculus over Na values </span></span>
<span id="cb107-256"><a href="#cb107-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-257"><a href="#cb107-257" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(Evp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Temp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(SOC_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(clay_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Spin_up[i,<span class="dv">3</span>]))  <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(NPP_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Precip[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov2[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov1[,<span class="dv">1</span>]))  <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(DR_im[,<span class="dv">1</span>]))    <span class="sc">|</span>  (SOC_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span> (clay_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span> (Spin_up[i,<span class="dv">3</span>]<span class="sc">&lt;=</span><span class="dv">0</span>) ) {WARM_UP[i,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">0</span>}<span class="cf">else</span>{</span>
<span id="cb107-258"><a href="#cb107-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-259"><a href="#cb107-259" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the variables from the vector</span></span>
<span id="cb107-260"><a href="#cb107-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-261"><a href="#cb107-261" aria-hidden="true" tabindex="-1"></a>soil.thick<span class="ot">=</span><span class="dv">30</span>  <span class="co">#Soil thickness (organic layer topsoil), in cm</span></span>
<span id="cb107-262"><a href="#cb107-262" aria-hidden="true" tabindex="-1"></a>SOC<span class="ot">&lt;-</span>SOC_im[i]      <span class="co">#Soil organic carbon in Mg/ha </span></span>
<span id="cb107-263"><a href="#cb107-263" aria-hidden="true" tabindex="-1"></a>clay<span class="ot">&lt;-</span>clay_im[i]        <span class="co">#Percent clay %</span></span>
<span id="cb107-264"><a href="#cb107-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-265"><a href="#cb107-265" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>DR_im[w,<span class="dv">1</span>]              <span class="co"># DPM/RPM (decomplosable vs resistant plant material.)</span></span>
<span id="cb107-266"><a href="#cb107-266" aria-hidden="true" tabindex="-1"></a>bare1<span class="ot">&lt;-</span>(Cov1<span class="sc">&gt;</span><span class="fl">0.8</span>)           <span class="co"># If the surface is bare or vegetated</span></span>
<span id="cb107-267"><a href="#cb107-267" aria-hidden="true" tabindex="-1"></a>NPP_81_00<span class="ot">&lt;-</span>NPP_im[i]</span>
<span id="cb107-268"><a href="#cb107-268" aria-hidden="true" tabindex="-1"></a>NPP_81_00_MIN<span class="ot">&lt;-</span>NPP_im_MIN[i]</span>
<span id="cb107-269"><a href="#cb107-269" aria-hidden="true" tabindex="-1"></a>NPP_81_00_MAX<span class="ot">&lt;-</span>NPP_im_MAX[i]</span>
<span id="cb107-270"><a href="#cb107-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-271"><a href="#cb107-271" aria-hidden="true" tabindex="-1"></a><span class="co"># PHASE 2  : WARM UP .  years (w)</span></span>
<span id="cb107-272"><a href="#cb107-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-273"><a href="#cb107-273" aria-hidden="true" tabindex="-1"></a><span class="co"># Cinputs </span></span>
<span id="cb107-274"><a href="#cb107-274" aria-hidden="true" tabindex="-1"></a>T<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[,<span class="dv">2</span>])</span>
<span id="cb107-275"><a href="#cb107-275" aria-hidden="true" tabindex="-1"></a>P<span class="ot">&lt;-</span><span class="fu">sum</span>(Precip[,<span class="dv">2</span>])</span>
<span id="cb107-276"><a href="#cb107-276" aria-hidden="true" tabindex="-1"></a>NPP_M[w]<span class="ot">&lt;-</span><span class="fu">NPPmodel</span>(P,T,<span class="st">&quot;miami&quot;</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb107-277"><a href="#cb107-277" aria-hidden="true" tabindex="-1"></a>NPP_M[w]<span class="ot">&lt;-</span>(LU_im[i]<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP_M[w]<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_M[w]<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_M[w]<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb107-278"><a href="#cb107-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-279"><a href="#cb107-279" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {Cinputs[w]<span class="ot">&lt;-</span>(Spin_up[i,<span class="dv">3</span>]<span class="sc">/</span>NPP_81_00)<span class="sc">*</span>NPP_M[w]} <span class="cf">else</span> {Cinputs[w]<span class="ot">&lt;-</span>(Cinputs[[w<span class="dv">-1</span>]]<span class="sc">/</span> NPP_M[w<span class="dv">-1</span>]) <span class="sc">*</span> NPP_M[w]} </span>
<span id="cb107-280"><a href="#cb107-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-281"><a href="#cb107-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Cinputs MIN</span></span>
<span id="cb107-282"><a href="#cb107-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-283"><a href="#cb107-283" aria-hidden="true" tabindex="-1"></a>Tmin<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">1.02</span>)</span>
<span id="cb107-284"><a href="#cb107-284" aria-hidden="true" tabindex="-1"></a>Pmin<span class="ot">&lt;-</span><span class="fu">sum</span>(Precip[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">0.95</span>)</span>
<span id="cb107-285"><a href="#cb107-285" aria-hidden="true" tabindex="-1"></a>NPP_M_MIN[w]<span class="ot">&lt;-</span><span class="fu">NPPmodel</span>(Pmin,Tmin,<span class="st">&quot;miami&quot;</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb107-286"><a href="#cb107-286" aria-hidden="true" tabindex="-1"></a>NPP_M_MIN[w]<span class="ot">&lt;-</span>(LU_im[i]<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP_M_MIN[w]<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_M_MIN[w]<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_M_MIN[w]<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb107-287"><a href="#cb107-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-288"><a href="#cb107-288" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {Cinputs_min[w]<span class="ot">&lt;-</span>(Spin_up[i,<span class="dv">10</span>]<span class="sc">/</span>NPP_81_00)<span class="sc">*</span>NPP_M_MIN[w]} <span class="cf">else</span> {Cinputs_min[w]<span class="ot">&lt;-</span>(Cinputs_min[[w<span class="dv">-1</span>]]<span class="sc">/</span> NPP_M_MIN[w<span class="dv">-1</span>]) <span class="sc">*</span> NPP_M_MIN[w]} </span>
<span id="cb107-289"><a href="#cb107-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-290"><a href="#cb107-290" aria-hidden="true" tabindex="-1"></a><span class="co"># Cinputs MAX</span></span>
<span id="cb107-291"><a href="#cb107-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-292"><a href="#cb107-292" aria-hidden="true" tabindex="-1"></a>Tmax<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">0.98</span>)</span>
<span id="cb107-293"><a href="#cb107-293" aria-hidden="true" tabindex="-1"></a>Pmax<span class="ot">&lt;-</span><span class="fu">sum</span>(Precip[,<span class="dv">2</span>]<span class="sc">*</span><span class="fl">1.05</span>)</span>
<span id="cb107-294"><a href="#cb107-294" aria-hidden="true" tabindex="-1"></a>NPP_M_MAX[w]<span class="ot">&lt;-</span><span class="fu">NPPmodel</span>(Pmax,Tmax,<span class="st">&quot;miami&quot;</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb107-295"><a href="#cb107-295" aria-hidden="true" tabindex="-1"></a>NPP_M_MAX[w]<span class="ot">&lt;-</span>(LU_im[i]<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span>NPP_M_MAX[w]<span class="sc">*</span><span class="fl">0.53</span><span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span>NPP_M_MAX[w]<span class="sc">*</span><span class="fl">0.88</span> <span class="sc">+</span> (LU_im[i]<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_im[i]<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span>NPP_M_MAX[w]<span class="sc">*</span><span class="fl">0.72</span></span>
<span id="cb107-296"><a href="#cb107-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-297"><a href="#cb107-297" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {Cinputs_max[w]<span class="ot">&lt;-</span>(Spin_up[i,<span class="dv">11</span>]<span class="sc">/</span>NPP_81_00)<span class="sc">*</span>NPP_M_MAX[w]} <span class="cf">else</span> {Cinputs_max[w]<span class="ot">&lt;-</span>(Cinputs_max[[w<span class="dv">-1</span>]]<span class="sc">/</span> NPP_M_MAX[w<span class="dv">-1</span>]) <span class="sc">*</span> NPP_M_MAX[w]} </span>
<span id="cb107-298"><a href="#cb107-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-299"><a href="#cb107-299" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model for 2001-2018 </span></span>
<span id="cb107-300"><a href="#cb107-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-301"><a href="#cb107-301" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb107-302"><a href="#cb107-302" aria-hidden="true" tabindex="-1"></a>f_wp<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs[<span class="dv">1</span>],<span class="at">years=</span>years,<span class="at">DPMptf=</span>Spin_up[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>Spin_up[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>Spin_up[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>Spin_up[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>Spin_up[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU_im[i])</span>
<span id="cb107-303"><a href="#cb107-303" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb107-304"><a href="#cb107-304" aria-hidden="true" tabindex="-1"></a>f_wp<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs[w],<span class="at">years=</span>years,<span class="at">DPMptf=</span>f_wp[<span class="dv">1</span>], <span class="at">RPMptf=</span>f_wp[<span class="dv">2</span>], <span class="at">BIOptf=</span>f_wp[<span class="dv">3</span>], <span class="at">HUMptf=</span>f_wp[<span class="dv">4</span>], <span class="at">FallIOM=</span>f_wp[<span class="dv">5</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU_im[i])</span>
<span id="cb107-305"><a href="#cb107-305" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-306"><a href="#cb107-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-307"><a href="#cb107-307" aria-hidden="true" tabindex="-1"></a>f_wp_t<span class="ot">&lt;-</span>f_wp[<span class="dv">1</span>]<span class="sc">+</span>f_wp[<span class="dv">2</span>]<span class="sc">+</span>f_wp[<span class="dv">3</span>]<span class="sc">+</span>f_wp[<span class="dv">4</span>]<span class="sc">+</span>f_wp[<span class="dv">5</span>]</span>
<span id="cb107-308"><a href="#cb107-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-309"><a href="#cb107-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model for minimum values</span></span>
<span id="cb107-310"><a href="#cb107-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-311"><a href="#cb107-311" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb107-312"><a href="#cb107-312" aria-hidden="true" tabindex="-1"></a>f_wp_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_min[<span class="dv">1</span>],<span class="at">years=</span>years,<span class="at">DPMptf=</span>Spin_up[i,<span class="dv">13</span>], <span class="at">RPMptf=</span>Spin_up[i,<span class="dv">14</span>], <span class="at">BIOptf=</span>Spin_up[i,<span class="dv">15</span>], <span class="at">HUMptf=</span>Spin_up[i,<span class="dv">16</span>], <span class="at">FallIOM=</span>Spin_up[i,<span class="dv">17</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU_im[i])</span>
<span id="cb107-313"><a href="#cb107-313" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb107-314"><a href="#cb107-314" aria-hidden="true" tabindex="-1"></a>f_wp_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_min[w],<span class="at">years=</span>years,<span class="at">DPMptf=</span>f_wp_min[<span class="dv">1</span>], <span class="at">RPMptf=</span>f_wp_min[<span class="dv">2</span>], <span class="at">BIOptf=</span>f_wp_min[<span class="dv">3</span>], <span class="at">HUMptf=</span>f_wp_min[<span class="dv">4</span>], <span class="at">FallIOM=</span>f_wp_min[<span class="dv">5</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU_im[i])</span>
<span id="cb107-315"><a href="#cb107-315" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-316"><a href="#cb107-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-317"><a href="#cb107-317" aria-hidden="true" tabindex="-1"></a>f_wp_t_min<span class="ot">&lt;-</span>f_wp_min[<span class="dv">1</span>]<span class="sc">+</span>f_wp_min[<span class="dv">2</span>]<span class="sc">+</span>f_wp_min[<span class="dv">3</span>]<span class="sc">+</span>f_wp_min[<span class="dv">4</span>]<span class="sc">+</span>f_wp_min[<span class="dv">5</span>]</span>
<span id="cb107-318"><a href="#cb107-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-319"><a href="#cb107-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model for maximum values</span></span>
<span id="cb107-320"><a href="#cb107-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-321"><a href="#cb107-321" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (w<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb107-322"><a href="#cb107-322" aria-hidden="true" tabindex="-1"></a>f_wp_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_max[<span class="dv">1</span>],<span class="at">years=</span>years,<span class="at">DPMptf=</span>Spin_up[i,<span class="dv">19</span>], <span class="at">RPMptf=</span>Spin_up[i,<span class="dv">20</span>], <span class="at">BIOptf=</span>Spin_up[i,<span class="dv">21</span>], <span class="at">HUMptf=</span>Spin_up[i,<span class="dv">22</span>], <span class="at">FallIOM=</span>Spin_up[i,<span class="dv">23</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU_im[i])</span>
<span id="cb107-323"><a href="#cb107-323" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb107-324"><a href="#cb107-324" aria-hidden="true" tabindex="-1"></a>f_wp_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_max[w],<span class="at">years=</span>years,<span class="at">DPMptf=</span>f_wp_max[<span class="dv">1</span>], <span class="at">RPMptf=</span>f_wp_max[<span class="dv">2</span>], <span class="at">BIOptf=</span>f_wp_max[<span class="dv">3</span>], <span class="at">HUMptf=</span>f_wp_max[<span class="dv">4</span>], <span class="at">FallIOM=</span>f_wp_max[<span class="dv">5</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU_im[i])</span>
<span id="cb107-325"><a href="#cb107-325" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-326"><a href="#cb107-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-327"><a href="#cb107-327" aria-hidden="true" tabindex="-1"></a>f_wp_t_max<span class="ot">&lt;-</span>f_wp_max[<span class="dv">1</span>]<span class="sc">+</span>f_wp_max[<span class="dv">2</span>]<span class="sc">+</span>f_wp_max[<span class="dv">3</span>]<span class="sc">+</span>f_wp_max[<span class="dv">4</span>]<span class="sc">+</span>f_wp_max[<span class="dv">5</span>]</span>
<span id="cb107-328"><a href="#cb107-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-329"><a href="#cb107-329" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w)</span>
<span id="cb107-330"><a href="#cb107-330" aria-hidden="true" tabindex="-1"></a><span class="co">#print(c(i,SOC,Spin_up[i,3],NPP_81_00,Cinputs[w],f_wp_t))</span></span>
<span id="cb107-331"><a href="#cb107-331" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(NPP_M[w],Cinputs[w]))</span>
<span id="cb107-332"><a href="#cb107-332" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-333"><a href="#cb107-333" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-334"><a href="#cb107-334" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">mean</span>(Cinputs))){ CinputFOWARD<span class="ot">&lt;-</span><span class="cn">NA</span>} <span class="cf">else</span> { </span>
<span id="cb107-335"><a href="#cb107-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-336"><a href="#cb107-336" aria-hidden="true" tabindex="-1"></a>CinputFOWARD<span class="ot">&lt;-</span><span class="fu">mean</span>(Cinputs)</span>
<span id="cb107-337"><a href="#cb107-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-338"><a href="#cb107-338" aria-hidden="true" tabindex="-1"></a>CinputFOWARD_min<span class="ot">&lt;-</span><span class="fu">mean</span>(Cinputs_min)</span>
<span id="cb107-339"><a href="#cb107-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-340"><a href="#cb107-340" aria-hidden="true" tabindex="-1"></a>CinputFOWARD_max<span class="ot">&lt;-</span><span class="fu">mean</span>(Cinputs_max)</span>
<span id="cb107-341"><a href="#cb107-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-342"><a href="#cb107-342" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">2</span>]<span class="ot">&lt;-</span>SOC</span>
<span id="cb107-343"><a href="#cb107-343" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">3</span>]<span class="ot">&lt;-</span>Cinputs[<span class="dv">18</span>]</span>
<span id="cb107-344"><a href="#cb107-344" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">4</span>]<span class="ot">&lt;-</span>f_wp_t</span>
<span id="cb107-345"><a href="#cb107-345" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">5</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">1</span>]</span>
<span id="cb107-346"><a href="#cb107-346" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">6</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">2</span>]</span>
<span id="cb107-347"><a href="#cb107-347" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">7</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">3</span>]</span>
<span id="cb107-348"><a href="#cb107-348" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">8</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">4</span>]</span>
<span id="cb107-349"><a href="#cb107-349" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">9</span>]<span class="ot">&lt;-</span>f_wp[<span class="dv">5</span>]</span>
<span id="cb107-350"><a href="#cb107-350" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">10</span>]<span class="ot">&lt;-</span>CinputFOWARD</span>
<span id="cb107-351"><a href="#cb107-351" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">11</span>]<span class="ot">&lt;-</span>f_wp_t_min</span>
<span id="cb107-352"><a href="#cb107-352" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">12</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">1</span>]</span>
<span id="cb107-353"><a href="#cb107-353" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">13</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">2</span>]</span>
<span id="cb107-354"><a href="#cb107-354" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">14</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">3</span>]</span>
<span id="cb107-355"><a href="#cb107-355" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">15</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">4</span>]</span>
<span id="cb107-356"><a href="#cb107-356" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">16</span>]<span class="ot">&lt;-</span>f_wp_min[<span class="dv">5</span>]</span>
<span id="cb107-357"><a href="#cb107-357" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">17</span>]<span class="ot">&lt;-</span>f_wp_t_max</span>
<span id="cb107-358"><a href="#cb107-358" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">18</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">1</span>]</span>
<span id="cb107-359"><a href="#cb107-359" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">19</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">2</span>]</span>
<span id="cb107-360"><a href="#cb107-360" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">20</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">3</span>]</span>
<span id="cb107-361"><a href="#cb107-361" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">21</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">4</span>]</span>
<span id="cb107-362"><a href="#cb107-362" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">22</span>]<span class="ot">&lt;-</span>f_wp_max[<span class="dv">5</span>]</span>
<span id="cb107-363"><a href="#cb107-363" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">23</span>]<span class="ot">&lt;-</span>CinputFOWARD_min</span>
<span id="cb107-364"><a href="#cb107-364" aria-hidden="true" tabindex="-1"></a>WARM_UP[i,<span class="dv">24</span>]<span class="ot">&lt;-</span>CinputFOWARD_max</span>
<span id="cb107-365"><a href="#cb107-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-366"><a href="#cb107-366" aria-hidden="true" tabindex="-1"></a>Cinputs<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb107-367"><a href="#cb107-367" aria-hidden="true" tabindex="-1"></a>Cinputs_min<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb107-368"><a href="#cb107-368" aria-hidden="true" tabindex="-1"></a>Cinputs_max<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb107-369"><a href="#cb107-369" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-370"><a href="#cb107-370" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(i)</span>
<span id="cb107-371"><a href="#cb107-371" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-372"><a href="#cb107-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-373"><a href="#cb107-373" aria-hidden="true" tabindex="-1"></a><span class="do">################for loop ends#############</span></span>
<span id="cb107-374"><a href="#cb107-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-375"><a href="#cb107-375" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">&quot;SOC_FAO&quot;</span></span>
<span id="cb107-376"><a href="#cb107-376" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">&quot;Cin_t0&quot;</span></span>
<span id="cb107-377"><a href="#cb107-377" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0&quot;</span></span>
<span id="cb107-378"><a href="#cb107-378" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">5</span>]<span class="ot">=</span><span class="st">&quot;DPM_w_up&quot;</span></span>
<span id="cb107-379"><a href="#cb107-379" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">6</span>]<span class="ot">=</span><span class="st">&quot;RPM_w_up&quot;</span></span>
<span id="cb107-380"><a href="#cb107-380" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">7</span>]<span class="ot">=</span><span class="st">&quot;BIO_w_up&quot;</span></span>
<span id="cb107-381"><a href="#cb107-381" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">8</span>]<span class="ot">=</span><span class="st">&quot;HUM_w_up&quot;</span></span>
<span id="cb107-382"><a href="#cb107-382" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">9</span>]<span class="ot">=</span><span class="st">&quot;IOM_w_up&quot;</span></span>
<span id="cb107-383"><a href="#cb107-383" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">10</span>]<span class="ot">=</span><span class="st">&quot;Cin_mean&quot;</span></span>
<span id="cb107-384"><a href="#cb107-384" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">11</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0min&quot;</span></span>
<span id="cb107-385"><a href="#cb107-385" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">12</span>]<span class="ot">=</span><span class="st">&quot;DPM_w_min&quot;</span></span>
<span id="cb107-386"><a href="#cb107-386" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">13</span>]<span class="ot">=</span><span class="st">&quot;RPM_w_min&quot;</span></span>
<span id="cb107-387"><a href="#cb107-387" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">14</span>]<span class="ot">=</span><span class="st">&quot;BIO_w_min&quot;</span></span>
<span id="cb107-388"><a href="#cb107-388" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">15</span>]<span class="ot">=</span><span class="st">&quot;HUM_w_min&quot;</span></span>
<span id="cb107-389"><a href="#cb107-389" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">16</span>]<span class="ot">=</span><span class="st">&quot;IOM_w_min&quot;</span></span>
<span id="cb107-390"><a href="#cb107-390" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">17</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0max&quot;</span></span>
<span id="cb107-391"><a href="#cb107-391" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">18</span>]<span class="ot">=</span><span class="st">&quot;DPM_w_max&quot;</span></span>
<span id="cb107-392"><a href="#cb107-392" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">19</span>]<span class="ot">=</span><span class="st">&quot;RPM_w_max&quot;</span></span>
<span id="cb107-393"><a href="#cb107-393" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">20</span>]<span class="ot">=</span><span class="st">&quot;BIO_w_max&quot;</span></span>
<span id="cb107-394"><a href="#cb107-394" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">21</span>]<span class="ot">=</span><span class="st">&quot;HUM_w_max&quot;</span></span>
<span id="cb107-395"><a href="#cb107-395" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">22</span>]<span class="ot">=</span><span class="st">&quot;IOM_w_max&quot;</span></span>
<span id="cb107-396"><a href="#cb107-396" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">23</span>]<span class="ot">=</span><span class="st">&quot;Cin_min&quot;</span></span>
<span id="cb107-397"><a href="#cb107-397" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(WARM_UP<span class="sc">@</span>data)[<span class="dv">24</span>]<span class="ot">=</span><span class="st">&quot;Cin_max&quot;</span></span>
<span id="cb107-398"><a href="#cb107-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-399"><a href="#cb107-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-400"><a href="#cb107-400" aria-hidden="true" tabindex="-1"></a><span class="co"># SAVE the Points (shapefile)</span></span>
<span id="cb107-401"><a href="#cb107-401" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/OUTPUTS/2_WARM_UP&quot;</span>)</span>
<span id="cb107-402"><a href="#cb107-402" aria-hidden="true" tabindex="-1"></a><span class="fu">writeOGR</span>(WARM_UP,<span class="st">&quot;.&quot;</span>, <span class="st">&quot;WARM_UP_County_AOI&quot;</span>, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="step-8-run-the-forward-phase-for-points-outside-the-cru-layer-script-15b" class="section level3 unnumbered">
<h3 class="unnumbered">Step 8 Run the Forward phase for points outside the CRU layer (Script 15B)</h3>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">#12/11/2020</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SPATIAL SOIL R  for VECTORS</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="co"># FOWARD SCENARIOS</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MSc Ing Agr Luciano E Di Paolo</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="co"># SOilR from Sierra, C.A., M. Mueller, S.E. Trumbore (2012). </span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Models of soil organic matter decomposition: the SoilR package, version 1.0 Geoscientific Model Development, 5(4), </span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="co">#1045--1060. URL http://www.geosci-model-dev.net/5/1045/2012/gmd-5-1045-2012.html.</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SoilR)</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilassessment)</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>WD_OUT<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/OUTPUTS/3_FOWARD&quot;</span>)</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>working_dir<span class="ot">&lt;-</span><span class="fu">setwd</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020&quot;</span>)</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a><span class="co"># OPEN THE VECTOR OF POINTS</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>Vector<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;INPUTS/TARGET_POINTS/AOI_Empty_points_borders.shp&quot;</span>)</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a><span class="co"># OPEN THE RESULT VECTOR FROM THE WARM UP PROCESS</span></span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>WARM_UP<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;OUTPUTS/2_WARM_UP/WARM_UP_County_AOI.shp&quot;</span>)</span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a><span class="co"># OPEN THE STACK WITH THE VARIABLES FOR THE FOWARD PROCESS</span></span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a>Stack_Set_1<span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;INPUTS/STACK/Stack_Set_FOWARD.tif&quot;</span>)</span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(Stack_Set_1)){</span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>  Stack_Set_1[[i]]<span class="ot">&lt;-</span><span class="fu">focal</span>(Stack_Set_1[[i]], <span class="at">w =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="dv">25</span>,<span class="dv">25</span>), <span class="at">fun=</span> mean,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">NAonly=</span><span class="cn">TRUE</span> , <span class="at">pad=</span><span class="cn">TRUE</span>)</span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the increase in Carbon input for each land use and each scenario</span></span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a><span class="co">#Crops and Crop trees</span></span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>Low_Crops<span class="ot">&lt;-</span><span class="fl">1.05</span></span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>Med_Crops<span class="ot">&lt;-</span><span class="fl">1.10</span></span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a>High_Crops<span class="ot">&lt;-</span><span class="fl">1.2</span></span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a><span class="co">#Shrublands, Grasslands , Herbaceous vegetation flooded &amp; Sparse Vegetation</span></span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>Low_Grass<span class="ot">&lt;-</span><span class="fl">1.05</span></span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a>Med_Grass<span class="ot">&lt;-</span><span class="fl">1.10</span></span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a>High_Grass<span class="ot">&lt;-</span><span class="fl">1.2</span></span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a><span class="co">#Paddy Fields</span></span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a>Low_PaddyFields<span class="ot">&lt;-</span><span class="fl">1.05</span></span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a>Med_PaddyFields<span class="ot">&lt;-</span><span class="fl">1.10</span></span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a>High_PaddyFields<span class="ot">&lt;-</span><span class="fl">1.2</span></span>
<span id="cb108-59"><a href="#cb108-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-60"><a href="#cb108-60" aria-hidden="true" tabindex="-1"></a><span class="co"># extract variables to points</span></span>
<span id="cb108-61"><a href="#cb108-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-62"><a href="#cb108-62" aria-hidden="true" tabindex="-1"></a>Variables<span class="ot">&lt;-</span><span class="fu">extract</span>(Stack_Set_1,Vector,<span class="at">sp=</span><span class="cn">TRUE</span>)</span>
<span id="cb108-63"><a href="#cb108-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-64"><a href="#cb108-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates an empty vector</span></span>
<span id="cb108-65"><a href="#cb108-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-66"><a href="#cb108-66" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="ot">&lt;-</span>Vector</span>
<span id="cb108-67"><a href="#cb108-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-68"><a href="#cb108-68" aria-hidden="true" tabindex="-1"></a><span class="co"># use it only for backup</span></span>
<span id="cb108-69"><a href="#cb108-69" aria-hidden="true" tabindex="-1"></a><span class="co">#FOWARD&lt;-readOGR(&quot;OUTPUTS/3_FOWARD/FOWARD_ARGENTINA_BSAS_17-04-2020_352671.shp&quot;)</span></span>
<span id="cb108-70"><a href="#cb108-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-71"><a href="#cb108-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the layers from the Vector</span></span>
<span id="cb108-72"><a href="#cb108-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-73"><a href="#cb108-73" aria-hidden="true" tabindex="-1"></a>SOC_im<span class="ot">&lt;-</span>WARM_UP[[<span class="dv">4</span>]]</span>
<span id="cb108-74"><a href="#cb108-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-75"><a href="#cb108-75" aria-hidden="true" tabindex="-1"></a>clay_im<span class="ot">&lt;-</span>Variables[[<span class="dv">3</span>]] </span>
<span id="cb108-76"><a href="#cb108-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-77"><a href="#cb108-77" aria-hidden="true" tabindex="-1"></a>Cinputs_im<span class="ot">&lt;-</span>WARM_UP[[<span class="dv">10</span>]]</span>
<span id="cb108-78"><a href="#cb108-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-79"><a href="#cb108-79" aria-hidden="true" tabindex="-1"></a>DR_im<span class="ot">&lt;-</span>Variables[[<span class="dv">40</span>]]</span>
<span id="cb108-80"><a href="#cb108-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-81"><a href="#cb108-81" aria-hidden="true" tabindex="-1"></a>LU_im<span class="ot">&lt;-</span>Variables[[<span class="dv">41</span>]]</span>
<span id="cb108-82"><a href="#cb108-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-83"><a href="#cb108-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the years to run the model</span></span>
<span id="cb108-84"><a href="#cb108-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-85"><a href="#cb108-85" aria-hidden="true" tabindex="-1"></a>years<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>,<span class="dv">20</span>,<span class="at">by=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb108-86"><a href="#cb108-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-87"><a href="#cb108-87" aria-hidden="true" tabindex="-1"></a><span class="co"># ROTH C MODEL FUNCTION . </span></span>
<span id="cb108-88"><a href="#cb108-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-89"><a href="#cb108-89" aria-hidden="true" tabindex="-1"></a><span class="do">#############function set up starts###############</span></span>
<span id="cb108-90"><a href="#cb108-90" aria-hidden="true" tabindex="-1"></a>Roth_C<span class="ot">&lt;-</span><span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1,LU)</span>
<span id="cb108-91"><a href="#cb108-91" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb108-92"><a href="#cb108-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Paddy Fields coefficent fPR = 0.4 if the target point is class = 13 , else fPR=1</span></span>
<span id="cb108-93"><a href="#cb108-93" aria-hidden="true" tabindex="-1"></a><span class="co"># From Shirato and Yukozawa 2004</span></span>
<span id="cb108-94"><a href="#cb108-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-95"><a href="#cb108-95" aria-hidden="true" tabindex="-1"></a>fPR<span class="ot">=</span>(LU <span class="sc">==</span> <span class="dv">13</span>)<span class="sc">*</span><span class="fl">0.4</span> <span class="sc">+</span> (LU<span class="sc">!=</span><span class="dv">13</span>)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb108-96"><a href="#cb108-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-97"><a href="#cb108-97" aria-hidden="true" tabindex="-1"></a><span class="co">#Temperature effects per month</span></span>
<span id="cb108-98"><a href="#cb108-98" aria-hidden="true" tabindex="-1"></a>fT<span class="ot">=</span><span class="fu">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span>
<span id="cb108-99"><a href="#cb108-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-100"><a href="#cb108-100" aria-hidden="true" tabindex="-1"></a><span class="co">#Moisture effects per month . </span></span>
<span id="cb108-101"><a href="#cb108-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-102"><a href="#cb108-102" aria-hidden="true" tabindex="-1"></a>fw1func<span class="ot">&lt;-</span><span class="cf">function</span>(P, E, <span class="at">S.Thick =</span> <span class="dv">30</span>, <span class="at">pClay =</span> <span class="fl">32.0213</span>, <span class="at">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb108-103"><a href="#cb108-103" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb108-104"><a href="#cb108-104" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb108-105"><a href="#cb108-105" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> P <span class="sc">-</span> E <span class="sc">*</span> pE</span>
<span id="cb108-106"><a href="#cb108-106" aria-hidden="true" tabindex="-1"></a>    Acc.TSMD <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb108-107"><a href="#cb108-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb108-108"><a href="#cb108-108" aria-hidden="true" tabindex="-1"></a>    B <span class="ot">=</span> <span class="fu">ifelse</span>(bare[i] <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb108-109"><a href="#cb108-109" aria-hidden="true" tabindex="-1"></a>     Max.TSMD <span class="ot">=</span> <span class="sc">-</span>(<span class="dv">20</span> <span class="sc">+</span> <span class="fl">1.3</span> <span class="sc">*</span> pClay <span class="sc">-</span> <span class="fl">0.01</span> <span class="sc">*</span> (pClay<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> (S.Thick<span class="sc">/</span><span class="dv">23</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>B)</span>
<span id="cb108-110"><a href="#cb108-110" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">ifelse</span>(M[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb108-111"><a href="#cb108-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i] <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb108-112"><a href="#cb108-112" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Acc.TSMD[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> M[i]</span>
<span id="cb108-113"><a href="#cb108-113" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb108-114"><a href="#cb108-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> (Acc.TSMD[i] <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb108-115"><a href="#cb108-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="sc">&lt;=</span> Max.TSMD) {</span>
<span id="cb108-116"><a href="#cb108-116" aria-hidden="true" tabindex="-1"></a>            Acc.TSMD[i] <span class="ot">=</span> Max.TSMD</span>
<span id="cb108-117"><a href="#cb108-117" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb108-118"><a href="#cb108-118" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb108-119"><a href="#cb108-119" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> <span class="fu">ifelse</span>(Acc.TSMD <span class="sc">&gt;</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> ((Max.TSMD <span class="sc">-</span> </span>
<span id="cb108-120"><a href="#cb108-120" aria-hidden="true" tabindex="-1"></a>        Acc.TSMD)<span class="sc">/</span>(Max.TSMD <span class="sc">-</span> <span class="fl">0.444</span> <span class="sc">*</span> Max.TSMD))))</span>
<span id="cb108-121"><a href="#cb108-121" aria-hidden="true" tabindex="-1"></a>    b<span class="ot">&lt;-</span><span class="fu">clamp</span>(b,<span class="at">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb108-122"><a href="#cb108-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(b))</span>
<span id="cb108-123"><a href="#cb108-123" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-124"><a href="#cb108-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-125"><a href="#cb108-125" aria-hidden="true" tabindex="-1"></a>fW_2<span class="ot">&lt;-</span> <span class="fu">fw1func</span>(<span class="at">P=</span>(Precip[,<span class="dv">2</span>]), <span class="at">E=</span>(Evp[,<span class="dv">2</span>]), <span class="at">S.Thick =</span> soil.thick, <span class="at">pClay =</span> clay, <span class="at">pE =</span> <span class="dv">1</span>, <span class="at">bare=</span>bare1)<span class="sc">$</span>b </span>
<span id="cb108-126"><a href="#cb108-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-127"><a href="#cb108-127" aria-hidden="true" tabindex="-1"></a><span class="co">#Vegetation Cover effects  </span></span>
<span id="cb108-128"><a href="#cb108-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-129"><a href="#cb108-129" aria-hidden="true" tabindex="-1"></a>fC<span class="ot">&lt;-</span>Cov2[,<span class="dv">2</span>]</span>
<span id="cb108-130"><a href="#cb108-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-131"><a href="#cb108-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb108-132"><a href="#cb108-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-133"><a href="#cb108-133" aria-hidden="true" tabindex="-1"></a>xi.frame<span class="ot">=</span><span class="fu">data.frame</span>(years,<span class="fu">rep</span>(fT<span class="sc">*</span>fW_2<span class="sc">*</span>fC<span class="sc">*</span>fPR,<span class="at">length.out=</span><span class="fu">length</span>(years)))</span>
<span id="cb108-134"><a href="#cb108-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-135"><a href="#cb108-135" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from SoilR</span></span>
<span id="cb108-136"><a href="#cb108-136" aria-hidden="true" tabindex="-1"></a><span class="co">#Loads the model </span></span>
<span id="cb108-137"><a href="#cb108-137" aria-hidden="true" tabindex="-1"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf[[1]], RPMptf[[1]], BIOptf[[1]], HUMptf[[1]], FallIOM[[1]]),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb108-138"><a href="#cb108-138" aria-hidden="true" tabindex="-1"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb108-139"><a href="#cb108-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-140"><a href="#cb108-140" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN THE MODEL from soilassesment</span></span>
<span id="cb108-141"><a href="#cb108-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-142"><a href="#cb108-142" aria-hidden="true" tabindex="-1"></a>Model3_spin<span class="ot">=</span><span class="fu">carbonTurnover</span>(<span class="at">tt=</span>years,<span class="at">C0=</span><span class="fu">c</span>(DPMptf[[<span class="dv">1</span>]], RPMptf[[<span class="dv">1</span>]], BIOptf[[<span class="dv">1</span>]], HUMptf[[<span class="dv">1</span>]], FallIOM[[<span class="dv">1</span>]]),<span class="at">In=</span>Cinputs,<span class="at">Dr=</span>DR,<span class="at">clay=</span>clay,<span class="at">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb108-143"><a href="#cb108-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-144"><a href="#cb108-144" aria-hidden="true" tabindex="-1"></a>Ct3_spin<span class="ot">=</span>Model3_spin[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb108-145"><a href="#cb108-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-146"><a href="#cb108-146" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb108-147"><a href="#cb108-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-148"><a href="#cb108-148" aria-hidden="true" tabindex="-1"></a>poolSize3_spin<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb108-149"><a href="#cb108-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-150"><a href="#cb108-150" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(poolSize3_spin)</span>
<span id="cb108-151"><a href="#cb108-151" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-152"><a href="#cb108-152" aria-hidden="true" tabindex="-1"></a><span class="do">################function set up ends#############</span></span>
<span id="cb108-153"><a href="#cb108-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-154"><a href="#cb108-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-155"><a href="#cb108-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterates over the area of interest</span></span>
<span id="cb108-156"><a href="#cb108-156" aria-hidden="true" tabindex="-1"></a><span class="do">##################for loop starts###############</span></span>
<span id="cb108-157"><a href="#cb108-157" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Variables)[<span class="dv">1</span>]) {</span>
<span id="cb108-158"><a href="#cb108-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-159"><a href="#cb108-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the variables </span></span>
<span id="cb108-160"><a href="#cb108-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-161"><a href="#cb108-161" aria-hidden="true" tabindex="-1"></a>Vect<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Variables[i,])</span>
<span id="cb108-162"><a href="#cb108-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-163"><a href="#cb108-163" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">4</span><span class="sc">:</span><span class="dv">15</span>]))</span>
<span id="cb108-164"><a href="#cb108-164" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Temp=</span>Temp[,<span class="dv">1</span>])</span>
<span id="cb108-165"><a href="#cb108-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-166"><a href="#cb108-166" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">16</span><span class="sc">:</span><span class="dv">27</span>]))</span>
<span id="cb108-167"><a href="#cb108-167" aria-hidden="true" tabindex="-1"></a>Precip<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Precip=</span>Precip[,<span class="dv">1</span>])</span>
<span id="cb108-168"><a href="#cb108-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-169"><a href="#cb108-169" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">28</span><span class="sc">:</span><span class="dv">39</span>]))</span>
<span id="cb108-170"><a href="#cb108-170" aria-hidden="true" tabindex="-1"></a>Evp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Evp=</span>Evp[,<span class="dv">1</span>])</span>
<span id="cb108-171"><a href="#cb108-171" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-172"><a href="#cb108-172" aria-hidden="true" tabindex="-1"></a>Cov<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(Vect[<span class="dv">42</span><span class="sc">:</span><span class="dv">53</span>]))</span>
<span id="cb108-173"><a href="#cb108-173" aria-hidden="true" tabindex="-1"></a>Cov1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb108-174"><a href="#cb108-174" aria-hidden="true" tabindex="-1"></a>Cov2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Month=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb108-175"><a href="#cb108-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-176"><a href="#cb108-176" aria-hidden="true" tabindex="-1"></a><span class="co">#Avoid calculus over Na values </span></span>
<span id="cb108-177"><a href="#cb108-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-178"><a href="#cb108-178" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(Evp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Temp[,<span class="dv">2</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(SOC_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(clay_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Precip[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov2[,<span class="dv">2</span>]))  <span class="sc">|</span>  <span class="fu">any</span>(<span class="fu">is.na</span>(Cov1[,<span class="dv">1</span>])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(Cinputs_im[i])) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(DR_im[i])) <span class="sc">|</span> (Cinputs_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span>  (SOC_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">|</span> (clay_im[i]<span class="sc">&lt;</span><span class="dv">0</span>) ) {FOWARD[i,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">0</span>}<span class="cf">else</span>{</span>
<span id="cb108-179"><a href="#cb108-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-180"><a href="#cb108-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-181"><a href="#cb108-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the variables from the images</span></span>
<span id="cb108-182"><a href="#cb108-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-183"><a href="#cb108-183" aria-hidden="true" tabindex="-1"></a>soil.thick<span class="ot">=</span><span class="dv">30</span>  <span class="co">#Soil thickness (organic layer topsoil), in cm</span></span>
<span id="cb108-184"><a href="#cb108-184" aria-hidden="true" tabindex="-1"></a>SOC<span class="ot">&lt;-</span>SOC_im[i]      <span class="co">#Soil organic carbon in Mg/ha </span></span>
<span id="cb108-185"><a href="#cb108-185" aria-hidden="true" tabindex="-1"></a>clay<span class="ot">&lt;-</span>clay_im[i]        <span class="co">#Percent clay %</span></span>
<span id="cb108-186"><a href="#cb108-186" aria-hidden="true" tabindex="-1"></a>Cinputs<span class="ot">&lt;-</span>Cinputs_im[i]    <span class="co">#Annual C inputs to soil in Mg/ha/yr</span></span>
<span id="cb108-187"><a href="#cb108-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-188"><a href="#cb108-188" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>DR_im[i]              <span class="co"># DPM/RPM (decomplosable vs resistant plant material.)</span></span>
<span id="cb108-189"><a href="#cb108-189" aria-hidden="true" tabindex="-1"></a>bare1<span class="ot">&lt;-</span>(Cov1<span class="sc">&gt;</span><span class="fl">0.8</span>)           <span class="co"># If the surface is bare or vegetated</span></span>
<span id="cb108-190"><a href="#cb108-190" aria-hidden="true" tabindex="-1"></a>LU<span class="ot">&lt;-</span>LU_im[i]</span>
<span id="cb108-191"><a href="#cb108-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-192"><a href="#cb108-192" aria-hidden="true" tabindex="-1"></a><span class="co"># Final calculation of SOC  20 years in the future  (Business as usual)</span></span>
<span id="cb108-193"><a href="#cb108-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-194"><a href="#cb108-194" aria-hidden="true" tabindex="-1"></a>f_bau<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs,<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-195"><a href="#cb108-195" aria-hidden="true" tabindex="-1"></a>f_bau_t<span class="ot">&lt;-</span>f_bau[<span class="dv">1</span>]<span class="sc">+</span>f_bau[<span class="dv">2</span>]<span class="sc">+</span>f_bau[<span class="dv">3</span>]<span class="sc">+</span>f_bau[<span class="dv">4</span>]<span class="sc">+</span>f_bau[<span class="dv">5</span>]</span>
<span id="cb108-196"><a href="#cb108-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-197"><a href="#cb108-197" aria-hidden="true" tabindex="-1"></a><span class="co">#Unc BAU minimum </span></span>
<span id="cb108-198"><a href="#cb108-198" aria-hidden="true" tabindex="-1"></a>Cinputs_min<span class="ot">&lt;-</span>WARM_UP<span class="sc">@</span>data[i,<span class="dv">23</span>]</span>
<span id="cb108-199"><a href="#cb108-199" aria-hidden="true" tabindex="-1"></a>Cinputs_max<span class="ot">&lt;-</span>WARM_UP<span class="sc">@</span>data[i,<span class="dv">24</span>]</span>
<span id="cb108-200"><a href="#cb108-200" aria-hidden="true" tabindex="-1"></a>SOC_t0_min<span class="ot">&lt;-</span>WARM_UP<span class="sc">@</span>data[i,<span class="dv">11</span>]</span>
<span id="cb108-201"><a href="#cb108-201" aria-hidden="true" tabindex="-1"></a>SOC_t0_max<span class="ot">&lt;-</span>WARM_UP<span class="sc">@</span>data[i,<span class="dv">17</span>]</span>
<span id="cb108-202"><a href="#cb108-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-203"><a href="#cb108-203" aria-hidden="true" tabindex="-1"></a>f_bau_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_min,<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-204"><a href="#cb108-204" aria-hidden="true" tabindex="-1"></a>f_bau_t_min<span class="ot">&lt;-</span>f_bau_min[<span class="dv">1</span>]<span class="sc">+</span>f_bau_min[<span class="dv">2</span>]<span class="sc">+</span>f_bau_min[<span class="dv">3</span>]<span class="sc">+</span>f_bau_min[<span class="dv">4</span>]<span class="sc">+</span>f_bau_min[<span class="dv">5</span>]</span>
<span id="cb108-205"><a href="#cb108-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-206"><a href="#cb108-206" aria-hidden="true" tabindex="-1"></a><span class="co">#Unc BAU maximum</span></span>
<span id="cb108-207"><a href="#cb108-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-208"><a href="#cb108-208" aria-hidden="true" tabindex="-1"></a>f_bau_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>Cinputs_max,<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-209"><a href="#cb108-209" aria-hidden="true" tabindex="-1"></a>f_bau_t_max<span class="ot">&lt;-</span>f_bau_max[<span class="dv">1</span>]<span class="sc">+</span>f_bau_max[<span class="dv">2</span>]<span class="sc">+</span>f_bau_max[<span class="dv">3</span>]<span class="sc">+</span>f_bau_max[<span class="dv">4</span>]<span class="sc">+</span>f_bau_max[<span class="dv">5</span>]</span>
<span id="cb108-210"><a href="#cb108-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-211"><a href="#cb108-211" aria-hidden="true" tabindex="-1"></a><span class="co"># Crops and Tree crops</span></span>
<span id="cb108-212"><a href="#cb108-212" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (LU<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">12</span>){</span>
<span id="cb108-213"><a href="#cb108-213" aria-hidden="true" tabindex="-1"></a>f_low<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Low_Crops),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-214"><a href="#cb108-214" aria-hidden="true" tabindex="-1"></a>f_low_t<span class="ot">&lt;-</span>f_low[<span class="dv">1</span>]<span class="sc">+</span>f_low[<span class="dv">2</span>]<span class="sc">+</span>f_low[<span class="dv">3</span>]<span class="sc">+</span>f_low[<span class="dv">4</span>]<span class="sc">+</span>f_low[<span class="dv">5</span>]</span>
<span id="cb108-215"><a href="#cb108-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-216"><a href="#cb108-216" aria-hidden="true" tabindex="-1"></a>f_med<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Med_Crops),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-217"><a href="#cb108-217" aria-hidden="true" tabindex="-1"></a>f_med_t<span class="ot">&lt;-</span>f_med[<span class="dv">1</span>]<span class="sc">+</span>f_med[<span class="dv">2</span>]<span class="sc">+</span>f_med[<span class="dv">3</span>]<span class="sc">+</span>f_med[<span class="dv">4</span>]<span class="sc">+</span>f_med[<span class="dv">5</span>]</span>
<span id="cb108-218"><a href="#cb108-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-219"><a href="#cb108-219" aria-hidden="true" tabindex="-1"></a>f_high<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>High_Crops),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-220"><a href="#cb108-220" aria-hidden="true" tabindex="-1"></a>f_high_t<span class="ot">&lt;-</span>f_high[<span class="dv">1</span>]<span class="sc">+</span>f_high[<span class="dv">2</span>]<span class="sc">+</span>f_high[<span class="dv">3</span>]<span class="sc">+</span>f_high[<span class="dv">4</span>]<span class="sc">+</span>f_high[<span class="dv">5</span>]</span>
<span id="cb108-221"><a href="#cb108-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-222"><a href="#cb108-222" aria-hidden="true" tabindex="-1"></a><span class="co"># SSM croplands unc min</span></span>
<span id="cb108-223"><a href="#cb108-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-224"><a href="#cb108-224" aria-hidden="true" tabindex="-1"></a>f_med_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_min<span class="sc">*</span>(Med_Crops<span class="fl">-0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-225"><a href="#cb108-225" aria-hidden="true" tabindex="-1"></a>f_med_t_min<span class="ot">&lt;-</span>f_med_min[<span class="dv">1</span>]<span class="sc">+</span>f_med_min[<span class="dv">2</span>]<span class="sc">+</span>f_med_min[<span class="dv">3</span>]<span class="sc">+</span>f_med_min[<span class="dv">4</span>]<span class="sc">+</span>f_med_min[<span class="dv">5</span>]</span>
<span id="cb108-226"><a href="#cb108-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-227"><a href="#cb108-227" aria-hidden="true" tabindex="-1"></a><span class="co"># SSM croplands unc max</span></span>
<span id="cb108-228"><a href="#cb108-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-229"><a href="#cb108-229" aria-hidden="true" tabindex="-1"></a>f_med_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_max<span class="sc">*</span>(Med_Crops<span class="fl">+0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-230"><a href="#cb108-230" aria-hidden="true" tabindex="-1"></a>f_med_t_max<span class="ot">&lt;-</span>f_med_max[<span class="dv">1</span>]<span class="sc">+</span>f_med_max[<span class="dv">2</span>]<span class="sc">+</span>f_med_max[<span class="dv">3</span>]<span class="sc">+</span>f_med_max[<span class="dv">4</span>]<span class="sc">+</span>f_med_max[<span class="dv">5</span>]</span>
<span id="cb108-231"><a href="#cb108-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-232"><a href="#cb108-232" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-233"><a href="#cb108-233" aria-hidden="true" tabindex="-1"></a><span class="co">#Shrublands, grasslands, and sparce vegetation</span></span>
<span id="cb108-234"><a href="#cb108-234" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> (LU<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU<span class="sc">==</span><span class="dv">8</span>) {</span>
<span id="cb108-235"><a href="#cb108-235" aria-hidden="true" tabindex="-1"></a>f_low<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Low_Grass),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-236"><a href="#cb108-236" aria-hidden="true" tabindex="-1"></a>f_low_t<span class="ot">&lt;-</span>f_low[<span class="dv">1</span>]<span class="sc">+</span>f_low[<span class="dv">2</span>]<span class="sc">+</span>f_low[<span class="dv">3</span>]<span class="sc">+</span>f_low[<span class="dv">4</span>]<span class="sc">+</span>f_low[<span class="dv">5</span>]</span>
<span id="cb108-237"><a href="#cb108-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-238"><a href="#cb108-238" aria-hidden="true" tabindex="-1"></a>f_med<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Med_Grass),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-239"><a href="#cb108-239" aria-hidden="true" tabindex="-1"></a>f_med_t<span class="ot">&lt;-</span>f_med[<span class="dv">1</span>]<span class="sc">+</span>f_med[<span class="dv">2</span>]<span class="sc">+</span>f_med[<span class="dv">3</span>]<span class="sc">+</span>f_med[<span class="dv">4</span>]<span class="sc">+</span>f_med[<span class="dv">5</span>]</span>
<span id="cb108-240"><a href="#cb108-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-241"><a href="#cb108-241" aria-hidden="true" tabindex="-1"></a>f_high<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>High_Grass),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-242"><a href="#cb108-242" aria-hidden="true" tabindex="-1"></a>f_high_t<span class="ot">&lt;-</span>f_high[<span class="dv">1</span>]<span class="sc">+</span>f_high[<span class="dv">2</span>]<span class="sc">+</span>f_high[<span class="dv">3</span>]<span class="sc">+</span>f_high[<span class="dv">4</span>]<span class="sc">+</span>f_high[<span class="dv">5</span>]</span>
<span id="cb108-243"><a href="#cb108-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-244"><a href="#cb108-244" aria-hidden="true" tabindex="-1"></a><span class="co">#SSM Shrublands unc min</span></span>
<span id="cb108-245"><a href="#cb108-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-246"><a href="#cb108-246" aria-hidden="true" tabindex="-1"></a>f_med_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_min<span class="sc">*</span>(Med_Grass<span class="fl">-0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-247"><a href="#cb108-247" aria-hidden="true" tabindex="-1"></a>f_med_t_min<span class="ot">&lt;-</span>f_med_min[<span class="dv">1</span>]<span class="sc">+</span>f_med_min[<span class="dv">2</span>]<span class="sc">+</span>f_med_min[<span class="dv">3</span>]<span class="sc">+</span>f_med_min[<span class="dv">4</span>]<span class="sc">+</span>f_med_min[<span class="dv">5</span>]</span>
<span id="cb108-248"><a href="#cb108-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-249"><a href="#cb108-249" aria-hidden="true" tabindex="-1"></a><span class="co">#SSM Shrublands unc max</span></span>
<span id="cb108-250"><a href="#cb108-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-251"><a href="#cb108-251" aria-hidden="true" tabindex="-1"></a>f_med_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_max<span class="sc">*</span>(Med_Grass<span class="fl">+0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-252"><a href="#cb108-252" aria-hidden="true" tabindex="-1"></a>f_med_t_max<span class="ot">&lt;-</span>f_med_max[<span class="dv">1</span>]<span class="sc">+</span>f_med_max[<span class="dv">2</span>]<span class="sc">+</span>f_med_max[<span class="dv">3</span>]<span class="sc">+</span>f_med_max[<span class="dv">4</span>]<span class="sc">+</span>f_med_max[<span class="dv">5</span>]</span>
<span id="cb108-253"><a href="#cb108-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-254"><a href="#cb108-254" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-255"><a href="#cb108-255" aria-hidden="true" tabindex="-1"></a><span class="co"># Paddy Fields </span></span>
<span id="cb108-256"><a href="#cb108-256" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> (LU<span class="sc">==</span><span class="dv">13</span>) {</span>
<span id="cb108-257"><a href="#cb108-257" aria-hidden="true" tabindex="-1"></a>f_low<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Low_PaddyFields),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-258"><a href="#cb108-258" aria-hidden="true" tabindex="-1"></a>f_low_t<span class="ot">&lt;-</span>f_low[<span class="dv">1</span>]<span class="sc">+</span>f_low[<span class="dv">2</span>]<span class="sc">+</span>f_low[<span class="dv">3</span>]<span class="sc">+</span>f_low[<span class="dv">4</span>]<span class="sc">+</span>f_low[<span class="dv">5</span>]</span>
<span id="cb108-259"><a href="#cb108-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-260"><a href="#cb108-260" aria-hidden="true" tabindex="-1"></a>f_med<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>Med_PaddyFields),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-261"><a href="#cb108-261" aria-hidden="true" tabindex="-1"></a>f_med_t<span class="ot">&lt;-</span>f_med[<span class="dv">1</span>]<span class="sc">+</span>f_med[<span class="dv">2</span>]<span class="sc">+</span>f_med[<span class="dv">3</span>]<span class="sc">+</span>f_med[<span class="dv">4</span>]<span class="sc">+</span>f_med[<span class="dv">5</span>]</span>
<span id="cb108-262"><a href="#cb108-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-263"><a href="#cb108-263" aria-hidden="true" tabindex="-1"></a>f_high<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs<span class="sc">*</span>High_PaddyFields),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="at">Temp=</span>Temp,<span class="at">Precip=</span>Precip,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC,<span class="at">clay=</span>clay,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-264"><a href="#cb108-264" aria-hidden="true" tabindex="-1"></a>f_high_t<span class="ot">&lt;-</span>f_high[<span class="dv">1</span>]<span class="sc">+</span>f_high[<span class="dv">2</span>]<span class="sc">+</span>f_high[<span class="dv">3</span>]<span class="sc">+</span>f_high[<span class="dv">4</span>]<span class="sc">+</span>f_high[<span class="dv">5</span>]</span>
<span id="cb108-265"><a href="#cb108-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-266"><a href="#cb108-266" aria-hidden="true" tabindex="-1"></a><span class="co">#SSM Forest unc min</span></span>
<span id="cb108-267"><a href="#cb108-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-268"><a href="#cb108-268" aria-hidden="true" tabindex="-1"></a>f_med_min<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_min<span class="sc">*</span>(Med_PaddyFields<span class="fl">-0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">1.02</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">0.95</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">0.8</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">0.9</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-269"><a href="#cb108-269" aria-hidden="true" tabindex="-1"></a>f_med_t_min<span class="ot">&lt;-</span>f_med_min[<span class="dv">1</span>]<span class="sc">+</span>f_med_min[<span class="dv">2</span>]<span class="sc">+</span>f_med_min[<span class="dv">3</span>]<span class="sc">+</span>f_med_min[<span class="dv">4</span>]<span class="sc">+</span>f_med_min[<span class="dv">5</span>]</span>
<span id="cb108-270"><a href="#cb108-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-271"><a href="#cb108-271" aria-hidden="true" tabindex="-1"></a><span class="co">#SSM Forest unc max</span></span>
<span id="cb108-272"><a href="#cb108-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-273"><a href="#cb108-273" aria-hidden="true" tabindex="-1"></a>f_med_max<span class="ot">&lt;-</span><span class="fu">Roth_C</span>(<span class="at">Cinputs=</span>(Cinputs_max<span class="sc">*</span>(Med_PaddyFields<span class="fl">+0.15</span>)),<span class="at">years=</span>years,<span class="at">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="at">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="at">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="at">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="at">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="at">Temp=</span>Temp<span class="sc">*</span><span class="fl">0.98</span>,<span class="at">Precip=</span>Precip<span class="sc">*</span><span class="fl">1.05</span>,<span class="at">Evp=</span>Evp,<span class="at">Cov=</span>Cov,<span class="at">Cov1=</span>Cov1,<span class="at">Cov2=</span>Cov2,<span class="at">soil.thick=</span>soil.thick,<span class="at">SOC=</span>SOC<span class="sc">*</span><span class="fl">1.2</span>,<span class="at">clay=</span>clay<span class="sc">*</span><span class="fl">1.1</span>,<span class="at">DR=</span>DR,<span class="at">bare1=</span>bare1,<span class="at">LU=</span>LU)</span>
<span id="cb108-274"><a href="#cb108-274" aria-hidden="true" tabindex="-1"></a>f_med_t_max<span class="ot">&lt;-</span>f_med_max[<span class="dv">1</span>]<span class="sc">+</span>f_med_max[<span class="dv">2</span>]<span class="sc">+</span>f_med_max[<span class="dv">3</span>]<span class="sc">+</span>f_med_max[<span class="dv">4</span>]<span class="sc">+</span>f_med_max[<span class="dv">5</span>]</span>
<span id="cb108-275"><a href="#cb108-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-276"><a href="#cb108-276" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-277"><a href="#cb108-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-278"><a href="#cb108-278" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>{</span>
<span id="cb108-279"><a href="#cb108-279" aria-hidden="true" tabindex="-1"></a>f_bau_t<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb108-280"><a href="#cb108-280" aria-hidden="true" tabindex="-1"></a>f_low_t<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb108-281"><a href="#cb108-281" aria-hidden="true" tabindex="-1"></a>f_med_t<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb108-282"><a href="#cb108-282" aria-hidden="true" tabindex="-1"></a>f_high_t<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb108-283"><a href="#cb108-283" aria-hidden="true" tabindex="-1"></a>f_bau_t_min<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb108-284"><a href="#cb108-284" aria-hidden="true" tabindex="-1"></a>f_bau_t_max<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb108-285"><a href="#cb108-285" aria-hidden="true" tabindex="-1"></a>f_med_t_min<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb108-286"><a href="#cb108-286" aria-hidden="true" tabindex="-1"></a>f_med_t_max<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb108-287"><a href="#cb108-287" aria-hidden="true" tabindex="-1"></a>SOC_t0_min<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb108-288"><a href="#cb108-288" aria-hidden="true" tabindex="-1"></a>SOC_t0_max<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb108-289"><a href="#cb108-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-290"><a href="#cb108-290" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-291"><a href="#cb108-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-292"><a href="#cb108-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-293"><a href="#cb108-293" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">2</span>]<span class="ot">&lt;-</span>SOC</span>
<span id="cb108-294"><a href="#cb108-294" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">3</span>]<span class="ot">&lt;-</span>f_bau_t</span>
<span id="cb108-295"><a href="#cb108-295" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">4</span>]<span class="ot">&lt;-</span>f_bau[<span class="dv">1</span>]</span>
<span id="cb108-296"><a href="#cb108-296" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">5</span>]<span class="ot">&lt;-</span>f_bau[<span class="dv">2</span>]</span>
<span id="cb108-297"><a href="#cb108-297" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">6</span>]<span class="ot">&lt;-</span>f_bau[<span class="dv">3</span>]</span>
<span id="cb108-298"><a href="#cb108-298" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">7</span>]<span class="ot">&lt;-</span>f_bau[<span class="dv">4</span>]</span>
<span id="cb108-299"><a href="#cb108-299" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">8</span>]<span class="ot">&lt;-</span>f_bau[<span class="dv">5</span>]</span>
<span id="cb108-300"><a href="#cb108-300" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">9</span>]<span class="ot">&lt;-</span>LU</span>
<span id="cb108-301"><a href="#cb108-301" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">10</span>]<span class="ot">&lt;-</span>f_low_t</span>
<span id="cb108-302"><a href="#cb108-302" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">11</span>]<span class="ot">&lt;-</span>f_med_t</span>
<span id="cb108-303"><a href="#cb108-303" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">12</span>]<span class="ot">&lt;-</span>f_high_t</span>
<span id="cb108-304"><a href="#cb108-304" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">13</span>]<span class="ot">&lt;-</span>f_bau_t_min</span>
<span id="cb108-305"><a href="#cb108-305" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">14</span>]<span class="ot">&lt;-</span>f_bau_t_max</span>
<span id="cb108-306"><a href="#cb108-306" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">15</span>]<span class="ot">&lt;-</span>f_med_t_min</span>
<span id="cb108-307"><a href="#cb108-307" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">16</span>]<span class="ot">&lt;-</span>f_med_t_max</span>
<span id="cb108-308"><a href="#cb108-308" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">17</span>]<span class="ot">&lt;-</span>SOC_t0_min</span>
<span id="cb108-309"><a href="#cb108-309" aria-hidden="true" tabindex="-1"></a>FOWARD[i,<span class="dv">18</span>]<span class="ot">&lt;-</span>SOC_t0_max</span>
<span id="cb108-310"><a href="#cb108-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-311"><a href="#cb108-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-312"><a href="#cb108-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-313"><a href="#cb108-313" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(i,SOC,f_bau_t,f_low_t,f_med_t,f_high_t,f_bau_t_min,f_bau_t_max))</span>
<span id="cb108-314"><a href="#cb108-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-315"><a href="#cb108-315" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-316"><a href="#cb108-316" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-317"><a href="#cb108-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-318"><a href="#cb108-318" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop ends##############</span></span>
<span id="cb108-319"><a href="#cb108-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-320"><a href="#cb108-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-321"><a href="#cb108-321" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0&quot;</span></span>
<span id="cb108-322"><a href="#cb108-322" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">&quot;SOC_BAU_20&quot;</span></span>
<span id="cb108-323"><a href="#cb108-323" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">&quot;DPM_BAU_20&quot;</span></span>
<span id="cb108-324"><a href="#cb108-324" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">5</span>]<span class="ot">=</span><span class="st">&quot;RPM_BAU_20&quot;</span></span>
<span id="cb108-325"><a href="#cb108-325" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">6</span>]<span class="ot">=</span><span class="st">&quot;BIO_BAU_20&quot;</span></span>
<span id="cb108-326"><a href="#cb108-326" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">7</span>]<span class="ot">=</span><span class="st">&quot;HUM_BAU_20&quot;</span></span>
<span id="cb108-327"><a href="#cb108-327" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">8</span>]<span class="ot">=</span><span class="st">&quot;IOM_BAU_20&quot;</span></span>
<span id="cb108-328"><a href="#cb108-328" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">9</span>]<span class="ot">=</span><span class="st">&quot;LandUse&quot;</span></span>
<span id="cb108-329"><a href="#cb108-329" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">10</span>]<span class="ot">=</span><span class="st">&quot;Low_Scenario&quot;</span></span>
<span id="cb108-330"><a href="#cb108-330" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">11</span>]<span class="ot">=</span><span class="st">&quot;Med_Scenario&quot;</span></span>
<span id="cb108-331"><a href="#cb108-331" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">12</span>]<span class="ot">=</span><span class="st">&quot;High_Scenario&quot;</span></span>
<span id="cb108-332"><a href="#cb108-332" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">13</span>]<span class="ot">=</span><span class="st">&quot;SOC_BAU_20_min&quot;</span></span>
<span id="cb108-333"><a href="#cb108-333" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">14</span>]<span class="ot">=</span><span class="st">&quot;SOC_BAU_20_max&quot;</span></span>
<span id="cb108-334"><a href="#cb108-334" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">15</span>]<span class="ot">=</span><span class="st">&quot;Med_Scen_min&quot;</span></span>
<span id="cb108-335"><a href="#cb108-335" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">16</span>]<span class="ot">=</span><span class="st">&quot;Med_Scen_max&quot;</span></span>
<span id="cb108-336"><a href="#cb108-336" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">17</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0_min&quot;</span></span>
<span id="cb108-337"><a href="#cb108-337" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">18</span>]<span class="ot">=</span><span class="st">&quot;SOC_t0_max&quot;</span></span>
<span id="cb108-338"><a href="#cb108-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-339"><a href="#cb108-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-340"><a href="#cb108-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-341"><a href="#cb108-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminate  values out of range</span></span>
<span id="cb108-342"><a href="#cb108-342" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20[FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-343"><a href="#cb108-343" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Low_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Low_Scenario<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-344"><a href="#cb108-344" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scenario<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-345"><a href="#cb108-345" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>High_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>High_Scenario<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-346"><a href="#cb108-346" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_min[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_min<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-347"><a href="#cb108-347" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_max[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_max<span class="sc">&lt;</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-348"><a href="#cb108-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-349"><a href="#cb108-349" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20[FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-350"><a href="#cb108-350" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Low_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Low_Scenario<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-351"><a href="#cb108-351" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scenario<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-352"><a href="#cb108-352" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>High_Scenario[FOWARD<span class="sc">@</span>data<span class="sc">$</span>High_Scenario<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-353"><a href="#cb108-353" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_min[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_min<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-354"><a href="#cb108-354" aria-hidden="true" tabindex="-1"></a>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_max[FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_max<span class="sc">&gt;</span><span class="dv">300</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb108-355"><a href="#cb108-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-356"><a href="#cb108-356" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the working directory </span></span>
<span id="cb108-357"><a href="#cb108-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-358"><a href="#cb108-358" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_OUT)</span>
<span id="cb108-359"><a href="#cb108-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-360"><a href="#cb108-360" aria-hidden="true" tabindex="-1"></a><span class="co"># UNCERTAINTIES</span></span>
<span id="cb108-361"><a href="#cb108-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-362"><a href="#cb108-362" aria-hidden="true" tabindex="-1"></a>UNC_SOC<span class="ot">&lt;-</span>((FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20_max<span class="sc">-</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20_min)<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_BAU_20))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb108-363"><a href="#cb108-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-364"><a href="#cb108-364" aria-hidden="true" tabindex="-1"></a>UNC_t0<span class="ot">&lt;-</span>((FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_t0_max<span class="sc">-</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_t0_min)<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>SOC_t0))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb108-365"><a href="#cb108-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-366"><a href="#cb108-366" aria-hidden="true" tabindex="-1"></a>UNC_SSM<span class="ot">&lt;-</span>((FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_max<span class="sc">-</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scen_min)<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>FOWARD<span class="sc">@</span>data<span class="sc">$</span>Med_Scenario))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb108-367"><a href="#cb108-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-368"><a href="#cb108-368" aria-hidden="true" tabindex="-1"></a>FOWARD[[<span class="dv">19</span>]]<span class="ot">&lt;-</span>UNC_SOC</span>
<span id="cb108-369"><a href="#cb108-369" aria-hidden="true" tabindex="-1"></a>FOWARD[[<span class="dv">20</span>]]<span class="ot">&lt;-</span>UNC_t0</span>
<span id="cb108-370"><a href="#cb108-370" aria-hidden="true" tabindex="-1"></a>FOWARD[[<span class="dv">21</span>]]<span class="ot">&lt;-</span>UNC_SSM</span>
<span id="cb108-371"><a href="#cb108-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-372"><a href="#cb108-372" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">19</span>]<span class="ot">=</span><span class="st">&quot;UNC_BAU&quot;</span></span>
<span id="cb108-373"><a href="#cb108-373" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">20</span>]<span class="ot">=</span><span class="st">&quot;UNC_t0&quot;</span></span>
<span id="cb108-374"><a href="#cb108-374" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FOWARD<span class="sc">@</span>data)[<span class="dv">21</span>]<span class="ot">=</span><span class="st">&quot;UNC_SSM&quot;</span></span>
<span id="cb108-375"><a href="#cb108-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-376"><a href="#cb108-376" aria-hidden="true" tabindex="-1"></a><span class="co"># SAVE the Points (shapefile)</span></span>
<span id="cb108-377"><a href="#cb108-377" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb108-378"><a href="#cb108-378" aria-hidden="true" tabindex="-1"></a><span class="fu">writeOGR</span>(FOWARD, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;FOWARD_County_AOI&quot;</span>, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>) </span></code></pre></div>
</div>
</div>
<div id="common-errors-and-considerations" class="section level2 unnumbered">
<h2 class="unnumbered">Common errors and considerations</h2>
<p>The following section provides an overview of common issues and potential solutions.</p>
<ol style="list-style-type: decimal">
<li>SOC stocks at T<sub>0</sub>, Final SOC stocks, and Sequestration Rates with significantly lower values than expected (refer to section 16.1)</li>
</ol>
<p>→ <em>Possible reason &amp; solution:</em> The SOC and Clay layer were in the wrong unit (e.g. the input SOC layer was in kg/m<sup>2</sup> instead of t/ha and Clay was in g/kg instead of %). The units need to be corrected and the whole process has to be repeated.</p>
<ol start="2" style="list-style-type: decimal">
<li>High % of -999 values, negative/positive values outside the expected ranges that do not show a clear dispersion pattern</li>
</ol>
<p>→ <em>Possible reason &amp; solution:</em> The input data was missing for several pixels, and/or the differential equations calculated with the “euler” method did not generate results. If these values do not exceed 10% of all pixel values and are dispersed without any clear pattern they can be simply masked out.</p>
<ol start="3" style="list-style-type: decimal">
<li>More than 10 % of clustered <em>No data values</em> (values equal to -999) and negative/positive values outside the expected ranges</li>
</ol>
<p>→ <em>Possible reason &amp; solution:</em> Potential errors in the input data e.g. missing values and/or wrong units are present. Additionally, errors can occur due to potential model limitations including:</p>
<ul>
<li>Model limitations when simulating changes in soils with high initial SOC content (&gt;200 t/ha);</li>
<li>Model limitations when simulating changes in soils with high clay content (&gt;50% clay).</li>
<li>Model limitations when simulating changes in tropical conditions.</li>
</ul>
<p>If more than 10% of the modeled area shows no values, the procedure should be re-run using the “lsoda” method in the SoilR package to solve the differential equations in scripts 13 to 15. For more information on the limitations of the RothC model please refer to chapter 14.</p>
<ol start="4" style="list-style-type: decimal">
<li>Very high uncertainty values
→ <em>Possible reason &amp; solution:</em> Minimum and maximum values used for the various input layers (e.g. GSOCmap, Clay, Temperature and Precipitation) when running the model should be checked. They should represent the upper and lower limits of the 95 % confidence interval. For more information on the approach used for the estimation of uncertainty please refer to chapter 12.</li>
</ol>
</div>
</div>
<div id="annex-ii-quality-assurance-and-quality-control" class="section level1 unnumbered">
<h1 class="unnumbered">Annex II Quality assurance and quality control</h1>
<p>The following protocol was devised to provide National Experts with a step-by-step guideline to perform a Quality Assurance (QA) and Quality Control (QC) of the 29 GSOCseq products that result from the proposed methodology.</p>
<p>The following protocol does not provide any guidance in terms of uncertainty estimation and validation. For more details and information on the estimation of uncertainties and potential map validation strategies please refer to Chapter 12.</p>
<p>Quality assurance and quality control consist of activities to ensure the quality of a particular result. Quality control is a reactive process that focuses on
identifying defects and errors while quality assurance is a proactive approach aimed at preventing defects and errors. In the context of digital soil mapping, both processes are often interlinked. A QA is interlinked with a QC when it identifies defects and the QA remodels the process to eliminate the defects and prevent them from recurring (Chapman, 2005)(Figure 16.1).</p>
<div class="figure">
<img src="images/Figure_16.png" alt="" />
<p class="caption">Figure 16.1 Quality Assurance &amp; Quality Control</p>
</div>
<p>Each step in the following protocol should be considered in order to detect and eliminate errors, address data inaccuracies and assess the output completeness.</p>
<div id="step-1-check-that-29-products-have-been-labeled-appropriately-and-are-in-the-correct-format" class="section level2 unnumbered">
<h2 class="unnumbered">Step 1 Check that 29 products have been labeled appropriately and are in the correct format</h2>
<p>The following Table (Table 16.1) gives an overview of all the GSOCseq products in alphabetical order. Each product should include the ISO 3166-1 alpha-3 country code in its name. For instance, in the case of Turkey, ISO_GSOCseq_AbsDiff_BAU_Map030 should be changed to TUR_GSOCseq_AbsDiff_BAU_Map030.</p>
<p>All 29 products must be georeferenced TIF (.tif) files.</p>
<p><em>Table 16.1</em> Overview of the 29 GSOCseq Products
<img src="tables/Table_16.1.PNG" /></p>
</div>
<div id="step-2-check-the-projection-and-resolution-of-all-products" class="section level2 unnumbered">
<h2 class="unnumbered">Step 2 Check the projection and resolution of all products</h2>
<p>Open the products in QGIS or any other preferred GIS platform. Check that the projection of all products is EPSG:4326 - WGS 84 (Layer properties). Check that the spatial resolution (pixel size) (Layer properties) is equal to ~0.00833 degrees ; 1 km x 1km at the equator.</p>
</div>
<div id="step-3-check-that-the-products-were-generated-for-agricultural-and-grazing-areas-only" class="section level2 unnumbered">
<h2 class="unnumbered">Step 3 Check that the products were generated for agricultural and grazing areas only</h2>
<p>Visualize the 29 products in QGIS or any preferred GIS platform. Load a land-use layer to visually assess that the simulations were done exclusively on agricultural areas.</p>
</div>
<div id="step-4-check-for-units-range-and-outliers" class="section level2 unnumbered">
<h2 class="unnumbered">Step 4 Check for units, range, and outliers</h2>
<p>In the following section expected value ranges for each product category are presented. It is important to note that the provided ranges represent a gross approximation of what can be normally expected when running the proposed methodology. Results that fall outside these ranges and that did not occur due to common issues presented in the section 15.2 need to be carefully evaluated based on local expertise and available literature.</p>
<p>The provided ranges can be compared in QGIS, R, or any preferred platform. Descriptive layer statistics can be viewed in QGIS under Layer Properties in the Information tab (Figure 16.2).</p>
<div class="figure">
<img src="images/Figure_16.2.PNG" alt="" />
<p class="caption">Figure 16.2 Layer statistics in QGIS</p>
</div>
<div id="soil-organic-carbon-at-t0-2020" class="section level3 unnumbered">
<h3 class="unnumbered">Soil Organic Carbon at T0 (2020)</h3>
<p>The product <em>ISO_GSOCseq_T0_Map030</em> refers to the SOC stocks 0-30 cm in t/ha used as input in the Forward phase.</p>
<p>Check statistics of ISO_GSOCseq_T0_Map030 file. The provided reference values may vary for each country depending on external factors that need to be carefully evaluated. However, the following values can be generally expected:</p>
<ul>
<li>Most of the values should fall between 15-100 t/ha</li>
<li>Minimum values should be greater than 0 (except for -999 Values, which indicate no data values)</li>
<li>-999 values should be masked out</li>
<li>There should not be negative values other than -999</li>
<li>Maximum values should not exceed 800 t/ha.</li>
</ul>
</div>
<div id="final-soc-stocks-after-20-simulation-years-for-all-scenarios-bau-ssm1-ssm2-ssm3" class="section level3 unnumbered">
<h3 class="unnumbered">Final SOC stocks after 20 simulation years for all scenarios (BAU, SSM1, SSM2, SSM3)</h3>
<p>These products refer to the SOC stocks 0-30 cm in t/ha at the end of the forward phase simulations for the 4 scenarios (BAU, SSM1, SSM2, SSM3).</p>
<p>Check the statistics of:</p>
<ol style="list-style-type: decimal">
<li>ISO_GSOCseq_finalSOC_BAU_Map030</li>
<li>ISO_GSOCseq_finalSOC_SSM1_Map030</li>
<li>ISO_GSOCseq_finalSOC_SSM2_Map030</li>
<li>ISO_GSOCseq_finalSOC_SSM3_Map030</li>
</ol>
<p>The provided reference values may vary for each country depending on external factors that need to be carefully evaluated. However, the following values can be generally expected:</p>
<ul>
<li>Most of the values should fall between 15-100 t/ha</li>
<li>Minimum values should be greater than 0 (except for -999 Values, which indicate no data values)</li>
<li>-999 values should be masked out</li>
<li>There should not be negative values other than -999</li>
<li>Maximum values should not exceed 800 t/ha.</li>
<li>Mean values SOC SSM3 &gt; SSM 2 &gt; SSM 1 &gt; BAU</li>
</ul>
</div>
<div id="absolute-differences-in-soc-stocks" class="section level3 unnumbered">
<h3 class="unnumbered">Absolute differences in SOC stocks</h3>
<p>The layers showing the absolute differences in SOC stocks refer to the SOC change 0-30 cm in t/ha (Final SOC stocks vs initial stocks T0) for the BAU, SSM1, SSM2, and SSM3 scenarios.</p>
<p>Check the statistics of:</p>
<ol style="list-style-type: decimal">
<li>ISO_GSOCseq_AbsDiff_BAU_Map030</li>
<li>ISO_GSOCseq_AbsDiff_SSM1_Map030</li>
<li>ISO_GSOCseq_AbsDiff_SSM2_Map030</li>
<li>ISO_GSOCseq_AbsDiff_SSM3_Map030</li>
</ol>
<p>The provided reference values may vary for each country depending on external factors that need to be carefully evaluated. However, the following values can be generally expected:</p>
<ul>
<li>The expected range should fall usually between -80 to +80 t/ha (with an approximate average of -15 to +15)</li>
<li>Negative values can occur and indicate SOC losses between 2020 and 2040 (-999 indicate no data values).</li>
<li>-999 values should be masked out</li>
<li>Negative values other than -999 values should usually not exceed -80</li>
<li>Maximum values should usually not exceed +80</li>
<li>Check if extreme values (values &gt; +80 and values &lt; -80) are grouped or dispersed (refer to Annex I, Common errors and considerations)</li>
<li>Mean values in order of size SSM3 &gt; SSM 2 &gt; SSM 1 &gt; BAU</li>
</ul>
</div>
<div id="relative-differences-in-soc-stocks" class="section level3 unnumbered">
<h3 class="unnumbered">Relative differences in SOC stocks</h3>
<p>These products refer to the SOC change 0-30 cm in t/ha (Final SOC stocks in SSM scenarios vs Final stocks BAU scenario) for the SSM1, SSM2, and SSM3 scenarios.</p>
<p>Check the statistics of:</p>
<ol style="list-style-type: decimal">
<li>ISO_GSOCseq_RelDiff_SSM1_Map030</li>
<li>ISO_GSOCseq_RelDiff_SSM2_Map030</li>
<li>ISO_GSOCseq_RelDiff_SSM3_Map030</li>
</ol>
<p>The provided reference values may vary for each country depending on external factors that need to be carefully evaluated. However, the following values can be generally expected:</p>
<ul>
<li>Expected range usually falls between 0 to +80 t/ha</li>
<li>-999 values should be masked out</li>
<li>There should not be negative values other than -999</li>
<li>Maximum values should usually not exceed +80</li>
<li>Check if extreme values (values &gt; +80) are grouped or dispersed (refer to Annex I, Common errors and considerations)</li>
<li>Mean values SSM3 &gt; SSM 2 &gt; SSM 1</li>
</ul>
</div>
<div id="absolute-sequestration-rates-asr" class="section level3 unnumbered">
<h3 class="unnumbered">Absolute sequestration rates (ASR)</h3>
<p>Absolute sequestration rates (ASR) refer to the SOC change rate 0-30 cm in t/ha/yr (Final SOC stocks vs initial stocks T0 divided by 20 years) for the BAU, SSM1, SSM2, and SSM3 scenarios.</p>
<p>Check the statistics of:</p>
<ol style="list-style-type: decimal">
<li>ISO_GSOCseq_ASR_BAU_Map030</li>
<li>ISO_GSOCseq_ASR_SSM1_Map030</li>
<li>ISO_GSOCseq_ASR_SSM2_Map030</li>
<li>ISO_GSOCseq_ASR_SSM3_Map030</li>
</ol>
<p>The provided reference values may vary for each country depending on external factors that need to be carefully evaluated. However, the following values can be generally expected:</p>
<ul>
<li>The expected range for all maps should fall between -4 to +4 t/ha</li>
<li>ASR BAU: usually most values from -0.5 to + 0.5, with median values near 0 or lower</li>
<li>ASR SSM1: usually most values -0.4 to + 0.6, with median near 0 or higher (similar to BAU)</li>
<li>ASR SSM2: usually most values -0.3 to + 0.7</li>
<li>ASR SSM3: usually most values -0.2 to + 0.8</li>
<li>-999 and -49.95 Values (-999/20) indicate no data values. Values &lt;= -49.95 should be masked out</li>
<li>Negative values other than -999 and -49.95 (meaning SOC losses between 2020 and 2040) should not exceed -4</li>
<li>Maximum values should usually not exceed +4.</li>
<li>Check if extreme values (&gt; +4; &lt;-4) are grouped or dispersed (refer to Annex I, Common errors and considerations)</li>
<li>Mean values SSM3 &gt; SSM 2 &gt; SSM 1 &gt; BAU</li>
</ul>
</div>
<div id="relative-sequestration-rates-rsr" class="section level3 unnumbered">
<h3 class="unnumbered">Relative sequestration rates (RSR)</h3>
<p>Relative sequestration rates refer to the SOC change rate 0-30 cm in t/ha/yr (Final SOC stocks under SSM vs Final stocks BAU divided by 20 years) for the SSM1, SSM2, and SSM3 scenarios, compared to BAU scenario.</p>
<p>Check the statistics of:</p>
<ol style="list-style-type: decimal">
<li>ISO_GSOCseq_RSR_SSM1_Map030</li>
<li>ISO_GSOCseq_RSR_SSM2_Map030</li>
<li>ISO_GSOCseq_RSR_SSM3_Map030</li>
</ol>
<p>The provided reference values may vary for each country depending on external factors that need to be carefully evaluated. However, the following values can be generally expected:</p>
<ul>
<li>The expected range should fall between 0 to +4 t C/ha (with most data being distributed between 0 to +1)</li>
<li>RSR SSM1: usually most values range from 0 to + 0.6, with median near 0 or higher (similar to BAU)</li>
<li>RSR SSM2: usually most values range from 0 to + 0.7</li>
<li>RSR SSM3: usually most values range 0 to + 0.8</li>
<li>-999 and -49.95 Values (-999/20) indicate no data values. Values &lt;= -49.95 will be excluded from Global product</li>
<li>There should not be negative values other than -999 and -49.95:</li>
<li>Check if grouped or dispersed (refer to Annex I)</li>
<li>Maximum values should usually not exceed +4.</li>
<li>Check if grouped or dispersed (refer to Annex I)</li>
<li>Mean SOC values in order of size SSM3 &gt; SSM 2 &gt; SSM 1</li>
</ul>
</div>
<div id="uncertainties" class="section level3 unnumbered">
<h3 class="unnumbered">Uncertainties</h3>
<p>Check the statistics of:</p>
<ol style="list-style-type: decimal">
<li>ISO_GSOCseq_ASR_BAU_UncertaintyMap030</li>
<li>ISO_GSOCseq_ASR_SSM1_UncertaintyMap030</li>
<li>ISO_GSOCseq_ASR_SSM2_UncertaintyMap030</li>
<li>ISO_GSOCseq_ASR_SSM3_UncertaintyMap030</li>
<li>ISO_GSOCseq_BAU_UncertaintyMap030</li>
<li>ISO_GSOCseq_RSR_SSM1_UncertaintyMap030</li>
<li>ISO_GSOCseq_RSR_SSM2_UncertaintyMap030</li>
<li>ISO_GSOCseq_RSR_SSM3_UncertaintyMap030</li>
<li>ISO_GSOCseq_SSM_UncertaintyMap030</li>
<li>ISO_GSOCseq_T0_UncertaintyMap030</li>
</ol>
<p>The provided reference values may vary for each country depending on external factors that need to be carefully evaluated. However, the following values can be generally expected:</p>
<ul>
<li>Expected range all maps, usually between 0 to +200 % (most data generally between 15 to 50%)</li>
<li>-999 indicates no data values. Negative values and -999 values should be masked out</li>
<li>Maximum values should usually not exceed +200%.</li>
<li>Check if extreme values (&gt;200 % and &lt;0 %) are grouped or dispersed (refer to Annex I, Common errors and considerations)</li>
</ul>
<!--chapter:end:15.Annex.rmd-->
</div>
</div>
</div>
<div id="references" class="section level1" number="15">
<h1 number="15"><span class="header-section-number">15</span> References</h1>
<!--chapter:end:References.rmd-->
<div id="refs" class="references csl-bib-body">
<div id="ref-Abberton.2010" class="csl-entry">
<strong>Abberton, M.T., Conant, R.T. &amp; Batello, C.</strong> 2010. <em><span class="nocase">Grassland carbon sequestration: Management, policy and economics : proceedings of the Workshop on the role of grassland carbon sequestration in the mitigation of climate change</span></em>. Integrated crop management, 1020-4555. Rome, Food; Agriculture Organization of the United Nations, Plant Production; Protection Division; Food; Agriculture Organization of the United Nations.
</div>
<div id="ref-AlAdamat.2007" class="csl-entry">
<strong>Al-Adamat, R., Rawajfih, Z., Easter, M., Paustian, K., Coleman, K., Milne, E., Falloon, P., Powlson, D.S. &amp; BATJES, N.H.</strong> 2007. <span class="nocase">Predicted soil organic carbon stocks and changes in Jordan between 2000 and 2030 made using the GEFSOC Modelling System</span>. <em>Agriculture, Ecosystems <span>&amp;</span> Environment</em>, 122(1): 35–45. <a href="https://doi.org/10.1016/j.agee.2007.01.006">https://doi.org/10.1016/j.agee.2007.01.006</a>
</div>
<div id="ref-Allen.2014" class="csl-entry">
<strong>Allen, M.R. &amp; Stocker, T.F.</strong> 2014. <span class="nocase">Impact of delay in reducing carbon dioxide emissions</span>. <em>Nature Climate Change</em>, 4(1): 23–26. <a href="https://doi.org/10.1038/nclimate2077">https://doi.org/10.1038/nclimate2077</a>
</div>
<div id="ref-.26112020" class="csl-entry">
<strong>Anonymous</strong>. undated. <span class="nocase">Global Soil Organic Carbon (GSOC) Map | Global Soil Partnership | Food and Agriculture Organization of the United Nations</span>. [Cited 26 November 2020]. <a href="http://www.fao.org/global-soil-partnership/pillars-action/4-information-and-data-new/global-soil-organic-carbon-gsoc-map">http://www.fao.org/global-soil-partnership/pillars-action/4-information-and-data-new/global-soil-organic-carbon-gsoc-map</a>
</div>
<div id="ref-Bahn.2012" class="csl-entry">
<strong>Bahn, M., Kutsch, W.L. &amp; Heinemeyer, A.</strong> 2012. <span class="nocase">Synthesis: emerging issues and challenges for an integrated understanding of soil carbon fluxes</span>. <em>In</em> W.L. Kutsch, ed. <em>Soil carbon dynamics</em>, pp. 257–271. Cambridge, Cambridge University Press.
</div>
<div id="ref-BATJES.1996" class="csl-entry">
<strong>Batjes, N.H.</strong> 1996. <span class="nocase">Total carbon and nitrogen in the soils of the world</span>. <em>European Journal of Soil Science</em>, 47(2): 151–163. <a href="https://doi.org/10.1111/j.1365-2389.1996.tb01386.x">https://doi.org/10.1111/j.1365-2389.1996.tb01386.x</a>
</div>
<div id="ref-Beek.1973" class="csl-entry">
<strong>Beek, J. &amp; Frissel, M.J.</strong> 1973. <em><span class="nocase">Simulation of nitrogen behaviour in soils</span></em>. Simulation monographs. Wageningen, Pudoc. (also available at <a href="http://eprints.icrisat.ac.in/13135/">http://eprints.icrisat.ac.in/13135/</a>).
</div>
<div id="ref-Bolinder.2007" class="csl-entry">
<strong>Bolinder, M.A., Janzen, H.H., Gregorich, E.G., Angers, D.A. &amp; VandenBygaart, A.J.</strong> 2007. <span class="nocase">An approach for estimating net primary productivity and annual carbon inputs to soil for common agricultural crops in Canada</span>. <em>Agriculture, Ecosystems <span>&amp;</span> Environment</em>, 118(1-4): 29–42. <a href="https://doi.org/10.1016/j.agee.2006.05.013">https://doi.org/10.1016/j.agee.2006.05.013</a>
</div>
<div id="ref-Campbell.2015" class="csl-entry">
<strong>Campbell, E.E. &amp; Paustian, K.</strong> 2015. <span class="nocase">Current developments in soil organic matter modeling and the expansion of model applications: a review</span>. <em>Environmental Research Letters</em>, 10(12): 123004. <a href="https://doi.org/10.1088/1748-9326/10/12/123004">https://doi.org/10.1088/1748-9326/10/12/123004</a>
</div>
<div id="ref-Clarholm.1989" class="csl-entry">
<strong>Clarholm, M. &amp; Bergström, L., eds.</strong> 1989. <em><span class="nocase">Ecology of Arable Land – Perspectives and Challenges: Proceeding of an International Symposium, 9-12 June 1987 Swedish University of Agricultural Sciences, Uppsala, Sweden</span></em>. Developments in plant and soil sciences. Dordrecht, Springer Netherlands.
</div>
<div id="ref-Coleman.1996" class="csl-entry">
<strong>Coleman, K. &amp; Jenkinson, D.S.</strong> 1996. <span class="nocase">RothC-26.3 - A Model for the turnover of carbon in soil</span>. <em>In</em> D.S. Powlson, P. Smith &amp; J.U. Smith, eds. <em>Evaluation of soil organic matter models</em>. pp. 237–246. NATO ASI series. Series i, global environmental change. Paper presented at, 1996, Berlin; New York.
</div>
<div id="ref-Easter.2007" class="csl-entry">
<strong>Easter, M., Paustian, K., Killian, K., Williams, S., Feng, T., Al-Adamat, R., BATJES, N.H., Bernoux, M., Bhattacharyya, T., Cerri, C.C., Cerri, C.E.P., Coleman, K., Falloon, P., Feller, C., Gicheru, P., Kamoni, P., Milne, E., Pal, D.K., Powlson, D.S., Rawajfih, Z., Sessay, M. &amp; Wokabi, S.</strong> 2007. <span class="nocase">The GEFSOC soil carbon modelling system: A tool for conducting regional-scale soil carbon inventories and assessing the impacts of land use change on soil carbon</span>. <em>Agriculture, Ecosystems <span>&amp;</span> Environment</em>, 122(1): 13–25. <a href="https://doi.org/10.1016/j.agee.2007.01.004">https://doi.org/10.1016/j.agee.2007.01.004</a>
</div>
<div id="ref-Eggleston.2006" class="csl-entry">
<strong>Eggleston, H.S., ed.</strong> 2006. <em><span class="nocase">2006 IPCC guidelines for national greenhouse gas inventories</span></em>. Hayama, Japan, Institute for Global Environmental Strategies.
</div>
<div id="ref-Falloon.1998" class="csl-entry">
<strong>Falloon, P.D., Smith, P., Smith, J.U., Szabó, J., Coleman, K. &amp; Marshall, S.</strong> 1998. <span class="nocase">Regional estimates of carbon sequestration potential: linking the Rothamsted Carbon Model to GIS databases</span>. <em>Biology and Fertility of Soils</em>, 27(3): 236–241. <a href="https://doi.org/10.1007/s003740050426">https://doi.org/10.1007/s003740050426</a>
</div>
<div id="ref-Falloon.2007" class="csl-entry">
<strong>Falloon, P., Jones, C.D., Cerri, C.E., Al-Adamat, R., Kamoni, P., Bhattacharyya, T., Easter, M., Paustian, K., Killian, K., Coleman, K. &amp; Milne, E.</strong> 2007. <span class="nocase">Climate change and its impact on soil and vegetation carbon storage in Kenya, Jordan, India and Brazil</span>. <em>Agriculture, Ecosystems <span>&amp;</span> Environment</em>, 122(1): 114–124. <a href="https://doi.org/10.1016/j.agee.2007.01.013">https://doi.org/10.1016/j.agee.2007.01.013</a>
</div>
<div id="ref-Falloon.2003" class="csl-entry">
<strong>Falloon, P. &amp; Smith, P.</strong> 2003. <span class="nocase">Accounting for changes in soil carbon under the Kyoto Protocol: need for improved long-term data sets to reduce uncertainty in model projections</span>. <em>Soil Use and Management</em>, 19(3): 265–269. <a href="https://doi.org/10.1111/j.1475-2743.2003.tb00313.x">https://doi.org/10.1111/j.1475-2743.2003.tb00313.x</a>
</div>
<div id="ref-Farina.2013" class="csl-entry">
<strong>Farina, R., Coleman, K. &amp; Whitmore, A.P.</strong> 2013. <span class="nocase">Modification of the RothC model for simulations of soil organic C dynamics in dryland regions</span>. <em>Geoderma</em>, 200-201: 18–30. <a href="https://doi.org/10.1016/j.geoderma.2013.01.021">https://doi.org/10.1016/j.geoderma.2013.01.021</a>
</div>
<div id="ref-Farina.2017" class="csl-entry">
<strong>Farina, R., Marchetti, A., Francaviglia, R., Napoli, R. &amp; Di Bene, C.</strong> 2017. <span class="nocase">Modeling regional soil C stocks and CO2 emissions under Mediterranean cropping systems and soil types</span>. <em>Agriculture, Ecosystems <span>&amp;</span> Environment</em>, 238: 128–141. <a href="https://doi.org/10.1016/j.agee.2016.08.015">https://doi.org/10.1016/j.agee.2016.08.015</a>
</div>
<div id="ref-Follett.2009" class="csl-entry">
<strong>Follett, R.F., Kimble, J.M., Pruessner, E.G., Samson-Liebig, S. &amp; Waltman, S.</strong> 2009. <span class="nocase">Soil Organic Carbon Stocks with Depth and Land Use at Various U.S. Sites</span>. <em>In</em> R. Lal &amp; R.F. Follett, eds. <em>Soil carbon sequestration and the greenhouse effect</em>, pp. 29–46. SSSA special publication. Madison, WI, Soil Science Society of America, Inc.
</div>
<div id="ref-FoodandAgricultureOrganizationoftheUnitedNations2017" class="csl-entry">
<strong>Food and Agriculture Organization of the United Nations</strong>. 2017. <span class="nocase">Voluntary Guidelines for Sustainable Soil Management</span>. Rome, FAO. <a href="http://www.fao.org/documents/card/en/c/5544358d-f11f-4e9f-90ef-a37c3bf52db7/">http://www.fao.org/documents/card/en/c/5544358d-f11f-4e9f-90ef-a37c3bf52db7/</a>
</div>
<div id="ref-Franko.1996" class="csl-entry">
<strong>Franko, U.</strong> 1996. <span class="nocase">Modelling approaches of soil organic matter turnover within the CANDY system</span>. <em>In</em> D.S. Powlson, P. Smith &amp; J.U. Smith, eds. <em>Evaluation of soil organic matter models</em>. pp. 247–254. NATO ASI series. Series i, global environmental change. Paper presented at, 1996, Berlin; New York.
</div>
<div id="ref-Gilhespy.2014" class="csl-entry">
<strong>Gilhespy, S.L., Anthony, S., Cardenas, L., Chadwick, D., Prado, A. del, Li, C., Misselbrook, T., Rees, R.M., Salas, W., Sanz-Cobena, A., Smith, P., Tilston, E.L., Topp, C.F.E., Vetter, S. &amp; Yeluripati, J.B.</strong> 2014. <span class="nocase">First 20 years of DNDC (DeNitrification DeComposition): Model evolution</span>. <em>Ecological Modelling</em>, 292: 51–62. <a href="https://doi.org/10.1016/j.ecolmodel.2014.09.004">https://doi.org/10.1016/j.ecolmodel.2014.09.004</a>
</div>
<div id="ref-Gottschalk.2012" class="csl-entry">
<strong>Gottschalk, P., Smith, J.U., Wattenbach, M., Bellarby, J., Stehfest, E., Arnell, N., Osborn, T.J., Jones, C. &amp; Smith, P.</strong> 2012. <span class="nocase">How will organic carbon stocks in mineral soils evolve under future climate? Global projections using RothC for a range of climate change scenarios</span>. <em>Biogeosciences</em>, 9(8): 3151–3171. <a href="https://doi.org/10.5194/bg-9-3151-2012">https://doi.org/10.5194/bg-9-3151-2012</a>
</div>
<div id="ref-GRACE.2006" class="csl-entry">
<strong>Grace, P., Ladd, J., Robertson, G. &amp; Gage, S.</strong> 2006. <span class="nocase">SOCRATES - A simple model for predicting long-term changes in soil organic carbon in terrestrial ecosystems</span>. <em>Soil Biology and Biochemistry</em>, 38(5): 1172–1176. <a href="https://doi.org/10.1016/j.soilbio.2005.09.013">https://doi.org/10.1016/j.soilbio.2005.09.013</a>
</div>
<div id="ref-HADAS.1998" class="csl-entry">
<strong>Hadas, A., Parkin, T.B. &amp; Stahl, P.D.</strong> 1998. <span class="nocase">Reduced CO 2 release from decomposing wheat straw under N-limiting conditions: simulation of carbon turnover</span>. <em>European Journal of Soil Science</em>, 49(3): 487–494. <a href="https://doi.org/10.1046/j.1365-2389.1998.4930487.x">https://doi.org/10.1046/j.1365-2389.1998.4930487.x</a>
</div>
<div id="ref-Hansen.1991" class="csl-entry">
<strong>Hansen, S., Jensen, H.E., Nielsen, N.E. &amp; Svendsen, H.</strong> 1991. <span class="nocase">Simulation of nitrogen dynamics and biomass production in winter wheat using the Danish simulation model DAISY</span>. <em>Fertilizer research</em>, 27(2-3): 245–259. <a href="https://doi.org/10.1007/BF01051131">https://doi.org/10.1007/BF01051131</a>
</div>
<div id="ref-Hengl.2017" class="csl-entry">
<strong>Hengl, T., Mendes de Jesus, J., Heuvelink, G.B.M., Ruiperez Gonzalez, M., Kilibarda, M., Blagotić, A., Shangguan, W., Wright, M.N., Geng, X., Bauer-Marschallinger, B., Guevara, M.A., Vargas, R., MacMillan, R.A., Batjes, N.H., Leenaars, J.G.B., Ribeiro, E., Wheeler, I., Mantel, S. &amp; Kempen, B.</strong> 2017. <span class="nocase">SoilGrids250m: Global gridded soil information based on machine learning</span>. <em>PloS one</em>, 12(2): e0169748. <a href="https://doi.org/10.1371/journal.pone.0169748">https://doi.org/10.1371/journal.pone.0169748</a>
</div>
<div id="ref-IPCC.2019" class="csl-entry">
<strong>IPCC</strong>. 2019. <span class="nocase">2019 Refinement to the 2006 IPCC Guidelines for National Greenhouse Gas Inventories</span>. <a href="https://www.ipcc-nggip.iges.or.jp/public/2006gl/vol4.html">https://www.ipcc-nggip.iges.or.jp/public/2006gl/vol4.html</a>
</div>
<div id="ref-Jansson.2010" class="csl-entry">
<strong>Jansson, C., Wullschleger, S.D., Kalluri, U.C. &amp; Tuskan, G.A.</strong> 2010. <span class="nocase">Phytosequestration: Carbon Biosequestration by Plants and the Prospects of Genetic Engineering</span>. <em>BioScience</em>, 60(9): 685–696. <a href="https://doi.org/10.1525/bio.2010.60.9.6">https://doi.org/10.1525/bio.2010.60.9.6</a>
</div>
<div id="ref-Jenkinson.1991" class="csl-entry">
<strong>Jenkinson, D.S., Adams, D.E. &amp; Wild, A.</strong> 1991. <span class="nocase">Model estimates of CO2 emissions from soil in response to global warming</span>. <em>Nature</em>, 351(6324): 304–306. <a href="https://doi.org/10.1038/351304a0">https://doi.org/10.1038/351304a0</a>
</div>
<div id="ref-Jenkinson.2008" class="csl-entry">
<strong>Jenkinson, D.S. &amp; Coleman, K.</strong> 2008. <span class="nocase">The turnover of organic carbon in subsoils. Part 2. Modelling carbon turnover</span>. <em>European Journal of Soil Science</em>, 59(2): 400–413. <a href="https://doi.org/10.1111/j.1365-2389.2008.01026.x">https://doi.org/10.1111/j.1365-2389.2008.01026.x</a>
</div>
<div id="ref-Jenkinson.1977" class="csl-entry">
<strong>Jenkinson, D.S. &amp; Rayner, J.H.</strong> 1977. <span class="nocase">The Turnover of Soil Organic Matter in Some of The Rothamsted Classical Experiments</span>. <em>Soil Science</em>, 123(5): 298–305. <a href="https://doi.org/10.1097/00010694-197705000-00005">https://doi.org/10.1097/00010694-197705000-00005</a>
</div>
<div id="ref-Jenny.1994" class="csl-entry">
<strong>Jenny, H.</strong> 1994. <em><span class="nocase">Factors of soil formation: A system of quantitative pedology</span></em>. New York, Dover.
</div>
<div id="ref-Jenny.1949" class="csl-entry">
<strong>Jenny, H., Gessel, S.P. &amp; Bingham, F.T.</strong> 1949. <span class="nocase">Comparative Study of Decomposition Rates of Organic Matter in Temperate and Tropical Regions</span>. <em>Soil Science</em>, 68(6): 419–432. <a href="https://doi.org/10.1097/00010694-194912000-00001">https://doi.org/10.1097/00010694-194912000-00001</a>
</div>
<div id="ref-JoSmith.2006" class="csl-entry">
<strong>Jo Smith, P.S., Jeannette Meyer, M.W., Sönke Zaehle, M.L., Robert J.A. Jones, R.H., Mark Rounsevell, L.M., REGINSTER, I. &amp; Kankaanpää, S.</strong> 2006. <span class="nocase">Projected changes in mineral soil carbon of European forests, 1990–2100</span>. <em>Canadian Journal of Soil Science</em>, 86(Special Issue): 159–169. <a href="https://doi.org/10.4141/S05-078">https://doi.org/10.4141/S05-078</a>
</div>
<div id="ref-Keenan.2011" class="csl-entry">
<strong>Keenan, T.F., Carbone, M.S., Reichstein, M. &amp; Richardson, A.D.</strong> 2011. <span class="nocase">The model-data fusion pitfall: assuming certainty in an uncertain world</span>. <em>Oecologia</em>, 167(3): 587–597. <a href="https://doi.org/10.1007/s00442-011-2106-x">https://doi.org/10.1007/s00442-011-2106-x</a>
</div>
<div id="ref-Kutsch.2016" class="csl-entry">
<strong>Kutsch, W., Bahn, M. &amp; Heinemeyer, A.</strong> 2016. <em><span class="nocase">Soil carbon dynamics: An integrated methodology / edited by Werner L. Kutsch (Johann Heinrich von Th<span class="nocase">ü</span>nen Institut, Braunschweig), Michael Bahn (Leopold-Franzens Universit<span class="nocase">ä</span>t Innsbruck), Andreas Heinemeyer (Stockholm Environment Institute, University of York)</span></em>. Reprinted with corrections edition. Cambridge, Cambridge University Press.
</div>
<div id="ref-Kutsch.2012" class="csl-entry">
<strong>Kutsch, W.L., ed.</strong> 2012. <em><span class="nocase">Soil carbon dynamics: An integrated methodology</span></em>. Repr. with edition. Cambridge, Cambridge University Press.
</div>
<div id="ref-Lal.2004" class="csl-entry">
<strong>Lal, R.</strong> 2004. <span class="nocase">Soil carbon sequestration impacts on global climate change and food security</span>. <em>Science (New York, N.Y.)</em>, 304(5677): 1623–1627. <a href="https://doi.org/10.1126/science.1097396">https://doi.org/10.1126/science.1097396</a>
</div>
<div id="ref-Lal.2009" class="csl-entry">
<strong>Lal, R. &amp; Follett, R.F., eds.</strong> 2009. <em><span class="nocase">Soil carbon sequestration and the greenhouse effect</span></em>. Second edi edition. SSSA special publication. Madison, WI, Soil Science Society of America, Inc.
</div>
<div id="ref-Lal.2018" class="csl-entry">
<strong>Lal, R., Smith, P., Jungkunst, H.F., Mitsch, W.J., Lehmann, J., Nair, P.RamachandranK., McBratney, A.B., de Moraes Sá, J.C., Schneider, J., Zinn, Y.L., Skorupa, A.L.A., Zhang, H.-L., Minasny, B., Srinivasrao, C. &amp; Ravindranath, N.H.</strong> 2018. <span class="nocase">The carbon sequestration potential of terrestrial ecosystems</span>. <em>Journal of Soil and Water Conservation</em>, 73(6): 145A—–152A. <a href="https://doi.org/10.2489/jswc.73.6.145A">https://doi.org/10.2489/jswc.73.6.145A</a>
</div>
<div id="ref-Lauenroth.1983" class="csl-entry">
<strong>Lauenroth, W.K., Skogerboe, G.V. &amp; Flug, M., eds.</strong> 1983. <em><span class="nocase">Analysis of ecological systems: State-of-the-art in ecological modelling / edited by William K. Lauenroth, Gaylord V. Skogerboe, Marshall Flug ; proceedings of a symposium held from 24 to 28 May 1982 at Colorado State University, Fort Collins, Colorado, U.S.A. ; sponsored by the International Society for Ecological Modelling (ISEM) ; hosted by the Natural Resource Ecology Laboratory, Colorado State University</span></em>. Developments in environmental modelling. Armstrong; Oxford, Elsevier Scientific.
</div>
<div id="ref-Lehtonen.2020" class="csl-entry">
<strong>Lehtonen, A., \backslashvTupek, B., Nieminen, T.M., Balázs, A., Anjulo, A., Teshome, M., Tiruneh, Y. &amp; Alm, J.</strong> 2020. <span class="nocase">Soil carbon stocks in Ethiopian forests and estimations of their future development under different forest use scenarios</span>. <em>Land Degradation <span>&amp;</span> Development</em>. <a href="https://doi.org/10.1002/ldr.3647">https://doi.org/10.1002/ldr.3647</a>
</div>
<div id="ref-Li.1996" class="csl-entry">
<strong>Li, C.</strong> 1996. <span>The DNDC Model</span>. <em>In</em> D.S. Powlson, P. Smith &amp; J.U. Smith, eds. <em>Evaluation of soil organic matter models</em>. pp. 263–267. NATO ASI series. Series i, global environmental change. Paper presented at, 1996, Berlin; New York.
</div>
<div id="ref-Lieth.1975b" class="csl-entry">
<strong>Lieth, H.</strong> 1975. <span class="nocase">Modeling the Primary Productivity of the World</span>. <em>In</em> H. Lieth &amp; R.H. Whittaker, eds. <em>Primary productivity of the biosphere</em>, pp. 237–263. Ecological studies, analysis and synthesis, 0070-8356. Berlin, Heidelberg, Springer Berlin Heidelberg.
</div>
<div id="ref-Lieth.1975" class="csl-entry">
<strong>Lieth, H. &amp; Whittaker, R.H., eds.</strong> 1975. <em><span class="nocase">Primary Productivity of the Biosphere</span></em>. Ecological studies, analysis and synthesis, 0070-8356. Berlin, Heidelberg, Springer Berlin Heidelberg.
</div>
<div id="ref-Lorenz.2018" class="csl-entry">
<strong>Lorenz, K. &amp; Lal, R.</strong> 2018. <em><span class="nocase">Carbon sequestration in agricultural ecosystems</span></em>. Cham, Switzerland, Springer.
</div>
<div id="ref-Lugato.2014" class="csl-entry">
<strong>Lugato, E., Bampa, F., Panagos, P., Montanarella, L. &amp; Jones, A.</strong> 2014. <span class="nocase">Potential carbon sequestration of European arable soils estimated by modelling a comprehensive set of management practices</span>. <em>Global change biology</em>, 20(11): 3557–3567. <a href="https://doi.org/10.1111/gcb.12551">https://doi.org/10.1111/gcb.12551</a>
</div>
<div id="ref-Manzoni.2009" class="csl-entry">
<strong>Manzoni, S. &amp; Porporato, A.</strong> 2009. <span class="nocase">Soil carbon and nitrogen mineralization: Theory and models across scales</span>. <em>Soil Biology and Biochemistry</em>, 41(7): 1355–1379. <a href="https://doi.org/10.1016/j.soilbio.2009.02.031">https://doi.org/10.1016/j.soilbio.2009.02.031</a>
</div>
<div id="ref-Martens.1995" class="csl-entry">
<strong>Martens, R.</strong> 1995. <span class="nocase">Current methods for measuring microbial biomass C in soil: Potentials and limitations</span>. <em>Biology and Fertility of Soils</em>, 19(2-3): 87–99. <a href="https://doi.org/10.1007/BF00336142">https://doi.org/10.1007/BF00336142</a>
</div>
<div id="ref-Milne.2007" class="csl-entry">
<strong>Milne, E., Adamat, R.A., BATJES, N.H., Bernoux, M., Bhattacharyya, T., Cerri, C.C., Cerri, C.E.P., Coleman, K., Easter, M., Falloon, P., Feller, C., Gicheru, P., Kamoni, P., Killian, K., Pal, D.K., Paustian, K., Powlson, D.S., Rawajfih, Z., Sessay, M., Williams, S. &amp; Wokabi, S.</strong> 2007. <span class="nocase">National and sub-national assessments of soil organic carbon stocks and changes: The GEFSOC modelling system</span>. <em>Agriculture, Ecosystems <span>&amp;</span> Environment</em>, 122(1): 3–12. <a href="https://doi.org/10.1016/j.agee.2007.01.002">https://doi.org/10.1016/j.agee.2007.01.002</a>
</div>
<div id="ref-Minasny.2017" class="csl-entry">
<strong>Minasny, B., Malone, B.P., McBratney, A.B., Angers, D.A., Arrouays, D., Chambers, A., Chaplot, V., Chen, Z.-S., Cheng, K., Das, B.S., Field, D.J., Gimona, A., Hedley, C.B., Hong, S.Y., Mandal, B., Marchant, B.P., Martin, M., McConkey, B.G., Mulder, V.L., O’Rourke, S., Richer-de-Forges, A.C., Odeh, I., Padarian, J., Paustian, K., Pan, G., Poggio, L., Savin, I., Stolbovoy, V., Stockmann, U., Sulaeman, Y., Tsui, C.-C., Vågen, T.-G., Wesemael, B. van &amp; Winowiecki, L.</strong> 2017. <span class="nocase">Soil carbon 4 per mille</span>. <em>Geoderma</em>, 292: 59–86. <a href="https://doi.org/10.1016/j.geoderma.2017.01.002">https://doi.org/10.1016/j.geoderma.2017.01.002</a>
</div>
<div id="ref-Mondini.2012" class="csl-entry">
<strong>Mondini, C., Coleman, K. &amp; Whitmore, A.P.</strong> 2012. <span class="nocase">Spatially explicit modelling of changes in soil organic C in agricultural soils in Italy, 2001–2100: Potential for compost amendment</span>. <em>Agriculture, Ecosystems <span>&amp;</span> Environment</em>, 153: 24–32. <a href="https://doi.org/10.1016/j.agee.2012.02.020">https://doi.org/10.1016/j.agee.2012.02.020</a>
</div>
<div id="ref-Moradizadeh.2016" class="csl-entry">
<strong>Moradizadeh, M. &amp; Saradjian, M.R.</strong> 2016. <span class="nocase">Vegetation Effects Modeling in Soil Moisture Retrieval Using MSVI</span>. <em>Photogrammetric Engineering <span>&amp;</span> Remote Sensing</em>, 82(10): 803–810. <a href="https://doi.org/10.14358/PERS.82.10.803">https://doi.org/10.14358/PERS.82.10.803</a>
</div>
<div id="ref-Morais.2019" class="csl-entry">
<strong>Morais, T.G., Teixeira, R.F.M. &amp; Domingos, T.</strong> 2019. <span class="nocase">Detailed global modelling of soil organic carbon in cropland, grassland and forest soils</span>. <em>PloS one</em>, 14(9): e0222604. <a href="https://doi.org/10.1371/journal.pone.0222604">https://doi.org/10.1371/journal.pone.0222604</a>
</div>
<div id="ref-Motavalli.1995" class="csl-entry">
<strong>Motavalli, P.P., Palm, C.A., Parton, W.J., Elliott, E.T. &amp; Frey, S.D.</strong> 1995. <span class="nocase">Soil pH and organic C dynamics in tropical forest soils: Evidence from laboratory and simulation studies</span>. <em>Soil Biology and Biochemistry</em>, 27(12): 1589–1599. <a href="https://doi.org/10.1016/0038-0717(95)00082-P">https://doi.org/10.1016/0038-0717(95)00082-P</a>
</div>
<div id="ref-Neumann.2018" class="csl-entry">
<strong>Neumann, M. &amp; Smith, P.</strong> 2018. <span class="nocase">Carbon uptake by European agricultural land is variable, and in many regions could be increased: Evidence from remote sensing, yield statistics and models of potential productivity</span>. <em>The Science of the total environment</em>, 643: 902–911. <a href="https://doi.org/10.1016/j.scitotenv.2018.06.268">https://doi.org/10.1016/j.scitotenv.2018.06.268</a>
</div>
<div id="ref-Palosuo.2012" class="csl-entry">
<strong>Palosuo, T., Foereid, B., Svensson, M., Shurpali, N., Lehtonen, A., Herbst, M., Linkosalo, T., Ortiz, C., Rampazzo Todorovic, G., Marcinkonis, S., Li, C. &amp; Jandl, R.</strong> 2012. <span class="nocase">A multi-model comparison of soil carbon assessment of a coniferous forest stand</span>. <em>Environmental Modelling <span>&amp;</span> Software</em>, 35: 38–49. <a href="https://doi.org/10.1016/j.envsoft.2012.02.004">https://doi.org/10.1016/j.envsoft.2012.02.004</a>
</div>
<div id="ref-Parshotam.1995" class="csl-entry">
<strong>Parshotam, A. &amp; Hewitt, A.E.</strong> 1995. <span class="nocase">Application of the Rothamsted carbon turnover model to soils in degraded semi-arid land in New Zealand</span>. <em>Environment International</em>, 21(5): 693–697. <a href="https://doi.org/10.1016/0160-4120(95)00071-R">https://doi.org/10.1016/0160-4120(95)00071-R</a>
</div>
<div id="ref-Parton.1996" class="csl-entry">
<strong>Parton, W.J.</strong> 1996. <span class="nocase">The CENTURY model</span>. <em>In</em> D.S. Powlson, P. Smith &amp; J.U. Smith, eds. <em>Evaluation of soil organic matter models</em>. pp. 283–291. NATO ASI series. Series i, global environmental change. Paper presented at, 1996, Berlin; New York.
</div>
<div id="ref-Parton.1989" class="csl-entry">
<strong>Parton, W.J., Cole, C.V., Stewart, J.W.B., Ojima, D.S. &amp; Schimel, D.S.</strong> 1989. <span class="nocase">Simulating regional patterns of soil C, N, and P dynamics in the U.S. central grasslands region</span>. <em>In</em> M. Clarholm &amp; L. Bergström, eds. <em>Ecology of arable land – perspectives and challenges</em>, pp. 99–108. Developments in plant and soil sciences. Dordrecht, Springer Netherlands.
</div>
<div id="ref-Paustian.2019" class="csl-entry">
<strong>Paustian, K., Collier, S., Baldock, J., Burgess, R., Creque, J., DeLonge, M., Dungait, J., Ellert, B., Frank, S., Goddard, T., Govaerts, B., Grundy, M., Henning, M., Izaurralde, R.C., Madaras, M., McConkey, B., Porzig, E., Rice, C., Searle, R., Seavy, N., Skalsky, R., Mulhern, W. &amp; Jahn, M.</strong> 2019. <span class="nocase">Quantifying carbon for agricultural soil management: from the current status toward a global soil information system</span>. <em>Carbon Management</em>, 10(6): 567–587. <a href="https://doi.org/10.1080/17583004.2019.1633231">https://doi.org/10.1080/17583004.2019.1633231</a>
</div>
<div id="ref-Paustian.2016" class="csl-entry">
<strong>Paustian, K., Lehmann, J., Ogle, S., Reay, D., Robertson, G.P. &amp; Smith, P.</strong> 2016. <span class="nocase">Climate-smart soils</span>. <em>Nature</em>, 532(7597): 49–57. <a href="https://doi.org/10.1038/nature17174">https://doi.org/10.1038/nature17174</a>
</div>
<div id="ref-Petri.2009" class="csl-entry">
<strong>Petri, M., Batello, C., Villani, R. &amp; Nachtergaele, F.</strong> 2009. <em><span class="nocase">Carbon status and carbon sequestration potential in the world’s grasslands</span></em>. FAO.
</div>
<div id="ref-Plutzar.2016" class="csl-entry">
<strong>Plutzar, C., Kroisleitner, C., Haberl, H., Fetzel, T., Bulgheroni, C., Beringer, T., Hostert, P., Kastner, T., Kuemmerle, T., Lauk, C., Levers, C., Lindner, M., Moser, D., Müller, D., Niedertscheider, M., Paracchini, M.L., Schaphoff, S., Verburg, P.H., Verkerk, P.J. &amp; Erb, K.-H.</strong> 2016. <span class="nocase">Changes in the spatial patterns of human appropriation of net primary production (HANPP) in Europe 1990–2006</span>. <em>Regional Environmental Change</em>, 16(5): 1225–1238. <a href="https://doi.org/10.1007/s10113-015-0820-3">https://doi.org/10.1007/s10113-015-0820-3</a>
</div>
<div id="ref-PoeplauChristopherandDonAxel.2012" class="csl-entry">
<strong>Poeplau, Christopher and Don, Axel</strong>. 2012. <span class="nocase">Sensitivity of soil organic carbon stocks and fractions to different land-use changes across Europe</span>. <em>Geoderma</em>, 192: 189–201. <a href="https://doi.org/10.1016/j.geoderma.2012.08.003">https://doi.org/10.1016/j.geoderma.2012.08.003</a>
</div>
<div id="ref-Poulton.2018" class="csl-entry">
<strong>Poulton, P., Johnston, J., Macdonald, A., White, R. &amp; Powlson, D.</strong> 2018. <span class="nocase">Major limitations to achieving "4 per 1000" increases in soil organic carbon stock in temperate regions: Evidence from long-term experiments at Rothamsted Research, United Kingdom</span>. <em>Global change biology</em>, 24(6): 2563–2584. <a href="https://doi.org/10.1111/gcb.14066">https://doi.org/10.1111/gcb.14066</a>
</div>
<div id="ref-Powlson.1996" class="csl-entry">
<strong>Powlson, D.S., Smith, P. &amp; Smith, J.U., eds.</strong> 1996. <em><span class="nocase">Evaluation of soil organic matter models: Using existing long-term datasets</span></em>. NATO ASI series. Series i, global environmental change. Berlin; New York, NATO Advanced Research Workshop <span>{</span><span class="math inline">\(\backslash\)</span>textquotedbl<span>}</span>Evaluation of Soil Organic Matter Models Using Existing Long-term Datasets<span>{</span><span class="math inline">\(\backslash\)</span>textquotedbl<span>}</span>; Springer.
</div>
<div id="ref-Richter.1981" class="csl-entry">
<strong>Richter, J.</strong> 1981. <span class="nocase">Simulation of nitrogen behaviour of soil-plant systems, Papers of a workshop Models for the behaviour of nitrogen in soil and uptake by plant</span>. <em>Zeitschrift f<span>ü</span>r Pflanzenern<span>ä</span>hrung und Bodenkunde</em>, 144(4): 428–429. <a href="https://doi.org/10.1002/jpln.19811440414">https://doi.org/10.1002/jpln.19811440414</a>
</div>
<div id="ref-Riggers.2019" class="csl-entry">
<strong>Riggers, C., Poeplau, C., Don, A., Bamminger, C., Höper, H. &amp; Dechow, R.</strong> 2019. <span class="nocase">Multi-model ensemble improved the prediction of trends in soil organic carbon stocks in German croplands</span>. <em>Geoderma</em>, 345: 17–30. <a href="https://doi.org/10.1016/j.geoderma.2019.03.014">https://doi.org/10.1016/j.geoderma.2019.03.014</a>
</div>
<div id="ref-.1990" class="csl-entry">
<strong>S., J.D.</strong> 1990. <span class="nocase">The turnover of organic carbon and nitrogen in soil</span>. <em>Philosophical Transactions of the Royal Society of London. Series B: Biological Sciences</em>, 329(1255): 361–368. <a href="https://doi.org/10.1098/rstb.1990.0177">https://doi.org/10.1098/rstb.1990.0177</a>
</div>
<div id="ref-Saggar.1996" class="csl-entry">
<strong>Saggar, S., Parshotam, A., Sparling, G.P., Feltham, C.W. &amp; Hart, P.B.S.</strong> 1996. <span class="nocase">14C-labelled ryegrass turnover and residence times in soils varying in clay content and mineralogy</span>. <em>Soil Biology and Biochemistry</em>, 28(12): 1677–1686. <a href="https://doi.org/10.1016/S0038-0717(96)00250-7">https://doi.org/10.1016/S0038-0717(96)00250-7</a>
</div>
<div id="ref-Scharlemann.2014" class="csl-entry">
<strong>Scharlemann, J.P.W., Tanner, E.V.J., Hiederer, R. &amp; Kapos, V.</strong> 2014. <span class="nocase">Global soil carbon: understanding and managing the largest terrestrial carbon pool</span>. <em>Carbon Management</em>, 5(1): 81–91. <a href="https://doi.org/10.4155/cmt.13.77">https://doi.org/10.4155/cmt.13.77</a>
</div>
<div id="ref-Schmer.2014" class="csl-entry">
<strong>Schmer, M.R., Jin, V.L., Wienhold, B.J., Varvel, G.E. &amp; Follett, R.F.</strong> 2014. <span class="nocase">Tillage and Residue Management Effects on Soil Carbon and Nitrogen Under Irrigated Continuous Corn</span>. <em>Soil Science Society of America Journal</em>, 78(6): 1987–1996. <a href="https://doi.org/10.2136/sssaj2014.04.0166">https://doi.org/10.2136/sssaj2014.04.0166</a>
</div>
<div id="ref-Schmidt.2011" class="csl-entry">
<strong>Schmidt, M.W.I., Torn, M.S., Abiven, S., Dittmar, T., Guggenberger, G., Janssens, I.A., Kleber, M., Kögel-Knabner, I., Lehmann, J., Manning, D.A.C., Nannipieri, P., Rasse, D.P., Weiner, S. &amp; Trumbore, S.E.</strong> 2011. <span class="nocase">Persistence of soil organic matter as an ecosystem property</span>. <em>Nature</em>, 478(7367): 49–56. <a href="https://doi.org/10.1038/nature10386">https://doi.org/10.1038/nature10386</a>
</div>
<div id="ref-SCHULZE.2010" class="csl-entry">
<strong>Schulze, E.D., Ciais, P., Luyssaert, S., Schrumpf, M., Janssens, I.A., Thiruchittampalam, B., Theloke, J., Saurat, M., Bringezu, S., Lelieveld, J., Lohila, A., Rebmann, C., Jung, M., Bastviken, D., Abril, G., Grassi, G., Leip, A., Freibauer, A., Kutsch, W., Don, A., Nieschulze, J., Börner, A., Gash, J.H. &amp; Dolman, A.J.</strong> 2010. <span class="nocase">The European carbon balance. Part 4: integration of carbon and other trace-gas fluxes</span>. <em>Global change biology</em>, 16(5): 1451–1469. <a href="https://doi.org/10.1111/j.1365-2486.2010.02215.x">https://doi.org/10.1111/j.1365-2486.2010.02215.x</a>
</div>
<div id="ref-Shang.1998" class="csl-entry">
<strong>Shang, C. &amp; Tiessen, H.</strong> 1998. <span class="nocase">Organic Matter Stabilization in Two Semiarid Tropical Soils: Size, Density, and Magnetic Separations</span>. <em>Soil Science Society of America Journal</em>, 62(5): 1247–1257. <a href="https://doi.org/10.2136/sssaj1998.03615995006200050015x">https://doi.org/10.2136/sssaj1998.03615995006200050015x</a>
</div>
<div id="ref-Shirato.2004" class="csl-entry">
<strong>Shirato, Y., Hakamata, T. &amp; Taniyama, I.</strong> 2004. <span class="nocase">Modified rothamsted carbon model for andosols and its validation: changing humus decomposition rate constant with pyrophosphate-extractable Al</span>. <em>Soil Science and Plant Nutrition</em>, 50(1): 149–158. <a href="https://doi.org/10.1080/00380768.2004.10408463">https://doi.org/10.1080/00380768.2004.10408463</a>
</div>
<div id="ref-Shirato.2005" class="csl-entry">
<strong>Shirato, Y. &amp; Yokozawa, M.</strong> 2005. <span class="nocase">Applying the Rothamsted Carbon Model for Long-Term Experiments on Japanese Paddy Soils and Modifying It by Simple Tuning of the Decomposition Rate</span>. <em>Soil Science and Plant Nutrition</em>, 51(3): 405–415. <a href="https://doi.org/10.1111/j.1747-0765.2005.tb00046.x">https://doi.org/10.1111/j.1747-0765.2005.tb00046.x</a>
</div>
<div id="ref-Sierra.2012" class="csl-entry">
<strong>Sierra, C.A., Müller, M. &amp; Trumbore, S.E.</strong> 2012. <span class="nocase">Models of soil organic matter decomposition: the SoilR package, version 1.0</span>. <em>Geoscientific Model Development</em>, 5(4): 1045–1060. <a href="https://doi.org/10.5194/gmd-5-1045-2012">https://doi.org/10.5194/gmd-5-1045-2012</a>
</div>
<div id="ref-Sinclair.1996" class="csl-entry">
<strong>Sinclair, T.R. &amp; Seligman, N.G.</strong> 1996. <span class="nocase">Crop Modeling: From Infancy to Maturity</span>. <em>Agronomy Journal</em>, 88(5): 698–704. <a href="https://doi.org/10.2134/agronj1996.00021962008800050004x">https://doi.org/10.2134/agronj1996.00021962008800050004x</a>
</div>
<div id="ref-Six.2002" class="csl-entry">
<strong>Six, J., Conant, R.T., Paul, E.A. &amp; Paustian, K.</strong> 2002. <span class="nocase">Stabilization Mechanisms of Soil Organic Matter: Implications for C-Saturation of Soils</span>. <em>Plant and Soil</em>, 241(2): 155–176. <a href="https://doi.org/10.1023/A:1016125726789">https://doi.org/10.1023/A:1016125726789</a>
</div>
<div id="ref-SMITH.2005" class="csl-entry">
<strong>Smith, J.O., Smith, P., Wattenbach, M., Zaehle, S., Hiederer, R., Jones, R.J.A., Montanarella, L., Rounsevell, M.D.A., Reginster, I. &amp; Ewert, F.</strong> 2005. <span class="nocase">Projected changes in mineral soil carbon of European croplands and grasslands, 1990-2080</span>. <em>Global Change Biology</em>, 11(12): 2141–2152. <a href="https://doi.org/10.1111/j.1365-2486.2005.001075.x">https://doi.org/10.1111/j.1365-2486.2005.001075.x</a>
</div>
<div id="ref-Smith.2004" class="csl-entry">
<strong>Smith, P.</strong> 2004. <span class="nocase">How long before a change in soil organic carbon can be detected?</span> <em>Global Change Biology</em>, 10(11): 1878–1883. <a href="https://doi.org/10.1111/j.1365-2486.2004.00854.x">https://doi.org/10.1111/j.1365-2486.2004.00854.x</a>
</div>
<div id="ref-SMITH.1998" class="csl-entry">
<strong>Smith, P., Andrén, O., Brussaard, L., Dangerfield, M., Ekschmitt, K., Lavelle, P. &amp; Tate, K.</strong> 1998. <span class="nocase">Soil biota and global change at the ecosystem level: describing soil biota in mathematical models</span>. <em>Global Change Biology</em>, 4(7): 773–784. <a href="https://doi.org/10.1046/j.1365-2486.1998.00193.x">https://doi.org/10.1046/j.1365-2486.1998.00193.x</a>
</div>
<div id="ref-Smith.2000" class="csl-entry">
<strong>Smith, P. &amp; Falloon, P.D.</strong> 2000. <span class="nocase">Modelling refractory soil organic matter</span>. <em>Biology and Fertility of Soils</em>, 30(5-6): 388–398. <a href="https://doi.org/10.1007/s003740050019">https://doi.org/10.1007/s003740050019</a>
</div>
<div id="ref-Smith.2008" class="csl-entry">
<strong>Smith, P., Martino, D., Cai, Z., Gwary, D., Janzen, H., Kumar, P., McCarl, B., Ogle, S., O’Mara, F., Rice, C., Scholes, B., Sirotenko, O., Howden, M., McAllister, T., Pan, G., Romanenkov, V., Schneider, U., Towprayoon, S., WATTENBACH, M. &amp; Smith, J.</strong> 2008. <span class="nocase">Greenhouse gas mitigation in agriculture</span>. <em>Philosophical Transactions of the Royal Society of London. Series B: Biological Sciences</em>, 363(1492): 789–813. <a href="https://doi.org/10.1098/rstb.2007.2184">https://doi.org/10.1098/rstb.2007.2184</a>
</div>
<div id="ref-Smith.2007" class="csl-entry">
<strong>Smith, P., Smith, J.U., Franko, U., Kuka, K., Romanenkov, V.A., Shevtsova, L.K., Wattenbach, M., Gottschalk, P., Sirotenko, O.D., Rukhovich, D.I., Koroleva, P.V., Romanenko, I.A. &amp; Lisovoi, N.V.</strong> 2007. <span class="nocase">Changes in mineral soil organic carbon stocks in the croplands of European Russia and the Ukraine, 1990–2070; comparison of three models and implications for climate mitigation</span>. <em>Regional Environmental Change</em>, 7(2): 105–119. <a href="https://doi.org/10.1007/s10113-007-0028-2">https://doi.org/10.1007/s10113-007-0028-2</a>
</div>
<div id="ref-Smith.1997" class="csl-entry">
<strong>Smith, P., Smith, J.U., Powlson, D.S., McGill, W.B., Arah, J.R.M., Chertov, O.G., Coleman, K., Franko, U., Frolking, S., Jenkinson, D.S., Jensen, L.S., Kelly, R.H., Klein-Gunnewiek, H., Komarov, A.S., Li, C., Molina, J.A.E., Mueller, T., Parton, W.J., Thornley, J.H.M. &amp; Whitmore, A.P.</strong> 1997. <span class="nocase">A comparison of the performance of nine soil organic matter models using datasets from seven long-term experiments</span>. <em>Geoderma</em>, 81(1-2): 153–225. <a href="https://doi.org/10.1016/S0016-7061(97)00087-6">https://doi.org/10.1016/S0016-7061(97)00087-6</a>
</div>
<div id="ref-Smith.2020" class="csl-entry">
<strong>Smith, P., Soussana, J.-F., Angers, D., Schipper, L., Chenu, C., Rasse, D.P., Batjes, N.H., Egmond, F. van, McNeill, S., Kuhnert, M., Arias-Navarro, C., Olesen, J.E., Chirinda, N., Fornara, D., Wollenberg, E., Álvaro-Fuentes, J., Sanz-Cobena, A. &amp; Klumpp, K.</strong> 2020. <span class="nocase">How to measure, report and verify soil carbon change to realize the potential of soil carbon sequestration for atmospheric greenhouse gas removal</span>. <em>Global Change Biology</em>, 26(1): 219–241. <a href="https://doi.org/10.1111/gcb.14815">https://doi.org/10.1111/gcb.14815</a>
</div>
<div id="ref-Tifafi.2018" class="csl-entry">
<strong>Tifafi, M., Guenet, B. &amp; Hatté, C.</strong> 2018. <span class="nocase">Large Differences in Global and Regional Total Soil Carbon Stock Estimates Based on SoilGrids, HWSD, and NCSCD: Intercomparison and Evaluation Based on Field Data From USA, England, Wales, and France</span>. <em>Global Biogeochemical Cycles</em>, 32(1): 42–56. <a href="https://doi.org/10.1002/2017GB005678">https://doi.org/10.1002/2017GB005678</a>
</div>
<div id="ref-Vries.2018" class="csl-entry">
<strong>Vries, W. de</strong>. 2018. <span class="nocase">Soil carbon 4 per mille: a good initiative but let’s manage not only the soil but also the expectations</span>. <em>Geoderma</em>, 309: 111–112. <a href="https://doi.org/10.1016/j.geoderma.2017.05.023">https://doi.org/10.1016/j.geoderma.2017.05.023</a>
</div>
<div id="ref-Weihermuller.2013" class="csl-entry">
<strong>Weihermüller, L., Graf, A., Herbst, M. &amp; Vereecken, H.</strong> 2013. <span class="nocase">Simple pedotransfer functions to initialize reactive carbon pools of the RothC model</span>. <em>European Journal of Soil Science</em>, 64(5): 567–575. <a href="https://doi.org/10.1111/ejss.12036">https://doi.org/10.1111/ejss.12036</a>
</div>
<div id="ref-Wieder.2014" class="csl-entry">
<strong>Wieder, W.R., Grandy, A.S., Kallenbach, C.M. &amp; Bonan, G.B.</strong> 2014. <span class="nocase">Integrating microbial physiology and physio-chemical principles in soils with the MIcrobial-MIneral Carbon Stabilization (MIMICS) model</span>. <em>Biogeosciences</em>, 11(14): 3899–3917. <a href="https://doi.org/10.5194/bg-11-3899-2014">https://doi.org/10.5194/bg-11-3899-2014</a>
</div>
<div id="ref-Wiesmeier.2016" class="csl-entry">
<strong>Wiesmeier, M., Poeplau, C., Sierra, C.A., Maier, H., Frühauf, C., Hübner, R., Kühnel, A., Spörlein, P., Geuß, U., Hangen, E., Schilling, B., Lützow, M. von &amp; Kögel-Knabner, I.</strong> 2016. <span class="nocase">Projected loss of soil organic carbon in temperate agricultural soils in the 21(st) century: effects of climate change and carbon input trends</span>. <em>Scientific reports</em>, 6: 32525. <a href="https://doi.org/10.1038/srep32525">https://doi.org/10.1038/srep32525</a>
</div>
<div id="ref-Wiesmeier.2014" class="csl-entry">
<strong>Wiesmeier, M., Schad, P., Lützow, M. von, Poeplau, C., Spörlein, P., Geuß, U., Hangen, E., Reischl, A., Schilling, B. &amp; Kögel-Knabner, I.</strong> 2014. <span class="nocase">Quantification of functional soil organic carbon pools for major soil units and land uses in southeast Germany (Bavaria)</span>. <em>Agriculture, Ecosystems <span>&amp;</span> Environment</em>, 185: 208–220. <a href="https://doi.org/10.1016/j.agee.2013.12.028">https://doi.org/10.1016/j.agee.2013.12.028</a>
</div>
<div id="ref-Williams.1983" class="csl-entry">
<strong>Williams, J.R., Dyke, P.T. &amp; Jones, C.A.</strong> 1983. <span class="nocase">Epic - a Model for Assessing the Effects of Erosion on Soil Productivity</span>. <em>In</em> W.K. Lauenroth, G.V. Skogerboe &amp; M. Flug, eds. <em>Analysis of ecological systems</em>, pp. 553–572. Developments in environmental modelling. Armstrong; Oxford, Elsevier Scientific.
</div>
<div id="ref-FoodandAgricultureOrganizationoftheUnitedNationsissuingbody.2018" class="csl-entry">
<strong>Yigini, Y., Olmedo, G.F., Reiter, S., Baritz, R., Viatkin, K. &amp; Vargas, R.</strong> 2018. <em><span class="nocase">Soil organic carbon mapping cookbook</span></em>. 2nd editio edition. Rome, FAO; FAO.
</div>
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
