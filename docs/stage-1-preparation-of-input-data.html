<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 | Stage 1: preparation of input data | Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq</title>
  <meta name="description" content="The GSOCseq Technical Manual" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 | Stage 1: preparation of input data | Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The GSOCseq Technical Manual" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 | Stage 1: preparation of input data | Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq" />
  
  <meta name="twitter:description" content="The GSOCseq Technical Manual" />
  

<meta name="author" content="Food and Agriculture Organization of the United Nations, Rome, 2020" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="running-the-scripts-overview.html"/>
<link rel="next" href="stage-2-running-the-model-1.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>List of contributors</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributers-and-reviewers"><i class="fa fa-check"></i>Contributers and Reviewers</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#special-advisor"><i class="fa fa-check"></i>Special Advisor</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#github-page"><i class="fa fa-check"></i>GitHub Page</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="presentation.html"><a href="presentation.html"><i class="fa fa-check"></i><b>1</b> | Presentation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="presentation.html"><a href="presentation.html#how-to-use-this-book"><i class="fa fa-check"></i><b>1.1</b> How to use this book</a></li>
<li class="chapter" data-level="1.2" data-path="presentation.html"><a href="presentation.html#the-sample-data-set"><i class="fa fa-check"></i><b>1.2</b> The sample data set</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="soil-organic-carbon-soc-sequestration.html"><a href="soil-organic-carbon-soc-sequestration.html"><i class="fa fa-check"></i><b>2</b> | Soil Organic Carbon (SOC) sequestration</a>
<ul>
<li class="chapter" data-level="2.1" data-path="soil-organic-carbon-soc-sequestration.html"><a href="soil-organic-carbon-soc-sequestration.html#soil-carbon"><i class="fa fa-check"></i><b>2.1</b> Soil carbon</a></li>
<li class="chapter" data-level="2.2" data-path="soil-organic-carbon-soc-sequestration.html"><a href="soil-organic-carbon-soc-sequestration.html#soc-sequestration"><i class="fa fa-check"></i><b>2.2</b> SOC sequestration</a></li>
<li class="chapter" data-level="2.3" data-path="soil-organic-carbon-soc-sequestration.html"><a href="soil-organic-carbon-soc-sequestration.html#factors-affecting-soc-sequestration"><i class="fa fa-check"></i><b>2.3</b> Factors affecting SOC sequestration</a></li>
<li class="chapter" data-level="2.4" data-path="soil-organic-carbon-soc-sequestration.html"><a href="soil-organic-carbon-soc-sequestration.html#estimating-soc-sequestration-potential"><i class="fa fa-check"></i><b>2.4</b> Estimating SOC sequestration potential</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="soc-modelling.html"><a href="soc-modelling.html"><i class="fa fa-check"></i><b>3</b> | SOC Modelling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="soc-modelling.html"><a href="soc-modelling.html#process-oriented-models"><i class="fa fa-check"></i><b>3.1</b> Process-oriented models</a></li>
<li class="chapter" data-level="3.2" data-path="soc-modelling.html"><a href="soc-modelling.html#examples-of-process-oriented-models"><i class="fa fa-check"></i><b>3.2</b> Examples of process-oriented models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="the-rothc-model.html"><a href="the-rothc-model.html"><i class="fa fa-check"></i><b>4</b> | The RothC model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="the-rothc-model.html"><a href="the-rothc-model.html#model-description"><i class="fa fa-check"></i><b>4.1</b> Model description</a></li>
<li class="chapter" data-level="4.2" data-path="the-rothc-model.html"><a href="the-rothc-model.html#rothc-general-data-requirements"><i class="fa fa-check"></i><b>4.2</b> RothC general data requirements</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html"><i class="fa fa-check"></i><b>5</b> | Modelling approach for the GSOCseq</a>
<ul>
<li class="chapter" data-level="5.1" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#general-framework"><i class="fa fa-check"></i><b>5.1</b> General framework</a></li>
<li class="chapter" data-level="5.2" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#potential-soc-sequestration-estimates-after-the-implementation-of-ssm-practices"><i class="fa fa-check"></i><b>5.2</b> Potential SOC sequestration estimates after the implementation of SSM practices</a></li>
<li class="chapter" data-level="5.3" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#business-as-usual-and-sustainable-soil-management-scenarios"><i class="fa fa-check"></i><b>5.3</b> Business as usual and sustainable soil management scenarios</a></li>
<li class="chapter" data-level="5.4" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#general-modeling-procedures"><i class="fa fa-check"></i><b>5.4</b> General modeling procedures</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#initialization-long-spin-up"><i class="fa fa-check"></i><b>5.4.1</b> Initialization: Long spin-up</a></li>
<li class="chapter" data-level="5.4.2" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#short-spin-up"><i class="fa fa-check"></i><b>5.4.2</b> Short spin-up</a></li>
<li class="chapter" data-level="5.4.3" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#forward-runs"><i class="fa fa-check"></i><b>5.4.3</b> Forward runs</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#summary"><i class="fa fa-check"></i><b>5.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html"><i class="fa fa-check"></i><b>6</b> | Data sets and inputs</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#climate-data-sets"><i class="fa fa-check"></i><b>6.1</b> Climate data sets</a></li>
<li class="chapter" data-level="6.2" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#soil-data-sets"><i class="fa fa-check"></i><b>6.2</b> Soil data sets</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#initial-total-soc-stocks"><i class="fa fa-check"></i><b>6.2.1</b> Initial total SOC stocks</a></li>
<li class="chapter" data-level="6.2.2" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#initial-c-pools"><i class="fa fa-check"></i><b>6.2.2</b> Initial C pools</a></li>
<li class="chapter" data-level="6.2.3" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#soil-texture-clay-content"><i class="fa fa-check"></i><b>6.2.3</b> Soil texture: clay content</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#land-cover-data-sets"><i class="fa fa-check"></i><b>6.3</b> Land cover data sets</a></li>
<li class="chapter" data-level="6.4" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#monthly-vegetation-cover"><i class="fa fa-check"></i><b>6.4</b> Monthly vegetation cover</a></li>
<li class="chapter" data-level="6.5" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#monthly-carbon-inputs"><i class="fa fa-check"></i><b>6.5</b> Monthly carbon inputs:</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#c-inputs-under-bau-practices"><i class="fa fa-check"></i><b>6.5.1</b> C inputs under BAU practices:</a></li>
<li class="chapter" data-level="6.5.2" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#c-inputs-under-ssm-practices"><i class="fa fa-check"></i><b>6.5.2</b> C inputs under SSM practices:</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#residue-decomposability-decomposable-to-resistant-plant-material-ratio-dpmrpm"><i class="fa fa-check"></i><b>6.6</b> Residue decomposability: decomposable to resistant plant material ratio (DPM/RPM)</a></li>
<li class="chapter" data-level="6.7" data-path="data-sets-and-inputs.html"><a href="data-sets-and-inputs.html#required-data-sets-and-global-data-sources.-summary"><i class="fa fa-check"></i><b>6.7</b> Required data sets and global data sources. Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="software-environment.html"><a href="software-environment.html"><i class="fa fa-check"></i><b>7</b> | Software environment</a>
<ul>
<li class="chapter" data-level="7.1" data-path="software-environment.html"><a href="software-environment.html#setting-up-the-software-environment-r-rstudio-and-r-packages"><i class="fa fa-check"></i><b>7.1</b> Setting up the software environment: R, RStudio and R Packages</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="software-environment.html"><a href="software-environment.html#obtaining-and-installing-r"><i class="fa fa-check"></i><b>7.1.1</b> Obtaining and installing R</a></li>
<li class="chapter" data-level="7.1.2" data-path="software-environment.html"><a href="software-environment.html#obtaining-and-installing-rstudio"><i class="fa fa-check"></i><b>7.1.2</b> Obtaining and installing RStudio</a></li>
<li class="chapter" data-level="7.1.3" data-path="software-environment.html"><a href="software-environment.html#getting-started-with-r"><i class="fa fa-check"></i><b>7.1.3</b> Getting started with R</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="software-environment.html"><a href="software-environment.html#r-packages"><i class="fa fa-check"></i><b>7.2</b> R packages</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="software-environment.html"><a href="software-environment.html#finding-r-packages"><i class="fa fa-check"></i><b>7.2.1</b> Finding R packages</a></li>
<li class="chapter" data-level="7.2.2" data-path="software-environment.html"><a href="software-environment.html#some-useful-r-packages-for-the-socseq-maps"><i class="fa fa-check"></i><b>7.2.2</b> Some useful R-packages for the SOCseq maps</a></li>
<li class="chapter" data-level="7.2.3" data-path="software-environment.html"><a href="software-environment.html#installation-of-r-packages-used-in-this-technical-manual"><i class="fa fa-check"></i><b>7.2.3</b> Installation of R-Packages used in this technical manual</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="software-environment.html"><a href="software-environment.html#considerations-when-using-r"><i class="fa fa-check"></i><b>7.3</b> Considerations when using R</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html"><i class="fa fa-check"></i><b>8</b> | Running the scripts: overview</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html#summary-of-steps-and-scripts"><i class="fa fa-check"></i><b>8.1</b> Summary of steps and scripts</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html#stage-1-preparation-of-data"><i class="fa fa-check"></i><b>8.2</b> Stage 1: Preparation of data</a></li>
<li class="chapter" data-level="8.3" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html#stage-2-running-the-model"><i class="fa fa-check"></i><b>8.3</b> Stage 2: Running the model</a></li>
<li class="chapter" data-level="8.4" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html#stage-3-generation-of-the-map"><i class="fa fa-check"></i><b>8.4</b> Stage 3: generation of the map</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html"><i class="fa fa-check"></i><b>9</b> | Stage 1: preparation of input data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#preparation-of-soc-layer"><i class="fa fa-check"></i><b>9.1</b> Preparation of SOC layer</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-0.soc_map_aoi.r"><i class="fa fa-check"></i><b>9.1.1</b> Script Number 0.“SOC_MAP_AOI.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#preparation-of-climate-layers"><i class="fa fa-check"></i><b>9.2</b> Preparation of climate Layers</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#option-a-preparation-of-the-cru-climatic-variables"><i class="fa fa-check"></i><b>9.2.1</b> <em>Option A</em> Preparation of the CRU climatic variables</a></li>
<li class="chapter" data-level="9.2.2" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#option-b-preparation-of-the-terraclimate-climatic-variables"><i class="fa fa-check"></i><b>9.2.2</b> <em>Option B</em> Preparation of the TerraClimate climatic variables</a></li>
<li class="chapter" data-level="9.2.3" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-6.-monthly_vegetation_cover-vegetation-cover-from-google-earth-engine."><i class="fa fa-check"></i><b>9.2.3</b> Script Number 6. “Monthly_vegetation_cover” vegetation cover from Google Earth Engine.</a></li>
<li class="chapter" data-level="9.2.4" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-7.-vegetation_cover_stack.r"><i class="fa fa-check"></i><b>9.2.4</b> Script Number 7. “Vegetation_Cover_stack.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#preparing-the-land-use-layer"><i class="fa fa-check"></i><b>9.3</b> Preparing the land use layer</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-9-land_use_esa_to_fao_classes.r-no-land-use-change"><i class="fa fa-check"></i><b>9.3.1</b> Script Number 9 “Land_Use_ESA_to_FAO_classes.R” No land use change</a></li>
<li class="chapter" data-level="9.3.2" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-9-land_use_esa_to_fao_classes_lusim.r-land-use-change-simulation"><i class="fa fa-check"></i><b>9.3.2</b> Script Number 9 “Land_Use_ESA_to_FAO_classes_LUsim.R” Land use change simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#harmonization-of-soil-climate-and-vegetation-layers."><i class="fa fa-check"></i><b>9.4</b> Harmonization of soil, climate and vegetation layers.</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-10.-spin_up_stack.v3.r"><i class="fa fa-check"></i><b>9.4.1</b> Script Number 10. “SPIN_UP_STACK.v3.R”</a></li>
<li class="chapter" data-level="9.4.2" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-11.-warm_up_stack_v5.r-no-land-use-change"><i class="fa fa-check"></i><b>9.4.2</b> Script Number 11. “WARM_UP_STACK_V5.R” No Land use change</a></li>
<li class="chapter" data-level="9.4.3" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-11.-warm_up_stack_v5_lusim.r-land-use-change-simulation"><i class="fa fa-check"></i><b>9.4.3</b> Script Number 11. WARM_UP_STACK_V5_LUsim.R Land use change simulation</a></li>
<li class="chapter" data-level="9.4.4" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-12.-forward_stack.r"><i class="fa fa-check"></i><b>9.4.4</b> Script Number 12. “FORWARD_STACK.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#defining-target-points-to-run-the-model"><i class="fa fa-check"></i><b>9.5</b> Defining target points to run the model</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#qgis-procedure-number-1-model"><i class="fa fa-check"></i><b>9.5.1</b> QGIS Procedure number 1 (model)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="stage-2-running-the-model-1.html"><a href="stage-2-running-the-model-1.html"><i class="fa fa-check"></i><b>10</b> | Stage 2: running the model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="stage-2-running-the-model-1.html"><a href="stage-2-running-the-model-1.html#script-number-13.-roth_c_spin_up_v2.r"><i class="fa fa-check"></i><b>10.1</b> Script Number 13. “ROTH_C_SPIN_UP_v2.R”</a></li>
<li class="chapter" data-level="10.2" data-path="stage-2-running-the-model-1.html"><a href="stage-2-running-the-model-1.html#script-number-14.-roth_c_warm_up_v4.r-no-land-use-change"><i class="fa fa-check"></i><b>10.2</b> Script Number 14. “ROTH_C_WARM_UP_v4.R” No Land use change</a></li>
<li class="chapter" data-level="10.3" data-path="stage-2-running-the-model-1.html"><a href="stage-2-running-the-model-1.html#script-number-14.-roth_c_warm_up_v4.r-land-use-change-simulation"><i class="fa fa-check"></i><b>10.3</b> Script Number 14. “ROTH_C_WARM_UP_v4.R” Land use change simulation</a></li>
<li class="chapter" data-level="10.4" data-path="stage-2-running-the-model-1.html"><a href="stage-2-running-the-model-1.html#script-number-15.-roth_c_forward_v2.r"><i class="fa fa-check"></i><b>10.4</b> Script Number 15. “ROTH_C_forward_v2.R”</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="stage-3-map-generation.html"><a href="stage-3-map-generation.html"><i class="fa fa-check"></i><b>11</b> | Stage 3: Map generation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="stage-3-map-generation.html"><a href="stage-3-map-generation.html#script-number-16-points_to_raster.r"><i class="fa fa-check"></i><b>11.1</b> Script Number 16: “Points_to_Raster.R”</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="uncertainty-and-validation.html"><a href="uncertainty-and-validation.html"><i class="fa fa-check"></i><b>12</b> | Uncertainty and validation</a></li>
<li class="chapter" data-level="13" data-path="data-sharing.html"><a href="data-sharing.html"><i class="fa fa-check"></i><b>13</b> | Data sharing</a>
<ul>
<li class="chapter" data-level="13.1" data-path="data-sharing.html"><a href="data-sharing.html#general-principles"><i class="fa fa-check"></i><b>13.1</b> General principles</a></li>
<li class="chapter" data-level="13.2" data-path="data-sharing.html"><a href="data-sharing.html#data-formats-and-integrity"><i class="fa fa-check"></i><b>13.2</b> Data formats and integrity</a></li>
<li class="chapter" data-level="13.3" data-path="data-sharing.html"><a href="data-sharing.html#data-correctness"><i class="fa fa-check"></i><b>13.3</b> Data correctness</a></li>
<li class="chapter" data-level="13.4" data-path="data-sharing.html"><a href="data-sharing.html#data-completeness"><i class="fa fa-check"></i><b>13.4</b> Data completeness</a></li>
<li class="chapter" data-level="13.5" data-path="data-sharing.html"><a href="data-sharing.html#other-modes-of-data-sharing"><i class="fa fa-check"></i><b>13.5</b> Other modes of data sharing</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="limitations-knowledge-gaps-and-way-forward.html"><a href="limitations-knowledge-gaps-and-way-forward.html"><i class="fa fa-check"></i><b>14</b> | Limitations, knowledge gaps and way forward</a></li>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html"><i class="fa fa-check"></i>Annex I Troubleshooting</a>
<ul>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html#coastal-and-small-countries-not-fully-covered-by-the-cru-layers"><i class="fa fa-check"></i>Coastal and small countries not fully covered by the CRU layers</a>
<ul>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html#step-1-create-a-single-cru-layer-cropped-and-masked-to-the-extent-of-your-aoi-using-the-following-r-script"><i class="fa fa-check"></i>Step 1 Create a single CRU layer cropped and masked to the extent of your AOI using the following R script</a></li>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html#step-2-open-qgis-and-generate-the-empty-points"><i class="fa fa-check"></i>Step 2 Open QGIS and generate the empty points</a></li>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html#step-3-polygonize-the-raster"><i class="fa fa-check"></i>Step 3 Polygonize the raster</a></li>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html#step-4-select-points-outside-of-the-polygon"><i class="fa fa-check"></i>Step 4 Select points outside of the polygon</a></li>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html#step-5-export-the-extracted-points"><i class="fa fa-check"></i>Step 5 Export the extracted points</a></li>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html#step-6-run-the-spin-up-phase-for-points-outside-the-cru-layer-script-13b"><i class="fa fa-check"></i>Step 6 Run the Spin up phase for points outside the CRU layer (Script 13B)</a></li>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html#step-7-run-the-warm-up-phase-for-points-outside-the-cru-layer-script-14b"><i class="fa fa-check"></i>Step 7 Run the Warm up phase for points outside the CRU layer (Script 14B)</a></li>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html#step-8-run-the-forward-phase-for-points-outside-the-cru-layer-script-15b"><i class="fa fa-check"></i>Step 8 Run the Forward phase for points outside the CRU layer (Script 15B)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="annex-i-troubleshooting.html"><a href="annex-i-troubleshooting.html#common-errors-and-considerations"><i class="fa fa-check"></i>Common errors and considerations</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html"><i class="fa fa-check"></i>Annex II Quality assurance and quality control</a>
<ul>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#step-1-check-that-29-products-have-been-labeled-appropriately-and-are-in-the-correct-format"><i class="fa fa-check"></i>Step 1 Check that 29 products have been labeled appropriately and are in the correct format</a></li>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#step-2-check-the-projection-and-resolution-of-all-products"><i class="fa fa-check"></i>Step 2 Check the Projection and resolution of all products</a></li>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#step-3-check-that-the-products-were-generated-for-agricultural-and-grazing-areas-only"><i class="fa fa-check"></i>Step 3 Check that the products were generated for agricultural and grazing areas only</a></li>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#step-4-check-for-units-range-and-outliers"><i class="fa fa-check"></i>Step 4 Check for units, range, and outliers</a>
<ul>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#soil-organic-carbon-at-t0-2020"><i class="fa fa-check"></i>Soil Organic Carbon at T0 (2020)</a></li>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#final-soc-stocks-after-20-simulation-years-for-all-scenarios-bau-ssm1-ssm2-ssm3"><i class="fa fa-check"></i>Final SOC stocks after 20 simulation years for all scenarios (BAU, SSM1, SSM2, SSM3)</a></li>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#absolute-differences-in-soc-stocks"><i class="fa fa-check"></i>Absolute differences in SOC stocks</a></li>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#relative-differences-in-soc-stocks"><i class="fa fa-check"></i>Relative differences in SOC stocks</a></li>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#absolute-sequestration-rates-asr"><i class="fa fa-check"></i>Absolute sequestration rates (ASR)</a></li>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#relative-sequestration-rates-rsr"><i class="fa fa-check"></i>Relative sequestration rates (RSR)</a></li>
<li class="chapter" data-level="" data-path="annex-ii-quality-assurance-and-quality-control.html"><a href="annex-ii-quality-assurance-and-quality-control.html#uncertainties"><i class="fa fa-check"></i>Uncertainties</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>15</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stage-1-preparation-of-input-data" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> | Stage 1: preparation of input data</h1>
<p>This stage is aimed at:</p>
<ul>
<li>preparing, organizing and harmonizing all the required input data layers to run the model in the different phases;</li>
<li>creating supplementary input data layers;</li>
<li>creating target points for land use classes of interests.</li>
</ul>
<p>During this stage we will need to arrange and prepare climate datasets for the different modelling phases, generate NPP estimates for each phase, generate vegetation cover data, prepare clay content data layers, and harmonize and stack all layers for each modelling phase. Finally, we will have to create target points to run the model. This stage requires the most effort and is the most time consuming of the entire process. Eleven R scripts, one QGIS script and one Google earth engine script are provided to complete these tasks.</p>
<div id="preparation-of-soc-layer" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Preparation of SOC layer</h2>
<p>As a default option, users are invited to use the GSOCmap to retrieve their SOC data for their area of interest (AOI). This can be achieved easily, by clipping the GSOCmap to the extent of a shapefile making up the borders of the chosen study area or country. All data sources can be found in Table 6.3 of Chapter 6.</p>
<div id="script-number-0.soc_map_aoi.r" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Script Number 0.“SOC_MAP_AOI.R”</h3>
<p><strong>Table 9.1</strong> <em>Script Number 0. Preparation of the Soil Organic Carbon SOC layer. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.0.png" /></p>
<p>First, open the scrip SOC_MAP_AOI.R in RStudio. If you haven’t done so previously install the necessary packages. Then create two user-defined variables containing the paths to the two working directories:
* “WD_AOI” which contains the vector polygon of the AOI;
* “WD_GSOC”, which contains the GSOCmap raster layer</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="stage-1-preparation-of-input-data.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Install all necessary packages</span></span>
<span id="cb3-2"><a href="stage-1-preparation-of-input-data.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;raster&quot;</span>,<span class="st">&quot;rgdal&quot;</span>,<span class="st">&quot;SoilR&quot;</span>,<span class="st">&quot;Formula&quot;</span>,<span class="st">&quot;soilassessment&quot;</span>,<span class="st">&quot;abind&quot;</span>,<span class="st">&quot;ncdf4&quot;</span>))</span>
<span id="cb3-3"><a href="stage-1-preparation-of-input-data.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="stage-1-preparation-of-input-data.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the packages into R</span></span>
<span id="cb3-5"><a href="stage-1-preparation-of-input-data.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb3-6"><a href="stage-1-preparation-of-input-data.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb3-7"><a href="stage-1-preparation-of-input-data.html#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="stage-1-preparation-of-input-data.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the path to GSOCmap and Area of interest (AOI) vector.</span></span>
<span id="cb3-9"><a href="stage-1-preparation-of-input-data.html#cb3-9" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb3-10"><a href="stage-1-preparation-of-input-data.html#cb3-10" aria-hidden="true" tabindex="-1"></a>WD_GSOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb3-11"><a href="stage-1-preparation-of-input-data.html#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="stage-1-preparation-of-input-data.html#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the AOI (region/country)</span></span>
<span id="cb3-13"><a href="stage-1-preparation-of-input-data.html#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb3-14"><a href="stage-1-preparation-of-input-data.html#cb3-14" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb3-15"><a href="stage-1-preparation-of-input-data.html#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="stage-1-preparation-of-input-data.html#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Open FAO GSOC MAP </span></span>
<span id="cb3-17"><a href="stage-1-preparation-of-input-data.html#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_GSOC)</span>
<span id="cb3-18"><a href="stage-1-preparation-of-input-data.html#cb3-18" aria-hidden="true" tabindex="-1"></a>SOC_MAP<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;GSOCmap_1.6.1.tif&quot;</span>)</span></code></pre></div>
<p>Finally, we clip the SOC layer with the vector polygon of the AOI and save the result to the WD_SOC folder. This layer will become the master layer of the process.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="stage-1-preparation-of-input-data.html#cb4-1" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(SOC_MAP,AOI)</span>
<span id="cb4-2"><a href="stage-1-preparation-of-input-data.html#cb4-2" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(SOC_MAP_AOI,AOI)</span>
<span id="cb4-3"><a href="stage-1-preparation-of-input-data.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(SOC_MAP_AOI,<span class="at">filename=</span><span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="preparation-of-climate-layers" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Preparation of climate Layers</h2>
<p>The climate variables needed for the three modeling phases are:</p>
<ol style="list-style-type: decimal">
<li>Monthly rainfall (mm/month);<br />
</li>
<li>Monthly Evapotranspiration (mm/month);</li>
<li>Average monthly mean air temperature (average <span class="math inline">\(^\circ\)</span>C/month).</li>
</ol>
<p>We will need to arrange these climatic variables into three datasets:</p>
<ul>
<li>1980-2000 (monthly average values for the complete series)</li>
<li>2001-2020 (year to year monthly values)</li>
<li>2001-2020 (monthly average values for the complete series)</li>
</ul>
<p>Gridded climate data shall be obtained from either National Sources or regional or global datasets when national gridded historical climate datasets are not available. The recommended global data source of these layers are:</p>
<ul>
<li>The Climate Research Unit (<a href="http://www.cru.uea.ac.uk/" class="uri">http://www.cru.uea.ac.uk/</a>)</li>
<li>TerraClimate (readily available from the Google Earth Engine catalogue: <a href="https://developers.google.com/earth-engine/datasets/catalog/IDAHO_EPSCOR_TERRACLIMATE#citations" class="uri">https://developers.google.com/earth-engine/datasets/catalog/IDAHO_EPSCOR_TERRACLIMATE#citations</a>)</li>
</ul>
<p>For countries wanting to use the TerraClimate or the CRU data set, several scripts to obtain and to reformat the climate spatial layers to run the three modelling phases, will be presented. Users can prepare the necessary input climate data sets using other data sources. However, these scripts may still be helpful to guide the preparation process of other data sets, and as a guide of the required outputs that will be needed as inputs for the different modeling phases. Due to the coarse resolution of the CRU data set, small and/or coastal countries may encounter issues with the data set.</p>
<p>It is important to note that the CRU layers do not cover countries in their entirety. To overcome this, this revised version of the Technical Manual provides two options:</p>
<ol style="list-style-type: decimal">
<li>Perform the whole procedure with higher resolution climate layers again for every point. We have provided scripts to download and prepare TerraClimate climatic layers.</li>
<li>Re-running the model only for those points that fall outside of the CRU layer using the provided scripts that include a line of code that fills NA values with the average of all surrounding pixel values (Annex).</li>
</ol>
<p>For both cases a detailed step by step guideline is provided.</p>
<p>The preparation of the climate data depending on whether a user selects the CRU (Option A) or TerraClimate (option B) data set is presented in the flowchart below (Figure 9.0). To make use of the TerraClimate dataset, users need to first download the data for the time periods 1980-2000 and 2001-2018 using two scripts for Google Earth Egine (GEE) and subsequently prepare the target climatic variables using two R scripts.</p>
<div class="figure">
<img src="images/Figure_9.0.png" alt="" />
<p class="caption">Figure 9.0 Script order to follow depending on wether CRU or TerraClimate data sets are selected</p>
</div>
<p>Additionally, in the ANNEX a small guide is provided to overcome issues linked to the use of CRU layers in coastal and small countries.</p>
<hr />
<div id="option-a-preparation-of-the-cru-climatic-variables" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> <em>Option A</em> Preparation of the CRU climatic variables</h3>
<div id="script-number-1.-cru_variables_spin_up.r" class="section level4" number="9.2.1.1">
<h4><span class="header-section-number">9.2.1.1</span> Script Number 1. “CRU_variables_SPIN_UP.R”</h4>
<p>For each modelling phase we will need a different selection of climate layers. For phase 1 (“Long Spin up”), we will need to stack 12 spatial layers (the output file will be a multiband raster layer) for each climate variable mentioned above (temperature, precipitation and evapotranspiration). The time series for this initial phase goes from 1981 to 2000. The script number 1 will transform the downloaded CRU files to geotiff raster files and obtain monthly averages (temperature, precipitation, evapotranspiration) for the 1981-2000 series, ready to be used in the spin up modelling phase.</p>
<p><strong>Table 9.2</strong> <em>Script Number 1.1 Preparation of CRU datasets for the “Long Spin Up phase”. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.1.png" /></p>
<p>Open the script CRU_variables_SPIN_UP.R in RStudio.<br />
The first lines begin with “#”, which indicates that these lines are commented. From line 7 to line 10, the script loads the required packages into R.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="stage-1-preparation-of-input-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb5-2"><a href="stage-1-preparation-of-input-data.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb5-3"><a href="stage-1-preparation-of-input-data.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb5-4"><a href="stage-1-preparation-of-input-data.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind)</span></code></pre></div>
<p>From line 15 to line 48 the script opens two nc files (1981-1990 and 1991-2000 periods), from a local directory to be defined with the setwd function and converts them into an internal variable called “tmp”. Here we will have to set the path to the local directory of the two temperature files downloaded from the CRU site. Remember to unzip the CRU files.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="stage-1-preparation-of-input-data.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Set working directory</span></span>
<span id="cb6-2"><a href="stage-1-preparation-of-input-data.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Set working directory</span></span>
<span id="cb6-3"><a href="stage-1-preparation-of-input-data.html#cb6-3" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb6-4"><a href="stage-1-preparation-of-input-data.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb6-5"><a href="stage-1-preparation-of-input-data.html#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="stage-1-preparation-of-input-data.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb6-7"><a href="stage-1-preparation-of-input-data.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Open nc temperature file 1981-1990 unzip the cru files</span></span>
<span id="cb6-8"><a href="stage-1-preparation-of-input-data.html#cb6-8" aria-hidden="true" tabindex="-1"></a>nc_temp_81_90<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.tmp.dat.nc&quot;</span>)</span>
<span id="cb6-9"><a href="stage-1-preparation-of-input-data.html#cb6-9" aria-hidden="true" tabindex="-1"></a>lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb6-10"><a href="stage-1-preparation-of-input-data.html#cb6-10" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb6-11"><a href="stage-1-preparation-of-input-data.html#cb6-11" aria-hidden="true" tabindex="-1"></a>t_81_90 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb6-12"><a href="stage-1-preparation-of-input-data.html#cb6-12" aria-hidden="true" tabindex="-1"></a>tmp_81_90<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb6-13"><a href="stage-1-preparation-of-input-data.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#close de nc temperature file</span></span>
<span id="cb6-14"><a href="stage-1-preparation-of-input-data.html#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">nc_close</span>(nc_temp_81_90) </span>
<span id="cb6-15"><a href="stage-1-preparation-of-input-data.html#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Open nc temperature file 1991-2000</span></span>
<span id="cb6-16"><a href="stage-1-preparation-of-input-data.html#cb6-16" aria-hidden="true" tabindex="-1"></a>nc_temp_91_00<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.tmp.dat.nc&quot;</span>)</span>
<span id="cb6-17"><a href="stage-1-preparation-of-input-data.html#cb6-17" aria-hidden="true" tabindex="-1"></a>lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb6-18"><a href="stage-1-preparation-of-input-data.html#cb6-18" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb6-19"><a href="stage-1-preparation-of-input-data.html#cb6-19" aria-hidden="true" tabindex="-1"></a>t_91_00 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb6-20"><a href="stage-1-preparation-of-input-data.html#cb6-20" aria-hidden="true" tabindex="-1"></a>tmp_91_00<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb6-21"><a href="stage-1-preparation-of-input-data.html#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#close de nc temperature file</span></span>
<span id="cb6-22"><a href="stage-1-preparation-of-input-data.html#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="fu">nc_close</span>(nc_temp_91_00) </span>
<span id="cb6-23"><a href="stage-1-preparation-of-input-data.html#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb6-24"><a href="stage-1-preparation-of-input-data.html#cb6-24" aria-hidden="true" tabindex="-1"></a>tmp<span class="ot">&lt;-</span><span class="fu">abind</span>(tmp_81_90,tmp_91_00)</span></code></pre></div>
<p>Then the script generates a variable to be used later on called “tmp_Jan_1”:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="stage-1-preparation-of-input-data.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get one month temperature ( January)</span></span>
<span id="cb7-2"><a href="stage-1-preparation-of-input-data.html#cb7-2" aria-hidden="true" tabindex="-1"></a> tmp_Jan_1<span class="ot">&lt;-</span>tmp[,,<span class="dv">1</span>]</span>
<span id="cb7-3"><a href="stage-1-preparation-of-input-data.html#cb7-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(tmp_Jan_1)</span></code></pre></div>
<p>Now, all the settings for this part of the script are done. The user just has to go on running the rest of the script until the “Precipitation” code begins where “Precipitation” files will be needed.
The code below will generate one temperature file, consisting of a stack of 12 raster files with an average of 20 years for each month. Each raster corresponds to a month.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="stage-1-preparation-of-input-data.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb8-2"><a href="stage-1-preparation-of-input-data.html#cb8-2" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb8-3"><a href="stage-1-preparation-of-input-data.html#cb8-3" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb8-4"><a href="stage-1-preparation-of-input-data.html#cb8-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb8-5"><a href="stage-1-preparation-of-input-data.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb8-6"><a href="stage-1-preparation-of-input-data.html#cb8-6" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb8-7"><a href="stage-1-preparation-of-input-data.html#cb8-7" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>tmp_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb8-8"><a href="stage-1-preparation-of-input-data.html#cb8-8" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb8-9"><a href="stage-1-preparation-of-input-data.html#cb8-9" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb8-10"><a href="stage-1-preparation-of-input-data.html#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb8-11"><a href="stage-1-preparation-of-input-data.html#cb8-11" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> tmp[,,k])</span>
<span id="cb8-12"><a href="stage-1-preparation-of-input-data.html#cb8-12" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb8-13"><a href="stage-1-preparation-of-input-data.html#cb8-13" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb8-14"><a href="stage-1-preparation-of-input-data.html#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb8-15"><a href="stage-1-preparation-of-input-data.html#cb8-15" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span><span class="dv">20</span></span>
<span id="cb8-16"><a href="stage-1-preparation-of-input-data.html#cb8-16" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Temp_1981_2000_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb8-17"><a href="stage-1-preparation-of-input-data.html#cb8-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb8-18"><a href="stage-1-preparation-of-input-data.html#cb8-18" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb8-19"><a href="stage-1-preparation-of-input-data.html#cb8-19" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb8-20"><a href="stage-1-preparation-of-input-data.html#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ra,<span class="at">filename=</span>name, <span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb8-21"><a href="stage-1-preparation-of-input-data.html#cb8-21" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb8-22"><a href="stage-1-preparation-of-input-data.html#cb8-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-23"><a href="stage-1-preparation-of-input-data.html#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop ends#######</span></span>
<span id="cb8-24"><a href="stage-1-preparation-of-input-data.html#cb8-24" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb8-25"><a href="stage-1-preparation-of-input-data.html#cb8-25" aria-hidden="true" tabindex="-1"></a> Temp_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb8-26"><a href="stage-1-preparation-of-input-data.html#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>The first line of the “Precipitation” code block will delete all the variables that have been created until that moment. This will free up memory and increase the execution speed of the rest of the script running.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="stage-1-preparation-of-input-data.html#cb9-1" aria-hidden="true" tabindex="-1"></a> <span class="do">#######################################################################################</span></span>
<span id="cb9-2"><a href="stage-1-preparation-of-input-data.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#PRECIPITATION</span></span>
<span id="cb9-3"><a href="stage-1-preparation-of-input-data.html#cb9-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb9-4"><a href="stage-1-preparation-of-input-data.html#cb9-4" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb9-5"><a href="stage-1-preparation-of-input-data.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span></code></pre></div>
<p>From line 106 to line 144, the script operates in the same way as for the initial “Temperature” code block. We must define the path to the CRU precipitation files and run the rest of the code:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="stage-1-preparation-of-input-data.html#cb10-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc precipitation file 1981-1990</span></span>
<span id="cb10-2"><a href="stage-1-preparation-of-input-data.html#cb10-2" aria-hidden="true" tabindex="-1"></a>nc_pre_81_90<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.pre.dat.nc&quot;</span>)</span>
<span id="cb10-3"><a href="stage-1-preparation-of-input-data.html#cb10-3" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb10-4"><a href="stage-1-preparation-of-input-data.html#cb10-4" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb10-5"><a href="stage-1-preparation-of-input-data.html#cb10-5" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb10-6"><a href="stage-1-preparation-of-input-data.html#cb10-6" aria-hidden="true" tabindex="-1"></a> pre_81_90<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb10-7"><a href="stage-1-preparation-of-input-data.html#cb10-7" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb10-8"><a href="stage-1-preparation-of-input-data.html#cb10-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_81_90) </span>
<span id="cb10-9"><a href="stage-1-preparation-of-input-data.html#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open nc precipitation file 1991-2000</span></span>
<span id="cb10-10"><a href="stage-1-preparation-of-input-data.html#cb10-10" aria-hidden="true" tabindex="-1"></a>nc_pre_91_00<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.pre.dat.nc&quot;</span>)</span>
<span id="cb10-11"><a href="stage-1-preparation-of-input-data.html#cb10-11" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb10-12"><a href="stage-1-preparation-of-input-data.html#cb10-12" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb10-13"><a href="stage-1-preparation-of-input-data.html#cb10-13" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb10-14"><a href="stage-1-preparation-of-input-data.html#cb10-14" aria-hidden="true" tabindex="-1"></a> pre_91_00<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb10-15"><a href="stage-1-preparation-of-input-data.html#cb10-15" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb10-16"><a href="stage-1-preparation-of-input-data.html#cb10-16" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_91_00) </span>
<span id="cb10-17"><a href="stage-1-preparation-of-input-data.html#cb10-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb10-18"><a href="stage-1-preparation-of-input-data.html#cb10-18" aria-hidden="true" tabindex="-1"></a> pre_81_00<span class="ot">&lt;-</span><span class="fu">abind</span>(pre_81_90,pre_91_00)</span>
<span id="cb10-19"><a href="stage-1-preparation-of-input-data.html#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Have one month Precipitation ( January)</span></span>
<span id="cb10-20"><a href="stage-1-preparation-of-input-data.html#cb10-20" aria-hidden="true" tabindex="-1"></a> pre_Jan_1<span class="ot">&lt;-</span>pre_81_00[,,<span class="dv">1</span>]</span>
<span id="cb10-21"><a href="stage-1-preparation-of-input-data.html#cb10-21" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(pre_Jan_1)</span></code></pre></div>
<p>The following code block is very similar to the one used to create the temperature files, but instead of creating an annual average, the script saves the average of the monthly sum.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="stage-1-preparation-of-input-data.html#cb11-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb11-2"><a href="stage-1-preparation-of-input-data.html#cb11-2" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb11-3"><a href="stage-1-preparation-of-input-data.html#cb11-3" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb11-4"><a href="stage-1-preparation-of-input-data.html#cb11-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb11-5"><a href="stage-1-preparation-of-input-data.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb11-6"><a href="stage-1-preparation-of-input-data.html#cb11-6" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb11-7"><a href="stage-1-preparation-of-input-data.html#cb11-7" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pre_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb11-8"><a href="stage-1-preparation-of-input-data.html#cb11-8" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb11-9"><a href="stage-1-preparation-of-input-data.html#cb11-9" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb11-10"><a href="stage-1-preparation-of-input-data.html#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb11-11"><a href="stage-1-preparation-of-input-data.html#cb11-11" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pre_81_00[,,k])</span>
<span id="cb11-12"><a href="stage-1-preparation-of-input-data.html#cb11-12" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb11-13"><a href="stage-1-preparation-of-input-data.html#cb11-13" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb11-14"><a href="stage-1-preparation-of-input-data.html#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb11-15"><a href="stage-1-preparation-of-input-data.html#cb11-15" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span><span class="dv">20</span></span>
<span id="cb11-16"><a href="stage-1-preparation-of-input-data.html#cb11-16" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Prec_1981_2000_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb11-17"><a href="stage-1-preparation-of-input-data.html#cb11-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from the each average</span></span>
<span id="cb11-18"><a href="stage-1-preparation-of-input-data.html#cb11-18" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb11-19"><a href="stage-1-preparation-of-input-data.html#cb11-19" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb11-20"><a href="stage-1-preparation-of-input-data.html#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ra,<span class="at">filename=</span>name, <span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb11-21"><a href="stage-1-preparation-of-input-data.html#cb11-21" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb11-22"><a href="stage-1-preparation-of-input-data.html#cb11-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-23"><a href="stage-1-preparation-of-input-data.html#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop ends#######</span></span>
<span id="cb11-24"><a href="stage-1-preparation-of-input-data.html#cb11-24" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb11-25"><a href="stage-1-preparation-of-input-data.html#cb11-25" aria-hidden="true" tabindex="-1"></a>Prec_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb11-26"><a href="stage-1-preparation-of-input-data.html#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>Finally, we must run the “Potential Evapotranspiration” block of the script. First, as we did before, we should delete the variables created in the “Precipitation” code block.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="stage-1-preparation-of-input-data.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb12-2"><a href="stage-1-preparation-of-input-data.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># POTENTIAL EVAPOTRANSPIRATION </span></span>
<span id="cb12-3"><a href="stage-1-preparation-of-input-data.html#cb12-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb12-4"><a href="stage-1-preparation-of-input-data.html#cb12-4" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb12-5"><a href="stage-1-preparation-of-input-data.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb12-6"><a href="stage-1-preparation-of-input-data.html#cb12-6" aria-hidden="true" tabindex="-1"></a>The same commands are repeated as the ones executed <span class="cf">for</span> the previous code blocks<span class="sc">:</span> <span class="st">&quot;Temperature&quot;</span> and <span class="st">&quot;Precipitation&quot;</span>. </span>
<span id="cb12-7"><a href="stage-1-preparation-of-input-data.html#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Open nc temperature file 81 - 90</span></span>
<span id="cb12-8"><a href="stage-1-preparation-of-input-data.html#cb12-8" aria-hidden="true" tabindex="-1"></a>nc_pet_81_90<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.pet.dat.nc&quot;</span>)</span>
<span id="cb12-9"><a href="stage-1-preparation-of-input-data.html#cb12-9" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_81_90, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb12-10"><a href="stage-1-preparation-of-input-data.html#cb12-10" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_81_90, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb12-11"><a href="stage-1-preparation-of-input-data.html#cb12-11" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_81_90, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb12-12"><a href="stage-1-preparation-of-input-data.html#cb12-12" aria-hidden="true" tabindex="-1"></a> pet_81_90<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pet_81_90, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb12-13"><a href="stage-1-preparation-of-input-data.html#cb12-13" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb12-14"><a href="stage-1-preparation-of-input-data.html#cb12-14" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pet_81_90) </span>
<span id="cb12-15"><a href="stage-1-preparation-of-input-data.html#cb12-15" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 91 - 00</span></span>
<span id="cb12-16"><a href="stage-1-preparation-of-input-data.html#cb12-16" aria-hidden="true" tabindex="-1"></a> nc_pet_91_00<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.pet.dat.nc&quot;</span>)</span>
<span id="cb12-17"><a href="stage-1-preparation-of-input-data.html#cb12-17" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_91_00, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb12-18"><a href="stage-1-preparation-of-input-data.html#cb12-18" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_91_00, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb12-19"><a href="stage-1-preparation-of-input-data.html#cb12-19" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_91_00, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb12-20"><a href="stage-1-preparation-of-input-data.html#cb12-20" aria-hidden="true" tabindex="-1"></a> pet_91_00<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pet_91_00, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb12-21"><a href="stage-1-preparation-of-input-data.html#cb12-21" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb12-22"><a href="stage-1-preparation-of-input-data.html#cb12-22" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pet_91_00) </span>
<span id="cb12-23"><a href="stage-1-preparation-of-input-data.html#cb12-23" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb12-24"><a href="stage-1-preparation-of-input-data.html#cb12-24" aria-hidden="true" tabindex="-1"></a> pet_81_00<span class="ot">&lt;-</span><span class="fu">abind</span>(pet_81_90,pet_91_00)</span>
<span id="cb12-25"><a href="stage-1-preparation-of-input-data.html#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Have one month ETP ( January)</span></span>
<span id="cb12-26"><a href="stage-1-preparation-of-input-data.html#cb12-26" aria-hidden="true" tabindex="-1"></a> pet_Jan_1<span class="ot">&lt;-</span>pet_81_90[,,<span class="dv">1</span>]</span>
<span id="cb12-27"><a href="stage-1-preparation-of-input-data.html#cb12-27" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(pet_Jan_1) </span>
<span id="cb12-28"><a href="stage-1-preparation-of-input-data.html#cb12-28" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb12-29"><a href="stage-1-preparation-of-input-data.html#cb12-29" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb12-30"><a href="stage-1-preparation-of-input-data.html#cb12-30" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb12-31"><a href="stage-1-preparation-of-input-data.html#cb12-31" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 8 years (j)  and 12 months (i) </span></span>
<span id="cb12-32"><a href="stage-1-preparation-of-input-data.html#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb12-33"><a href="stage-1-preparation-of-input-data.html#cb12-33" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb12-34"><a href="stage-1-preparation-of-input-data.html#cb12-34" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pet_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb12-35"><a href="stage-1-preparation-of-input-data.html#cb12-35" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb12-36"><a href="stage-1-preparation-of-input-data.html#cb12-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb12-37"><a href="stage-1-preparation-of-input-data.html#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb12-38"><a href="stage-1-preparation-of-input-data.html#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb12-39"><a href="stage-1-preparation-of-input-data.html#cb12-39" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pet_81_00[,,k])</span>
<span id="cb12-40"><a href="stage-1-preparation-of-input-data.html#cb12-40" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb12-41"><a href="stage-1-preparation-of-input-data.html#cb12-41" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb12-42"><a href="stage-1-preparation-of-input-data.html#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb12-43"><a href="stage-1-preparation-of-input-data.html#cb12-43" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">*</span><span class="dv">30</span><span class="sc">/</span><span class="dv">20</span></span>
<span id="cb12-44"><a href="stage-1-preparation-of-input-data.html#cb12-44" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;PET_1981_2000_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb12-45"><a href="stage-1-preparation-of-input-data.html#cb12-45" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from the each average</span></span>
<span id="cb12-46"><a href="stage-1-preparation-of-input-data.html#cb12-46" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb12-47"><a href="stage-1-preparation-of-input-data.html#cb12-47" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb12-48"><a href="stage-1-preparation-of-input-data.html#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ra,<span class="at">filename=</span>name, <span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb12-49"><a href="stage-1-preparation-of-input-data.html#cb12-49" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb12-50"><a href="stage-1-preparation-of-input-data.html#cb12-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-51"><a href="stage-1-preparation-of-input-data.html#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop ends#######</span></span>
<span id="cb12-52"><a href="stage-1-preparation-of-input-data.html#cb12-52" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb12-53"><a href="stage-1-preparation-of-input-data.html#cb12-53" aria-hidden="true" tabindex="-1"></a> PET_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb12-54"><a href="stage-1-preparation-of-input-data.html#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(PET_Stack,<span class="at">filename=</span><span class="st">&#39;PET_Stack_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span></code></pre></div>
<p>Script number 1 is completed. The user should have created two files for the Temperature variable, two for the Precipitation variable and one for ETP variable. All these files will be used to create a raster stack of all layers needed to run the “long spin up” phase.</p>
</div>
<div id="script-number-2.-cru_variables_warm_up.r" class="section level4" number="9.2.1.2">
<h4><span class="header-section-number">9.2.1.2</span> Script Number 2. “CRU_variables_WARM_UP.R”</h4>
<p>The purpose of the “Warm up” phase is to adjust the initial SOC stock and initial pools for the “forward” phase. Once the input climate layers have been harmonized, the model will run for each year from 2001 to 2018/20, using the monthly climate data of each year of the series (for 216/240 values for each month of the time series). The script number 2 is prepared to arrange the necessary CRU climate files for this phase. We will need to generate one raster stack of 216/240 spatial layers for each climate variable mentioned above (216 spatial layers if we use just 18 years period instead of a 20 year period; from 2001 to 2018, depending on the available climate data). Each stack will have one layer for each month from 2001 to 2018/2020.
For phase number 3, the “Forward” phase, we will need monthly averages of the time series 2001-2018/20. We will use the same arrangement as used in phase number one (one stack of 12 bands for each variable) but instead of using the averages of the 1981-2000 period we will use the climatic data of the 2001-2018/20 period. We will assume that there is no climate change in the next 20 years. Thus, script number 2 will also prepare the climate files for the “forward phase”.</p>
<p><strong>Table 9.3</strong> <em>Overview of the input and output files in script number 1.2 used for the files for Warm Up and Forward Phases.</em></p>
<p><img src="tables/Table_9.2.png" /></p>
<p>First, we must load the required R packages.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="stage-1-preparation-of-input-data.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb13-2"><a href="stage-1-preparation-of-input-data.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb13-3"><a href="stage-1-preparation-of-input-data.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb13-4"><a href="stage-1-preparation-of-input-data.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind)</span></code></pre></div>
<p>Then we will have to define the path directory to the CRU files.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="stage-1-preparation-of-input-data.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb14-2"><a href="stage-1-preparation-of-input-data.html#cb14-2" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb14-3"><a href="stage-1-preparation-of-input-data.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb14-4"><a href="stage-1-preparation-of-input-data.html#cb14-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 2001-2010</span></span>
<span id="cb14-5"><a href="stage-1-preparation-of-input-data.html#cb14-5" aria-hidden="true" tabindex="-1"></a>nc_temp_01_10<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.2001.2010.tmp.dat.nc&quot;</span>)</span>
<span id="cb14-6"><a href="stage-1-preparation-of-input-data.html#cb14-6" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_01_10, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb14-7"><a href="stage-1-preparation-of-input-data.html#cb14-7" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_01_10, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb14-8"><a href="stage-1-preparation-of-input-data.html#cb14-8" aria-hidden="true" tabindex="-1"></a>t_01_10 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_01_10, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb14-9"><a href="stage-1-preparation-of-input-data.html#cb14-9" aria-hidden="true" tabindex="-1"></a> tmp_01_10<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_01_10, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb14-10"><a href="stage-1-preparation-of-input-data.html#cb14-10" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb14-11"><a href="stage-1-preparation-of-input-data.html#cb14-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_temp_01_10) </span>
<span id="cb14-12"><a href="stage-1-preparation-of-input-data.html#cb14-12" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 2010-2018</span></span>
<span id="cb14-13"><a href="stage-1-preparation-of-input-data.html#cb14-13" aria-hidden="true" tabindex="-1"></a>nc_temp_11_18<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.2011.2018.tmp.dat.nc&quot;</span>)</span>
<span id="cb14-14"><a href="stage-1-preparation-of-input-data.html#cb14-14" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_11_18, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb14-15"><a href="stage-1-preparation-of-input-data.html#cb14-15" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_11_18, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb14-16"><a href="stage-1-preparation-of-input-data.html#cb14-16" aria-hidden="true" tabindex="-1"></a>t_11_18 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_11_18, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb14-17"><a href="stage-1-preparation-of-input-data.html#cb14-17" aria-hidden="true" tabindex="-1"></a> tmp_11_18<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_11_18, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb14-18"><a href="stage-1-preparation-of-input-data.html#cb14-18" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb14-19"><a href="stage-1-preparation-of-input-data.html#cb14-19" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_temp_11_18) </span>
<span id="cb14-20"><a href="stage-1-preparation-of-input-data.html#cb14-20" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 2001-2010 and 2011-2018 data </span></span>
<span id="cb14-21"><a href="stage-1-preparation-of-input-data.html#cb14-21" aria-hidden="true" tabindex="-1"></a> tmp<span class="ot">&lt;-</span><span class="fu">abind</span>(tmp_01_10,tmp_11_18)</span>
<span id="cb14-22"><a href="stage-1-preparation-of-input-data.html#cb14-22" aria-hidden="true" tabindex="-1"></a> <span class="co"># Have one month temperature ( January)</span></span>
<span id="cb14-23"><a href="stage-1-preparation-of-input-data.html#cb14-23" aria-hidden="true" tabindex="-1"></a> tmp_Jan_1<span class="ot">&lt;-</span>tmp[,,<span class="dv">1</span>]</span>
<span id="cb14-24"><a href="stage-1-preparation-of-input-data.html#cb14-24" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(tmp_Jan_1)</span></code></pre></div>
<p>The next code block will create two raster stacks: a temperature monthly average for the 18/20 year period, and a file with one layer per month per year, summarizing 216 layers in the stack.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="stage-1-preparation-of-input-data.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb15-2"><a href="stage-1-preparation-of-input-data.html#cb15-2" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb15-3"><a href="stage-1-preparation-of-input-data.html#cb15-3" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb15-4"><a href="stage-1-preparation-of-input-data.html#cb15-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb15-5"><a href="stage-1-preparation-of-input-data.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop starts###############</span></span>
<span id="cb15-6"><a href="stage-1-preparation-of-input-data.html#cb15-6" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb15-7"><a href="stage-1-preparation-of-input-data.html#cb15-7" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>tmp_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb15-8"><a href="stage-1-preparation-of-input-data.html#cb15-8" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb15-9"><a href="stage-1-preparation-of-input-data.html#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb15-10"><a href="stage-1-preparation-of-input-data.html#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb15-11"><a href="stage-1-preparation-of-input-data.html#cb15-11" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> tmp[,,k])</span>
<span id="cb15-12"><a href="stage-1-preparation-of-input-data.html#cb15-12" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb15-13"><a href="stage-1-preparation-of-input-data.html#cb15-13" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb15-14"><a href="stage-1-preparation-of-input-data.html#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb15-15"><a href="stage-1-preparation-of-input-data.html#cb15-15" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb15-16"><a href="stage-1-preparation-of-input-data.html#cb15-16" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Temp_2001_2018_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb15-17"><a href="stage-1-preparation-of-input-data.html#cb15-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb15-18"><a href="stage-1-preparation-of-input-data.html#cb15-18" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb15-19"><a href="stage-1-preparation-of-input-data.html#cb15-19" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb15-20"><a href="stage-1-preparation-of-input-data.html#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb15-21"><a href="stage-1-preparation-of-input-data.html#cb15-21" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb15-22"><a href="stage-1-preparation-of-input-data.html#cb15-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-23"><a href="stage-1-preparation-of-input-data.html#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop ends###############</span></span>
<span id="cb15-24"><a href="stage-1-preparation-of-input-data.html#cb15-24" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb15-25"><a href="stage-1-preparation-of-input-data.html#cb15-25" aria-hidden="true" tabindex="-1"></a> Temp_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb15-26"><a href="stage-1-preparation-of-input-data.html#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb15-27"><a href="stage-1-preparation-of-input-data.html#cb15-27" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb15-28"><a href="stage-1-preparation-of-input-data.html#cb15-28" aria-hidden="true" tabindex="-1"></a> Rlist2<span class="sc">-</span>Rlist</span>
<span id="cb15-29"><a href="stage-1-preparation-of-input-data.html#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop starts###############</span></span>
<span id="cb15-30"><a href="stage-1-preparation-of-input-data.html#cb15-30" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>])) {</span>
<span id="cb15-31"><a href="stage-1-preparation-of-input-data.html#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(q)</span>
<span id="cb15-32"><a href="stage-1-preparation-of-input-data.html#cb15-32" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>(tmp[,,q])</span>
<span id="cb15-33"><a href="stage-1-preparation-of-input-data.html#cb15-33" aria-hidden="true" tabindex="-1"></a> <span class="co">#Save each month average. </span></span>
<span id="cb15-34"><a href="stage-1-preparation-of-input-data.html#cb15-34" aria-hidden="true" tabindex="-1"></a> name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Temp_2001-2018&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb15-35"><a href="stage-1-preparation-of-input-data.html#cb15-35" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb15-36"><a href="stage-1-preparation-of-input-data.html#cb15-36" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb15-37"><a href="stage-1-preparation-of-input-data.html#cb15-37" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb15-38"><a href="stage-1-preparation-of-input-data.html#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb15-39"><a href="stage-1-preparation-of-input-data.html#cb15-39" aria-hidden="true" tabindex="-1"></a>Rlist2[[q]]<span class="ot">&lt;-</span>ra</span>
<span id="cb15-40"><a href="stage-1-preparation-of-input-data.html#cb15-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-41"><a href="stage-1-preparation-of-input-data.html#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop ends###############</span></span>
<span id="cb15-42"><a href="stage-1-preparation-of-input-data.html#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="stage-1-preparation-of-input-data.html#cb15-43" aria-hidden="true" tabindex="-1"></a>Temp_Stack_2<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist2)</span>
<span id="cb15-44"><a href="stage-1-preparation-of-input-data.html#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack_2,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_216_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span>
<span id="cb15-45"><a href="stage-1-preparation-of-input-data.html#cb15-45" aria-hidden="true" tabindex="-1"></a> <span class="co">#PRECIPITATION</span></span>
<span id="cb15-46"><a href="stage-1-preparation-of-input-data.html#cb15-46" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb15-47"><a href="stage-1-preparation-of-input-data.html#cb15-47" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb15-48"><a href="stage-1-preparation-of-input-data.html#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb15-49"><a href="stage-1-preparation-of-input-data.html#cb15-49" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc precipitation file 2001-2010</span></span>
<span id="cb15-50"><a href="stage-1-preparation-of-input-data.html#cb15-50" aria-hidden="true" tabindex="-1"></a>nc_pre_01_10<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.2001.2010.pre.dat.nc&quot;</span>)</span>
<span id="cb15-51"><a href="stage-1-preparation-of-input-data.html#cb15-51" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_01_10, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb15-52"><a href="stage-1-preparation-of-input-data.html#cb15-52" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_01_10, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb15-53"><a href="stage-1-preparation-of-input-data.html#cb15-53" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_01_10, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb15-54"><a href="stage-1-preparation-of-input-data.html#cb15-54" aria-hidden="true" tabindex="-1"></a> pre_01_10<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_01_10, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb15-55"><a href="stage-1-preparation-of-input-data.html#cb15-55" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb15-56"><a href="stage-1-preparation-of-input-data.html#cb15-56" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_01_10) </span>
<span id="cb15-57"><a href="stage-1-preparation-of-input-data.html#cb15-57" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc precipitation file 2011-2018</span></span>
<span id="cb15-58"><a href="stage-1-preparation-of-input-data.html#cb15-58" aria-hidden="true" tabindex="-1"></a>nc_pre_11_18<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.2011.2018.pre.dat.nc&quot;</span>)</span>
<span id="cb15-59"><a href="stage-1-preparation-of-input-data.html#cb15-59" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_11_18, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb15-60"><a href="stage-1-preparation-of-input-data.html#cb15-60" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_11_18, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb15-61"><a href="stage-1-preparation-of-input-data.html#cb15-61" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_11_18, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb15-62"><a href="stage-1-preparation-of-input-data.html#cb15-62" aria-hidden="true" tabindex="-1"></a> pre_11_18<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_11_18, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb15-63"><a href="stage-1-preparation-of-input-data.html#cb15-63" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb15-64"><a href="stage-1-preparation-of-input-data.html#cb15-64" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_11_18) </span>
<span id="cb15-65"><a href="stage-1-preparation-of-input-data.html#cb15-65" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 2001-2010 and 2011-2018 data </span></span>
<span id="cb15-66"><a href="stage-1-preparation-of-input-data.html#cb15-66" aria-hidden="true" tabindex="-1"></a> pre_01_18<span class="ot">&lt;-</span><span class="fu">abind</span>(pre_01_10,pre_11_18)</span>
<span id="cb15-67"><a href="stage-1-preparation-of-input-data.html#cb15-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Have one month Precipitation ( January)</span></span>
<span id="cb15-68"><a href="stage-1-preparation-of-input-data.html#cb15-68" aria-hidden="true" tabindex="-1"></a> pre_Jan_1<span class="ot">&lt;-</span>pre_01_18[,,<span class="dv">1</span>]</span>
<span id="cb15-69"><a href="stage-1-preparation-of-input-data.html#cb15-69" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(pre_Jan_1)  </span>
<span id="cb15-70"><a href="stage-1-preparation-of-input-data.html#cb15-70" aria-hidden="true" tabindex="-1"></a> Continue running until the end of the block<span class="sc">:</span></span>
<span id="cb15-71"><a href="stage-1-preparation-of-input-data.html#cb15-71" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb15-72"><a href="stage-1-preparation-of-input-data.html#cb15-72" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb15-73"><a href="stage-1-preparation-of-input-data.html#cb15-73" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb15-74"><a href="stage-1-preparation-of-input-data.html#cb15-74" aria-hidden="true" tabindex="-1"></a>Rlist2<span class="ot">&lt;-</span>Rlist</span>
<span id="cb15-75"><a href="stage-1-preparation-of-input-data.html#cb15-75" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb15-76"><a href="stage-1-preparation-of-input-data.html#cb15-76" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop starts############</span></span>
<span id="cb15-77"><a href="stage-1-preparation-of-input-data.html#cb15-77" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb15-78"><a href="stage-1-preparation-of-input-data.html#cb15-78" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pre_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb15-79"><a href="stage-1-preparation-of-input-data.html#cb15-79" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb15-80"><a href="stage-1-preparation-of-input-data.html#cb15-80" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pre_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb15-81"><a href="stage-1-preparation-of-input-data.html#cb15-81" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb15-82"><a href="stage-1-preparation-of-input-data.html#cb15-82" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pre_01_18[,,k])</span>
<span id="cb15-83"><a href="stage-1-preparation-of-input-data.html#cb15-83" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb15-84"><a href="stage-1-preparation-of-input-data.html#cb15-84" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb15-85"><a href="stage-1-preparation-of-input-data.html#cb15-85" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb15-86"><a href="stage-1-preparation-of-input-data.html#cb15-86" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span>(<span class="fu">dim</span>(pre_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb15-87"><a href="stage-1-preparation-of-input-data.html#cb15-87" aria-hidden="true" tabindex="-1"></a> name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Prec_2001_2018_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb15-88"><a href="stage-1-preparation-of-input-data.html#cb15-88" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from  each average</span></span>
<span id="cb15-89"><a href="stage-1-preparation-of-input-data.html#cb15-89" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb15-90"><a href="stage-1-preparation-of-input-data.html#cb15-90" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb15-91"><a href="stage-1-preparation-of-input-data.html#cb15-91" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb15-92"><a href="stage-1-preparation-of-input-data.html#cb15-92" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb15-93"><a href="stage-1-preparation-of-input-data.html#cb15-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-94"><a href="stage-1-preparation-of-input-data.html#cb15-94" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop ends############</span></span>
<span id="cb15-95"><a href="stage-1-preparation-of-input-data.html#cb15-95" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb15-96"><a href="stage-1-preparation-of-input-data.html#cb15-96" aria-hidden="true" tabindex="-1"></a> Prec_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb15-97"><a href="stage-1-preparation-of-input-data.html#cb15-97" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb15-98"><a href="stage-1-preparation-of-input-data.html#cb15-98" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb15-99"><a href="stage-1-preparation-of-input-data.html#cb15-99" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop starts############</span></span>
<span id="cb15-100"><a href="stage-1-preparation-of-input-data.html#cb15-100" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pre_01_18)[<span class="dv">3</span>])) {</span>
<span id="cb15-101"><a href="stage-1-preparation-of-input-data.html#cb15-101" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(q)</span>
<span id="cb15-102"><a href="stage-1-preparation-of-input-data.html#cb15-102" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>(pre_01_18[,,q])</span>
<span id="cb15-103"><a href="stage-1-preparation-of-input-data.html#cb15-103" aria-hidden="true" tabindex="-1"></a> <span class="co">#Save each month average. </span></span>
<span id="cb15-104"><a href="stage-1-preparation-of-input-data.html#cb15-104" aria-hidden="true" tabindex="-1"></a> name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Prec_2001-2018&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb15-105"><a href="stage-1-preparation-of-input-data.html#cb15-105" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb15-106"><a href="stage-1-preparation-of-input-data.html#cb15-106" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb15-107"><a href="stage-1-preparation-of-input-data.html#cb15-107" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb15-108"><a href="stage-1-preparation-of-input-data.html#cb15-108" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb15-109"><a href="stage-1-preparation-of-input-data.html#cb15-109" aria-hidden="true" tabindex="-1"></a>Rlist2[[q]]<span class="ot">&lt;-</span>ra</span>
<span id="cb15-110"><a href="stage-1-preparation-of-input-data.html#cb15-110" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-111"><a href="stage-1-preparation-of-input-data.html#cb15-111" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop ends############</span></span>
<span id="cb15-112"><a href="stage-1-preparation-of-input-data.html#cb15-112" aria-hidden="true" tabindex="-1"></a>Prec_Stack_2<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist2)</span>
<span id="cb15-113"><a href="stage-1-preparation-of-input-data.html#cb15-113" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack_2,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_216_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span></code></pre></div>
<p>Now we must run the PET block. We will then run the rest of the code to create the necessary tif files.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="stage-1-preparation-of-input-data.html#cb16-1" aria-hidden="true" tabindex="-1"></a> <span class="do">########################################################################</span></span>
<span id="cb16-2"><a href="stage-1-preparation-of-input-data.html#cb16-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># POTENTIAL EVAPOTRANSPIRATION </span></span>
<span id="cb16-3"><a href="stage-1-preparation-of-input-data.html#cb16-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-4"><a href="stage-1-preparation-of-input-data.html#cb16-4" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb16-5"><a href="stage-1-preparation-of-input-data.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb16-6"><a href="stage-1-preparation-of-input-data.html#cb16-6" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 01 - 10</span></span>
<span id="cb16-7"><a href="stage-1-preparation-of-input-data.html#cb16-7" aria-hidden="true" tabindex="-1"></a>nc_pet_01_10<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.2001.2010.pet.dat.nc&quot;</span>)</span>
<span id="cb16-8"><a href="stage-1-preparation-of-input-data.html#cb16-8" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_01_10, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb16-9"><a href="stage-1-preparation-of-input-data.html#cb16-9" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_01_10, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb16-10"><a href="stage-1-preparation-of-input-data.html#cb16-10" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_01_10, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb16-11"><a href="stage-1-preparation-of-input-data.html#cb16-11" aria-hidden="true" tabindex="-1"></a> pet_01_10<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pet_01_10, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb16-12"><a href="stage-1-preparation-of-input-data.html#cb16-12" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb16-13"><a href="stage-1-preparation-of-input-data.html#cb16-13" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pet_01_10) </span>
<span id="cb16-14"><a href="stage-1-preparation-of-input-data.html#cb16-14" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 11 - 18 nc_pet_11_18&lt;-nc_open(&quot;cru_ts4.03.2011.2018.pet.dat.nc&quot;)</span></span>
<span id="cb16-15"><a href="stage-1-preparation-of-input-data.html#cb16-15" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_11_18, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb16-16"><a href="stage-1-preparation-of-input-data.html#cb16-16" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_11_18, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb16-17"><a href="stage-1-preparation-of-input-data.html#cb16-17" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pet_11_18, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb16-18"><a href="stage-1-preparation-of-input-data.html#cb16-18" aria-hidden="true" tabindex="-1"></a> pet_11_18<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pet_11_18, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb16-19"><a href="stage-1-preparation-of-input-data.html#cb16-19" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb16-20"><a href="stage-1-preparation-of-input-data.html#cb16-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pet_11_18) </span>
<span id="cb16-21"><a href="stage-1-preparation-of-input-data.html#cb16-21" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 2001-2010 and 2011-2018 data </span></span>
<span id="cb16-22"><a href="stage-1-preparation-of-input-data.html#cb16-22" aria-hidden="true" tabindex="-1"></a> pet_01_18<span class="ot">&lt;-</span><span class="fu">abind</span>(pet_01_10,pet_11_18)</span>
<span id="cb16-23"><a href="stage-1-preparation-of-input-data.html#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># get one month ETP ( January)</span></span>
<span id="cb16-24"><a href="stage-1-preparation-of-input-data.html#cb16-24" aria-hidden="true" tabindex="-1"></a> pet_Jan_1<span class="ot">&lt;-</span>pet_01_18[,,<span class="dv">1</span>]</span>
<span id="cb16-25"><a href="stage-1-preparation-of-input-data.html#cb16-25" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(pet_Jan_1)</span>
<span id="cb16-26"><a href="stage-1-preparation-of-input-data.html#cb16-26" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb16-27"><a href="stage-1-preparation-of-input-data.html#cb16-27" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb16-28"><a href="stage-1-preparation-of-input-data.html#cb16-28" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb16-29"><a href="stage-1-preparation-of-input-data.html#cb16-29" aria-hidden="true" tabindex="-1"></a>Rlist2<span class="ot">&lt;-</span>Rlist</span>
<span id="cb16-30"><a href="stage-1-preparation-of-input-data.html#cb16-30" aria-hidden="true" tabindex="-1"></a> <span class="co"># Average of 18 years (j)  and 12 months (i) </span></span>
<span id="cb16-31"><a href="stage-1-preparation-of-input-data.html#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts##############</span></span>
<span id="cb16-32"><a href="stage-1-preparation-of-input-data.html#cb16-32" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb16-33"><a href="stage-1-preparation-of-input-data.html#cb16-33" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pet_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb16-34"><a href="stage-1-preparation-of-input-data.html#cb16-34" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb16-35"><a href="stage-1-preparation-of-input-data.html#cb16-35" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pet_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb16-36"><a href="stage-1-preparation-of-input-data.html#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb16-37"><a href="stage-1-preparation-of-input-data.html#cb16-37" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pet_01_18[,,k])</span>
<span id="cb16-38"><a href="stage-1-preparation-of-input-data.html#cb16-38" aria-hidden="true" tabindex="-1"></a> k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb16-39"><a href="stage-1-preparation-of-input-data.html#cb16-39" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb16-40"><a href="stage-1-preparation-of-input-data.html#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb16-41"><a href="stage-1-preparation-of-input-data.html#cb16-41" aria-hidden="true" tabindex="-1"></a> var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>(<span class="fu">dim</span>(pet_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb16-42"><a href="stage-1-preparation-of-input-data.html#cb16-42" aria-hidden="true" tabindex="-1"></a>name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;PET_2001_2018_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb16-43"><a href="stage-1-preparation-of-input-data.html#cb16-43" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from the each average</span></span>
<span id="cb16-44"><a href="stage-1-preparation-of-input-data.html#cb16-44" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var_avg), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb16-45"><a href="stage-1-preparation-of-input-data.html#cb16-45" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb16-46"><a href="stage-1-preparation-of-input-data.html#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb16-47"><a href="stage-1-preparation-of-input-data.html#cb16-47" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>ra</span>
<span id="cb16-48"><a href="stage-1-preparation-of-input-data.html#cb16-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-49"><a href="stage-1-preparation-of-input-data.html#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop ends##############</span></span>
<span id="cb16-50"><a href="stage-1-preparation-of-input-data.html#cb16-50" aria-hidden="true" tabindex="-1"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb16-51"><a href="stage-1-preparation-of-input-data.html#cb16-51" aria-hidden="true" tabindex="-1"></a> PET_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb16-52"><a href="stage-1-preparation-of-input-data.html#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(PET_Stack,<span class="at">filename=</span><span class="st">&#39;PET_Stack_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb16-53"><a href="stage-1-preparation-of-input-data.html#cb16-53" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb16-54"><a href="stage-1-preparation-of-input-data.html#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts##############</span></span>
<span id="cb16-55"><a href="stage-1-preparation-of-input-data.html#cb16-55" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pet_01_18)[<span class="dv">3</span>])) {</span>
<span id="cb16-56"><a href="stage-1-preparation-of-input-data.html#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(q)</span>
<span id="cb16-57"><a href="stage-1-preparation-of-input-data.html#cb16-57" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>(pet_01_18[,,q])<span class="sc">*</span><span class="dv">30</span></span>
<span id="cb16-58"><a href="stage-1-preparation-of-input-data.html#cb16-58" aria-hidden="true" tabindex="-1"></a> <span class="co">#Save each month average. </span></span>
<span id="cb16-59"><a href="stage-1-preparation-of-input-data.html#cb16-59" aria-hidden="true" tabindex="-1"></a> name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;PET_2001-2018&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb16-60"><a href="stage-1-preparation-of-input-data.html#cb16-60" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb16-61"><a href="stage-1-preparation-of-input-data.html#cb16-61" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb16-62"><a href="stage-1-preparation-of-input-data.html#cb16-62" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb16-63"><a href="stage-1-preparation-of-input-data.html#cb16-63" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ra,<span class="at">filename=</span>name, <span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb16-64"><a href="stage-1-preparation-of-input-data.html#cb16-64" aria-hidden="true" tabindex="-1"></a>Rlist2[[q]]<span class="ot">&lt;-</span>ra</span>
<span id="cb16-65"><a href="stage-1-preparation-of-input-data.html#cb16-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-66"><a href="stage-1-preparation-of-input-data.html#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts##############</span></span>
<span id="cb16-67"><a href="stage-1-preparation-of-input-data.html#cb16-67" aria-hidden="true" tabindex="-1"></a>PET_Stack_2<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist2)</span>
<span id="cb16-68"><a href="stage-1-preparation-of-input-data.html#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(PET_Stack_2,<span class="at">filename=</span><span class="st">&#39;PET_Stack_216_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span></code></pre></div>
</div>
<div id="script-number-3.-preparation-of-cru-files-to-estimate-npp-1981-2000" class="section level4" number="9.2.1.3">
<h4><span class="header-section-number">9.2.1.3</span> Script Number 3. Preparation of CRU files to estimate NPP 1981-2000</h4>
<p>We will need to convert the CRU monthly climate data 1981-2000 into annual data to estimate annual NPP 1981-2000.The script number 3 will process the CRU files from the 1981-2000 series to generate the climate inputs files required to estimate NPP by the MIAMI model.</p>
<p><strong>Table 9.4.</strong> <em>Script Number 1.3. CRU files for MIAMI MODEL. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.3.png" /></p>
<p>We will first open the R file: “CRU_variables_for_NPP_MIAMI_MEAN_81-00.R” and load the required packages:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="stage-1-preparation-of-input-data.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb17-2"><a href="stage-1-preparation-of-input-data.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb17-3"><a href="stage-1-preparation-of-input-data.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb17-4"><a href="stage-1-preparation-of-input-data.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind)</span></code></pre></div>
<p>The first block is the “temperature” block. We must set the path to the CRU files.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="stage-1-preparation-of-input-data.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb18-2"><a href="stage-1-preparation-of-input-data.html#cb18-2" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb18-3"><a href="stage-1-preparation-of-input-data.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb18-4"><a href="stage-1-preparation-of-input-data.html#cb18-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 1981-1990</span></span>
<span id="cb18-5"><a href="stage-1-preparation-of-input-data.html#cb18-5" aria-hidden="true" tabindex="-1"></a>nc_temp_81_90<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.tmp.dat.nc&quot;</span>)</span>
<span id="cb18-6"><a href="stage-1-preparation-of-input-data.html#cb18-6" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb18-7"><a href="stage-1-preparation-of-input-data.html#cb18-7" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb18-8"><a href="stage-1-preparation-of-input-data.html#cb18-8" aria-hidden="true" tabindex="-1"></a>t_81_90 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb18-9"><a href="stage-1-preparation-of-input-data.html#cb18-9" aria-hidden="true" tabindex="-1"></a> tmp_81_90<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_81_90, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb18-10"><a href="stage-1-preparation-of-input-data.html#cb18-10" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb18-11"><a href="stage-1-preparation-of-input-data.html#cb18-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_temp_81_90) </span>
<span id="cb18-12"><a href="stage-1-preparation-of-input-data.html#cb18-12" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc temperature file 1991-2000</span></span>
<span id="cb18-13"><a href="stage-1-preparation-of-input-data.html#cb18-13" aria-hidden="true" tabindex="-1"></a>nc_temp_91_00<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.tmp.dat.nc&quot;</span>)</span>
<span id="cb18-14"><a href="stage-1-preparation-of-input-data.html#cb18-14" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb18-15"><a href="stage-1-preparation-of-input-data.html#cb18-15" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb18-16"><a href="stage-1-preparation-of-input-data.html#cb18-16" aria-hidden="true" tabindex="-1"></a>t_91_00 <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb18-17"><a href="stage-1-preparation-of-input-data.html#cb18-17" aria-hidden="true" tabindex="-1"></a> tmp_91_00<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_temp_91_00, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb18-18"><a href="stage-1-preparation-of-input-data.html#cb18-18" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb18-19"><a href="stage-1-preparation-of-input-data.html#cb18-19" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_temp_91_00) </span>
<span id="cb18-20"><a href="stage-1-preparation-of-input-data.html#cb18-20" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb18-21"><a href="stage-1-preparation-of-input-data.html#cb18-21" aria-hidden="true" tabindex="-1"></a> tmp<span class="ot">&lt;-</span><span class="fu">abind</span>(tmp_81_90,tmp_91_00)</span>
<span id="cb18-22"><a href="stage-1-preparation-of-input-data.html#cb18-22" aria-hidden="true" tabindex="-1"></a> <span class="co"># Get one month temperature ( January)</span></span>
<span id="cb18-23"><a href="stage-1-preparation-of-input-data.html#cb18-23" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb18-24"><a href="stage-1-preparation-of-input-data.html#cb18-24" aria-hidden="true" tabindex="-1"></a>tmp_Jan_1<span class="ot">&lt;-</span>tmp[,,<span class="dv">1</span>]</span>
<span id="cb18-25"><a href="stage-1-preparation-of-input-data.html#cb18-25" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(tmp_Jan_1)</span>
<span id="cb18-26"><a href="stage-1-preparation-of-input-data.html#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb18-27"><a href="stage-1-preparation-of-input-data.html#cb18-27" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb18-28"><a href="stage-1-preparation-of-input-data.html#cb18-28" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb18-29"><a href="stage-1-preparation-of-input-data.html#cb18-29" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb18-30"><a href="stage-1-preparation-of-input-data.html#cb18-30" aria-hidden="true" tabindex="-1"></a> Rlist2<span class="ot">&lt;-</span>Rlist</span>
<span id="cb18-31"><a href="stage-1-preparation-of-input-data.html#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts###########</span></span>
<span id="cb18-32"><a href="stage-1-preparation-of-input-data.html#cb18-32" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>])) {</span>
<span id="cb18-33"><a href="stage-1-preparation-of-input-data.html#cb18-33" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>(tmp[,,q])</span>
<span id="cb18-34"><a href="stage-1-preparation-of-input-data.html#cb18-34" aria-hidden="true" tabindex="-1"></a> <span class="co">#Save each month average. </span></span>
<span id="cb18-35"><a href="stage-1-preparation-of-input-data.html#cb18-35" aria-hidden="true" tabindex="-1"></a> name<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">&#39;Temp_1981-2000&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb18-36"><a href="stage-1-preparation-of-input-data.html#cb18-36" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb18-37"><a href="stage-1-preparation-of-input-data.html#cb18-37" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb18-38"><a href="stage-1-preparation-of-input-data.html#cb18-38" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb18-39"><a href="stage-1-preparation-of-input-data.html#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb18-40"><a href="stage-1-preparation-of-input-data.html#cb18-40" aria-hidden="true" tabindex="-1"></a>Rlist2[[q]]<span class="ot">&lt;-</span>ra</span>
<span id="cb18-41"><a href="stage-1-preparation-of-input-data.html#cb18-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-42"><a href="stage-1-preparation-of-input-data.html#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop ends###########</span></span>
<span id="cb18-43"><a href="stage-1-preparation-of-input-data.html#cb18-43" aria-hidden="true" tabindex="-1"></a>Temp_Stack_2<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist2)</span>
<span id="cb18-44"><a href="stage-1-preparation-of-input-data.html#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack_2,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_240_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>After that, the “precipitation” block begins.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="stage-1-preparation-of-input-data.html#cb19-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#PRECIPITATION</span></span>
<span id="cb19-2"><a href="stage-1-preparation-of-input-data.html#cb19-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb19-3"><a href="stage-1-preparation-of-input-data.html#cb19-3" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb19-4"><a href="stage-1-preparation-of-input-data.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb19-5"><a href="stage-1-preparation-of-input-data.html#cb19-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc precipitation file 1981-1990</span></span>
<span id="cb19-6"><a href="stage-1-preparation-of-input-data.html#cb19-6" aria-hidden="true" tabindex="-1"></a>nc_pre_81_90<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.pre.dat.nc&quot;</span>)</span>
<span id="cb19-7"><a href="stage-1-preparation-of-input-data.html#cb19-7" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb19-8"><a href="stage-1-preparation-of-input-data.html#cb19-8" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb19-9"><a href="stage-1-preparation-of-input-data.html#cb19-9" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb19-10"><a href="stage-1-preparation-of-input-data.html#cb19-10" aria-hidden="true" tabindex="-1"></a> pre_81_90<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_81_90, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb19-11"><a href="stage-1-preparation-of-input-data.html#cb19-11" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb19-12"><a href="stage-1-preparation-of-input-data.html#cb19-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_81_90) </span>
<span id="cb19-13"><a href="stage-1-preparation-of-input-data.html#cb19-13" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open nc precipitation file 1991-2000</span></span>
<span id="cb19-14"><a href="stage-1-preparation-of-input-data.html#cb19-14" aria-hidden="true" tabindex="-1"></a>nc_pre_91_00<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.pre.dat.nc&quot;</span>)</span>
<span id="cb19-15"><a href="stage-1-preparation-of-input-data.html#cb19-15" aria-hidden="true" tabindex="-1"></a> lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb19-16"><a href="stage-1-preparation-of-input-data.html#cb19-16" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb19-17"><a href="stage-1-preparation-of-input-data.html#cb19-17" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb19-18"><a href="stage-1-preparation-of-input-data.html#cb19-18" aria-hidden="true" tabindex="-1"></a>pre_91_00<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(nc_pre_91_00, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb19-19"><a href="stage-1-preparation-of-input-data.html#cb19-19" aria-hidden="true" tabindex="-1"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb19-20"><a href="stage-1-preparation-of-input-data.html#cb19-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">nc_close</span>(nc_pre_91_00) </span>
<span id="cb19-21"><a href="stage-1-preparation-of-input-data.html#cb19-21" aria-hidden="true" tabindex="-1"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb19-22"><a href="stage-1-preparation-of-input-data.html#cb19-22" aria-hidden="true" tabindex="-1"></a> pre_81_00<span class="ot">&lt;-</span><span class="fu">abind</span>(pre_81_90,pre_91_00) </span>
<span id="cb19-23"><a href="stage-1-preparation-of-input-data.html#cb19-23" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb19-24"><a href="stage-1-preparation-of-input-data.html#cb19-24" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb19-25"><a href="stage-1-preparation-of-input-data.html#cb19-25" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb19-26"><a href="stage-1-preparation-of-input-data.html#cb19-26" aria-hidden="true" tabindex="-1"></a>Rlist2<span class="ot">&lt;-</span>Rlist</span>
<span id="cb19-27"><a href="stage-1-preparation-of-input-data.html#cb19-27" aria-hidden="true" tabindex="-1"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb19-28"><a href="stage-1-preparation-of-input-data.html#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="do">##############for loop starts############</span></span>
<span id="cb19-29"><a href="stage-1-preparation-of-input-data.html#cb19-29" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pre_81_00)[<span class="dv">3</span>])) {</span>
<span id="cb19-30"><a href="stage-1-preparation-of-input-data.html#cb19-30" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>(pre_81_00[,,q])</span>
<span id="cb19-31"><a href="stage-1-preparation-of-input-data.html#cb19-31" aria-hidden="true" tabindex="-1"></a> <span class="co">#Save each month average. </span></span>
<span id="cb19-32"><a href="stage-1-preparation-of-input-data.html#cb19-32" aria-hidden="true" tabindex="-1"></a> <span class="co">#name&lt;-paste0(&#39;Prec_2001-2018&#39;,q,&#39;.tif&#39;)</span></span>
<span id="cb19-33"><a href="stage-1-preparation-of-input-data.html#cb19-33" aria-hidden="true" tabindex="-1"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb19-34"><a href="stage-1-preparation-of-input-data.html#cb19-34" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(var), <span class="at">xmn=</span><span class="fu">min</span>(lon), <span class="at">xmx=</span><span class="fu">max</span>(lon), <span class="at">ymn=</span><span class="fu">min</span>(lat), <span class="at">ymx=</span><span class="fu">max</span>(lat), <span class="at">crs=</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb19-35"><a href="stage-1-preparation-of-input-data.html#cb19-35" aria-hidden="true" tabindex="-1"></a>ra<span class="ot">&lt;-</span><span class="fu">flip</span>(ra, <span class="at">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb19-36"><a href="stage-1-preparation-of-input-data.html#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb19-37"><a href="stage-1-preparation-of-input-data.html#cb19-37" aria-hidden="true" tabindex="-1"></a>Rlist2[[q]]<span class="ot">&lt;-</span>ra</span>
<span id="cb19-38"><a href="stage-1-preparation-of-input-data.html#cb19-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-39"><a href="stage-1-preparation-of-input-data.html#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="do">##############for loop ends############</span></span>
<span id="cb19-40"><a href="stage-1-preparation-of-input-data.html#cb19-40" aria-hidden="true" tabindex="-1"></a>Prec_Stack_2<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist2)</span>
<span id="cb19-41"><a href="stage-1-preparation-of-input-data.html#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack_2,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_240_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-5.-cru-miami-model-npp-mean-1981-2000" class="section level4" number="9.2.1.4">
<h4><span class="header-section-number">9.2.1.4</span> Script Number 5. CRU MIAMI model NPP mean (1981-2000)</h4>
<p>To adjust yearly C inputs during the warm up phase according to annual NPP values, we will need to estimate an average annual NPP 1981-2000, that will be used as the starting point to adjust C inputs during the “warm up” phase (See chapter 6). Script number 5 uses the climate raster outputs from script number 3 and estimates an annual NPP mean 1981-2000 value.</p>
<p><strong>Table 9.5</strong> <em>Script Number 5. CRU Miami Model 81-00 Mean. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.4.png" /></p>
<p>First, we will need to open the R script: “MIAMI_MODEL_NPP_MIAMI_MEAN_81-00.R”
Analogously to the previous scripts, the first lines load the required packages into R and set the working directories. Then the annual precipitation and annual temperature stacks (1981-2000) that were created in script number 3 are opened:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="stage-1-preparation-of-input-data.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb20-2"><a href="stage-1-preparation-of-input-data.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb20-3"><a href="stage-1-preparation-of-input-data.html#cb20-3" aria-hidden="true" tabindex="-1"></a>WD_NPP<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/NPP&quot;</span>)</span>
<span id="cb20-4"><a href="stage-1-preparation-of-input-data.html#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="stage-1-preparation-of-input-data.html#cb20-5" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb20-6"><a href="stage-1-preparation-of-input-data.html#cb20-6" aria-hidden="true" tabindex="-1"></a>WD_GSOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb20-7"><a href="stage-1-preparation-of-input-data.html#cb20-7" aria-hidden="true" tabindex="-1"></a>WD_CRU_LAYERS<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb20-8"><a href="stage-1-preparation-of-input-data.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CRU_LAYERS)</span>
<span id="cb20-9"><a href="stage-1-preparation-of-input-data.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Annual Precipitation (mm) and Mean Annual Temperature (degree C) stacks</span></span>
<span id="cb20-10"><a href="stage-1-preparation-of-input-data.html#cb20-10" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Temp_Stack_240_81-00_CRU.tif&quot;</span>)</span>
<span id="cb20-11"><a href="stage-1-preparation-of-input-data.html#cb20-11" aria-hidden="true" tabindex="-1"></a>Prec<span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;Prec_Stack_240_81-00_CRU.tif&quot;</span>)</span></code></pre></div>
<p>At line 73 the user must set the output directory to save the output files.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="stage-1-preparation-of-input-data.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb21-2"><a href="stage-1-preparation-of-input-data.html#cb21-2" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb21-3"><a href="stage-1-preparation-of-input-data.html#cb21-3" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb21-4"><a href="stage-1-preparation-of-input-data.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="do">#######loop for starts#########</span></span>
<span id="cb21-5"><a href="stage-1-preparation-of-input-data.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb21-6"><a href="stage-1-preparation-of-input-data.html#cb21-6" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb21-7"><a href="stage-1-preparation-of-input-data.html#cb21-7" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb21-8"><a href="stage-1-preparation-of-input-data.html#cb21-8" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb21-9"><a href="stage-1-preparation-of-input-data.html#cb21-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-10"><a href="stage-1-preparation-of-input-data.html#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="do">#######loop for ends##########</span></span>
<span id="cb21-11"><a href="stage-1-preparation-of-input-data.html#cb21-11" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb21-12"><a href="stage-1-preparation-of-input-data.html#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb21-13"><a href="stage-1-preparation-of-input-data.html#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="stage-1-preparation-of-input-data.html#cb21-14" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb21-15"><a href="stage-1-preparation-of-input-data.html#cb21-15" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb21-16"><a href="stage-1-preparation-of-input-data.html#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb21-17"><a href="stage-1-preparation-of-input-data.html#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb21-18"><a href="stage-1-preparation-of-input-data.html#cb21-18" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb21-19"><a href="stage-1-preparation-of-input-data.html#cb21-19" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb21-20"><a href="stage-1-preparation-of-input-data.html#cb21-20" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb21-21"><a href="stage-1-preparation-of-input-data.html#cb21-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-22"><a href="stage-1-preparation-of-input-data.html#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb21-23"><a href="stage-1-preparation-of-input-data.html#cb21-23" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb21-24"><a href="stage-1-preparation-of-input-data.html#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-25"><a href="stage-1-preparation-of-input-data.html#cb21-25" aria-hidden="true" tabindex="-1"></a>NPP_Prec<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb21-26"><a href="stage-1-preparation-of-input-data.html#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-27"><a href="stage-1-preparation-of-input-data.html#cb21-27" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb21-28"><a href="stage-1-preparation-of-input-data.html#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-29"><a href="stage-1-preparation-of-input-data.html#cb21-29" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb21-30"><a href="stage-1-preparation-of-input-data.html#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb21-31"><a href="stage-1-preparation-of-input-data.html#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb21-32"><a href="stage-1-preparation-of-input-data.html#cb21-32" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb21-33"><a href="stage-1-preparation-of-input-data.html#cb21-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-34"><a href="stage-1-preparation-of-input-data.html#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb21-35"><a href="stage-1-preparation-of-input-data.html#cb21-35" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb21-36"><a href="stage-1-preparation-of-input-data.html#cb21-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-37"><a href="stage-1-preparation-of-input-data.html#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb21-38"><a href="stage-1-preparation-of-input-data.html#cb21-38" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb21-39"><a href="stage-1-preparation-of-input-data.html#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb21-40"><a href="stage-1-preparation-of-input-data.html#cb21-40" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb21-41"><a href="stage-1-preparation-of-input-data.html#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Save WORLD NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb21-42"><a href="stage-1-preparation-of-input-data.html#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb21-43"><a href="stage-1-preparation-of-input-data.html#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb21-44"><a href="stage-1-preparation-of-input-data.html#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb21-45"><a href="stage-1-preparation-of-input-data.html#cb21-45" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb21-46"><a href="stage-1-preparation-of-input-data.html#cb21-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-47"><a href="stage-1-preparation-of-input-data.html#cb21-47" aria-hidden="true" tabindex="-1"></a>Then we will need to open the country polygon vector and the latest version of the FAO GSOCmap.</span>
<span id="cb21-48"><a href="stage-1-preparation-of-input-data.html#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Open the shapefile of the region/country</span></span>
<span id="cb21-49"><a href="stage-1-preparation-of-input-data.html#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb21-50"><a href="stage-1-preparation-of-input-data.html#cb21-50" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb21-51"><a href="stage-1-preparation-of-input-data.html#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="co">#Open FAO GSOC MAP </span></span>
<span id="cb21-52"><a href="stage-1-preparation-of-input-data.html#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_GSOC)</span>
<span id="cb21-53"><a href="stage-1-preparation-of-input-data.html#cb21-53" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb21-54"><a href="stage-1-preparation-of-input-data.html#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; mask</span></span>
<span id="cb21-55"><a href="stage-1-preparation-of-input-data.html#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb21-56"><a href="stage-1-preparation-of-input-data.html#cb21-56" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb21-57"><a href="stage-1-preparation-of-input-data.html#cb21-57" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb21-58"><a href="stage-1-preparation-of-input-data.html#cb21-58" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb21-59"><a href="stage-1-preparation-of-input-data.html#cb21-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-60"><a href="stage-1-preparation-of-input-data.html#cb21-60" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>In order to estimate the uncertainty of our predictions, we will create two additional layers, but this time using a minimum and maximum combination of precipitation and temperature variables to generate minimum and maximum NPP layers (See Chapter 12).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="stage-1-preparation-of-input-data.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#UNCERTAINTIES MINIMUM TEMP , PREC</span></span>
<span id="cb22-2"><a href="stage-1-preparation-of-input-data.html#cb22-2" aria-hidden="true" tabindex="-1"></a>Temp_min<span class="ot">&lt;-</span>Temp<span class="sc">*</span><span class="fl">1.02</span></span>
<span id="cb22-3"><a href="stage-1-preparation-of-input-data.html#cb22-3" aria-hidden="true" tabindex="-1"></a>Prec_min<span class="ot">&lt;-</span>Prec<span class="sc">*</span><span class="fl">0.95</span></span>
<span id="cb22-4"><a href="stage-1-preparation-of-input-data.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb22-5"><a href="stage-1-preparation-of-input-data.html#cb22-5" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb22-6"><a href="stage-1-preparation-of-input-data.html#cb22-6" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb22-7"><a href="stage-1-preparation-of-input-data.html#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb22-8"><a href="stage-1-preparation-of-input-data.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb22-9"><a href="stage-1-preparation-of-input-data.html#cb22-9" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp_min[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb22-10"><a href="stage-1-preparation-of-input-data.html#cb22-10" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb22-11"><a href="stage-1-preparation-of-input-data.html#cb22-11" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb22-12"><a href="stage-1-preparation-of-input-data.html#cb22-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-13"><a href="stage-1-preparation-of-input-data.html#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb22-14"><a href="stage-1-preparation-of-input-data.html#cb22-14" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb22-15"><a href="stage-1-preparation-of-input-data.html#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb22-16"><a href="stage-1-preparation-of-input-data.html#cb22-16" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb22-17"><a href="stage-1-preparation-of-input-data.html#cb22-17" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb22-18"><a href="stage-1-preparation-of-input-data.html#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb22-19"><a href="stage-1-preparation-of-input-data.html#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb22-20"><a href="stage-1-preparation-of-input-data.html#cb22-20" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec_min[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb22-21"><a href="stage-1-preparation-of-input-data.html#cb22-21" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb22-22"><a href="stage-1-preparation-of-input-data.html#cb22-22" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb22-23"><a href="stage-1-preparation-of-input-data.html#cb22-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-24"><a href="stage-1-preparation-of-input-data.html#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb22-25"><a href="stage-1-preparation-of-input-data.html#cb22-25" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb22-26"><a href="stage-1-preparation-of-input-data.html#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-27"><a href="stage-1-preparation-of-input-data.html#cb22-27" aria-hidden="true" tabindex="-1"></a>NPP_Prec<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb22-28"><a href="stage-1-preparation-of-input-data.html#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-29"><a href="stage-1-preparation-of-input-data.html#cb22-29" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb22-30"><a href="stage-1-preparation-of-input-data.html#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-31"><a href="stage-1-preparation-of-input-data.html#cb22-31" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb22-32"><a href="stage-1-preparation-of-input-data.html#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb22-33"><a href="stage-1-preparation-of-input-data.html#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb22-34"><a href="stage-1-preparation-of-input-data.html#cb22-34" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb22-35"><a href="stage-1-preparation-of-input-data.html#cb22-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-36"><a href="stage-1-preparation-of-input-data.html#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb22-37"><a href="stage-1-preparation-of-input-data.html#cb22-37" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb22-38"><a href="stage-1-preparation-of-input-data.html#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb22-39"><a href="stage-1-preparation-of-input-data.html#cb22-39" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb22-40"><a href="stage-1-preparation-of-input-data.html#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb22-41"><a href="stage-1-preparation-of-input-data.html#cb22-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-42"><a href="stage-1-preparation-of-input-data.html#cb22-42" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb22-43"><a href="stage-1-preparation-of-input-data.html#cb22-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Save WORLD NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb22-44"><a href="stage-1-preparation-of-input-data.html#cb22-44" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb22-45"><a href="stage-1-preparation-of-input-data.html#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00_MIN.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb22-46"><a href="stage-1-preparation-of-input-data.html#cb22-46" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb22-47"><a href="stage-1-preparation-of-input-data.html#cb22-47" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb22-48"><a href="stage-1-preparation-of-input-data.html#cb22-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; and mask</span></span>
<span id="cb22-49"><a href="stage-1-preparation-of-input-data.html#cb22-49" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb22-50"><a href="stage-1-preparation-of-input-data.html#cb22-50" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb22-51"><a href="stage-1-preparation-of-input-data.html#cb22-51" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb22-52"><a href="stage-1-preparation-of-input-data.html#cb22-52" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb22-53"><a href="stage-1-preparation-of-input-data.html#cb22-53" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI_MIN.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb22-54"><a href="stage-1-preparation-of-input-data.html#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="co">#UNCERTAINTIES MAXIMUM TEMP , PREC</span></span>
<span id="cb22-55"><a href="stage-1-preparation-of-input-data.html#cb22-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Anual Precipitation (mm) and Mean Anual Temperature (grades C) stacks</span></span>
<span id="cb22-56"><a href="stage-1-preparation-of-input-data.html#cb22-56" aria-hidden="true" tabindex="-1"></a>Temp_max<span class="ot">&lt;-</span>Temp<span class="sc">*</span><span class="fl">0.98</span></span>
<span id="cb22-57"><a href="stage-1-preparation-of-input-data.html#cb22-57" aria-hidden="true" tabindex="-1"></a>Prec_max<span class="ot">&lt;-</span>Prec<span class="sc">*</span><span class="fl">1.05</span></span>
<span id="cb22-58"><a href="stage-1-preparation-of-input-data.html#cb22-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb22-59"><a href="stage-1-preparation-of-input-data.html#cb22-59" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb22-60"><a href="stage-1-preparation-of-input-data.html#cb22-60" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb22-61"><a href="stage-1-preparation-of-input-data.html#cb22-61" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb22-62"><a href="stage-1-preparation-of-input-data.html#cb22-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb22-63"><a href="stage-1-preparation-of-input-data.html#cb22-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-64"><a href="stage-1-preparation-of-input-data.html#cb22-64" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp_max[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb22-65"><a href="stage-1-preparation-of-input-data.html#cb22-65" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb22-66"><a href="stage-1-preparation-of-input-data.html#cb22-66" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb22-67"><a href="stage-1-preparation-of-input-data.html#cb22-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-68"><a href="stage-1-preparation-of-input-data.html#cb22-68" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb22-69"><a href="stage-1-preparation-of-input-data.html#cb22-69" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb22-70"><a href="stage-1-preparation-of-input-data.html#cb22-70" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb22-71"><a href="stage-1-preparation-of-input-data.html#cb22-71" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb22-72"><a href="stage-1-preparation-of-input-data.html#cb22-72" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb22-73"><a href="stage-1-preparation-of-input-data.html#cb22-73" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb22-74"><a href="stage-1-preparation-of-input-data.html#cb22-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb22-75"><a href="stage-1-preparation-of-input-data.html#cb22-75" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec_max[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb22-76"><a href="stage-1-preparation-of-input-data.html#cb22-76" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb22-77"><a href="stage-1-preparation-of-input-data.html#cb22-77" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb22-78"><a href="stage-1-preparation-of-input-data.html#cb22-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-79"><a href="stage-1-preparation-of-input-data.html#cb22-79" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb22-80"><a href="stage-1-preparation-of-input-data.html#cb22-80" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb22-81"><a href="stage-1-preparation-of-input-data.html#cb22-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-82"><a href="stage-1-preparation-of-input-data.html#cb22-82" aria-hidden="true" tabindex="-1"></a>NPP_rain<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb22-83"><a href="stage-1-preparation-of-input-data.html#cb22-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-84"><a href="stage-1-preparation-of-input-data.html#cb22-84" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb22-85"><a href="stage-1-preparation-of-input-data.html#cb22-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-86"><a href="stage-1-preparation-of-input-data.html#cb22-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-87"><a href="stage-1-preparation-of-input-data.html#cb22-87" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb22-88"><a href="stage-1-preparation-of-input-data.html#cb22-88" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb22-89"><a href="stage-1-preparation-of-input-data.html#cb22-89" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb22-90"><a href="stage-1-preparation-of-input-data.html#cb22-90" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb22-91"><a href="stage-1-preparation-of-input-data.html#cb22-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-92"><a href="stage-1-preparation-of-input-data.html#cb22-92" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb22-93"><a href="stage-1-preparation-of-input-data.html#cb22-93" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb22-94"><a href="stage-1-preparation-of-input-data.html#cb22-94" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb22-95"><a href="stage-1-preparation-of-input-data.html#cb22-95" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb22-96"><a href="stage-1-preparation-of-input-data.html#cb22-96" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb22-97"><a href="stage-1-preparation-of-input-data.html#cb22-97" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb22-98"><a href="stage-1-preparation-of-input-data.html#cb22-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Save NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb22-99"><a href="stage-1-preparation-of-input-data.html#cb22-99" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb22-100"><a href="stage-1-preparation-of-input-data.html#cb22-100" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00_MAX.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb22-101"><a href="stage-1-preparation-of-input-data.html#cb22-101" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb22-102"><a href="stage-1-preparation-of-input-data.html#cb22-102" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb22-103"><a href="stage-1-preparation-of-input-data.html#cb22-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; and mask</span></span>
<span id="cb22-104"><a href="stage-1-preparation-of-input-data.html#cb22-104" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb22-105"><a href="stage-1-preparation-of-input-data.html#cb22-105" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb22-106"><a href="stage-1-preparation-of-input-data.html#cb22-106" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb22-107"><a href="stage-1-preparation-of-input-data.html#cb22-107" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb22-108"><a href="stage-1-preparation-of-input-data.html#cb22-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-109"><a href="stage-1-preparation-of-input-data.html#cb22-109" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI_MAX.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<hr />
</div>
</div>
<div id="option-b-preparation-of-the-terraclimate-climatic-variables" class="section level3" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> <em>Option B</em> Preparation of the TerraClimate climatic variables</h3>
<p>This section presents step by step guidelines on how to download and prepare the required climatic variables from the TerraClimate data set.</p>
<div id="script-number-1.-terraclimate-gee-spin-up-phase" class="section level4" number="9.2.2.1">
<h4><span class="header-section-number">9.2.2.1</span> Script Number 1. TerraClimate GEE Spin up phase</h4>
<p>The TerraClimate data set can be downloaded directly from Google Earth Engine, a powerful and free cloud computing platform.
First, the user will need to activate a Google Earth Engine account. To run the Google Earth Engine (GEE) tool, the user will need to copy and paste the script (provided below) into the GEE code editor (central panel, Fig. 9.1).</p>
<div class="figure">
<img src="images/Figure_9.1.png" alt="" />
<p class="caption"><strong>Figure 9.1</strong> <em>Google Earth Engine code editor</em></p>
</div>
<p>To run the script the user can input a new geometry using the geometry tools panel (Figure 9.2) or by uploading a shapefile.</p>
<div class="figure">
<img src="images/Figure_9.2.png" alt="" />
<p class="caption"><strong>Figure 9.2</strong> <em>Drawing a polygon in Google Earth Engine</em></p>
</div>
<p>The following script can be copied and pasted into GEE without any further modifications:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb23-1"><a href="stage-1-preparation-of-input-data.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Climate data sets for the Spin Up phase 1980-2001</span></span>
<span id="cb23-2"><a href="stage-1-preparation-of-input-data.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">// calculate the average temperature from minimum and maximum temperatures</span></span>
<span id="cb23-3"><a href="stage-1-preparation-of-input-data.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">// download the Minimum and Maximum Temperature </span></span>
<span id="cb23-4"><a href="stage-1-preparation-of-input-data.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">// download the Average temperature</span></span>
<span id="cb23-5"><a href="stage-1-preparation-of-input-data.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">// download the PET </span></span>
<span id="cb23-6"><a href="stage-1-preparation-of-input-data.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">// download the Precipitation</span></span>
<span id="cb23-7"><a href="stage-1-preparation-of-input-data.html#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="stage-1-preparation-of-input-data.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dataset <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;IDAHO_EPSCOR/TERRACLIMATE&#39;</span>)</span>
<span id="cb23-9"><a href="stage-1-preparation-of-input-data.html#cb23-9" aria-hidden="true" tabindex="-1"></a>                  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;1981-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2001-01-01&#39;</span>))<span class="op">;</span></span>
<span id="cb23-10"><a href="stage-1-preparation-of-input-data.html#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="stage-1-preparation-of-input-data.html#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> maximumTemperature <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;tmmx&#39;</span>)<span class="op">;</span></span>
<span id="cb23-12"><a href="stage-1-preparation-of-input-data.html#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mxT <span class="op">=</span> maximumTemperature<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb23-13"><a href="stage-1-preparation-of-input-data.html#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> minimumTemperature <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;tmmn&#39;</span>)<span class="op">;</span></span>
<span id="cb23-14"><a href="stage-1-preparation-of-input-data.html#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mnT <span class="op">=</span> minimumTemperature<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb23-15"><a href="stage-1-preparation-of-input-data.html#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="stage-1-preparation-of-input-data.html#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> precipitation <span class="op">=</span>dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pr&#39;</span>)<span class="op">;</span></span>
<span id="cb23-17"><a href="stage-1-preparation-of-input-data.html#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pre <span class="op">=</span>precipitation<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb23-18"><a href="stage-1-preparation-of-input-data.html#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="stage-1-preparation-of-input-data.html#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> evapotranspiration <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pet&#39;</span>)<span class="op">;</span></span>
<span id="cb23-20"><a href="stage-1-preparation-of-input-data.html#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pet <span class="op">=</span>evapotranspiration<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb23-21"><a href="stage-1-preparation-of-input-data.html#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="stage-1-preparation-of-input-data.html#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> diff <span class="op">=</span> mxT<span class="op">.</span><span class="fu">add</span>(mnT)<span class="op">;</span></span>
<span id="cb23-23"><a href="stage-1-preparation-of-input-data.html#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> avT <span class="op">=</span> diff<span class="op">.</span><span class="fu">divide</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb23-24"><a href="stage-1-preparation-of-input-data.html#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="stage-1-preparation-of-input-data.html#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> avT <span class="op">=</span>avT<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb23-26"><a href="stage-1-preparation-of-input-data.html#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pre <span class="op">=</span>pre<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb23-27"><a href="stage-1-preparation-of-input-data.html#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pet <span class="op">=</span>pet<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb23-28"><a href="stage-1-preparation-of-input-data.html#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="stage-1-preparation-of-input-data.html#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="stage-1-preparation-of-input-data.html#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="stage-1-preparation-of-input-data.html#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(avT<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb23-32"><a href="stage-1-preparation-of-input-data.html#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(pre<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb23-33"><a href="stage-1-preparation-of-input-data.html#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(pet<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb23-34"><a href="stage-1-preparation-of-input-data.html#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="stage-1-preparation-of-input-data.html#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="stage-1-preparation-of-input-data.html#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(avT<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb23-37"><a href="stage-1-preparation-of-input-data.html#cb23-37" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb23-38"><a href="stage-1-preparation-of-input-data.html#cb23-38" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> avT<span class="op">,</span></span>
<span id="cb23-39"><a href="stage-1-preparation-of-input-data.html#cb23-39" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClimate&quot;</span><span class="op">,</span></span>
<span id="cb23-40"><a href="stage-1-preparation-of-input-data.html#cb23-40" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;AverageTemperature_1981-2001&#39;</span><span class="op">,</span> </span>
<span id="cb23-41"><a href="stage-1-preparation-of-input-data.html#cb23-41" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb23-42"><a href="stage-1-preparation-of-input-data.html#cb23-42" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb23-43"><a href="stage-1-preparation-of-input-data.html#cb23-43" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb23-44"><a href="stage-1-preparation-of-input-data.html#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="stage-1-preparation-of-input-data.html#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(pre<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb23-46"><a href="stage-1-preparation-of-input-data.html#cb23-46" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb23-47"><a href="stage-1-preparation-of-input-data.html#cb23-47" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> pre<span class="op">,</span></span>
<span id="cb23-48"><a href="stage-1-preparation-of-input-data.html#cb23-48" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClimate&quot;</span><span class="op">,</span></span>
<span id="cb23-49"><a href="stage-1-preparation-of-input-data.html#cb23-49" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Precipitation_1981-2001&#39;</span><span class="op">,</span> </span>
<span id="cb23-50"><a href="stage-1-preparation-of-input-data.html#cb23-50" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb23-51"><a href="stage-1-preparation-of-input-data.html#cb23-51" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb23-52"><a href="stage-1-preparation-of-input-data.html#cb23-52" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb23-53"><a href="stage-1-preparation-of-input-data.html#cb23-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-54"><a href="stage-1-preparation-of-input-data.html#cb23-54" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(pet<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb23-55"><a href="stage-1-preparation-of-input-data.html#cb23-55" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb23-56"><a href="stage-1-preparation-of-input-data.html#cb23-56" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> pet<span class="op">,</span></span>
<span id="cb23-57"><a href="stage-1-preparation-of-input-data.html#cb23-57" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClimate&quot;</span><span class="op">,</span></span>
<span id="cb23-58"><a href="stage-1-preparation-of-input-data.html#cb23-58" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;PET_1981-2001&#39;</span><span class="op">,</span> </span>
<span id="cb23-59"><a href="stage-1-preparation-of-input-data.html#cb23-59" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb23-60"><a href="stage-1-preparation-of-input-data.html#cb23-60" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb23-61"><a href="stage-1-preparation-of-input-data.html#cb23-61" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<div id="scrip-number-2.-terraclimate-gee-warm-up-and-forward-phase" class="section level4" number="9.2.2.2">
<h4><span class="header-section-number">9.2.2.2</span> Scrip Number 2. TerraClimate GEE Warm up and Forward phase</h4>
<p>To retrieve the necessary climatic data (2001-2018/20) to be used as input for the warm up and subsequent forward phase the same steps are repeated as for Script 2.1. After defining a geometry or inputting a shapefile the following code can be copied and pasted into the GEE code editor.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb24-1"><a href="stage-1-preparation-of-input-data.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ss">/ Climate data sets for the Warm Up phase and Forward phase 2001 - 2020</span></span>
<span id="cb24-2"><a href="stage-1-preparation-of-input-data.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ss">// calculate the average temperature from minimum and maximum temperatures</span></span>
<span id="cb24-3"><a href="stage-1-preparation-of-input-data.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="ss">// download the Average temperature</span></span>
<span id="cb24-4"><a href="stage-1-preparation-of-input-data.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="ss">// download the PET </span></span>
<span id="cb24-5"><a href="stage-1-preparation-of-input-data.html#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="ss">// download the Precipitation</span></span>
<span id="cb24-6"><a href="stage-1-preparation-of-input-data.html#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="stage-1-preparation-of-input-data.html#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="ss">var dataset = ee.ImageCollection</span><span class="sc">(</span><span class="ss">&#39;IDAHO_EPSCOR/TERRACLIMATE</span><span class="st">&#39;)</span></span>
<span id="cb24-8"><a href="stage-1-preparation-of-input-data.html#cb24-8" aria-hidden="true" tabindex="-1"></a>                  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2001-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))<span class="op">;</span></span>
<span id="cb24-9"><a href="stage-1-preparation-of-input-data.html#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="stage-1-preparation-of-input-data.html#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> maximumTemperature <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;tmmx&#39;</span>)<span class="op">;</span></span>
<span id="cb24-11"><a href="stage-1-preparation-of-input-data.html#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mxT <span class="op">=</span> maximumTemperature<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb24-12"><a href="stage-1-preparation-of-input-data.html#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> minimumTemperature <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;tmmn&#39;</span>)<span class="op">;</span></span>
<span id="cb24-13"><a href="stage-1-preparation-of-input-data.html#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mnT <span class="op">=</span> minimumTemperature<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb24-14"><a href="stage-1-preparation-of-input-data.html#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="stage-1-preparation-of-input-data.html#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> precipitation <span class="op">=</span>dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pr&#39;</span>)<span class="op">;</span></span>
<span id="cb24-16"><a href="stage-1-preparation-of-input-data.html#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pre <span class="op">=</span>precipitation<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb24-17"><a href="stage-1-preparation-of-input-data.html#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="stage-1-preparation-of-input-data.html#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> evapotranspiration <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pet&#39;</span>)<span class="op">;</span></span>
<span id="cb24-19"><a href="stage-1-preparation-of-input-data.html#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pet <span class="op">=</span>evapotranspiration<span class="op">.</span><span class="fu">toBands</span>()<span class="op">;</span></span>
<span id="cb24-20"><a href="stage-1-preparation-of-input-data.html#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="stage-1-preparation-of-input-data.html#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> diff <span class="op">=</span> mxT<span class="op">.</span><span class="fu">add</span>(mnT)<span class="op">;</span></span>
<span id="cb24-22"><a href="stage-1-preparation-of-input-data.html#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> avT <span class="op">=</span> diff<span class="op">.</span><span class="fu">divide</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb24-23"><a href="stage-1-preparation-of-input-data.html#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="stage-1-preparation-of-input-data.html#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> avT <span class="op">=</span>avT<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb24-25"><a href="stage-1-preparation-of-input-data.html#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pre <span class="op">=</span>pre<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb24-26"><a href="stage-1-preparation-of-input-data.html#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pet <span class="op">=</span>pet<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb24-27"><a href="stage-1-preparation-of-input-data.html#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="stage-1-preparation-of-input-data.html#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="stage-1-preparation-of-input-data.html#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="stage-1-preparation-of-input-data.html#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(avT<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb24-31"><a href="stage-1-preparation-of-input-data.html#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(pre<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb24-32"><a href="stage-1-preparation-of-input-data.html#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(pet<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;default RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb24-33"><a href="stage-1-preparation-of-input-data.html#cb24-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-34"><a href="stage-1-preparation-of-input-data.html#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="stage-1-preparation-of-input-data.html#cb24-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-36"><a href="stage-1-preparation-of-input-data.html#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(avT<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb24-37"><a href="stage-1-preparation-of-input-data.html#cb24-37" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb24-38"><a href="stage-1-preparation-of-input-data.html#cb24-38" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> avT<span class="op">,</span></span>
<span id="cb24-39"><a href="stage-1-preparation-of-input-data.html#cb24-39" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClime&quot;</span><span class="op">,</span></span>
<span id="cb24-40"><a href="stage-1-preparation-of-input-data.html#cb24-40" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;AverageTemperature_2001-2021&#39;</span><span class="op">,</span> </span>
<span id="cb24-41"><a href="stage-1-preparation-of-input-data.html#cb24-41" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb24-42"><a href="stage-1-preparation-of-input-data.html#cb24-42" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb24-43"><a href="stage-1-preparation-of-input-data.html#cb24-43" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb24-44"><a href="stage-1-preparation-of-input-data.html#cb24-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-45"><a href="stage-1-preparation-of-input-data.html#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(pre<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb24-46"><a href="stage-1-preparation-of-input-data.html#cb24-46" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb24-47"><a href="stage-1-preparation-of-input-data.html#cb24-47" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> pre<span class="op">,</span></span>
<span id="cb24-48"><a href="stage-1-preparation-of-input-data.html#cb24-48" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClime&quot;</span><span class="op">,</span></span>
<span id="cb24-49"><a href="stage-1-preparation-of-input-data.html#cb24-49" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Precipitation_2001-2021&#39;</span><span class="op">,</span> </span>
<span id="cb24-50"><a href="stage-1-preparation-of-input-data.html#cb24-50" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb24-51"><a href="stage-1-preparation-of-input-data.html#cb24-51" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb24-52"><a href="stage-1-preparation-of-input-data.html#cb24-52" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb24-53"><a href="stage-1-preparation-of-input-data.html#cb24-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-54"><a href="stage-1-preparation-of-input-data.html#cb24-54" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(pet<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb24-55"><a href="stage-1-preparation-of-input-data.html#cb24-55" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb24-56"><a href="stage-1-preparation-of-input-data.html#cb24-56" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> pet<span class="op">,</span></span>
<span id="cb24-57"><a href="stage-1-preparation-of-input-data.html#cb24-57" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;TerraClime&quot;</span><span class="op">,</span></span>
<span id="cb24-58"><a href="stage-1-preparation-of-input-data.html#cb24-58" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;PET_2001-2021&#39;</span><span class="op">,</span> </span>
<span id="cb24-59"><a href="stage-1-preparation-of-input-data.html#cb24-59" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">4000</span><span class="op">,</span></span>
<span id="cb24-60"><a href="stage-1-preparation-of-input-data.html#cb24-60" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span> geometry</span>
<span id="cb24-61"><a href="stage-1-preparation-of-input-data.html#cb24-61" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<div id="script-number-3.-terraclimate-variables-spin-up-phase" class="section level4" number="9.2.2.3">
<h4><span class="header-section-number">9.2.2.3</span> Script Number 3. TerraClimate Variables Spin up phase</h4>
<p>Once the data has been downloaded using GEE for the time period 1981-2000, the necessary target variables for the spin up phase can be prepared using the following scripts. For each modelling phase we will need a different selection of climate layers. For phase 1 (“Long Spin up”), we will need to stack 12 spatial layers (the output file will be a multiband raster layer) for each climate variable mentioned above (temperature, precipitation and evapotranspiration). The time series for this initial phase goes from 1981 to 2000. The script number 3 will transform the downloaded TerraClimate files to obtain monthly averages (temperature, precipitation, evapotranspiration) for the 1981-2000 series, ready to be used in the spin up modelling phase.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="stage-1-preparation-of-input-data.html#cb25-1" aria-hidden="true" tabindex="-1"></a>DATE<span class="sc">:</span>  <span class="dv">2</span><span class="sc">/</span><span class="dv">11</span><span class="sc">/</span><span class="dv">2020</span></span>
<span id="cb25-2"><a href="stage-1-preparation-of-input-data.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="stage-1-preparation-of-input-data.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  MSc Ing Agr Luciano E. Di Paolo</span></span>
<span id="cb25-4"><a href="stage-1-preparation-of-input-data.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb25-5"><a href="stage-1-preparation-of-input-data.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb25-6"><a href="stage-1-preparation-of-input-data.html#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="stage-1-preparation-of-input-data.html#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb25-8"><a href="stage-1-preparation-of-input-data.html#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb25-9"><a href="stage-1-preparation-of-input-data.html#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="stage-1-preparation-of-input-data.html#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="stage-1-preparation-of-input-data.html#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># TerraClimate FROM GOOGLE EARTH ENGINE</span></span>
<span id="cb25-12"><a href="stage-1-preparation-of-input-data.html#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Abatzoglou, J.T., S.Z. Dobrowski, S.A. Parks, K.C. Hegewisch, 2018, Terraclimate, </span></span>
<span id="cb25-13"><a href="stage-1-preparation-of-input-data.html#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#a high-resolution global dataset of monthly climate and climatic water balance from 1958-2015, Scientific Data,</span></span>
<span id="cb25-14"><a href="stage-1-preparation-of-input-data.html#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb25-15"><a href="stage-1-preparation-of-input-data.html#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="stage-1-preparation-of-input-data.html#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Set working directory</span></span>
<span id="cb25-17"><a href="stage-1-preparation-of-input-data.html#cb25-17" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/TERRA_CLIME&quot;</span>)</span>
<span id="cb25-18"><a href="stage-1-preparation-of-input-data.html#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb25-19"><a href="stage-1-preparation-of-input-data.html#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="stage-1-preparation-of-input-data.html#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="stage-1-preparation-of-input-data.html#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the TerraClimate data from GEE</span></span>
<span id="cb25-22"><a href="stage-1-preparation-of-input-data.html#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="stage-1-preparation-of-input-data.html#cb25-23" aria-hidden="true" tabindex="-1"></a>tmp<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;AverageTemperature_1981-2001_Pergamino.tif&quot;</span>)</span>
<span id="cb25-24"><a href="stage-1-preparation-of-input-data.html#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="stage-1-preparation-of-input-data.html#cb25-25" aria-hidden="true" tabindex="-1"></a>pre_81_00<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Precipitation_1981-2001_Pergamino.tif&quot;</span>)</span>
<span id="cb25-26"><a href="stage-1-preparation-of-input-data.html#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="stage-1-preparation-of-input-data.html#cb25-27" aria-hidden="true" tabindex="-1"></a>pet_81_00<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;PET_1981-2001_Pergamino.tif&quot;</span>)</span>
<span id="cb25-28"><a href="stage-1-preparation-of-input-data.html#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="stage-1-preparation-of-input-data.html#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="stage-1-preparation-of-input-data.html#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb25-31"><a href="stage-1-preparation-of-input-data.html#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="stage-1-preparation-of-input-data.html#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Get one month temperature ( January)</span></span>
<span id="cb25-33"><a href="stage-1-preparation-of-input-data.html#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="stage-1-preparation-of-input-data.html#cb25-34" aria-hidden="true" tabindex="-1"></a>tmp_Jan_1<span class="ot">&lt;-</span>tmp[[<span class="dv">1</span>]]</span>
<span id="cb25-35"><a href="stage-1-preparation-of-input-data.html#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="stage-1-preparation-of-input-data.html#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(tmp_Jan_1)</span>
<span id="cb25-37"><a href="stage-1-preparation-of-input-data.html#cb25-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-38"><a href="stage-1-preparation-of-input-data.html#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb25-39"><a href="stage-1-preparation-of-input-data.html#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="stage-1-preparation-of-input-data.html#cb25-40" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb25-41"><a href="stage-1-preparation-of-input-data.html#cb25-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-42"><a href="stage-1-preparation-of-input-data.html#cb25-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb25-43"><a href="stage-1-preparation-of-input-data.html#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="stage-1-preparation-of-input-data.html#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb25-45"><a href="stage-1-preparation-of-input-data.html#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb25-46"><a href="stage-1-preparation-of-input-data.html#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="stage-1-preparation-of-input-data.html#cb25-47" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>tmp_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb25-48"><a href="stage-1-preparation-of-input-data.html#cb25-48" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb25-49"><a href="stage-1-preparation-of-input-data.html#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="stage-1-preparation-of-input-data.html#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb25-51"><a href="stage-1-preparation-of-input-data.html#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb25-52"><a href="stage-1-preparation-of-input-data.html#cb25-52" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> tmp[[k]])</span>
<span id="cb25-53"><a href="stage-1-preparation-of-input-data.html#cb25-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-54"><a href="stage-1-preparation-of-input-data.html#cb25-54" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb25-55"><a href="stage-1-preparation-of-input-data.html#cb25-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-56"><a href="stage-1-preparation-of-input-data.html#cb25-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-57"><a href="stage-1-preparation-of-input-data.html#cb25-57" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate each month average. </span></span>
<span id="cb25-58"><a href="stage-1-preparation-of-input-data.html#cb25-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-59"><a href="stage-1-preparation-of-input-data.html#cb25-59" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span><span class="dv">20</span></span>
<span id="cb25-60"><a href="stage-1-preparation-of-input-data.html#cb25-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-61"><a href="stage-1-preparation-of-input-data.html#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the average of each month (i)</span></span>
<span id="cb25-62"><a href="stage-1-preparation-of-input-data.html#cb25-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-63"><a href="stage-1-preparation-of-input-data.html#cb25-63" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb25-64"><a href="stage-1-preparation-of-input-data.html#cb25-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-65"><a href="stage-1-preparation-of-input-data.html#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="do">#######for loop ends########</span></span>
<span id="cb25-66"><a href="stage-1-preparation-of-input-data.html#cb25-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-67"><a href="stage-1-preparation-of-input-data.html#cb25-67" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb25-68"><a href="stage-1-preparation-of-input-data.html#cb25-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-69"><a href="stage-1-preparation-of-input-data.html#cb25-69" aria-hidden="true" tabindex="-1"></a>Temp_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb25-70"><a href="stage-1-preparation-of-input-data.html#cb25-70" aria-hidden="true" tabindex="-1"></a>Temp_Stack<span class="ot">&lt;-</span>Temp_Stack<span class="sc">*</span><span class="fl">0.1</span> <span class="co"># rescale to C</span></span>
<span id="cb25-71"><a href="stage-1-preparation-of-input-data.html#cb25-71" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_81-00_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-72"><a href="stage-1-preparation-of-input-data.html#cb25-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-73"><a href="stage-1-preparation-of-input-data.html#cb25-73" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb25-74"><a href="stage-1-preparation-of-input-data.html#cb25-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-75"><a href="stage-1-preparation-of-input-data.html#cb25-75" aria-hidden="true" tabindex="-1"></a><span class="co">#PRECIPITATION</span></span>
<span id="cb25-76"><a href="stage-1-preparation-of-input-data.html#cb25-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-77"><a href="stage-1-preparation-of-input-data.html#cb25-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Get one month Precipitation ( January)</span></span>
<span id="cb25-78"><a href="stage-1-preparation-of-input-data.html#cb25-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-79"><a href="stage-1-preparation-of-input-data.html#cb25-79" aria-hidden="true" tabindex="-1"></a>pre_Jan_1<span class="ot">&lt;-</span>pre_81_00[[<span class="dv">1</span>]]</span>
<span id="cb25-80"><a href="stage-1-preparation-of-input-data.html#cb25-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-81"><a href="stage-1-preparation-of-input-data.html#cb25-81" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(pre_Jan_1)</span>
<span id="cb25-82"><a href="stage-1-preparation-of-input-data.html#cb25-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-83"><a href="stage-1-preparation-of-input-data.html#cb25-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb25-84"><a href="stage-1-preparation-of-input-data.html#cb25-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-85"><a href="stage-1-preparation-of-input-data.html#cb25-85" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb25-86"><a href="stage-1-preparation-of-input-data.html#cb25-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-87"><a href="stage-1-preparation-of-input-data.html#cb25-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb25-88"><a href="stage-1-preparation-of-input-data.html#cb25-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-89"><a href="stage-1-preparation-of-input-data.html#cb25-89" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb25-90"><a href="stage-1-preparation-of-input-data.html#cb25-90" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb25-91"><a href="stage-1-preparation-of-input-data.html#cb25-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-92"><a href="stage-1-preparation-of-input-data.html#cb25-92" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pre_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb25-93"><a href="stage-1-preparation-of-input-data.html#cb25-93" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb25-94"><a href="stage-1-preparation-of-input-data.html#cb25-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-95"><a href="stage-1-preparation-of-input-data.html#cb25-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb25-96"><a href="stage-1-preparation-of-input-data.html#cb25-96" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb25-97"><a href="stage-1-preparation-of-input-data.html#cb25-97" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pre_81_00[[k]])</span>
<span id="cb25-98"><a href="stage-1-preparation-of-input-data.html#cb25-98" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb25-99"><a href="stage-1-preparation-of-input-data.html#cb25-99" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-100"><a href="stage-1-preparation-of-input-data.html#cb25-100" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb25-101"><a href="stage-1-preparation-of-input-data.html#cb25-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-102"><a href="stage-1-preparation-of-input-data.html#cb25-102" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span><span class="dv">20</span></span>
<span id="cb25-103"><a href="stage-1-preparation-of-input-data.html#cb25-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-104"><a href="stage-1-preparation-of-input-data.html#cb25-104" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb25-105"><a href="stage-1-preparation-of-input-data.html#cb25-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-106"><a href="stage-1-preparation-of-input-data.html#cb25-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-107"><a href="stage-1-preparation-of-input-data.html#cb25-107" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop ends#######</span></span>
<span id="cb25-108"><a href="stage-1-preparation-of-input-data.html#cb25-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-109"><a href="stage-1-preparation-of-input-data.html#cb25-109" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb25-110"><a href="stage-1-preparation-of-input-data.html#cb25-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-111"><a href="stage-1-preparation-of-input-data.html#cb25-111" aria-hidden="true" tabindex="-1"></a>Prec_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb25-112"><a href="stage-1-preparation-of-input-data.html#cb25-112" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_81-00_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-113"><a href="stage-1-preparation-of-input-data.html#cb25-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-114"><a href="stage-1-preparation-of-input-data.html#cb25-114" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb25-115"><a href="stage-1-preparation-of-input-data.html#cb25-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-116"><a href="stage-1-preparation-of-input-data.html#cb25-116" aria-hidden="true" tabindex="-1"></a><span class="co"># POTENTIAL EVAPOTRANSPIRATION </span></span>
<span id="cb25-117"><a href="stage-1-preparation-of-input-data.html#cb25-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-118"><a href="stage-1-preparation-of-input-data.html#cb25-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-119"><a href="stage-1-preparation-of-input-data.html#cb25-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Get one month PET ( January)</span></span>
<span id="cb25-120"><a href="stage-1-preparation-of-input-data.html#cb25-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-121"><a href="stage-1-preparation-of-input-data.html#cb25-121" aria-hidden="true" tabindex="-1"></a>pet_Jan_1<span class="ot">&lt;-</span>pet_81_00[[<span class="dv">1</span>]]</span>
<span id="cb25-122"><a href="stage-1-preparation-of-input-data.html#cb25-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-123"><a href="stage-1-preparation-of-input-data.html#cb25-123" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(pet_Jan_1)</span>
<span id="cb25-124"><a href="stage-1-preparation-of-input-data.html#cb25-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-125"><a href="stage-1-preparation-of-input-data.html#cb25-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb25-126"><a href="stage-1-preparation-of-input-data.html#cb25-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-127"><a href="stage-1-preparation-of-input-data.html#cb25-127" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb25-128"><a href="stage-1-preparation-of-input-data.html#cb25-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-129"><a href="stage-1-preparation-of-input-data.html#cb25-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb25-130"><a href="stage-1-preparation-of-input-data.html#cb25-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-131"><a href="stage-1-preparation-of-input-data.html#cb25-131" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop starts#######</span></span>
<span id="cb25-132"><a href="stage-1-preparation-of-input-data.html#cb25-132" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb25-133"><a href="stage-1-preparation-of-input-data.html#cb25-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-134"><a href="stage-1-preparation-of-input-data.html#cb25-134" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pet_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb25-135"><a href="stage-1-preparation-of-input-data.html#cb25-135" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb25-136"><a href="stage-1-preparation-of-input-data.html#cb25-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-137"><a href="stage-1-preparation-of-input-data.html#cb25-137" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb25-138"><a href="stage-1-preparation-of-input-data.html#cb25-138" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb25-139"><a href="stage-1-preparation-of-input-data.html#cb25-139" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pet_81_00[[k]])</span>
<span id="cb25-140"><a href="stage-1-preparation-of-input-data.html#cb25-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-141"><a href="stage-1-preparation-of-input-data.html#cb25-141" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb25-142"><a href="stage-1-preparation-of-input-data.html#cb25-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-143"><a href="stage-1-preparation-of-input-data.html#cb25-143" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-144"><a href="stage-1-preparation-of-input-data.html#cb25-144" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb25-145"><a href="stage-1-preparation-of-input-data.html#cb25-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-146"><a href="stage-1-preparation-of-input-data.html#cb25-146" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span><span class="dv">20</span></span>
<span id="cb25-147"><a href="stage-1-preparation-of-input-data.html#cb25-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-148"><a href="stage-1-preparation-of-input-data.html#cb25-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-149"><a href="stage-1-preparation-of-input-data.html#cb25-149" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb25-150"><a href="stage-1-preparation-of-input-data.html#cb25-150" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-151"><a href="stage-1-preparation-of-input-data.html#cb25-151" aria-hidden="true" tabindex="-1"></a><span class="do">######for loop ends#######</span></span>
<span id="cb25-152"><a href="stage-1-preparation-of-input-data.html#cb25-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-153"><a href="stage-1-preparation-of-input-data.html#cb25-153" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb25-154"><a href="stage-1-preparation-of-input-data.html#cb25-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-155"><a href="stage-1-preparation-of-input-data.html#cb25-155" aria-hidden="true" tabindex="-1"></a>PET_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb25-156"><a href="stage-1-preparation-of-input-data.html#cb25-156" aria-hidden="true" tabindex="-1"></a>PET_Stack<span class="ot">&lt;-</span>PET_Stack<span class="sc">*</span><span class="fl">0.1</span></span>
<span id="cb25-157"><a href="stage-1-preparation-of-input-data.html#cb25-157" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(PET_Stack,<span class="at">filename=</span><span class="st">&#39;PET_Stack_81-00_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="script-number-4.-terraclimate-variables-warm-up-phase" class="section level4" number="9.2.2.4">
<h4><span class="header-section-number">9.2.2.4</span> Script Number 4. TerraClimate Variables Warm up phase</h4>
<p>Once the data has been downloaded using GEE for the time period 2001-2018/20, the necessary target variables for the warm up and forward phases can be prepared using the following script. The purpose of the “Warm up” phase is to adjust the initial SOC stock and initial pools for the “forward” phase. Once the input climate layers have been harmonized, the model will run for each year from 2001 to 2018/20, using the monthly climate data of each year of the series (for 216/240 values for each month of the time series). The script number 4 is prepared to arrange the necessary TerraClimate files for this phase. We will need to generate one raster stack of 216/240 spatial layers for each climate variable mentioned above (216 spatial layers if we use just 18 years period instead of a 20 year period; from 2001 to 2018, depending on the available climate data). Each stack will have one layer for each month from 2001 to 2018/2020. For phase number 3, the “Forward” phase, we will need monthly averages of the time series 2001-2018/20. We will use the same arrangement as used in phase number one (one stack of 12 bands for each variable) but instead of using the averages of the 1981-2000 period we will use the climatic data of the 2001-2018/20 period. We will assume that there is no climate change in the next 20 years. Thus, script number 2 will also prepare the climate files for the “forward phase”.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="stage-1-preparation-of-input-data.html#cb26-1" aria-hidden="true" tabindex="-1"></a>DATE<span class="sc">:</span> <span class="dv">12</span><span class="sc">/</span><span class="dv">02</span><span class="sc">/</span><span class="dv">2021</span></span>
<span id="cb26-2"><a href="stage-1-preparation-of-input-data.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="stage-1-preparation-of-input-data.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  MSc Ing Agr Luciano E. Di Paolo</span></span>
<span id="cb26-4"><a href="stage-1-preparation-of-input-data.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb26-5"><a href="stage-1-preparation-of-input-data.html#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="stage-1-preparation-of-input-data.html#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="stage-1-preparation-of-input-data.html#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="stage-1-preparation-of-input-data.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># TerraClimate FROM GOOGLE EARTH ENGINE</span></span>
<span id="cb26-9"><a href="stage-1-preparation-of-input-data.html#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Abatzoglou, J.T., S.Z. Dobrowski, S.A. Parks, K.C. Hegewisch, 2018, Terraclimate, </span></span>
<span id="cb26-10"><a href="stage-1-preparation-of-input-data.html#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">#a high-resolution global dataset of monthly climate and climatic water balance from 1958-2015, Scientific Data,</span></span>
<span id="cb26-11"><a href="stage-1-preparation-of-input-data.html#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb26-12"><a href="stage-1-preparation-of-input-data.html#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="stage-1-preparation-of-input-data.html#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb26-14"><a href="stage-1-preparation-of-input-data.html#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="stage-1-preparation-of-input-data.html#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb26-16"><a href="stage-1-preparation-of-input-data.html#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb26-17"><a href="stage-1-preparation-of-input-data.html#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="stage-1-preparation-of-input-data.html#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################################</span></span>
<span id="cb26-19"><a href="stage-1-preparation-of-input-data.html#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="stage-1-preparation-of-input-data.html#cb26-20" aria-hidden="true" tabindex="-1"></a>WD<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/TERRA_CLIME&quot;</span>)</span>
<span id="cb26-21"><a href="stage-1-preparation-of-input-data.html#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD)</span>
<span id="cb26-22"><a href="stage-1-preparation-of-input-data.html#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="stage-1-preparation-of-input-data.html#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co"># OPEN LAYERS</span></span>
<span id="cb26-24"><a href="stage-1-preparation-of-input-data.html#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="stage-1-preparation-of-input-data.html#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="stage-1-preparation-of-input-data.html#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the TerraClimate data from GEE</span></span>
<span id="cb26-27"><a href="stage-1-preparation-of-input-data.html#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="stage-1-preparation-of-input-data.html#cb26-28" aria-hidden="true" tabindex="-1"></a>tmp<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;AverageTemperature_2001-2021_Pergamino.tif&quot;</span>)</span>
<span id="cb26-29"><a href="stage-1-preparation-of-input-data.html#cb26-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-30"><a href="stage-1-preparation-of-input-data.html#cb26-30" aria-hidden="true" tabindex="-1"></a>pre_01_18<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Precipitation_2001-2021_Pergamino.tif&quot;</span>)</span>
<span id="cb26-31"><a href="stage-1-preparation-of-input-data.html#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="stage-1-preparation-of-input-data.html#cb26-32" aria-hidden="true" tabindex="-1"></a>pet_01_18<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;PET_2001-2021_Pergamino.tif&quot;</span>)</span>
<span id="cb26-33"><a href="stage-1-preparation-of-input-data.html#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="stage-1-preparation-of-input-data.html#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb26-35"><a href="stage-1-preparation-of-input-data.html#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="stage-1-preparation-of-input-data.html#cb26-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-37"><a href="stage-1-preparation-of-input-data.html#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Get one month temperature ( January)</span></span>
<span id="cb26-38"><a href="stage-1-preparation-of-input-data.html#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="stage-1-preparation-of-input-data.html#cb26-39" aria-hidden="true" tabindex="-1"></a>tmp_Jan_1<span class="ot">&lt;-</span>tmp[[<span class="dv">1</span>]]</span>
<span id="cb26-40"><a href="stage-1-preparation-of-input-data.html#cb26-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-41"><a href="stage-1-preparation-of-input-data.html#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(tmp_Jan_1)</span>
<span id="cb26-42"><a href="stage-1-preparation-of-input-data.html#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-43"><a href="stage-1-preparation-of-input-data.html#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb26-44"><a href="stage-1-preparation-of-input-data.html#cb26-44" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-45"><a href="stage-1-preparation-of-input-data.html#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="stage-1-preparation-of-input-data.html#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb26-47"><a href="stage-1-preparation-of-input-data.html#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop starts###############</span></span>
<span id="cb26-48"><a href="stage-1-preparation-of-input-data.html#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb26-49"><a href="stage-1-preparation-of-input-data.html#cb26-49" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>tmp_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb26-50"><a href="stage-1-preparation-of-input-data.html#cb26-50" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb26-51"><a href="stage-1-preparation-of-input-data.html#cb26-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-52"><a href="stage-1-preparation-of-input-data.html#cb26-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb26-53"><a href="stage-1-preparation-of-input-data.html#cb26-53" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb26-54"><a href="stage-1-preparation-of-input-data.html#cb26-54" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> tmp[[k]])</span>
<span id="cb26-55"><a href="stage-1-preparation-of-input-data.html#cb26-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-56"><a href="stage-1-preparation-of-input-data.html#cb26-56" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb26-57"><a href="stage-1-preparation-of-input-data.html#cb26-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-58"><a href="stage-1-preparation-of-input-data.html#cb26-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-59"><a href="stage-1-preparation-of-input-data.html#cb26-59" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb26-60"><a href="stage-1-preparation-of-input-data.html#cb26-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-61"><a href="stage-1-preparation-of-input-data.html#cb26-61" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span>(<span class="fu">dim</span>(tmp)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb26-62"><a href="stage-1-preparation-of-input-data.html#cb26-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-63"><a href="stage-1-preparation-of-input-data.html#cb26-63" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb26-64"><a href="stage-1-preparation-of-input-data.html#cb26-64" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb26-65"><a href="stage-1-preparation-of-input-data.html#cb26-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-66"><a href="stage-1-preparation-of-input-data.html#cb26-66" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop ends#############</span></span>
<span id="cb26-67"><a href="stage-1-preparation-of-input-data.html#cb26-67" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb26-68"><a href="stage-1-preparation-of-input-data.html#cb26-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-69"><a href="stage-1-preparation-of-input-data.html#cb26-69" aria-hidden="true" tabindex="-1"></a>Temp_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb26-70"><a href="stage-1-preparation-of-input-data.html#cb26-70" aria-hidden="true" tabindex="-1"></a>Temp_Stack<span class="ot">&lt;-</span>Temp_Stack<span class="sc">*</span><span class="fl">0.1</span> <span class="co"># rescale to C</span></span>
<span id="cb26-71"><a href="stage-1-preparation-of-input-data.html#cb26-71" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Temp_Stack,<span class="at">filename=</span><span class="st">&#39;Temp_Stack_01-19_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-72"><a href="stage-1-preparation-of-input-data.html#cb26-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-73"><a href="stage-1-preparation-of-input-data.html#cb26-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-74"><a href="stage-1-preparation-of-input-data.html#cb26-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-75"><a href="stage-1-preparation-of-input-data.html#cb26-75" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################################################################################</span></span>
<span id="cb26-76"><a href="stage-1-preparation-of-input-data.html#cb26-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-77"><a href="stage-1-preparation-of-input-data.html#cb26-77" aria-hidden="true" tabindex="-1"></a><span class="co">#PRECIPITATION</span></span>
<span id="cb26-78"><a href="stage-1-preparation-of-input-data.html#cb26-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-79"><a href="stage-1-preparation-of-input-data.html#cb26-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-80"><a href="stage-1-preparation-of-input-data.html#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Have one month Precipitation ( January)</span></span>
<span id="cb26-81"><a href="stage-1-preparation-of-input-data.html#cb26-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-82"><a href="stage-1-preparation-of-input-data.html#cb26-82" aria-hidden="true" tabindex="-1"></a>pre_Jan_1<span class="ot">&lt;-</span>pre_01_18[[<span class="dv">1</span>]]</span>
<span id="cb26-83"><a href="stage-1-preparation-of-input-data.html#cb26-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-84"><a href="stage-1-preparation-of-input-data.html#cb26-84" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(pre_Jan_1)</span>
<span id="cb26-85"><a href="stage-1-preparation-of-input-data.html#cb26-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-86"><a href="stage-1-preparation-of-input-data.html#cb26-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb26-87"><a href="stage-1-preparation-of-input-data.html#cb26-87" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-88"><a href="stage-1-preparation-of-input-data.html#cb26-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-89"><a href="stage-1-preparation-of-input-data.html#cb26-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-90"><a href="stage-1-preparation-of-input-data.html#cb26-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb26-91"><a href="stage-1-preparation-of-input-data.html#cb26-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-92"><a href="stage-1-preparation-of-input-data.html#cb26-92" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop starts############</span></span>
<span id="cb26-93"><a href="stage-1-preparation-of-input-data.html#cb26-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb26-94"><a href="stage-1-preparation-of-input-data.html#cb26-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-95"><a href="stage-1-preparation-of-input-data.html#cb26-95" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pre_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb26-96"><a href="stage-1-preparation-of-input-data.html#cb26-96" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb26-97"><a href="stage-1-preparation-of-input-data.html#cb26-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-98"><a href="stage-1-preparation-of-input-data.html#cb26-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pre_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb26-99"><a href="stage-1-preparation-of-input-data.html#cb26-99" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb26-100"><a href="stage-1-preparation-of-input-data.html#cb26-100" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pre_01_18[[k]])</span>
<span id="cb26-101"><a href="stage-1-preparation-of-input-data.html#cb26-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-102"><a href="stage-1-preparation-of-input-data.html#cb26-102" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb26-103"><a href="stage-1-preparation-of-input-data.html#cb26-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-104"><a href="stage-1-preparation-of-input-data.html#cb26-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-105"><a href="stage-1-preparation-of-input-data.html#cb26-105" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb26-106"><a href="stage-1-preparation-of-input-data.html#cb26-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-107"><a href="stage-1-preparation-of-input-data.html#cb26-107" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span>(<span class="fu">dim</span>(pre_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb26-108"><a href="stage-1-preparation-of-input-data.html#cb26-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-109"><a href="stage-1-preparation-of-input-data.html#cb26-109" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;,overwrite=TRUE)</span></span>
<span id="cb26-110"><a href="stage-1-preparation-of-input-data.html#cb26-110" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb26-111"><a href="stage-1-preparation-of-input-data.html#cb26-111" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-112"><a href="stage-1-preparation-of-input-data.html#cb26-112" aria-hidden="true" tabindex="-1"></a><span class="do">##########for loop ends##########</span></span>
<span id="cb26-113"><a href="stage-1-preparation-of-input-data.html#cb26-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-114"><a href="stage-1-preparation-of-input-data.html#cb26-114" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb26-115"><a href="stage-1-preparation-of-input-data.html#cb26-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-116"><a href="stage-1-preparation-of-input-data.html#cb26-116" aria-hidden="true" tabindex="-1"></a>Prec_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb26-117"><a href="stage-1-preparation-of-input-data.html#cb26-117" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Prec_Stack,<span class="at">filename=</span><span class="st">&#39;Prec_Stack_01-19_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-118"><a href="stage-1-preparation-of-input-data.html#cb26-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-119"><a href="stage-1-preparation-of-input-data.html#cb26-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-120"><a href="stage-1-preparation-of-input-data.html#cb26-120" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb26-121"><a href="stage-1-preparation-of-input-data.html#cb26-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-122"><a href="stage-1-preparation-of-input-data.html#cb26-122" aria-hidden="true" tabindex="-1"></a><span class="co"># POTENTIAL EVAPOTRANSPIRATION </span></span>
<span id="cb26-123"><a href="stage-1-preparation-of-input-data.html#cb26-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-124"><a href="stage-1-preparation-of-input-data.html#cb26-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Have one month ETP ( January)</span></span>
<span id="cb26-125"><a href="stage-1-preparation-of-input-data.html#cb26-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-126"><a href="stage-1-preparation-of-input-data.html#cb26-126" aria-hidden="true" tabindex="-1"></a>pet_Jan_1<span class="ot">&lt;-</span>pet_01_18[[<span class="dv">1</span>]]</span>
<span id="cb26-127"><a href="stage-1-preparation-of-input-data.html#cb26-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-128"><a href="stage-1-preparation-of-input-data.html#cb26-128" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(pet_Jan_1)</span>
<span id="cb26-129"><a href="stage-1-preparation-of-input-data.html#cb26-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-130"><a href="stage-1-preparation-of-input-data.html#cb26-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list</span></span>
<span id="cb26-131"><a href="stage-1-preparation-of-input-data.html#cb26-131" aria-hidden="true" tabindex="-1"></a>Rlist<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-132"><a href="stage-1-preparation-of-input-data.html#cb26-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-133"><a href="stage-1-preparation-of-input-data.html#cb26-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of 18 years (j)  and 12 months (i) </span></span>
<span id="cb26-134"><a href="stage-1-preparation-of-input-data.html#cb26-134" aria-hidden="true" tabindex="-1"></a><span class="do">############for loop starts##############</span></span>
<span id="cb26-135"><a href="stage-1-preparation-of-input-data.html#cb26-135" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { </span>
<span id="cb26-136"><a href="stage-1-preparation-of-input-data.html#cb26-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-137"><a href="stage-1-preparation-of-input-data.html#cb26-137" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>pet_Jan_1<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb26-138"><a href="stage-1-preparation-of-input-data.html#cb26-138" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>i</span>
<span id="cb26-139"><a href="stage-1-preparation-of-input-data.html#cb26-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-140"><a href="stage-1-preparation-of-input-data.html#cb26-140" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(pet_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)) {</span>
<span id="cb26-141"><a href="stage-1-preparation-of-input-data.html#cb26-141" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(k)</span>
<span id="cb26-142"><a href="stage-1-preparation-of-input-data.html#cb26-142" aria-hidden="true" tabindex="-1"></a>var_sum<span class="ot">&lt;-</span>(var_sum <span class="sc">+</span> pet_01_18[[k]])</span>
<span id="cb26-143"><a href="stage-1-preparation-of-input-data.html#cb26-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-144"><a href="stage-1-preparation-of-input-data.html#cb26-144" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb26-145"><a href="stage-1-preparation-of-input-data.html#cb26-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-146"><a href="stage-1-preparation-of-input-data.html#cb26-146" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-147"><a href="stage-1-preparation-of-input-data.html#cb26-147" aria-hidden="true" tabindex="-1"></a><span class="co">#Save each month average. </span></span>
<span id="cb26-148"><a href="stage-1-preparation-of-input-data.html#cb26-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-149"><a href="stage-1-preparation-of-input-data.html#cb26-149" aria-hidden="true" tabindex="-1"></a>var_avg<span class="ot">&lt;-</span>var_sum<span class="sc">/</span>(<span class="fu">dim</span>(pet_01_18)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb26-150"><a href="stage-1-preparation-of-input-data.html#cb26-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-151"><a href="stage-1-preparation-of-input-data.html#cb26-151" aria-hidden="true" tabindex="-1"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;,overwrite=TRUE)</span></span>
<span id="cb26-152"><a href="stage-1-preparation-of-input-data.html#cb26-152" aria-hidden="true" tabindex="-1"></a>Rlist[[i]]<span class="ot">&lt;-</span>var_avg</span>
<span id="cb26-153"><a href="stage-1-preparation-of-input-data.html#cb26-153" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-154"><a href="stage-1-preparation-of-input-data.html#cb26-154" aria-hidden="true" tabindex="-1"></a><span class="do">#########for loop ends############</span></span>
<span id="cb26-155"><a href="stage-1-preparation-of-input-data.html#cb26-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-156"><a href="stage-1-preparation-of-input-data.html#cb26-156" aria-hidden="true" tabindex="-1"></a><span class="co">#save a stack of months averages</span></span>
<span id="cb26-157"><a href="stage-1-preparation-of-input-data.html#cb26-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-158"><a href="stage-1-preparation-of-input-data.html#cb26-158" aria-hidden="true" tabindex="-1"></a>PET_Stack<span class="ot">&lt;-</span><span class="fu">stack</span>(Rlist)</span>
<span id="cb26-159"><a href="stage-1-preparation-of-input-data.html#cb26-159" aria-hidden="true" tabindex="-1"></a>PET_Stack<span class="ot">&lt;-</span>PET_Stack<span class="sc">*</span><span class="fl">0.1</span></span>
<span id="cb26-160"><a href="stage-1-preparation-of-input-data.html#cb26-160" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(PET_Stack,<span class="at">filename=</span><span class="st">&#39;PET_Stack_01-19_TC.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="script-number-5.-terraclimate-miami-model-npp-mean-1981-2000" class="section level4" number="9.2.2.5">
<h4><span class="header-section-number">9.2.2.5</span> Script Number 5. TerraClimate MIAMI model NPP mean 1981-2000</h4>
<p>To adjust yearly C inputs during the warm up phase according to annual NPP values, we will need to estimate an average annual NPP 1981-2000, that will be used as the starting point to adjust C inputs during the “warm up” phase (See chapter 6). Script number 5 uses the TerraClimate climate raster outputs from script number 3 and estimates an annual NPP mean 1981-2000 value.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="stage-1-preparation-of-input-data.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DATE: 2-12-2020</span></span>
<span id="cb27-2"><a href="stage-1-preparation-of-input-data.html#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="stage-1-preparation-of-input-data.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># MSc Ing.Agr. Luciano E. DI Paolo</span></span>
<span id="cb27-4"><a href="stage-1-preparation-of-input-data.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># PHD Ing.Agr. Guillermo E. Peralta</span></span>
<span id="cb27-5"><a href="stage-1-preparation-of-input-data.html#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="stage-1-preparation-of-input-data.html#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="stage-1-preparation-of-input-data.html#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MIAMI MODEL</span></span>
<span id="cb27-8"><a href="stage-1-preparation-of-input-data.html#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="stage-1-preparation-of-input-data.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb27-10"><a href="stage-1-preparation-of-input-data.html#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb27-11"><a href="stage-1-preparation-of-input-data.html#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="stage-1-preparation-of-input-data.html#cb27-12" aria-hidden="true" tabindex="-1"></a>WD_NPP<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/NPP&quot;</span>)</span>
<span id="cb27-13"><a href="stage-1-preparation-of-input-data.html#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="stage-1-preparation-of-input-data.html#cb27-14" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb27-15"><a href="stage-1-preparation-of-input-data.html#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="stage-1-preparation-of-input-data.html#cb27-16" aria-hidden="true" tabindex="-1"></a>WD_GSOC<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb27-17"><a href="stage-1-preparation-of-input-data.html#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="stage-1-preparation-of-input-data.html#cb27-18" aria-hidden="true" tabindex="-1"></a>WD_TC_LAYERS<span class="ot">&lt;-</span>(<span class="st">&quot;D:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/TERRA_CLIME&quot;</span>)</span>
<span id="cb27-19"><a href="stage-1-preparation-of-input-data.html#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="stage-1-preparation-of-input-data.html#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_TC_LAYERS)</span>
<span id="cb27-21"><a href="stage-1-preparation-of-input-data.html#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="stage-1-preparation-of-input-data.html#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Anual Precipitation (mm) and Mean Anual Temperature (grades C) stacks</span></span>
<span id="cb27-23"><a href="stage-1-preparation-of-input-data.html#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="stage-1-preparation-of-input-data.html#cb27-24" aria-hidden="true" tabindex="-1"></a>Temp<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;AverageTemperature_1981-2001_Pergamino.tif&quot;</span>)</span>
<span id="cb27-25"><a href="stage-1-preparation-of-input-data.html#cb27-25" aria-hidden="true" tabindex="-1"></a>Prec<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Precipitation_1981-2001_Pergamino.tif&quot;</span>)</span>
<span id="cb27-26"><a href="stage-1-preparation-of-input-data.html#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="stage-1-preparation-of-input-data.html#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb27-28"><a href="stage-1-preparation-of-input-data.html#cb27-28" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb27-29"><a href="stage-1-preparation-of-input-data.html#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="stage-1-preparation-of-input-data.html#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Temp&lt;-crop(Temp,AOI)</span></span>
<span id="cb27-31"><a href="stage-1-preparation-of-input-data.html#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Prec&lt;-crop(Prec,AOI)</span></span>
<span id="cb27-32"><a href="stage-1-preparation-of-input-data.html#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="stage-1-preparation-of-input-data.html#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb27-34"><a href="stage-1-preparation-of-input-data.html#cb27-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-35"><a href="stage-1-preparation-of-input-data.html#cb27-35" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb27-36"><a href="stage-1-preparation-of-input-data.html#cb27-36" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb27-37"><a href="stage-1-preparation-of-input-data.html#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="do">#######loop for starts#########</span></span>
<span id="cb27-38"><a href="stage-1-preparation-of-input-data.html#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(Temp)[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">12</span>)){</span>
<span id="cb27-39"><a href="stage-1-preparation-of-input-data.html#cb27-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-40"><a href="stage-1-preparation-of-input-data.html#cb27-40" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb27-41"><a href="stage-1-preparation-of-input-data.html#cb27-41" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb27-42"><a href="stage-1-preparation-of-input-data.html#cb27-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-43"><a href="stage-1-preparation-of-input-data.html#cb27-43" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb27-44"><a href="stage-1-preparation-of-input-data.html#cb27-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-45"><a href="stage-1-preparation-of-input-data.html#cb27-45" aria-hidden="true" tabindex="-1"></a><span class="do">#######loop for ends##########</span></span>
<span id="cb27-46"><a href="stage-1-preparation-of-input-data.html#cb27-46" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb27-47"><a href="stage-1-preparation-of-input-data.html#cb27-47" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span>TempStack<span class="sc">*</span><span class="fl">0.1</span> <span class="co"># rescale to C</span></span>
<span id="cb27-48"><a href="stage-1-preparation-of-input-data.html#cb27-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-49"><a href="stage-1-preparation-of-input-data.html#cb27-49" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb27-50"><a href="stage-1-preparation-of-input-data.html#cb27-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-51"><a href="stage-1-preparation-of-input-data.html#cb27-51" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb27-52"><a href="stage-1-preparation-of-input-data.html#cb27-52" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb27-53"><a href="stage-1-preparation-of-input-data.html#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb27-54"><a href="stage-1-preparation-of-input-data.html#cb27-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb27-55"><a href="stage-1-preparation-of-input-data.html#cb27-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-56"><a href="stage-1-preparation-of-input-data.html#cb27-56" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb27-57"><a href="stage-1-preparation-of-input-data.html#cb27-57" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb27-58"><a href="stage-1-preparation-of-input-data.html#cb27-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-59"><a href="stage-1-preparation-of-input-data.html#cb27-59" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb27-60"><a href="stage-1-preparation-of-input-data.html#cb27-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-61"><a href="stage-1-preparation-of-input-data.html#cb27-61" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb27-62"><a href="stage-1-preparation-of-input-data.html#cb27-62" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb27-63"><a href="stage-1-preparation-of-input-data.html#cb27-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-64"><a href="stage-1-preparation-of-input-data.html#cb27-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb27-65"><a href="stage-1-preparation-of-input-data.html#cb27-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-66"><a href="stage-1-preparation-of-input-data.html#cb27-66" aria-hidden="true" tabindex="-1"></a>NPP_Prec<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb27-67"><a href="stage-1-preparation-of-input-data.html#cb27-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-68"><a href="stage-1-preparation-of-input-data.html#cb27-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb27-69"><a href="stage-1-preparation-of-input-data.html#cb27-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-70"><a href="stage-1-preparation-of-input-data.html#cb27-70" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb27-71"><a href="stage-1-preparation-of-input-data.html#cb27-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-72"><a href="stage-1-preparation-of-input-data.html#cb27-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb27-73"><a href="stage-1-preparation-of-input-data.html#cb27-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-74"><a href="stage-1-preparation-of-input-data.html#cb27-74" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb27-75"><a href="stage-1-preparation-of-input-data.html#cb27-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-76"><a href="stage-1-preparation-of-input-data.html#cb27-76" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb27-77"><a href="stage-1-preparation-of-input-data.html#cb27-77" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb27-78"><a href="stage-1-preparation-of-input-data.html#cb27-78" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb27-79"><a href="stage-1-preparation-of-input-data.html#cb27-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-80"><a href="stage-1-preparation-of-input-data.html#cb27-80" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb27-81"><a href="stage-1-preparation-of-input-data.html#cb27-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-82"><a href="stage-1-preparation-of-input-data.html#cb27-82" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb27-83"><a href="stage-1-preparation-of-input-data.html#cb27-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-84"><a href="stage-1-preparation-of-input-data.html#cb27-84" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb27-85"><a href="stage-1-preparation-of-input-data.html#cb27-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-86"><a href="stage-1-preparation-of-input-data.html#cb27-86" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb27-87"><a href="stage-1-preparation-of-input-data.html#cb27-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-88"><a href="stage-1-preparation-of-input-data.html#cb27-88" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb27-89"><a href="stage-1-preparation-of-input-data.html#cb27-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-90"><a href="stage-1-preparation-of-input-data.html#cb27-90" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb27-91"><a href="stage-1-preparation-of-input-data.html#cb27-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-92"><a href="stage-1-preparation-of-input-data.html#cb27-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Save WORLD NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb27-93"><a href="stage-1-preparation-of-input-data.html#cb27-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-94"><a href="stage-1-preparation-of-input-data.html#cb27-94" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb27-95"><a href="stage-1-preparation-of-input-data.html#cb27-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-96"><a href="stage-1-preparation-of-input-data.html#cb27-96" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-97"><a href="stage-1-preparation-of-input-data.html#cb27-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-98"><a href="stage-1-preparation-of-input-data.html#cb27-98" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI_tnC_Ha_Year&lt;-stack(&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00.tif&quot;)</span></span>
<span id="cb27-99"><a href="stage-1-preparation-of-input-data.html#cb27-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-100"><a href="stage-1-preparation-of-input-data.html#cb27-100" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb27-101"><a href="stage-1-preparation-of-input-data.html#cb27-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-102"><a href="stage-1-preparation-of-input-data.html#cb27-102" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb27-103"><a href="stage-1-preparation-of-input-data.html#cb27-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-104"><a href="stage-1-preparation-of-input-data.html#cb27-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-105"><a href="stage-1-preparation-of-input-data.html#cb27-105" aria-hidden="true" tabindex="-1"></a><span class="co">#Open FAO GSOC MAP </span></span>
<span id="cb27-106"><a href="stage-1-preparation-of-input-data.html#cb27-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-107"><a href="stage-1-preparation-of-input-data.html#cb27-107" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_GSOC)</span>
<span id="cb27-108"><a href="stage-1-preparation-of-input-data.html#cb27-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-109"><a href="stage-1-preparation-of-input-data.html#cb27-109" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb27-110"><a href="stage-1-preparation-of-input-data.html#cb27-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-111"><a href="stage-1-preparation-of-input-data.html#cb27-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; mask</span></span>
<span id="cb27-112"><a href="stage-1-preparation-of-input-data.html#cb27-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-113"><a href="stage-1-preparation-of-input-data.html#cb27-113" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb27-114"><a href="stage-1-preparation-of-input-data.html#cb27-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-115"><a href="stage-1-preparation-of-input-data.html#cb27-115" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb27-116"><a href="stage-1-preparation-of-input-data.html#cb27-116" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb27-117"><a href="stage-1-preparation-of-input-data.html#cb27-117" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb27-118"><a href="stage-1-preparation-of-input-data.html#cb27-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-119"><a href="stage-1-preparation-of-input-data.html#cb27-119" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-120"><a href="stage-1-preparation-of-input-data.html#cb27-120" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-121"><a href="stage-1-preparation-of-input-data.html#cb27-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-122"><a href="stage-1-preparation-of-input-data.html#cb27-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-123"><a href="stage-1-preparation-of-input-data.html#cb27-123" aria-hidden="true" tabindex="-1"></a><span class="co">#UNCERTAINTIES MINIMUM TEMP , PREC</span></span>
<span id="cb27-124"><a href="stage-1-preparation-of-input-data.html#cb27-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-125"><a href="stage-1-preparation-of-input-data.html#cb27-125" aria-hidden="true" tabindex="-1"></a>Temp_min<span class="ot">&lt;-</span>Temp<span class="sc">*</span><span class="fl">1.02</span></span>
<span id="cb27-126"><a href="stage-1-preparation-of-input-data.html#cb27-126" aria-hidden="true" tabindex="-1"></a>Prec_min<span class="ot">&lt;-</span>Prec<span class="sc">*</span><span class="fl">0.95</span></span>
<span id="cb27-127"><a href="stage-1-preparation-of-input-data.html#cb27-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-128"><a href="stage-1-preparation-of-input-data.html#cb27-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb27-129"><a href="stage-1-preparation-of-input-data.html#cb27-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-130"><a href="stage-1-preparation-of-input-data.html#cb27-130" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb27-131"><a href="stage-1-preparation-of-input-data.html#cb27-131" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb27-132"><a href="stage-1-preparation-of-input-data.html#cb27-132" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb27-133"><a href="stage-1-preparation-of-input-data.html#cb27-133" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb27-134"><a href="stage-1-preparation-of-input-data.html#cb27-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-135"><a href="stage-1-preparation-of-input-data.html#cb27-135" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp_min[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb27-136"><a href="stage-1-preparation-of-input-data.html#cb27-136" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb27-137"><a href="stage-1-preparation-of-input-data.html#cb27-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-138"><a href="stage-1-preparation-of-input-data.html#cb27-138" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb27-139"><a href="stage-1-preparation-of-input-data.html#cb27-139" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-140"><a href="stage-1-preparation-of-input-data.html#cb27-140" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb27-141"><a href="stage-1-preparation-of-input-data.html#cb27-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-142"><a href="stage-1-preparation-of-input-data.html#cb27-142" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb27-143"><a href="stage-1-preparation-of-input-data.html#cb27-143" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span>TempStack<span class="sc">*</span><span class="fl">0.1</span> <span class="co"># rescale to C</span></span>
<span id="cb27-144"><a href="stage-1-preparation-of-input-data.html#cb27-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-145"><a href="stage-1-preparation-of-input-data.html#cb27-145" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb27-146"><a href="stage-1-preparation-of-input-data.html#cb27-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-147"><a href="stage-1-preparation-of-input-data.html#cb27-147" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb27-148"><a href="stage-1-preparation-of-input-data.html#cb27-148" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb27-149"><a href="stage-1-preparation-of-input-data.html#cb27-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-150"><a href="stage-1-preparation-of-input-data.html#cb27-150" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb27-151"><a href="stage-1-preparation-of-input-data.html#cb27-151" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb27-152"><a href="stage-1-preparation-of-input-data.html#cb27-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-153"><a href="stage-1-preparation-of-input-data.html#cb27-153" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec_min[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb27-154"><a href="stage-1-preparation-of-input-data.html#cb27-154" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb27-155"><a href="stage-1-preparation-of-input-data.html#cb27-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-156"><a href="stage-1-preparation-of-input-data.html#cb27-156" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb27-157"><a href="stage-1-preparation-of-input-data.html#cb27-157" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-158"><a href="stage-1-preparation-of-input-data.html#cb27-158" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb27-159"><a href="stage-1-preparation-of-input-data.html#cb27-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-160"><a href="stage-1-preparation-of-input-data.html#cb27-160" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb27-161"><a href="stage-1-preparation-of-input-data.html#cb27-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-162"><a href="stage-1-preparation-of-input-data.html#cb27-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb27-163"><a href="stage-1-preparation-of-input-data.html#cb27-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-164"><a href="stage-1-preparation-of-input-data.html#cb27-164" aria-hidden="true" tabindex="-1"></a>NPP_Prec<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb27-165"><a href="stage-1-preparation-of-input-data.html#cb27-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-166"><a href="stage-1-preparation-of-input-data.html#cb27-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb27-167"><a href="stage-1-preparation-of-input-data.html#cb27-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-168"><a href="stage-1-preparation-of-input-data.html#cb27-168" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb27-169"><a href="stage-1-preparation-of-input-data.html#cb27-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-170"><a href="stage-1-preparation-of-input-data.html#cb27-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb27-171"><a href="stage-1-preparation-of-input-data.html#cb27-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-172"><a href="stage-1-preparation-of-input-data.html#cb27-172" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb27-173"><a href="stage-1-preparation-of-input-data.html#cb27-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-174"><a href="stage-1-preparation-of-input-data.html#cb27-174" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb27-175"><a href="stage-1-preparation-of-input-data.html#cb27-175" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb27-176"><a href="stage-1-preparation-of-input-data.html#cb27-176" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb27-177"><a href="stage-1-preparation-of-input-data.html#cb27-177" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-178"><a href="stage-1-preparation-of-input-data.html#cb27-178" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb27-179"><a href="stage-1-preparation-of-input-data.html#cb27-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-180"><a href="stage-1-preparation-of-input-data.html#cb27-180" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb27-181"><a href="stage-1-preparation-of-input-data.html#cb27-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-182"><a href="stage-1-preparation-of-input-data.html#cb27-182" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb27-183"><a href="stage-1-preparation-of-input-data.html#cb27-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-184"><a href="stage-1-preparation-of-input-data.html#cb27-184" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb27-185"><a href="stage-1-preparation-of-input-data.html#cb27-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-186"><a href="stage-1-preparation-of-input-data.html#cb27-186" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb27-187"><a href="stage-1-preparation-of-input-data.html#cb27-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-188"><a href="stage-1-preparation-of-input-data.html#cb27-188" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb27-189"><a href="stage-1-preparation-of-input-data.html#cb27-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-190"><a href="stage-1-preparation-of-input-data.html#cb27-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Save WORLD NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb27-191"><a href="stage-1-preparation-of-input-data.html#cb27-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-192"><a href="stage-1-preparation-of-input-data.html#cb27-192" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb27-193"><a href="stage-1-preparation-of-input-data.html#cb27-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-194"><a href="stage-1-preparation-of-input-data.html#cb27-194" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00_MIN.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-195"><a href="stage-1-preparation-of-input-data.html#cb27-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-196"><a href="stage-1-preparation-of-input-data.html#cb27-196" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb27-197"><a href="stage-1-preparation-of-input-data.html#cb27-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-198"><a href="stage-1-preparation-of-input-data.html#cb27-198" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb27-199"><a href="stage-1-preparation-of-input-data.html#cb27-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-200"><a href="stage-1-preparation-of-input-data.html#cb27-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; and mask</span></span>
<span id="cb27-201"><a href="stage-1-preparation-of-input-data.html#cb27-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-202"><a href="stage-1-preparation-of-input-data.html#cb27-202" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb27-203"><a href="stage-1-preparation-of-input-data.html#cb27-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-204"><a href="stage-1-preparation-of-input-data.html#cb27-204" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb27-205"><a href="stage-1-preparation-of-input-data.html#cb27-205" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb27-206"><a href="stage-1-preparation-of-input-data.html#cb27-206" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb27-207"><a href="stage-1-preparation-of-input-data.html#cb27-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-208"><a href="stage-1-preparation-of-input-data.html#cb27-208" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI_MIN.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-209"><a href="stage-1-preparation-of-input-data.html#cb27-209" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_MIN.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-210"><a href="stage-1-preparation-of-input-data.html#cb27-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-211"><a href="stage-1-preparation-of-input-data.html#cb27-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-212"><a href="stage-1-preparation-of-input-data.html#cb27-212" aria-hidden="true" tabindex="-1"></a><span class="co">#UNCERTAINTIES MAXIMUM TEMP , PREC</span></span>
<span id="cb27-213"><a href="stage-1-preparation-of-input-data.html#cb27-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-214"><a href="stage-1-preparation-of-input-data.html#cb27-214" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Anual Precipitation (mm) and Mean Anual Temperature (grades C) stacks</span></span>
<span id="cb27-215"><a href="stage-1-preparation-of-input-data.html#cb27-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-216"><a href="stage-1-preparation-of-input-data.html#cb27-216" aria-hidden="true" tabindex="-1"></a>Temp_max<span class="ot">&lt;-</span>Temp<span class="sc">*</span><span class="fl">0.98</span></span>
<span id="cb27-217"><a href="stage-1-preparation-of-input-data.html#cb27-217" aria-hidden="true" tabindex="-1"></a>Prec_max<span class="ot">&lt;-</span>Prec<span class="sc">*</span><span class="fl">1.05</span></span>
<span id="cb27-218"><a href="stage-1-preparation-of-input-data.html#cb27-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-219"><a href="stage-1-preparation-of-input-data.html#cb27-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb27-220"><a href="stage-1-preparation-of-input-data.html#cb27-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-221"><a href="stage-1-preparation-of-input-data.html#cb27-221" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb27-222"><a href="stage-1-preparation-of-input-data.html#cb27-222" aria-hidden="true" tabindex="-1"></a>TempList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb27-223"><a href="stage-1-preparation-of-input-data.html#cb27-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-224"><a href="stage-1-preparation-of-input-data.html#cb27-224" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb27-225"><a href="stage-1-preparation-of-input-data.html#cb27-225" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb27-226"><a href="stage-1-preparation-of-input-data.html#cb27-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-227"><a href="stage-1-preparation-of-input-data.html#cb27-227" aria-hidden="true" tabindex="-1"></a>Temp1<span class="ot">&lt;-</span><span class="fu">mean</span>(Temp_max[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb27-228"><a href="stage-1-preparation-of-input-data.html#cb27-228" aria-hidden="true" tabindex="-1"></a>TempList[i]<span class="ot">&lt;-</span>Temp1</span>
<span id="cb27-229"><a href="stage-1-preparation-of-input-data.html#cb27-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-230"><a href="stage-1-preparation-of-input-data.html#cb27-230" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb27-231"><a href="stage-1-preparation-of-input-data.html#cb27-231" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-232"><a href="stage-1-preparation-of-input-data.html#cb27-232" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb27-233"><a href="stage-1-preparation-of-input-data.html#cb27-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-234"><a href="stage-1-preparation-of-input-data.html#cb27-234" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span><span class="fu">stack</span>(TempList)</span>
<span id="cb27-235"><a href="stage-1-preparation-of-input-data.html#cb27-235" aria-hidden="true" tabindex="-1"></a>TempStack<span class="ot">&lt;-</span>TempStack<span class="sc">*</span><span class="fl">0.1</span> <span class="co"># rescale to C</span></span>
<span id="cb27-236"><a href="stage-1-preparation-of-input-data.html#cb27-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-237"><a href="stage-1-preparation-of-input-data.html#cb27-237" aria-hidden="true" tabindex="-1"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb27-238"><a href="stage-1-preparation-of-input-data.html#cb27-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-239"><a href="stage-1-preparation-of-input-data.html#cb27-239" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb27-240"><a href="stage-1-preparation-of-input-data.html#cb27-240" aria-hidden="true" tabindex="-1"></a>PrecList<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb27-241"><a href="stage-1-preparation-of-input-data.html#cb27-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-242"><a href="stage-1-preparation-of-input-data.html#cb27-242" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb27-243"><a href="stage-1-preparation-of-input-data.html#cb27-243" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb27-244"><a href="stage-1-preparation-of-input-data.html#cb27-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-245"><a href="stage-1-preparation-of-input-data.html#cb27-245" aria-hidden="true" tabindex="-1"></a>Prec1<span class="ot">&lt;-</span><span class="fu">sum</span>(Prec_max[[k<span class="sc">:</span>(k<span class="sc">+</span><span class="dv">11</span>)]])</span>
<span id="cb27-246"><a href="stage-1-preparation-of-input-data.html#cb27-246" aria-hidden="true" tabindex="-1"></a>PrecList[i]<span class="ot">&lt;-</span>Prec1</span>
<span id="cb27-247"><a href="stage-1-preparation-of-input-data.html#cb27-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-248"><a href="stage-1-preparation-of-input-data.html#cb27-248" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">12</span></span>
<span id="cb27-249"><a href="stage-1-preparation-of-input-data.html#cb27-249" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-250"><a href="stage-1-preparation-of-input-data.html#cb27-250" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb27-251"><a href="stage-1-preparation-of-input-data.html#cb27-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-252"><a href="stage-1-preparation-of-input-data.html#cb27-252" aria-hidden="true" tabindex="-1"></a>PrecStack<span class="ot">&lt;-</span><span class="fu">stack</span>(PrecList)</span>
<span id="cb27-253"><a href="stage-1-preparation-of-input-data.html#cb27-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-254"><a href="stage-1-preparation-of-input-data.html#cb27-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb27-255"><a href="stage-1-preparation-of-input-data.html#cb27-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-256"><a href="stage-1-preparation-of-input-data.html#cb27-256" aria-hidden="true" tabindex="-1"></a>NPP_Prec<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.000664</span><span class="sc">*</span>PrecStack))</span>
<span id="cb27-257"><a href="stage-1-preparation-of-input-data.html#cb27-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-258"><a href="stage-1-preparation-of-input-data.html#cb27-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb27-259"><a href="stage-1-preparation-of-input-data.html#cb27-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-260"><a href="stage-1-preparation-of-input-data.html#cb27-260" aria-hidden="true" tabindex="-1"></a>NPP_temp<span class="ot">&lt;-</span><span class="dv">3000</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fl">1.315-0.119</span><span class="sc">*</span>TempStack))</span>
<span id="cb27-261"><a href="stage-1-preparation-of-input-data.html#cb27-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-262"><a href="stage-1-preparation-of-input-data.html#cb27-262" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb27-263"><a href="stage-1-preparation-of-input-data.html#cb27-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-264"><a href="stage-1-preparation-of-input-data.html#cb27-264" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb27-265"><a href="stage-1-preparation-of-input-data.html#cb27-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-266"><a href="stage-1-preparation-of-input-data.html#cb27-266" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for starts#######</span></span>
<span id="cb27-267"><a href="stage-1-preparation-of-input-data.html#cb27-267" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb27-268"><a href="stage-1-preparation-of-input-data.html#cb27-268" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_List[i]<span class="ot">&lt;-</span><span class="fu">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb27-269"><a href="stage-1-preparation-of-input-data.html#cb27-269" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-270"><a href="stage-1-preparation-of-input-data.html#cb27-270" aria-hidden="true" tabindex="-1"></a><span class="do">########loop for ends#######</span></span>
<span id="cb27-271"><a href="stage-1-preparation-of-input-data.html#cb27-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-272"><a href="stage-1-preparation-of-input-data.html#cb27-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-273"><a href="stage-1-preparation-of-input-data.html#cb27-273" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI<span class="ot">&lt;-</span><span class="fu">stack</span>(NPP_MIAMI_List)</span>
<span id="cb27-274"><a href="stage-1-preparation-of-input-data.html#cb27-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-275"><a href="stage-1-preparation-of-input-data.html#cb27-275" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb27-276"><a href="stage-1-preparation-of-input-data.html#cb27-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-277"><a href="stage-1-preparation-of-input-data.html#cb27-277" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnDM_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb27-278"><a href="stage-1-preparation-of-input-data.html#cb27-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-279"><a href="stage-1-preparation-of-input-data.html#cb27-279" aria-hidden="true" tabindex="-1"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb27-280"><a href="stage-1-preparation-of-input-data.html#cb27-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-281"><a href="stage-1-preparation-of-input-data.html#cb27-281" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_tnC_Ha_Year<span class="ot">&lt;-</span>NPP_MIAMI_tnDM_Ha_Year<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb27-282"><a href="stage-1-preparation-of-input-data.html#cb27-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-283"><a href="stage-1-preparation-of-input-data.html#cb27-283" aria-hidden="true" tabindex="-1"></a><span class="co"># Save NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb27-284"><a href="stage-1-preparation-of-input-data.html#cb27-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-285"><a href="stage-1-preparation-of-input-data.html#cb27-285" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb27-286"><a href="stage-1-preparation-of-input-data.html#cb27-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-287"><a href="stage-1-preparation-of-input-data.html#cb27-287" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00_MAX.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-288"><a href="stage-1-preparation-of-input-data.html#cb27-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-289"><a href="stage-1-preparation-of-input-data.html#cb27-289" aria-hidden="true" tabindex="-1"></a><span class="co"># NPP MEAN</span></span>
<span id="cb27-290"><a href="stage-1-preparation-of-input-data.html#cb27-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-291"><a href="stage-1-preparation-of-input-data.html#cb27-291" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00<span class="ot">&lt;-</span><span class="fu">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb27-292"><a href="stage-1-preparation-of-input-data.html#cb27-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-293"><a href="stage-1-preparation-of-input-data.html#cb27-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop &amp; and mask</span></span>
<span id="cb27-294"><a href="stage-1-preparation-of-input-data.html#cb27-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-295"><a href="stage-1-preparation-of-input-data.html#cb27-295" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_NPP)</span>
<span id="cb27-296"><a href="stage-1-preparation-of-input-data.html#cb27-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-297"><a href="stage-1-preparation-of-input-data.html#cb27-297" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(NPP_MIAMI_MEAN_81_00,AOI)</span>
<span id="cb27-298"><a href="stage-1-preparation-of-input-data.html#cb27-298" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(NPP_MIAMI_MEAN_81_00_AOI,SOC_MAP_AOI)</span>
<span id="cb27-299"><a href="stage-1-preparation-of-input-data.html#cb27-299" aria-hidden="true" tabindex="-1"></a>NPP_MIAMI_MEAN_81_00_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(NPP_MIAMI_MEAN_81_00_AOI,AOI)</span>
<span id="cb27-300"><a href="stage-1-preparation-of-input-data.html#cb27-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-301"><a href="stage-1-preparation-of-input-data.html#cb27-301" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00_AOI,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI_MAX.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-302"><a href="stage-1-preparation-of-input-data.html#cb27-302" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(NPP_MIAMI_MEAN_81_00,<span class="at">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_MAX.tif&quot;</span>,<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="script-number-6.-monthly_vegetation_cover-vegetation-cover-from-google-earth-engine." class="section level3" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Script Number 6. “Monthly_vegetation_cover” vegetation cover from Google Earth Engine.</h3>
<p>Script number 6 is a Google Earth Engine script. It is aimed at estimating an average vegetation cover status for each month of the year. Therefore, the script should be run twelve times, modifying the month number each time. It estimates, within a specified time series, the probability for each pixel to present NDVI values greater than a specified threshold, over which the soil is vegetated (for example NDVI &gt; 0.6). The result will vary between 0 and 1. Users may modify the time series and NDVI threshold as desired and according to local knowledge.</p>
<p><strong>Table 9.6.</strong> <em>Script Number 6.GEE Monthly Vegetation Cover. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.5.png" /></p>
<p>First, the user will need to activate a Google Earth Engine account. To run the Google Earth Engine (GEE) tool, the user will need to copy and paste the script (provided below) into the GEE code editor (central panel, Fig. 9.1).</p>
<div class="figure">
<img src="images/Figure_9.1.png" alt="" />
<p class="caption"><strong>Figure 9.1</strong> <em>Google Earth Engine code editor</em></p>
</div>
<p>The user will need to draw a polygon that includes the country that is being analyzed, by clicking on “+new layer”. The polygon will contain the country’s boundary or area of interest (Fig. 9.2)</p>
<div class="figure">
<img src="images/Figure_9.2.png" alt="" />
<p class="caption"><strong>Figure 9.2</strong> <em>Drawing a polygon in Google Earth Engine</em></p>
</div>
<p>The script shall be run twelve times, once for each month of the year. The user will need to specify the month, the name of the output folder and the name of the output raster each time the script is run. The following lines need to be edited:</p>
<ul>
<li>Line 10, the month number to be processed, (e.g. for January (1,1,‘month’);</li>
<li>Line 55, the name of the folder where the output raster file is to be saved (in the Google Drive Account);</li>
<li>Line 56, the name of the output raster which coincides with the month number that has been run.</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb28-1"><a href="stage-1-preparation-of-input-data.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Google Earth Engine </span></span>
<span id="cb28-2"><a href="stage-1-preparation-of-input-data.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Monthly Vegetation Cover for Roth C Model   </span></span>
<span id="cb28-3"><a href="stage-1-preparation-of-input-data.html#cb28-3" aria-hidden="true" tabindex="-1"></a> <span class="co">// Provide a polygon geometry</span></span>
<span id="cb28-4"><a href="stage-1-preparation-of-input-data.html#cb28-4" aria-hidden="true" tabindex="-1"></a> <span class="co">// Select the Modis dataset. MOD13A2 is an NDVI product. Modify the number of the month filter for each month from 1 to 12. </span></span>
<span id="cb28-5"><a href="stage-1-preparation-of-input-data.html#cb28-5" aria-hidden="true" tabindex="-1"></a> <span class="kw">var</span> dataset <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;MODIS/006/MOD13A2&#39;</span>)</span>
<span id="cb28-6"><a href="stage-1-preparation-of-input-data.html#cb28-6" aria-hidden="true" tabindex="-1"></a>                  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2015-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2019-12-01&#39;</span>))</span>
<span id="cb28-7"><a href="stage-1-preparation-of-input-data.html#cb28-7" aria-hidden="true" tabindex="-1"></a>                  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">12</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="st">&#39;month&#39;</span>))<span class="op">;</span></span>
<span id="cb28-8"><a href="stage-1-preparation-of-input-data.html#cb28-8" aria-hidden="true" tabindex="-1"></a> <span class="kw">var</span> ndvi <span class="op">=</span> dataset<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">;</span></span>
<span id="cb28-9"><a href="stage-1-preparation-of-input-data.html#cb28-9" aria-hidden="true" tabindex="-1"></a> <span class="co">// Masks every pixel greater than 0.6 NDVI</span></span>
<span id="cb28-10"><a href="stage-1-preparation-of-input-data.html#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mask06<span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb28-11"><a href="stage-1-preparation-of-input-data.html#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">.</span><span class="fu">gt</span>(<span class="dv">3000</span>)<span class="op">;</span></span>
<span id="cb28-12"><a href="stage-1-preparation-of-input-data.html#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb28-13"><a href="stage-1-preparation-of-input-data.html#cb28-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb28-14"><a href="stage-1-preparation-of-input-data.html#cb28-14" aria-hidden="true" tabindex="-1"></a> <span class="co">// Apply the mask to the dataset (var ndvi)</span></span>
<span id="cb28-15"><a href="stage-1-preparation-of-input-data.html#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi_06<span class="op">=</span>ndvi<span class="op">.</span><span class="fu">map</span>(mask06)<span class="op">;</span> </span>
<span id="cb28-16"><a href="stage-1-preparation-of-input-data.html#cb28-16" aria-hidden="true" tabindex="-1"></a> <span class="co">// Count the number of times a pixel has an NDVI value greater than 0.6</span></span>
<span id="cb28-17"><a href="stage-1-preparation-of-input-data.html#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi_06_nn<span class="op">=</span>ndvi_06<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb28-18"><a href="stage-1-preparation-of-input-data.html#cb28-18" aria-hidden="true" tabindex="-1"></a> <span class="co">// Count the total number of values per pixel</span></span>
<span id="cb28-19"><a href="stage-1-preparation-of-input-data.html#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi_nn<span class="op">=</span>ndvi<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb28-20"><a href="stage-1-preparation-of-input-data.html#cb28-20" aria-hidden="true" tabindex="-1"></a> <span class="co">// Calculate the proportion of times the NDVI value is greater than 0.6 per pixel</span></span>
<span id="cb28-21"><a href="stage-1-preparation-of-input-data.html#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_cover<span class="op">=</span> ndvi_06_nn<span class="op">.</span><span class="fu">divide</span>(ndvi_nn)<span class="op">;</span></span>
<span id="cb28-22"><a href="stage-1-preparation-of-input-data.html#cb28-22" aria-hidden="true" tabindex="-1"></a> <span class="co">// Color palette</span></span>
<span id="cb28-23"><a href="stage-1-preparation-of-input-data.html#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndviVis <span class="op">=</span> {</span>
<span id="cb28-24"><a href="stage-1-preparation-of-input-data.html#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb28-25"><a href="stage-1-preparation-of-input-data.html#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="fl">1.0</span><span class="op">,</span></span>
<span id="cb28-26"><a href="stage-1-preparation-of-input-data.html#cb28-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">palette</span><span class="op">:</span> [</span>
<span id="cb28-27"><a href="stage-1-preparation-of-input-data.html#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;FFFFFF&#39;</span><span class="op">,</span> <span class="st">&#39;CE7E45&#39;</span><span class="op">,</span> <span class="st">&#39;DF923D&#39;</span><span class="op">,</span> <span class="st">&#39;F1B555&#39;</span><span class="op">,</span> <span class="st">&#39;FCD163&#39;</span><span class="op">,</span> <span class="st">&#39;99B718&#39;</span><span class="op">,</span> <span class="st">&#39;74A901&#39;</span><span class="op">,</span></span>
<span id="cb28-28"><a href="stage-1-preparation-of-input-data.html#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;66A000&#39;</span><span class="op">,</span> <span class="st">&#39;529400&#39;</span><span class="op">,</span> <span class="st">&#39;3E8601&#39;</span><span class="op">,</span> <span class="st">&#39;207401&#39;</span><span class="op">,</span> <span class="st">&#39;056201&#39;</span><span class="op">,</span> <span class="st">&#39;004C00&#39;</span><span class="op">,</span> <span class="st">&#39;023B01&#39;</span><span class="op">,</span></span>
<span id="cb28-29"><a href="stage-1-preparation-of-input-data.html#cb28-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;012E01&#39;</span><span class="op">,</span> <span class="st">&#39;011D01&#39;</span><span class="op">,</span> <span class="st">&#39;011301&#39;</span></span>
<span id="cb28-30"><a href="stage-1-preparation-of-input-data.html#cb28-30" aria-hidden="true" tabindex="-1"></a> ]<span class="op">,</span></span>
<span id="cb28-31"><a href="stage-1-preparation-of-input-data.html#cb28-31" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb28-32"><a href="stage-1-preparation-of-input-data.html#cb28-32" aria-hidden="true" tabindex="-1"></a> <span class="co">// Clip the map with the country geometry</span></span>
<span id="cb28-33"><a href="stage-1-preparation-of-input-data.html#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Recorte <span class="op">=</span> prop_cover<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb28-34"><a href="stage-1-preparation-of-input-data.html#cb28-34" aria-hidden="true" tabindex="-1"></a> <span class="co">// Add the map to the visualization google earth engine panel</span></span>
<span id="cb28-35"><a href="stage-1-preparation-of-input-data.html#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(Recorte<span class="op">,</span> ndviVis<span class="op">,</span> <span class="st">&#39;Country&#39;</span>)</span>
<span id="cb28-36"><a href="stage-1-preparation-of-input-data.html#cb28-36" aria-hidden="true" tabindex="-1"></a> <span class="co">// This code block needs to be modify for each month and allows the user to save the map into a Google drive account</span></span>
<span id="cb28-37"><a href="stage-1-preparation-of-input-data.html#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(Recorte<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb28-38"><a href="stage-1-preparation-of-input-data.html#cb28-38" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb28-39"><a href="stage-1-preparation-of-input-data.html#cb28-39" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> Recorte<span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;NDVI_count&quot;</span>)<span class="op">,</span></span>
<span id="cb28-40"><a href="stage-1-preparation-of-input-data.html#cb28-40" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;MAPA_ROTH_C&quot;</span><span class="op">,</span></span>
<span id="cb28-41"><a href="stage-1-preparation-of-input-data.html#cb28-41" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;NDVI_2015-2019_prop_gt_06_CR_MES_01&#39;</span><span class="op">,</span> </span>
<span id="cb28-42"><a href="stage-1-preparation-of-input-data.html#cb28-42" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb28-43"><a href="stage-1-preparation-of-input-data.html#cb28-43" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span>geometry<span class="op">,</span></span>
<span id="cb28-44"><a href="stage-1-preparation-of-input-data.html#cb28-44" aria-hidden="true" tabindex="-1"></a>          <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span>     </span>
<span id="cb28-45"><a href="stage-1-preparation-of-input-data.html#cb28-45" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>After running the script for each month, the layer must be saved to the Google Drive account. To accomplish this, the user will need to click on the “task” button and then click the “run” button (Fig. 9.3)</p>
<div class="figure">
<img src="images/Figure_9.3.png" alt="" />
<p class="caption"><strong>Figure 9.3</strong> <em>Saving the task in GEE.</em></p>
</div>
<p>Once the procedure is completed, the layers should be downloaded from the Google Drive and saved into a local folder</p>
</div>
<div id="script-number-7.-vegetation_cover_stack.r" class="section level3" number="9.2.4">
<h3><span class="header-section-number">9.2.4</span> Script Number 7. “Vegetation_Cover_stack.R”</h3>
<p>The script number 7 is an R script that uses the monthly vegetation cover layers (0-1 values) created with the GEE script number 6 to create a raster stack. It also linearly rescales the values from “0 to 1” (proportion of vegetated pixels in a time series) to “1 to 0.6” (being 1 = bare soil and 0.6 = full vegetated pixel). This transformation will allow us to use the calculated values as modifying factors of the decomposition rates in the RothC model.</p>
<p>Table 9.6 Script Number 7. Vegetation Cover Stack. Inputs and Outputs.
<img src="tables/Table_9.6.png" /></p>
<p>Once the monthly vegetation cover layers are downloaded from Google Drive, we will generate a stack of those layers. We will first open script number 7 “Vegetation_Cover_stack.R” and the required packages. Then, we will need to open the country polygon vector and set the working directory for the input and the output layers.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="stage-1-preparation-of-input-data.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb29-2"><a href="stage-1-preparation-of-input-data.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb29-3"><a href="stage-1-preparation-of-input-data.html#cb29-3" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb29-4"><a href="stage-1-preparation-of-input-data.html#cb29-4" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb29-5"><a href="stage-1-preparation-of-input-data.html#cb29-5" aria-hidden="true" tabindex="-1"></a>WD_COV<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/INPUTS/COV&quot;</span>)</span>
<span id="cb29-6"><a href="stage-1-preparation-of-input-data.html#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="stage-1-preparation-of-input-data.html#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="stage-1-preparation-of-input-data.html#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb29-9"><a href="stage-1-preparation-of-input-data.html#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb29-10"><a href="stage-1-preparation-of-input-data.html#cb29-10" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb29-11"><a href="stage-1-preparation-of-input-data.html#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP FAO</span></span>
<span id="cb29-12"><a href="stage-1-preparation-of-input-data.html#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb29-13"><a href="stage-1-preparation-of-input-data.html#cb29-13" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb29-14"><a href="stage-1-preparation-of-input-data.html#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Vegetation Cover layer based only in proportion of NDVI pixels grater than 0.6 </span></span>
<span id="cb29-15"><a href="stage-1-preparation-of-input-data.html#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_COV)</span>
<span id="cb29-16"><a href="stage-1-preparation-of-input-data.html#cb29-16" aria-hidden="true" tabindex="-1"></a>Cov1<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M01.tif&quot;</span>)</span>
<span id="cb29-17"><a href="stage-1-preparation-of-input-data.html#cb29-17" aria-hidden="true" tabindex="-1"></a>Cov1[<span class="fu">is.na</span>(Cov1[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-18"><a href="stage-1-preparation-of-input-data.html#cb29-18" aria-hidden="true" tabindex="-1"></a>Cov1_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov1,AOI)</span>
<span id="cb29-19"><a href="stage-1-preparation-of-input-data.html#cb29-19" aria-hidden="true" tabindex="-1"></a>Cov1_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov1_crop,AOI)</span>
<span id="cb29-20"><a href="stage-1-preparation-of-input-data.html#cb29-20" aria-hidden="true" tabindex="-1"></a>Cov1_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov1_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-21"><a href="stage-1-preparation-of-input-data.html#cb29-21" aria-hidden="true" tabindex="-1"></a>Cov2<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M02.tif&quot;</span>)</span>
<span id="cb29-22"><a href="stage-1-preparation-of-input-data.html#cb29-22" aria-hidden="true" tabindex="-1"></a>Cov2[<span class="fu">is.na</span>(Cov2[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-23"><a href="stage-1-preparation-of-input-data.html#cb29-23" aria-hidden="true" tabindex="-1"></a>Cov2_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov2,AOI)</span>
<span id="cb29-24"><a href="stage-1-preparation-of-input-data.html#cb29-24" aria-hidden="true" tabindex="-1"></a>Cov2_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov2_crop,AOI)</span>
<span id="cb29-25"><a href="stage-1-preparation-of-input-data.html#cb29-25" aria-hidden="true" tabindex="-1"></a>Cov2_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov2_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-26"><a href="stage-1-preparation-of-input-data.html#cb29-26" aria-hidden="true" tabindex="-1"></a>Cov3<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M03.tif&quot;</span>)</span>
<span id="cb29-27"><a href="stage-1-preparation-of-input-data.html#cb29-27" aria-hidden="true" tabindex="-1"></a>Cov3[<span class="fu">is.na</span>(Cov3[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-28"><a href="stage-1-preparation-of-input-data.html#cb29-28" aria-hidden="true" tabindex="-1"></a>Cov3_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov3,AOI)</span>
<span id="cb29-29"><a href="stage-1-preparation-of-input-data.html#cb29-29" aria-hidden="true" tabindex="-1"></a>Cov3_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov3_crop,AOI)</span>
<span id="cb29-30"><a href="stage-1-preparation-of-input-data.html#cb29-30" aria-hidden="true" tabindex="-1"></a>Cov3_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov3_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-31"><a href="stage-1-preparation-of-input-data.html#cb29-31" aria-hidden="true" tabindex="-1"></a>Cov4<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M04.tif&quot;</span>)</span>
<span id="cb29-32"><a href="stage-1-preparation-of-input-data.html#cb29-32" aria-hidden="true" tabindex="-1"></a>Cov4[<span class="fu">is.na</span>(Cov4[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-33"><a href="stage-1-preparation-of-input-data.html#cb29-33" aria-hidden="true" tabindex="-1"></a>Cov4_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov4,AOI)</span>
<span id="cb29-34"><a href="stage-1-preparation-of-input-data.html#cb29-34" aria-hidden="true" tabindex="-1"></a>Cov4_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov4_crop,AOI)</span>
<span id="cb29-35"><a href="stage-1-preparation-of-input-data.html#cb29-35" aria-hidden="true" tabindex="-1"></a>Cov4_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov4_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-36"><a href="stage-1-preparation-of-input-data.html#cb29-36" aria-hidden="true" tabindex="-1"></a>Cov5<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M05.tif&quot;</span>)</span>
<span id="cb29-37"><a href="stage-1-preparation-of-input-data.html#cb29-37" aria-hidden="true" tabindex="-1"></a>Cov5[<span class="fu">is.na</span>(Cov5[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-38"><a href="stage-1-preparation-of-input-data.html#cb29-38" aria-hidden="true" tabindex="-1"></a>Cov5_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov5,AOI)</span>
<span id="cb29-39"><a href="stage-1-preparation-of-input-data.html#cb29-39" aria-hidden="true" tabindex="-1"></a>Cov5_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov5_crop,AOI)</span>
<span id="cb29-40"><a href="stage-1-preparation-of-input-data.html#cb29-40" aria-hidden="true" tabindex="-1"></a>Cov5_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov5_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-41"><a href="stage-1-preparation-of-input-data.html#cb29-41" aria-hidden="true" tabindex="-1"></a>Cov6<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M06.tif&quot;</span>)</span>
<span id="cb29-42"><a href="stage-1-preparation-of-input-data.html#cb29-42" aria-hidden="true" tabindex="-1"></a>Cov6[<span class="fu">is.na</span>(Cov6[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-43"><a href="stage-1-preparation-of-input-data.html#cb29-43" aria-hidden="true" tabindex="-1"></a>Cov6_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov6,AOI)</span>
<span id="cb29-44"><a href="stage-1-preparation-of-input-data.html#cb29-44" aria-hidden="true" tabindex="-1"></a>Cov6_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov6_crop,AOI)</span>
<span id="cb29-45"><a href="stage-1-preparation-of-input-data.html#cb29-45" aria-hidden="true" tabindex="-1"></a>Cov6_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov6_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-46"><a href="stage-1-preparation-of-input-data.html#cb29-46" aria-hidden="true" tabindex="-1"></a>Cov7<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M07.tif&quot;</span>)</span>
<span id="cb29-47"><a href="stage-1-preparation-of-input-data.html#cb29-47" aria-hidden="true" tabindex="-1"></a>Cov7[<span class="fu">is.na</span>(Cov7[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-48"><a href="stage-1-preparation-of-input-data.html#cb29-48" aria-hidden="true" tabindex="-1"></a>Cov7_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov7,AOI)</span>
<span id="cb29-49"><a href="stage-1-preparation-of-input-data.html#cb29-49" aria-hidden="true" tabindex="-1"></a>Cov7_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov7_crop,AOI)</span>
<span id="cb29-50"><a href="stage-1-preparation-of-input-data.html#cb29-50" aria-hidden="true" tabindex="-1"></a>Cov7_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov7_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-51"><a href="stage-1-preparation-of-input-data.html#cb29-51" aria-hidden="true" tabindex="-1"></a>Cov8<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M08.tif&quot;</span>)</span>
<span id="cb29-52"><a href="stage-1-preparation-of-input-data.html#cb29-52" aria-hidden="true" tabindex="-1"></a>Cov8[<span class="fu">is.na</span>(Cov8[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-53"><a href="stage-1-preparation-of-input-data.html#cb29-53" aria-hidden="true" tabindex="-1"></a>Cov8_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov8,AOI)</span>
<span id="cb29-54"><a href="stage-1-preparation-of-input-data.html#cb29-54" aria-hidden="true" tabindex="-1"></a>Cov8_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov8_crop,AOI)</span>
<span id="cb29-55"><a href="stage-1-preparation-of-input-data.html#cb29-55" aria-hidden="true" tabindex="-1"></a>Cov8_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov8_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-56"><a href="stage-1-preparation-of-input-data.html#cb29-56" aria-hidden="true" tabindex="-1"></a>Cov9<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M09.tif&quot;</span>)</span>
<span id="cb29-57"><a href="stage-1-preparation-of-input-data.html#cb29-57" aria-hidden="true" tabindex="-1"></a>Cov9[<span class="fu">is.na</span>(Cov9[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-58"><a href="stage-1-preparation-of-input-data.html#cb29-58" aria-hidden="true" tabindex="-1"></a>Cov9_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov9,AOI)</span>
<span id="cb29-59"><a href="stage-1-preparation-of-input-data.html#cb29-59" aria-hidden="true" tabindex="-1"></a>Cov9_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov9_crop,AOI)</span>
<span id="cb29-60"><a href="stage-1-preparation-of-input-data.html#cb29-60" aria-hidden="true" tabindex="-1"></a>Cov9_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov9_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-61"><a href="stage-1-preparation-of-input-data.html#cb29-61" aria-hidden="true" tabindex="-1"></a>Cov10<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M10.tif&quot;</span>)</span>
<span id="cb29-62"><a href="stage-1-preparation-of-input-data.html#cb29-62" aria-hidden="true" tabindex="-1"></a>Cov10[<span class="fu">is.na</span>(Cov10[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-63"><a href="stage-1-preparation-of-input-data.html#cb29-63" aria-hidden="true" tabindex="-1"></a>Cov10_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov10,AOI)</span>
<span id="cb29-64"><a href="stage-1-preparation-of-input-data.html#cb29-64" aria-hidden="true" tabindex="-1"></a>Cov10_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov10_crop,AOI)</span>
<span id="cb29-65"><a href="stage-1-preparation-of-input-data.html#cb29-65" aria-hidden="true" tabindex="-1"></a>Cov10_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov10_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-66"><a href="stage-1-preparation-of-input-data.html#cb29-66" aria-hidden="true" tabindex="-1"></a>Cov11<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M11.tif&quot;</span>)</span>
<span id="cb29-67"><a href="stage-1-preparation-of-input-data.html#cb29-67" aria-hidden="true" tabindex="-1"></a>Cov11[<span class="fu">is.na</span>(Cov11[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-68"><a href="stage-1-preparation-of-input-data.html#cb29-68" aria-hidden="true" tabindex="-1"></a>Cov11_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov11,AOI)</span>
<span id="cb29-69"><a href="stage-1-preparation-of-input-data.html#cb29-69" aria-hidden="true" tabindex="-1"></a>Cov11_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov11_crop,AOI)</span>
<span id="cb29-70"><a href="stage-1-preparation-of-input-data.html#cb29-70" aria-hidden="true" tabindex="-1"></a>Cov11_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov11_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-71"><a href="stage-1-preparation-of-input-data.html#cb29-71" aria-hidden="true" tabindex="-1"></a>Cov12<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M12.tif&quot;</span>)</span>
<span id="cb29-72"><a href="stage-1-preparation-of-input-data.html#cb29-72" aria-hidden="true" tabindex="-1"></a>Cov12[<span class="fu">is.na</span>(Cov12[])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-73"><a href="stage-1-preparation-of-input-data.html#cb29-73" aria-hidden="true" tabindex="-1"></a>Cov12_crop<span class="ot">&lt;-</span><span class="fu">crop</span>(Cov12,AOI)</span>
<span id="cb29-74"><a href="stage-1-preparation-of-input-data.html#cb29-74" aria-hidden="true" tabindex="-1"></a>Cov12_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(Cov12_crop,AOI)</span>
<span id="cb29-75"><a href="stage-1-preparation-of-input-data.html#cb29-75" aria-hidden="true" tabindex="-1"></a>Cov12_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Cov12_mask,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb29-76"><a href="stage-1-preparation-of-input-data.html#cb29-76" aria-hidden="true" tabindex="-1"></a>Stack_Cov<span class="ot">&lt;-</span><span class="fu">stack</span>(Cov1_res,Cov2_res,Cov3_res,Cov4_res,Cov5_res,Cov6_res,Cov7_res,Cov8_res,Cov9_res,Cov10_res,Cov11_res,Cov12_res)</span>
<span id="cb29-77"><a href="stage-1-preparation-of-input-data.html#cb29-77" aria-hidden="true" tabindex="-1"></a><span class="co"># rescale values to 1 if it is bare soil and 0.6 if it is vegetated.</span></span>
<span id="cb29-78"><a href="stage-1-preparation-of-input-data.html#cb29-78" aria-hidden="true" tabindex="-1"></a>Cov<span class="ot">&lt;-</span>((Stack_Cov)<span class="sc">*</span>(<span class="sc">-</span><span class="fl">0.4</span>))<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb29-79"><a href="stage-1-preparation-of-input-data.html#cb29-79" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Cov,<span class="at">filename=</span><span class="st">&#39;Cov_stack_AOI.tif&#39;</span>,<span class="at">format=</span><span class="st">&#39;GTiff&#39;</span>)</span></code></pre></div>
<p>Once the monthly vegetation cover layers are downloaded from Google Drive, we will generate a stack of those layers. We will first open script number 7 “Vegetation_Cover_stack.R” and the required packages. Then, we will need to open the country polygon vector and set the working directory for the input and the output layers.</p>
<p><strong>Table 9.8</strong> <em>Script Number 8. Clay Layer from ISRIC. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.7.png" /></p>
<p>ISRIC clay layers represent the clay content (0-2 micrometer; in g/100g; w%) at four standard depths (Sl1=0-1cm; Sl2=1-5; Sl3=5-15cm; Sl4=15-30 cm) at a 250m resolution. The objective of this script is to aggregate the different layers into one layer by estimating the weighted average of the four depths:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="stage-1-preparation-of-input-data.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb30-2"><a href="stage-1-preparation-of-input-data.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb30-3"><a href="stage-1-preparation-of-input-data.html#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="stage-1-preparation-of-input-data.html#cb30-4" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb30-5"><a href="stage-1-preparation-of-input-data.html#cb30-5" aria-hidden="true" tabindex="-1"></a>WD_ISRIC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/INPUTS/CLAY&quot;</span>)</span>
<span id="cb30-6"><a href="stage-1-preparation-of-input-data.html#cb30-6" aria-hidden="true" tabindex="-1"></a>WD_CLAY<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CLAY&quot;</span>)</span>
<span id="cb30-7"><a href="stage-1-preparation-of-input-data.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb30-8"><a href="stage-1-preparation-of-input-data.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb30-9"><a href="stage-1-preparation-of-input-data.html#cb30-9" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb30-10"><a href="stage-1-preparation-of-input-data.html#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb30-11"><a href="stage-1-preparation-of-input-data.html#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_ISRIC)</span>
<span id="cb30-12"><a href="stage-1-preparation-of-input-data.html#cb30-12" aria-hidden="true" tabindex="-1"></a>Clay1<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;CLYPPT_M_sl1_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb30-13"><a href="stage-1-preparation-of-input-data.html#cb30-13" aria-hidden="true" tabindex="-1"></a>Clay2<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;CLYPPT_M_sl2_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb30-14"><a href="stage-1-preparation-of-input-data.html#cb30-14" aria-hidden="true" tabindex="-1"></a>Clay3<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;CLYPPT_M_sl3_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb30-15"><a href="stage-1-preparation-of-input-data.html#cb30-15" aria-hidden="true" tabindex="-1"></a>Clay4<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;CLYPPT_M_sl4_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb30-16"><a href="stage-1-preparation-of-input-data.html#cb30-16" aria-hidden="true" tabindex="-1"></a>Clay1_AR<span class="ot">&lt;-</span><span class="fu">crop</span>(Clay1,AOI)</span>
<span id="cb30-17"><a href="stage-1-preparation-of-input-data.html#cb30-17" aria-hidden="true" tabindex="-1"></a>Clay2_AR<span class="ot">&lt;-</span><span class="fu">crop</span>(Clay2,AOI)</span>
<span id="cb30-18"><a href="stage-1-preparation-of-input-data.html#cb30-18" aria-hidden="true" tabindex="-1"></a>Clay3_AR<span class="ot">&lt;-</span><span class="fu">crop</span>(Clay3,AOI)</span>
<span id="cb30-19"><a href="stage-1-preparation-of-input-data.html#cb30-19" aria-hidden="true" tabindex="-1"></a>Clay4_AR<span class="ot">&lt;-</span><span class="fu">crop</span>(Clay4,AOI)</span>
<span id="cb30-20"><a href="stage-1-preparation-of-input-data.html#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of four depths </span></span>
<span id="cb30-21"><a href="stage-1-preparation-of-input-data.html#cb30-21" aria-hidden="true" tabindex="-1"></a>WeightedAverage<span class="ot">&lt;-</span><span class="cf">function</span>(r1,r2,r3,r4){<span class="fu">return</span>(r1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">30</span>)<span class="sc">+</span>r2<span class="sc">*</span>(<span class="dv">4</span><span class="sc">/</span><span class="dv">30</span>)<span class="sc">+</span>r3<span class="sc">*</span>(<span class="dv">10</span><span class="sc">/</span><span class="dv">30</span>)<span class="sc">+</span>r4<span class="sc">*</span>(<span class="dv">15</span><span class="sc">/</span><span class="dv">30</span>))}</span>
<span id="cb30-22"><a href="stage-1-preparation-of-input-data.html#cb30-22" aria-hidden="true" tabindex="-1"></a>Clay_WA<span class="ot">&lt;-</span><span class="fu">overlay</span>(Clay1_AR,Clay2_AR,Clay3_AR,Clay4_AR,<span class="at">fun=</span>WeightedAverage)</span>
<span id="cb30-23"><a href="stage-1-preparation-of-input-data.html#cb30-23" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(Clay_WA,AOI)</span>
<span id="cb30-24"><a href="stage-1-preparation-of-input-data.html#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLAY)</span>
<span id="cb30-25"><a href="stage-1-preparation-of-input-data.html#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Clay_WA_AOI,<span class="at">filename=</span><span class="st">&quot;Clay_WA_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&#39;GTiff&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="preparing-the-land-use-layer" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Preparing the land use layer</h2>
<p>The land use layer is one of the most important layers in the process, as it defines the target areas and production systems to be modeled.
The land use layer will be needed:</p>
<ul>
<li>to account for major land use changes during the 2000-2020 period;</li>
<li>to obtain the DPM/RPM ratios required in the RothC model ( See Chapter 4);</li>
<li>to define the modeling units/target points where the model is to be run (agricultural lands in 2020).</li>
</ul>
<p>Each modeling phase will require specific land use layers. For the ‘spin up’ phase, users should use a representative land use layer for the period 1980-2000 (e.g. land use layer as in year 2000), or best available land use layer. For the ‘warm-up’ phase, users can use year to year land use layers (2000 to 2020), or a representative land use layer for the period, depending on the available information. The ‘warm-up’ land use layer accounts for year to year changes in the land use during the period (for example a pixel that changes from forest to cropland). The script will need a stack of land use layers, one layer for each year of the warm up phase. If the user does not want to model changes in the land use layer over the warm up phase, or information is not available, the same land use layer for each year can be used over the warm-up phase. For the ‘forward’ phase, the latest best available land use layer should be used.
As a minimum, the last available land use data at 1x1 km resolution shall be defined. The predominant land use category in each cell of the 1x1 km grid shall be selected if finer resolutions are available.
The land use classes can be derived from land cover classes from different national, regional or global datasets which best correlate with national land use. The land use layers are used in the three modelling phases to generate a decomposition rate DR layer (generated through scripts 10, 11, and 12, See sections 9.8-9.10), that represents the above mentioned DPM/RPM ratios for the different land use classes. In scripts 10,11 and 12, default DPM/RPM values are assigned to each FAO Global Land Cover (GLC-SHARE) class (See Table 6.1 Chapter 6; Section 6.7; and scripts 10,11 and 12). For more information on this classification refer to FAO (2014) and to the FAO Land and Water site: <a href="http://www.fao.org/land-water/land/land-governance/land-resources-planning-toolbox/category/details/en/c/1036355/" class="uri">http://www.fao.org/land-water/land/land-governance/land-resources-planning-toolbox/category/details/en/c/1036355/</a>
Thus, land cover classes obtained from different datasets (e.g. European Space Agency - ESA) need to be re-classified into FAO land cover classes in a Geotiff format if the scripts 10,11 and 12 are to be run with the default land classes and DPM/RPM ratios provided with the training material.
In this section, we provide a script to transform ESA land use cover classes to FAO land use classes (script 9), which can be used as a model to convert and use classes from other datasets. Users can however modify the DPM/RPM default values (See Table 6.1, Chapter 6) based on local knowledge and available information, create additional land use classes or disaggregate the FAO land use classes, and assign DPM/RPM ratios to those new classes by modifying the provided scripts. Users are encouraged to leverage available local knowledge and data to produce the most accurate SOCseq maps possible. With this in mind, if more detailed land use maps, i.e. containing information about the types of cropping systems present, and local data on the DPM/RPM for the specific land use types are easily accessible, the provided script should be edited accordingly.<br />
Finally, the land use layer is also needed to define the target points where the three phases of the protocol will be run. In section 9.7 we provide a Qgis model to generate the target points from the land use layer. Defining the target points out of the land use layer will allow us to run the model just in the pixels with the land use classes of interest.</p>
<p>Depending on whether yearly land use layers are available for the forward phase, this technical manual contains alternative scripts both for the data preparation phase (Scripts 9_Land_Use_ESA_to_FAO_classes_LUsim.R and 11_WARM_UP_STACK_V5_LUsim.R) and the modelling phase (Script 14_ROTH_C_WARM_UP_UNC_v3_LUsim.R). Figure illustrates the script sequence to be followed depending on whether yearly land use change layers are available for the warm up phase.</p>
<p><img src="images/Figure_9.6.png" alt="Figure 9.6 Script sequence based on wether yearly land use change layers for the warm up phase are available" />
***</p>
<div id="script-number-9-land_use_esa_to_fao_classes.r-no-land-use-change" class="section level3" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Script Number 9 “Land_Use_ESA_to_FAO_classes.R” No land use change</h3>
<p>Script number 9 transforms the ESA (European Space Agency 2015; 300 m resolution; ESA CCI Land cover website) land cover classes to the FAO land use classes. This script can be modified to be used with any other land use dataset.</p>
<p><strong>Table 9.9</strong> <em>Script Number 9. ESA Land Use to FAO classes. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.8.png" /></p>
<p>First, we will need to open the R packages, open the shapefile of the region/country to be modelled, and open the land use/land cover data set to be re-classified into FAO land use classes:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="stage-1-preparation-of-input-data.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb31-2"><a href="stage-1-preparation-of-input-data.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb31-3"><a href="stage-1-preparation-of-input-data.html#cb31-3" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb31-4"><a href="stage-1-preparation-of-input-data.html#cb31-4" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb31-5"><a href="stage-1-preparation-of-input-data.html#cb31-5" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb31-6"><a href="stage-1-preparation-of-input-data.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb31-7"><a href="stage-1-preparation-of-input-data.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb31-8"><a href="stage-1-preparation-of-input-data.html#cb31-8" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb31-9"><a href="stage-1-preparation-of-input-data.html#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Land Use Layer (ESA)</span></span>
<span id="cb31-10"><a href="stage-1-preparation-of-input-data.html#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb31-11"><a href="stage-1-preparation-of-input-data.html#cb31-11" aria-hidden="true" tabindex="-1"></a>ESA_LU<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;ESACCI-LC-L4-LCCS-Map-300m-P1Y-2015-v2.0.7_subs.tif&quot;</span>)</span>
<span id="cb31-12"><a href="stage-1-preparation-of-input-data.html#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ESA_LU)</span>
<span id="cb31-13"><a href="stage-1-preparation-of-input-data.html#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut the LU layer by the country polygon</span></span>
<span id="cb31-14"><a href="stage-1-preparation-of-input-data.html#cb31-14" aria-hidden="true" tabindex="-1"></a>ESA_LU_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(ESA_LU,AOI)</span>
<span id="cb31-15"><a href="stage-1-preparation-of-input-data.html#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ESA_LU_AOI)</span>
<span id="cb31-16"><a href="stage-1-preparation-of-input-data.html#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify ESA LAND USE to FAO LAND USE classes</span></span>
<span id="cb31-17"><a href="stage-1-preparation-of-input-data.html#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     0 = 0   No Data</span></span>
<span id="cb31-18"><a href="stage-1-preparation-of-input-data.html#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   190 = 1 Artificial</span></span>
<span id="cb31-19"><a href="stage-1-preparation-of-input-data.html#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   10 11 20 30 40 = 2 Croplands</span></span>
<span id="cb31-20"><a href="stage-1-preparation-of-input-data.html#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   130 = 3 Grassland</span></span>
<span id="cb31-21"><a href="stage-1-preparation-of-input-data.html#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   50 60 61 62 70 71 72 80 81 82 90 100 110 = 4 Tree Covered</span></span>
<span id="cb31-22"><a href="stage-1-preparation-of-input-data.html#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   120 121 122= 5 Shrubs Covered</span></span>
<span id="cb31-23"><a href="stage-1-preparation-of-input-data.html#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   160 180 = 6 Herbaceous vegetation flooded</span></span>
<span id="cb31-24"><a href="stage-1-preparation-of-input-data.html#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   170 = 7 Mangroves</span></span>
<span id="cb31-25"><a href="stage-1-preparation-of-input-data.html#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   150 151 152 153= 8 Sparse Vegetation</span></span>
<span id="cb31-26"><a href="stage-1-preparation-of-input-data.html#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   200 201 202 = 9 Baresoil</span></span>
<span id="cb31-27"><a href="stage-1-preparation-of-input-data.html#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   220 = 10 Snow and Glaciers</span></span>
<span id="cb31-28"><a href="stage-1-preparation-of-input-data.html#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   210 = 11 Waterbodies</span></span>
<span id="cb31-29"><a href="stage-1-preparation-of-input-data.html#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   12 = 12 Treecrops</span></span>
<span id="cb31-30"><a href="stage-1-preparation-of-input-data.html#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   20 = 13 Paddy fields(rice/ flooded crops)</span></span>
<span id="cb31-31"><a href="stage-1-preparation-of-input-data.html#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify matrix. &quot;Is&quot; to &quot;become&quot;</span></span>
<span id="cb31-32"><a href="stage-1-preparation-of-input-data.html#cb31-32" aria-hidden="true" tabindex="-1"></a>is<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">190</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">130</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">61</span>,<span class="dv">62</span>,<span class="dv">70</span>,<span class="dv">71</span>,<span class="dv">72</span>,<span class="dv">80</span>,<span class="dv">81</span>,<span class="dv">82</span>,<span class="dv">90</span>,<span class="dv">100</span>,<span class="dv">110</span>,<span class="dv">120</span>,<span class="dv">121</span>,<span class="dv">122</span>,<span class="dv">160</span>,<span class="dv">180</span>,<span class="dv">170</span>,<span class="dv">150</span>,<span class="dv">151</span>,<span class="dv">152</span>,<span class="dv">153</span>,<span class="dv">200</span>,<span class="dv">201</span>,<span class="dv">202</span>,<span class="dv">220</span>,<span class="dv">210</span>,<span class="dv">12</span>)</span>
<span id="cb31-33"><a href="stage-1-preparation-of-input-data.html#cb31-33" aria-hidden="true" tabindex="-1"></a>become<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>)</span>
<span id="cb31-34"><a href="stage-1-preparation-of-input-data.html#cb31-34" aria-hidden="true" tabindex="-1"></a>recMat<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">c</span>(is,become),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">37</span>)</span>
<span id="cb31-35"><a href="stage-1-preparation-of-input-data.html#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify</span></span>
<span id="cb31-36"><a href="stage-1-preparation-of-input-data.html#cb31-36" aria-hidden="true" tabindex="-1"></a>ESA_FAO <span class="ot">&lt;-</span> <span class="fu">reclassify</span>(ESA_LU_AOI, recMat)</span>
<span id="cb31-37"><a href="stage-1-preparation-of-input-data.html#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to SOC map layer extent and resolution</span></span>
<span id="cb31-38"><a href="stage-1-preparation-of-input-data.html#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb31-39"><a href="stage-1-preparation-of-input-data.html#cb31-39" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb31-40"><a href="stage-1-preparation-of-input-data.html#cb31-40" aria-hidden="true" tabindex="-1"></a>ESA_FAO_res<span class="ot">&lt;-</span><span class="fu">resample</span>(ESA_FAO,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb31-41"><a href="stage-1-preparation-of-input-data.html#cb31-41" aria-hidden="true" tabindex="-1"></a>ESA_FAO_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(ESA_FAO_res,SOC_MAP_AOI) </span>
<span id="cb31-42"><a href="stage-1-preparation-of-input-data.html#cb31-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Save Land Use raster</span></span>
<span id="cb31-43"><a href="stage-1-preparation-of-input-data.html#cb31-43" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb31-44"><a href="stage-1-preparation-of-input-data.html#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ESA_FAO_mask,<span class="at">filename=</span><span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&#39;GTiff&#39;</span>)</span></code></pre></div>
</div>
<div id="script-number-9-land_use_esa_to_fao_classes_lusim.r-land-use-change-simulation" class="section level3" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Script Number 9 “Land_Use_ESA_to_FAO_classes_LUsim.R” Land use change simulation</h3>
<p>Script number 9 transforms the ESA (European Space Agency 2000 to 2018; 300 m resolution; ESA CCI Land cover website) land cover classes to the FAO land use classes. This script allows for the preparation of a stack with yearly land use layers to simulate land use change during the warm up phase.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="stage-1-preparation-of-input-data.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DATE: 11-02-2021</span></span>
<span id="cb32-2"><a href="stage-1-preparation-of-input-data.html#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="stage-1-preparation-of-input-data.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># MSc Ing Agr Luciano E Di Paolo</span></span>
<span id="cb32-4"><a href="stage-1-preparation-of-input-data.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb32-5"><a href="stage-1-preparation-of-input-data.html#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="stage-1-preparation-of-input-data.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="do">#### Prepare Land Use layer </span></span>
<span id="cb32-7"><a href="stage-1-preparation-of-input-data.html#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="stage-1-preparation-of-input-data.html#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb32-9"><a href="stage-1-preparation-of-input-data.html#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="stage-1-preparation-of-input-data.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb32-11"><a href="stage-1-preparation-of-input-data.html#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb32-12"><a href="stage-1-preparation-of-input-data.html#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="stage-1-preparation-of-input-data.html#cb32-13" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb32-14"><a href="stage-1-preparation-of-input-data.html#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="stage-1-preparation-of-input-data.html#cb32-15" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb32-16"><a href="stage-1-preparation-of-input-data.html#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="stage-1-preparation-of-input-data.html#cb32-17" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb32-18"><a href="stage-1-preparation-of-input-data.html#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="stage-1-preparation-of-input-data.html#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb32-20"><a href="stage-1-preparation-of-input-data.html#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="stage-1-preparation-of-input-data.html#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb32-22"><a href="stage-1-preparation-of-input-data.html#cb32-22" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>) <span class="co"># change for your own Area of interest</span></span>
<span id="cb32-23"><a href="stage-1-preparation-of-input-data.html#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="stage-1-preparation-of-input-data.html#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Land Use Layer (ESA)</span></span>
<span id="cb32-25"><a href="stage-1-preparation-of-input-data.html#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="stage-1-preparation-of-input-data.html#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb32-27"><a href="stage-1-preparation-of-input-data.html#cb32-27" aria-hidden="true" tabindex="-1"></a>ESA_LU<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;LU_stack_ESA_2001-2018.tif&quot;</span>)</span>
<span id="cb32-28"><a href="stage-1-preparation-of-input-data.html#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ESA_LU[[<span class="dv">1</span>]])</span>
<span id="cb32-29"><a href="stage-1-preparation-of-input-data.html#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="stage-1-preparation-of-input-data.html#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut the LU layer by the country polygon</span></span>
<span id="cb32-31"><a href="stage-1-preparation-of-input-data.html#cb32-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-32"><a href="stage-1-preparation-of-input-data.html#cb32-32" aria-hidden="true" tabindex="-1"></a>ESA_LU_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(ESA_LU,AOI)</span>
<span id="cb32-33"><a href="stage-1-preparation-of-input-data.html#cb32-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-34"><a href="stage-1-preparation-of-input-data.html#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ESA_LU_AOI[[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]])</span>
<span id="cb32-35"><a href="stage-1-preparation-of-input-data.html#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="stage-1-preparation-of-input-data.html#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify ESA LAND USE to FAO LAND USE classes</span></span>
<span id="cb32-37"><a href="stage-1-preparation-of-input-data.html#cb32-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-38"><a href="stage-1-preparation-of-input-data.html#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   0 = 0     No Data</span></span>
<span id="cb32-39"><a href="stage-1-preparation-of-input-data.html#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   190 = 1 Artificial</span></span>
<span id="cb32-40"><a href="stage-1-preparation-of-input-data.html#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   10 11 30 40 = 2 Croplands</span></span>
<span id="cb32-41"><a href="stage-1-preparation-of-input-data.html#cb32-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   130 = 3 Grassland</span></span>
<span id="cb32-42"><a href="stage-1-preparation-of-input-data.html#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   50 60 61 62 70 71 72 80 81 82 90 100 110 = 4 Tree Covered</span></span>
<span id="cb32-43"><a href="stage-1-preparation-of-input-data.html#cb32-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   120 121 122= 5 Shrubs Covered</span></span>
<span id="cb32-44"><a href="stage-1-preparation-of-input-data.html#cb32-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   160 180 = 6 Herbaceous vegetation flooded</span></span>
<span id="cb32-45"><a href="stage-1-preparation-of-input-data.html#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   170 = 7 Mangroves</span></span>
<span id="cb32-46"><a href="stage-1-preparation-of-input-data.html#cb32-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   150 151 152 153= 8 Sparse Vegetation</span></span>
<span id="cb32-47"><a href="stage-1-preparation-of-input-data.html#cb32-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   200 201 202 = 9 Baresoil</span></span>
<span id="cb32-48"><a href="stage-1-preparation-of-input-data.html#cb32-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   220 = 10 Snow and Glaciers</span></span>
<span id="cb32-49"><a href="stage-1-preparation-of-input-data.html#cb32-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   210 = 11 Waterbodies</span></span>
<span id="cb32-50"><a href="stage-1-preparation-of-input-data.html#cb32-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   12  = 12 Treecrops</span></span>
<span id="cb32-51"><a href="stage-1-preparation-of-input-data.html#cb32-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 = 13 Paddy fields(rice/ flooded crops)</span></span>
<span id="cb32-52"><a href="stage-1-preparation-of-input-data.html#cb32-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-53"><a href="stage-1-preparation-of-input-data.html#cb32-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a reclassification matrix. &quot;Is&quot; to &quot;become&quot;</span></span>
<span id="cb32-54"><a href="stage-1-preparation-of-input-data.html#cb32-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-55"><a href="stage-1-preparation-of-input-data.html#cb32-55" aria-hidden="true" tabindex="-1"></a>is<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">190</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">130</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">61</span>,<span class="dv">62</span>,<span class="dv">70</span>,<span class="dv">71</span>,<span class="dv">72</span>,<span class="dv">80</span>,<span class="dv">81</span>,<span class="dv">82</span>,<span class="dv">90</span>,<span class="dv">100</span>,<span class="dv">110</span>,<span class="dv">120</span>,<span class="dv">121</span>,<span class="dv">122</span>,<span class="dv">160</span>,<span class="dv">180</span>,</span>
<span id="cb32-56"><a href="stage-1-preparation-of-input-data.html#cb32-56" aria-hidden="true" tabindex="-1"></a><span class="dv">170</span>,<span class="dv">150</span>,<span class="dv">151</span>,<span class="dv">152</span>,<span class="dv">153</span>,<span class="dv">200</span>,<span class="dv">201</span>,<span class="dv">202</span>,<span class="dv">220</span>,<span class="dv">210</span>,<span class="dv">12</span>,<span class="dv">20</span>)</span>
<span id="cb32-57"><a href="stage-1-preparation-of-input-data.html#cb32-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-58"><a href="stage-1-preparation-of-input-data.html#cb32-58" aria-hidden="true" tabindex="-1"></a>become<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>)</span>
<span id="cb32-59"><a href="stage-1-preparation-of-input-data.html#cb32-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-60"><a href="stage-1-preparation-of-input-data.html#cb32-60" aria-hidden="true" tabindex="-1"></a>recMat<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">c</span>(is,become),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">37</span>)</span>
<span id="cb32-61"><a href="stage-1-preparation-of-input-data.html#cb32-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-62"><a href="stage-1-preparation-of-input-data.html#cb32-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify</span></span>
<span id="cb32-63"><a href="stage-1-preparation-of-input-data.html#cb32-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-64"><a href="stage-1-preparation-of-input-data.html#cb32-64" aria-hidden="true" tabindex="-1"></a>ESA_FAO <span class="ot">&lt;-</span> <span class="fu">reclassify</span>(ESA_LU_AOI, recMat)</span>
<span id="cb32-65"><a href="stage-1-preparation-of-input-data.html#cb32-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-66"><a href="stage-1-preparation-of-input-data.html#cb32-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to SOC map layer extent and resolution</span></span>
<span id="cb32-67"><a href="stage-1-preparation-of-input-data.html#cb32-67" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb32-68"><a href="stage-1-preparation-of-input-data.html#cb32-68" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>) <span class="co"># change for your own SOC MAP</span></span>
<span id="cb32-69"><a href="stage-1-preparation-of-input-data.html#cb32-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-70"><a href="stage-1-preparation-of-input-data.html#cb32-70" aria-hidden="true" tabindex="-1"></a>ESA_FAO_res<span class="ot">&lt;-</span><span class="fu">resample</span>(ESA_FAO,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb32-71"><a href="stage-1-preparation-of-input-data.html#cb32-71" aria-hidden="true" tabindex="-1"></a>ESA_FAO_mask<span class="ot">&lt;-</span><span class="fu">mask</span>(ESA_FAO_res,SOC_MAP_AOI) </span>
<span id="cb32-72"><a href="stage-1-preparation-of-input-data.html#cb32-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-73"><a href="stage-1-preparation-of-input-data.html#cb32-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Save Land Use raster</span></span>
<span id="cb32-74"><a href="stage-1-preparation-of-input-data.html#cb32-74" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb32-75"><a href="stage-1-preparation-of-input-data.html#cb32-75" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ESA_FAO_mask,<span class="at">filename=</span><span class="st">&quot;ESA_Land_Cover_12clases_FAO_Stack_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&#39;GTiff&#39;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-76"><a href="stage-1-preparation-of-input-data.html#cb32-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-77"><a href="stage-1-preparation-of-input-data.html#cb32-77" aria-hidden="true" tabindex="-1"></a><span class="co"># We save separately the land use from 2018 to perform the target&#39;s points creation</span></span>
<span id="cb32-78"><a href="stage-1-preparation-of-input-data.html#cb32-78" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(ESA_FAO_mask[[<span class="dv">18</span>]],<span class="at">filename=</span><span class="st">&quot;ESA_Land_Cover_12clases_FAO_2018_AOI.tif&quot;</span>,<span class="at">format=</span><span class="st">&#39;GTiff&#39;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><strong>Table 9.9</strong> <em>Script Number 9. ESA Land Use to FAO classes. Inputs and Outputs</em></p>
</div>
</div>
<div id="harmonization-of-soil-climate-and-vegetation-layers." class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Harmonization of soil, climate and vegetation layers.</h2>
<p>Once all soil, climate, vegetation and land use layers are created, they need to be harmonized in order to run the model. The harmonization of layers consists of three steps. First, if the model is to be run for an entire country, layers need to be harmonized to the extents of the country boundaries (country polygon layer extents). Second, a resampling process is required in order to match the spatial resolution to the master layer (SOC FAO layer). Finally, a masking process is required to cut the layer with the vector polygon boundaries. After the harmonization of all layers, we will generate a raster stack of all layers needed to run the model. The harmonization/stacking process will be performed three times (scripts 10,11,12), one for each modelling phase.</p>
<div id="script-number-10.-spin_up_stack.v3.r" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Script Number 10. “SPIN_UP_STACK.v3.R”</h3>
<p>Script number 10 is intended to harmonize all layers needed to complete phase 1 (long spin-up) of the spatial RothC model. The result of this script is a simple raster stack which contains all the data to perform the spin-up phase. To generate the stack we will need the SOC FAO layer (master layer), the clay layer (from script number 8), the three climate stacks (from script number 1), the land use layer (from script number 9), and the vegetation cover stack (from script number 7).</p>
<p><strong>Table 9.10</strong> <em>Script Number 10. Stack Layers for SPIN UP phase. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.9.png" /></p>
<p>First, we will open the required R-packages and a shapefile (polygon) which represents the country boundary. In the script below we will be using an example but when running it (AR), the user will have to replace the file according to the target country. The user can also modify the names of the variables inside the script. However, as these variables will only exist inside the script, it is not necessary.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="stage-1-preparation-of-input-data.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Prepare the layers for the SPIN UP process of the Roth C Model. </span></span>
<span id="cb33-2"><a href="stage-1-preparation-of-input-data.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb33-3"><a href="stage-1-preparation-of-input-data.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb33-4"><a href="stage-1-preparation-of-input-data.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb33-5"><a href="stage-1-preparation-of-input-data.html#cb33-5" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb33-6"><a href="stage-1-preparation-of-input-data.html#cb33-6" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb33-7"><a href="stage-1-preparation-of-input-data.html#cb33-7" aria-hidden="true" tabindex="-1"></a>WD_CLAY<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CLAY&quot;</span>)</span>
<span id="cb33-8"><a href="stage-1-preparation-of-input-data.html#cb33-8" aria-hidden="true" tabindex="-1"></a>WD_CLIM<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb33-9"><a href="stage-1-preparation-of-input-data.html#cb33-9" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb33-10"><a href="stage-1-preparation-of-input-data.html#cb33-10" aria-hidden="true" tabindex="-1"></a>WD_COV<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/COV&quot;</span>)</span>
<span id="cb33-11"><a href="stage-1-preparation-of-input-data.html#cb33-11" aria-hidden="true" tabindex="-1"></a>WD_STACK<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/STACK&quot;</span>)</span>
<span id="cb33-12"><a href="stage-1-preparation-of-input-data.html#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb33-13"><a href="stage-1-preparation-of-input-data.html#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb33-14"><a href="stage-1-preparation-of-input-data.html#cb33-14" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb33-15"><a href="stage-1-preparation-of-input-data.html#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="stage-1-preparation-of-input-data.html#cb33-16" aria-hidden="true" tabindex="-1"></a>The second step is to load the latest version of FAO Soil Organic Carbon map <span class="fu">layer</span> (Master Layer), created <span class="cf">in</span> script number <span class="fl">0.</span> </span>
<span id="cb33-17"><a href="stage-1-preparation-of-input-data.html#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP FAO</span></span>
<span id="cb33-18"><a href="stage-1-preparation-of-input-data.html#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb33-19"><a href="stage-1-preparation-of-input-data.html#cb33-19" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb33-20"><a href="stage-1-preparation-of-input-data.html#cb33-20" aria-hidden="true" tabindex="-1"></a> Next, we will open the clay content <span class="fu">layer</span> (from script number <span class="dv">8</span>)<span class="sc">:</span></span>
<span id="cb33-21"><a href="stage-1-preparation-of-input-data.html#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Clay layer</span></span>
<span id="cb33-22"><a href="stage-1-preparation-of-input-data.html#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLAY)</span>
<span id="cb33-23"><a href="stage-1-preparation-of-input-data.html#cb33-23" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb33-24"><a href="stage-1-preparation-of-input-data.html#cb33-24" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb33-25"><a href="stage-1-preparation-of-input-data.html#cb33-25" aria-hidden="true" tabindex="-1"></a>Clay_AR_Avg<span class="ot">&lt;-</span><span class="fu">crop</span>(Clay_AR_Avg,AR)</span>
<span id="cb33-26"><a href="stage-1-preparation-of-input-data.html#cb33-26" aria-hidden="true" tabindex="-1"></a>Clay_AR_Avg<span class="ot">&lt;-</span><span class="fu">mask</span>(Clay_AR_Avg,AR)</span>
<span id="cb33-27"><a href="stage-1-preparation-of-input-data.html#cb33-27" aria-hidden="true" tabindex="-1"></a>Clay_AR_Avg_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Clay_AR_Avg,SOC_MAP_AR,<span class="at">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb33-28"><a href="stage-1-preparation-of-input-data.html#cb33-28" aria-hidden="true" tabindex="-1"></a>Next, we will open the climate raster <span class="fu">layers</span> (generated <span class="cf">in</span> script number <span class="dv">1</span>).  These layers come from the CRU database, but the user can choose local layers <span class="cf">if</span> desired, as long as they match the arrangement and format needed <span class="cf">for</span> running the model.</span>
<span id="cb33-29"><a href="stage-1-preparation-of-input-data.html#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Precipitation layer </span></span>
<span id="cb33-30"><a href="stage-1-preparation-of-input-data.html#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLIM)</span>
<span id="cb33-31"><a href="stage-1-preparation-of-input-data.html#cb33-31" aria-hidden="true" tabindex="-1"></a>PREC<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Prec_Stack_81-00_CRU.tif&quot;</span>)</span>
<span id="cb33-32"><a href="stage-1-preparation-of-input-data.html#cb33-32" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(PREC,AOI)</span>
<span id="cb33-33"><a href="stage-1-preparation-of-input-data.html#cb33-33" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(PREC_AOI,SOC_MAP_AOI)</span>
<span id="cb33-34"><a href="stage-1-preparation-of-input-data.html#cb33-34" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(PREC_AOI,AOI)</span>
<span id="cb33-35"><a href="stage-1-preparation-of-input-data.html#cb33-35" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(PREC_AOI)</span>
<span id="cb33-36"><a href="stage-1-preparation-of-input-data.html#cb33-36" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Temperatures layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb33-37"><a href="stage-1-preparation-of-input-data.html#cb33-37" aria-hidden="true" tabindex="-1"></a>TEMP<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Temp_Stack_81-00_CRU.tif&quot;</span>)</span>
<span id="cb33-38"><a href="stage-1-preparation-of-input-data.html#cb33-38" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(TEMP,AOI)</span>
<span id="cb33-39"><a href="stage-1-preparation-of-input-data.html#cb33-39" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(TEMP_AOI,SOC_MAP_AOI)</span>
<span id="cb33-40"><a href="stage-1-preparation-of-input-data.html#cb33-40" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(TEMP_AOI,AOI)</span>
<span id="cb33-41"><a href="stage-1-preparation-of-input-data.html#cb33-41" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(TEMP_AOI)</span>
<span id="cb33-42"><a href="stage-1-preparation-of-input-data.html#cb33-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Potential Evapotranspiration layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb33-43"><a href="stage-1-preparation-of-input-data.html#cb33-43" aria-hidden="true" tabindex="-1"></a>PET<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;PET_Stack_81-00_CRU.tif&quot;</span>)</span>
<span id="cb33-44"><a href="stage-1-preparation-of-input-data.html#cb33-44" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(PET,AOI)</span>
<span id="cb33-45"><a href="stage-1-preparation-of-input-data.html#cb33-45" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(PET_AOI,SOC_MAP_AOI)</span>
<span id="cb33-46"><a href="stage-1-preparation-of-input-data.html#cb33-46" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(PET_AOI,AOI)</span>
<span id="cb33-47"><a href="stage-1-preparation-of-input-data.html#cb33-47" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(PET_AOI)</span>
<span id="cb33-48"><a href="stage-1-preparation-of-input-data.html#cb33-48" aria-hidden="true" tabindex="-1"></a>Next, we will open, resample and mask the land use raster layer to be used <span class="cf">in</span> the spin up <span class="fu">phase</span> (representative <span class="dv">1980-2000</span> period).  In this example we will use the ESA land used reclassified into FAO land use <span class="fu">classes</span> (script <span class="dv">9</span>)</span>
<span id="cb33-49"><a href="stage-1-preparation-of-input-data.html#cb33-49" aria-hidden="true" tabindex="-1"></a><span class="co"># OPen Land Use layer reclassify to FAO classes </span></span>
<span id="cb33-50"><a href="stage-1-preparation-of-input-data.html#cb33-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 No Data</span></span>
<span id="cb33-51"><a href="stage-1-preparation-of-input-data.html#cb33-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 Artificial</span></span>
<span id="cb33-52"><a href="stage-1-preparation-of-input-data.html#cb33-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 Croplands</span></span>
<span id="cb33-53"><a href="stage-1-preparation-of-input-data.html#cb33-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 Grassland</span></span>
<span id="cb33-54"><a href="stage-1-preparation-of-input-data.html#cb33-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 Tree Covered</span></span>
<span id="cb33-55"><a href="stage-1-preparation-of-input-data.html#cb33-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 Shrubs Covered</span></span>
<span id="cb33-56"><a href="stage-1-preparation-of-input-data.html#cb33-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 Herbaceous vegetation flooded</span></span>
<span id="cb33-57"><a href="stage-1-preparation-of-input-data.html#cb33-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 Mangroves</span></span>
<span id="cb33-58"><a href="stage-1-preparation-of-input-data.html#cb33-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 8 Sparse Vegetation</span></span>
<span id="cb33-59"><a href="stage-1-preparation-of-input-data.html#cb33-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 9 Baresoil</span></span>
<span id="cb33-60"><a href="stage-1-preparation-of-input-data.html#cb33-60" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 Snow and Glaciers</span></span>
<span id="cb33-61"><a href="stage-1-preparation-of-input-data.html#cb33-61" aria-hidden="true" tabindex="-1"></a><span class="co"># 11 Waterbodies</span></span>
<span id="cb33-62"><a href="stage-1-preparation-of-input-data.html#cb33-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 12 TreeCrops</span></span>
<span id="cb33-63"><a href="stage-1-preparation-of-input-data.html#cb33-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 13 Paddy fields</span></span>
<span id="cb33-64"><a href="stage-1-preparation-of-input-data.html#cb33-64" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb33-65"><a href="stage-1-preparation-of-input-data.html#cb33-65" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span>
<span id="cb33-66"><a href="stage-1-preparation-of-input-data.html#cb33-66" aria-hidden="true" tabindex="-1"></a>Then, we will open the vegetation cover <span class="fu">layers</span> (created <span class="cf">in</span> script number <span class="dv">7</span>)<span class="sc">:</span></span>
<span id="cb33-67"><a href="stage-1-preparation-of-input-data.html#cb33-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Vegetation Cover layer </span></span>
<span id="cb33-68"><a href="stage-1-preparation-of-input-data.html#cb33-68" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_COV)</span>
<span id="cb33-69"><a href="stage-1-preparation-of-input-data.html#cb33-69" aria-hidden="true" tabindex="-1"></a>Cov_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span></code></pre></div>
<p>The script then creates a DR layer (DPM/RPM ratio). Here the DR layer is derived from the Land use layer, assigning default DPM/RPM ratios to each FAO land cover class (See Table 9.13). Users can modify these ratios according to local expertise and available local information.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="stage-1-preparation-of-input-data.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use Land use layer to convert it to DR layer </span></span>
<span id="cb34-2"><a href="stage-1-preparation-of-input-data.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">#DPM/RPM (decomplosable vs resistant plant material)</span></span>
<span id="cb34-3"><a href="stage-1-preparation-of-input-data.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#(1) Most agricultural crops and improved grassland and tree crops 1.44 </span></span>
<span id="cb34-4"><a href="stage-1-preparation-of-input-data.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#(2) Unimproved grassland and schrub 0.67</span></span>
<span id="cb34-5"><a href="stage-1-preparation-of-input-data.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb34-6"><a href="stage-1-preparation-of-input-data.html#cb34-6" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span><span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span><span class="fl">1.44</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span><span class="fl">0.25</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span><span class="fl">0.67</span></span>
<span id="cb34-7"><a href="stage-1-preparation-of-input-data.html#cb34-7" aria-hidden="true" tabindex="-1"></a> Finally, we will create a stack with all the raster layers that have been prepared.</span>
<span id="cb34-8"><a href="stage-1-preparation-of-input-data.html#cb34-8" aria-hidden="true" tabindex="-1"></a> <span class="co"># STACK all layers</span></span>
<span id="cb34-9"><a href="stage-1-preparation-of-input-data.html#cb34-9" aria-hidden="true" tabindex="-1"></a>Stack_Set_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,TEMP_AOI,PREC_AOI,PET_AOI,DR,LU_AOI,Cov_AOI)</span>
<span id="cb34-10"><a href="stage-1-preparation-of-input-data.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_STACK)</span>
<span id="cb34-11"><a href="stage-1-preparation-of-input-data.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Stack_Set_AOI,<span class="at">filename=</span>(<span class="st">&quot;Stack_Set_SPIN_UP_AOI.tif&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-11.-warm_up_stack_v5.r-no-land-use-change" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Script Number 11. “WARM_UP_STACK_V5.R” No Land use change</h3>
<p>Script number 11 is intended to harmonize all layers required to run the phase 2 (WARM UP) of the spatial RothC model. The result of this script is a simple raster stack which contains most of the layers needed for the warm-up phase. To generate the stack we will need the latest version of SOC FAO layer (master layer), the clay layer (from script number 8), land use layers (from script number 9), a land use stack (one land use layer per year), a vegetation cover stack (from script number 7) and the NPP stack (from script number 4). The climate layers and the NPP mean are additional layers that will be needed in the WARM UP phase but will not be part of this stack because of the final size of the output file.</p>
<p><strong>Table 9.11</strong> <em>Script Number 11. Stack layers for Warm Up phase. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.10.png" /></p>
<p>First, we will load the packages, set the number of years of the warmup phase and set the directories of each layer. Then we will open the country vector polygon boundaries:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="stage-1-preparation-of-input-data.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb35-2"><a href="stage-1-preparation-of-input-data.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb35-3"><a href="stage-1-preparation-of-input-data.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb35-4"><a href="stage-1-preparation-of-input-data.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the number of years of the warm up</span></span>
<span id="cb35-5"><a href="stage-1-preparation-of-input-data.html#cb35-5" aria-hidden="true" tabindex="-1"></a>nWUP<span class="ot">&lt;-</span><span class="dv">18</span></span>
<span id="cb35-6"><a href="stage-1-preparation-of-input-data.html#cb35-6" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb35-7"><a href="stage-1-preparation-of-input-data.html#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="stage-1-preparation-of-input-data.html#cb35-8" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb35-9"><a href="stage-1-preparation-of-input-data.html#cb35-9" aria-hidden="true" tabindex="-1"></a>WD_CLAY<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/INPUTS/CLAY&quot;</span>)</span>
<span id="cb35-10"><a href="stage-1-preparation-of-input-data.html#cb35-10" aria-hidden="true" tabindex="-1"></a>WD_CLIM<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb35-11"><a href="stage-1-preparation-of-input-data.html#cb35-11" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb35-12"><a href="stage-1-preparation-of-input-data.html#cb35-12" aria-hidden="true" tabindex="-1"></a>WD_COV<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/COV&quot;</span>)</span>
<span id="cb35-13"><a href="stage-1-preparation-of-input-data.html#cb35-13" aria-hidden="true" tabindex="-1"></a>WD_STACK<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/STACK&quot;</span>)</span>
<span id="cb35-14"><a href="stage-1-preparation-of-input-data.html#cb35-14" aria-hidden="true" tabindex="-1"></a>WD_NPP<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/NPP&quot;</span>)</span>
<span id="cb35-15"><a href="stage-1-preparation-of-input-data.html#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb35-16"><a href="stage-1-preparation-of-input-data.html#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb35-17"><a href="stage-1-preparation-of-input-data.html#cb35-17" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span></code></pre></div>
<p>Then, we will open the harmonized FAO GSOCmap of the country created in script number 0:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="stage-1-preparation-of-input-data.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP </span></span>
<span id="cb36-2"><a href="stage-1-preparation-of-input-data.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb36-3"><a href="stage-1-preparation-of-input-data.html#cb36-3" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb36-4"><a href="stage-1-preparation-of-input-data.html#cb36-4" aria-hidden="true" tabindex="-1"></a>Then we will open the clay layer created <span class="cf">in</span> script number <span class="dv">8</span><span class="sc">:</span></span>
<span id="cb36-5"><a href="stage-1-preparation-of-input-data.html#cb36-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb36-6"><a href="stage-1-preparation-of-input-data.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLAY)</span>
<span id="cb36-7"><a href="stage-1-preparation-of-input-data.html#cb36-7" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb36-8"><a href="stage-1-preparation-of-input-data.html#cb36-8" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;bilinear&#39;</span>) </span></code></pre></div>
<p>Then, we will open the Land Use layers required for the warm up phase (2000-2020). In this example we used the ESA land use (2015) reclassified into to the FAO land use classes.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="stage-1-preparation-of-input-data.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OPen Land Use layer (ESA)</span></span>
<span id="cb37-2"><a href="stage-1-preparation-of-input-data.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb37-3"><a href="stage-1-preparation-of-input-data.html#cb37-3" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span></code></pre></div>
<p>We will then open the vegetation cover layer previously created in the script number 7:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="stage-1-preparation-of-input-data.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Vegetation Cover layer </span></span>
<span id="cb38-2"><a href="stage-1-preparation-of-input-data.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_COV)</span>
<span id="cb38-3"><a href="stage-1-preparation-of-input-data.html#cb38-3" aria-hidden="true" tabindex="-1"></a>Cov_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span></code></pre></div>
<p>If year to year land use layers are available for the warm up phase (2000-2020), we will open the Land Use stack of the annual land use layers. If annual land use layers are not available, we will just replicate a representative land use layer for the warm-up phase, as previously loaded.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="stage-1-preparation-of-input-data.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Land Use Stack , One Land use layer for each year (in this example we use the same LU for the 18/20 year #period set previously in the nWUP variable</span></span>
<span id="cb39-2"><a href="stage-1-preparation-of-input-data.html#cb39-2" aria-hidden="true" tabindex="-1"></a> LU_Stack <span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="fu">replicate</span>(nWUP, LU_AOI))</span></code></pre></div>
<p>Then, we will create a “DR” stack layer, one DR layer per year of the WARM UP phase.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="stage-1-preparation-of-input-data.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DR Layer from LU layer (ESA land use , 14 classes)</span></span>
<span id="cb40-2"><a href="stage-1-preparation-of-input-data.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#DPM/RPM (decomposable vs resistant plant material)</span></span>
<span id="cb40-3"><a href="stage-1-preparation-of-input-data.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#(1) Most agricultural crops and improved grassland or tree crops 1.44 </span></span>
<span id="cb40-4"><a href="stage-1-preparation-of-input-data.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">#(2) Unimproved grassland and shrub 0.67</span></span>
<span id="cb40-5"><a href="stage-1-preparation-of-input-data.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb40-6"><a href="stage-1-preparation-of-input-data.html#cb40-6" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span><span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span><span class="fl">1.44</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span><span class="fl">0.25</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span><span class="fl">0.67</span></span>
<span id="cb40-7"><a href="stage-1-preparation-of-input-data.html#cb40-7" aria-hidden="true" tabindex="-1"></a>DR_Stack<span class="ot">&lt;-</span>LU_Stack</span>
<span id="cb40-8"><a href="stage-1-preparation-of-input-data.html#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(LU_Stack)){</span>
<span id="cb40-9"><a href="stage-1-preparation-of-input-data.html#cb40-9" aria-hidden="true" tabindex="-1"></a>DR_Stack[[i]]<span class="ot">&lt;-</span>(LU_Stack[[i]]<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">12</span>)<span class="sc">*</span><span class="fl">1.44</span><span class="sc">+</span> (LU_Stack[[i]]<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span><span class="fl">0.25</span> <span class="sc">+</span> (LU_Stack[[i]]<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span><span class="fl">0.67</span></span>
<span id="cb40-10"><a href="stage-1-preparation-of-input-data.html#cb40-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, we will run the rest of the code and save the raster stack containing all the necessary layers to run the ‘warm up’ phase.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="stage-1-preparation-of-input-data.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># STACK all layers</span></span>
<span id="cb41-2"><a href="stage-1-preparation-of-input-data.html#cb41-2" aria-hidden="true" tabindex="-1"></a>Stack_Set_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,Cov_AOI,LU_Stack,DR_Stack)</span>
<span id="cb41-3"><a href="stage-1-preparation-of-input-data.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_STACK)</span>
<span id="cb41-4"><a href="stage-1-preparation-of-input-data.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Stack_Set_AOI,<span class="at">filename=</span>(<span class="st">&quot;Stack_Set_WARM_UP_AOI.tif&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-11.-warm_up_stack_v5_lusim.r-land-use-change-simulation" class="section level3" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> Script Number 11. WARM_UP_STACK_V5_LUsim.R Land use change simulation</h3>
<p>The following script is to be used if yearly land use layers to simulate land use change are available. This script uses the output from script numer 9 Land_Use_ESA_to_FAO_classes_LUsim.R</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="stage-1-preparation-of-input-data.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DATE 11-2-2021</span></span>
<span id="cb42-2"><a href="stage-1-preparation-of-input-data.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD NPP_MIN AND NPP_MAX TO THE STACK TO CALCULATE UNCERTAINTIES</span></span>
<span id="cb42-3"><a href="stage-1-preparation-of-input-data.html#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="stage-1-preparation-of-input-data.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># MSc Ing Agr Luciano E Di Paolo</span></span>
<span id="cb42-5"><a href="stage-1-preparation-of-input-data.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Dr Ing Agr Guillermo E Peralta</span></span>
<span id="cb42-6"><a href="stage-1-preparation-of-input-data.html#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="stage-1-preparation-of-input-data.html#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="stage-1-preparation-of-input-data.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="do">#### Prepare the layers for the WARM UP Roth C Model. </span></span>
<span id="cb42-9"><a href="stage-1-preparation-of-input-data.html#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="stage-1-preparation-of-input-data.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb42-11"><a href="stage-1-preparation-of-input-data.html#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="stage-1-preparation-of-input-data.html#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb42-13"><a href="stage-1-preparation-of-input-data.html#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb42-14"><a href="stage-1-preparation-of-input-data.html#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="stage-1-preparation-of-input-data.html#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the number of years of the warm up</span></span>
<span id="cb42-16"><a href="stage-1-preparation-of-input-data.html#cb42-16" aria-hidden="true" tabindex="-1"></a>nWUP<span class="ot">&lt;-</span><span class="dv">18</span></span>
<span id="cb42-17"><a href="stage-1-preparation-of-input-data.html#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="stage-1-preparation-of-input-data.html#cb42-18" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb42-19"><a href="stage-1-preparation-of-input-data.html#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="stage-1-preparation-of-input-data.html#cb42-20" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb42-21"><a href="stage-1-preparation-of-input-data.html#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="stage-1-preparation-of-input-data.html#cb42-22" aria-hidden="true" tabindex="-1"></a>WD_CLAY<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/CLAY&quot;</span>)</span>
<span id="cb42-23"><a href="stage-1-preparation-of-input-data.html#cb42-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-24"><a href="stage-1-preparation-of-input-data.html#cb42-24" aria-hidden="true" tabindex="-1"></a>WD_CLIM<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb42-25"><a href="stage-1-preparation-of-input-data.html#cb42-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-26"><a href="stage-1-preparation-of-input-data.html#cb42-26" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb42-27"><a href="stage-1-preparation-of-input-data.html#cb42-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="stage-1-preparation-of-input-data.html#cb42-28" aria-hidden="true" tabindex="-1"></a>WD_COV<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/COV&quot;</span>)</span>
<span id="cb42-29"><a href="stage-1-preparation-of-input-data.html#cb42-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-30"><a href="stage-1-preparation-of-input-data.html#cb42-30" aria-hidden="true" tabindex="-1"></a>WD_STACK<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/STACK&quot;</span>)</span>
<span id="cb42-31"><a href="stage-1-preparation-of-input-data.html#cb42-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-32"><a href="stage-1-preparation-of-input-data.html#cb42-32" aria-hidden="true" tabindex="-1"></a>WD_NPP<span class="ot">&lt;-</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_12-11-2020/INPUTS/NPP&quot;</span>)</span>
<span id="cb42-33"><a href="stage-1-preparation-of-input-data.html#cb42-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-34"><a href="stage-1-preparation-of-input-data.html#cb42-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-35"><a href="stage-1-preparation-of-input-data.html#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb42-36"><a href="stage-1-preparation-of-input-data.html#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb42-37"><a href="stage-1-preparation-of-input-data.html#cb42-37" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>) <span class="co"># change the AOI</span></span>
<span id="cb42-38"><a href="stage-1-preparation-of-input-data.html#cb42-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-39"><a href="stage-1-preparation-of-input-data.html#cb42-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP </span></span>
<span id="cb42-40"><a href="stage-1-preparation-of-input-data.html#cb42-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-41"><a href="stage-1-preparation-of-input-data.html#cb42-41" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb42-42"><a href="stage-1-preparation-of-input-data.html#cb42-42" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>) <span class="co"># change the SOC_MAP</span></span>
<span id="cb42-43"><a href="stage-1-preparation-of-input-data.html#cb42-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-44"><a href="stage-1-preparation-of-input-data.html#cb42-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb42-45"><a href="stage-1-preparation-of-input-data.html#cb42-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-46"><a href="stage-1-preparation-of-input-data.html#cb42-46" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLAY)</span>
<span id="cb42-47"><a href="stage-1-preparation-of-input-data.html#cb42-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-48"><a href="stage-1-preparation-of-input-data.html#cb42-48" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb42-49"><a href="stage-1-preparation-of-input-data.html#cb42-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-50"><a href="stage-1-preparation-of-input-data.html#cb42-50" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb42-51"><a href="stage-1-preparation-of-input-data.html#cb42-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-52"><a href="stage-1-preparation-of-input-data.html#cb42-52" aria-hidden="true" tabindex="-1"></a><span class="co"># OPen Land Use layer (ESA)</span></span>
<span id="cb42-53"><a href="stage-1-preparation-of-input-data.html#cb42-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-54"><a href="stage-1-preparation-of-input-data.html#cb42-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 No Data</span></span>
<span id="cb42-55"><a href="stage-1-preparation-of-input-data.html#cb42-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 Artificial</span></span>
<span id="cb42-56"><a href="stage-1-preparation-of-input-data.html#cb42-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 Croplands</span></span>
<span id="cb42-57"><a href="stage-1-preparation-of-input-data.html#cb42-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 Grassland</span></span>
<span id="cb42-58"><a href="stage-1-preparation-of-input-data.html#cb42-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 Tree Covered</span></span>
<span id="cb42-59"><a href="stage-1-preparation-of-input-data.html#cb42-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 Shrubs Covered</span></span>
<span id="cb42-60"><a href="stage-1-preparation-of-input-data.html#cb42-60" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 Herbaceous vegetation flooded</span></span>
<span id="cb42-61"><a href="stage-1-preparation-of-input-data.html#cb42-61" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 Mangroves</span></span>
<span id="cb42-62"><a href="stage-1-preparation-of-input-data.html#cb42-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 8 Sparse Vegetation</span></span>
<span id="cb42-63"><a href="stage-1-preparation-of-input-data.html#cb42-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 9 Baresoil</span></span>
<span id="cb42-64"><a href="stage-1-preparation-of-input-data.html#cb42-64" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 Snow and Glaciers</span></span>
<span id="cb42-65"><a href="stage-1-preparation-of-input-data.html#cb42-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 11 Waterbodies</span></span>
<span id="cb42-66"><a href="stage-1-preparation-of-input-data.html#cb42-66" aria-hidden="true" tabindex="-1"></a><span class="co"># 12 TreeCrops</span></span>
<span id="cb42-67"><a href="stage-1-preparation-of-input-data.html#cb42-67" aria-hidden="true" tabindex="-1"></a><span class="co"># 13 Paddy fields</span></span>
<span id="cb42-68"><a href="stage-1-preparation-of-input-data.html#cb42-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-69"><a href="stage-1-preparation-of-input-data.html#cb42-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-70"><a href="stage-1-preparation-of-input-data.html#cb42-70" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb42-71"><a href="stage-1-preparation-of-input-data.html#cb42-71" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_Stack_AOI.tif&quot;</span>)</span>
<span id="cb42-72"><a href="stage-1-preparation-of-input-data.html#cb42-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-73"><a href="stage-1-preparation-of-input-data.html#cb42-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Vegetation Cover layer </span></span>
<span id="cb42-74"><a href="stage-1-preparation-of-input-data.html#cb42-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-75"><a href="stage-1-preparation-of-input-data.html#cb42-75" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_COV)</span>
<span id="cb42-76"><a href="stage-1-preparation-of-input-data.html#cb42-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-77"><a href="stage-1-preparation-of-input-data.html#cb42-77" aria-hidden="true" tabindex="-1"></a>Cov_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span>
<span id="cb42-78"><a href="stage-1-preparation-of-input-data.html#cb42-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-79"><a href="stage-1-preparation-of-input-data.html#cb42-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Land Use Stack , One Land use layer for each year (in this example we use the same LU for the 18 year period</span></span>
<span id="cb42-80"><a href="stage-1-preparation-of-input-data.html#cb42-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-81"><a href="stage-1-preparation-of-input-data.html#cb42-81" aria-hidden="true" tabindex="-1"></a><span class="co">#LU_Stack &lt;-stack(replicate(nWUP, LU_AOI))</span></span>
<span id="cb42-82"><a href="stage-1-preparation-of-input-data.html#cb42-82" aria-hidden="true" tabindex="-1"></a><span class="co">#LU_Stack &lt;-stack(ESA[2001:2015],2015,2015,2015)</span></span>
<span id="cb42-83"><a href="stage-1-preparation-of-input-data.html#cb42-83" aria-hidden="true" tabindex="-1"></a>LU_Stack<span class="ot">&lt;-</span>LU_AOI</span>
<span id="cb42-84"><a href="stage-1-preparation-of-input-data.html#cb42-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-85"><a href="stage-1-preparation-of-input-data.html#cb42-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert LU layer  to DR layer (ESA land use , 14 classes)</span></span>
<span id="cb42-86"><a href="stage-1-preparation-of-input-data.html#cb42-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-87"><a href="stage-1-preparation-of-input-data.html#cb42-87" aria-hidden="true" tabindex="-1"></a><span class="co">#DPM/RPM (decomplosable vs resistant plant material)</span></span>
<span id="cb42-88"><a href="stage-1-preparation-of-input-data.html#cb42-88" aria-hidden="true" tabindex="-1"></a><span class="co">#(1) Most agricultural crops and improved grassland or tree crops 1.44 </span></span>
<span id="cb42-89"><a href="stage-1-preparation-of-input-data.html#cb42-89" aria-hidden="true" tabindex="-1"></a><span class="co">#(2) Unimproved grassland and schrub 0.67</span></span>
<span id="cb42-90"><a href="stage-1-preparation-of-input-data.html#cb42-90" aria-hidden="true" tabindex="-1"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb42-91"><a href="stage-1-preparation-of-input-data.html#cb42-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-92"><a href="stage-1-preparation-of-input-data.html#cb42-92" aria-hidden="true" tabindex="-1"></a><span class="co">#DR&lt;-(LU_AOI==2 | LU_AOI==12 | LU_AOI==13)*1.44+ (LU_AOI==4)*0.25 + (LU_AOI==3 | LU_AOI==5 | LU_AOI==6 | LU_AOI==8)*0.67</span></span>
<span id="cb42-93"><a href="stage-1-preparation-of-input-data.html#cb42-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-94"><a href="stage-1-preparation-of-input-data.html#cb42-94" aria-hidden="true" tabindex="-1"></a>DR_Stack<span class="ot">&lt;-</span>LU_Stack</span>
<span id="cb42-95"><a href="stage-1-preparation-of-input-data.html#cb42-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-96"><a href="stage-1-preparation-of-input-data.html#cb42-96" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(LU_Stack)){</span>
<span id="cb42-97"><a href="stage-1-preparation-of-input-data.html#cb42-97" aria-hidden="true" tabindex="-1"></a>DR_Stack[[i]]<span class="ot">&lt;-</span>(LU_Stack[[i]]<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">12</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span><span class="fl">1.44</span><span class="sc">+</span> (LU_Stack[[i]]<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span><span class="fl">0.25</span> <span class="sc">+</span> (LU_Stack[[i]]<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_Stack[[i]]<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span><span class="fl">0.67</span></span>
<span id="cb42-98"><a href="stage-1-preparation-of-input-data.html#cb42-98" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-99"><a href="stage-1-preparation-of-input-data.html#cb42-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-100"><a href="stage-1-preparation-of-input-data.html#cb42-100" aria-hidden="true" tabindex="-1"></a><span class="co"># STACK all layers</span></span>
<span id="cb42-101"><a href="stage-1-preparation-of-input-data.html#cb42-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-102"><a href="stage-1-preparation-of-input-data.html#cb42-102" aria-hidden="true" tabindex="-1"></a>Stack_Set_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,Cov_AOI,LU_Stack,DR_Stack)</span>
<span id="cb42-103"><a href="stage-1-preparation-of-input-data.html#cb42-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-104"><a href="stage-1-preparation-of-input-data.html#cb42-104" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_STACK)</span>
<span id="cb42-105"><a href="stage-1-preparation-of-input-data.html#cb42-105" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Stack_Set_AOI,<span class="at">filename=</span>(<span class="st">&quot;Stack_Set_WARM_UP_AOI.tif&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>,<span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="script-number-12.-forward_stack.r" class="section level3" number="9.4.4">
<h3><span class="header-section-number">9.4.4</span> Script Number 12. “FORWARD_STACK.R”</h3>
<p>Script number 12 harmonizes all layers needed to run phase 3 (forward) of the spatial Roth C model. The result of the script is a simple raster stack which contains the layers needed to perform the forward phase. To generate the stack we will need the SOC FAO layer (master layer), the clay layer (from script number 8), the three climate stacks required for the forward phase (from script number 2), the land use layer or the forward phase (from script number 9), and the vegetation cover stack (from script number 7).</p>
<p><strong>Table 9.12</strong> <em>Script Number 12. Stack layers for forward phase. Inputs and Outputs.</em></p>
<p><img src="tables/Table_9.11.png" /></p>
<p>First, we will load the packages, set path to the files directories and open the country vector polygon boundaries.</p>
<div id="prepare-the-layers-for-the-foward-mode-roth-c-model." class="section level4" number="9.4.4.1">
<h4><span class="header-section-number">9.4.4.1</span> Prepare the layers for the FOWARD Mode Roth C Model.</h4>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="stage-1-preparation-of-input-data.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb43-2"><a href="stage-1-preparation-of-input-data.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb43-3"><a href="stage-1-preparation-of-input-data.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb43-4"><a href="stage-1-preparation-of-input-data.html#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="stage-1-preparation-of-input-data.html#cb43-5" aria-hidden="true" tabindex="-1"></a>WD_AOI<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb43-6"><a href="stage-1-preparation-of-input-data.html#cb43-6" aria-hidden="true" tabindex="-1"></a>WD_SOC<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb43-7"><a href="stage-1-preparation-of-input-data.html#cb43-7" aria-hidden="true" tabindex="-1"></a>WD_CLAY<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CLAY&quot;</span>)</span>
<span id="cb43-8"><a href="stage-1-preparation-of-input-data.html#cb43-8" aria-hidden="true" tabindex="-1"></a>WD_CLIM<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb43-9"><a href="stage-1-preparation-of-input-data.html#cb43-9" aria-hidden="true" tabindex="-1"></a>WD_LU<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb43-10"><a href="stage-1-preparation-of-input-data.html#cb43-10" aria-hidden="true" tabindex="-1"></a>WD_COV<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/COV&quot;</span>)</span>
<span id="cb43-11"><a href="stage-1-preparation-of-input-data.html#cb43-11" aria-hidden="true" tabindex="-1"></a>WD_STACK<span class="ot">&lt;-</span>(<span class="st">&quot;C:/Training_Material/INPUTS/STACK&quot;</span>)</span>
<span id="cb43-12"><a href="stage-1-preparation-of-input-data.html#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb43-13"><a href="stage-1-preparation-of-input-data.html#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_AOI)</span>
<span id="cb43-14"><a href="stage-1-preparation-of-input-data.html#cb43-14" aria-hidden="true" tabindex="-1"></a>AOI<span class="ot">&lt;-</span><span class="fu">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb43-15"><a href="stage-1-preparation-of-input-data.html#cb43-15" aria-hidden="true" tabindex="-1"></a>Then, we will open the SOC layer and the clay layer.</span>
<span id="cb43-16"><a href="stage-1-preparation-of-input-data.html#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Open SOC MAP </span></span>
<span id="cb43-17"><a href="stage-1-preparation-of-input-data.html#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_SOC)</span>
<span id="cb43-18"><a href="stage-1-preparation-of-input-data.html#cb43-18" aria-hidden="true" tabindex="-1"></a>SOC_MAP_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb43-19"><a href="stage-1-preparation-of-input-data.html#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb43-20"><a href="stage-1-preparation-of-input-data.html#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLAY)</span>
<span id="cb43-21"><a href="stage-1-preparation-of-input-data.html#cb43-21" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb43-22"><a href="stage-1-preparation-of-input-data.html#cb43-22" aria-hidden="true" tabindex="-1"></a>Clay_WA_AOI_res<span class="ot">&lt;-</span><span class="fu">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="at">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb43-23"><a href="stage-1-preparation-of-input-data.html#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="stage-1-preparation-of-input-data.html#cb43-24" aria-hidden="true" tabindex="-1"></a>Then we will open the <span class="dv">2000-2020</span> average climate layers <span class="fu">created</span> (as the one created <span class="cf">in</span> script number <span class="dv">2</span>)</span>
<span id="cb43-25"><a href="stage-1-preparation-of-input-data.html#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Precipitation layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb43-26"><a href="stage-1-preparation-of-input-data.html#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_CLIM)</span>
<span id="cb43-27"><a href="stage-1-preparation-of-input-data.html#cb43-27" aria-hidden="true" tabindex="-1"></a>PREC<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Prec_Stack_01-18_CRU.tif&quot;</span>)</span>
<span id="cb43-28"><a href="stage-1-preparation-of-input-data.html#cb43-28" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(PREC,AOI)</span>
<span id="cb43-29"><a href="stage-1-preparation-of-input-data.html#cb43-29" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(PREC_AOI,SOC_MAP_AOI)</span>
<span id="cb43-30"><a href="stage-1-preparation-of-input-data.html#cb43-30" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(PREC_AOI,AOI)</span>
<span id="cb43-31"><a href="stage-1-preparation-of-input-data.html#cb43-31" aria-hidden="true" tabindex="-1"></a>PREC_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(PREC_AOI)</span>
<span id="cb43-32"><a href="stage-1-preparation-of-input-data.html#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Temperatures layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb43-33"><a href="stage-1-preparation-of-input-data.html#cb43-33" aria-hidden="true" tabindex="-1"></a>TEMP<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;Temp_Stack_01-18_CRU.tif&quot;</span>)</span>
<span id="cb43-34"><a href="stage-1-preparation-of-input-data.html#cb43-34" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(TEMP,AOI)</span>
<span id="cb43-35"><a href="stage-1-preparation-of-input-data.html#cb43-35" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(TEMP_AOI,SOC_MAP_AOI)</span>
<span id="cb43-36"><a href="stage-1-preparation-of-input-data.html#cb43-36" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(TEMP_AOI,AOI)</span>
<span id="cb43-37"><a href="stage-1-preparation-of-input-data.html#cb43-37" aria-hidden="true" tabindex="-1"></a>TEMP_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(TEMP_AOI)</span>
<span id="cb43-38"><a href="stage-1-preparation-of-input-data.html#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="co">#Open Potential Evapotranspiration layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb43-39"><a href="stage-1-preparation-of-input-data.html#cb43-39" aria-hidden="true" tabindex="-1"></a>PET<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;PET_Stack_01-18_CRU.tif&quot;</span>)</span>
<span id="cb43-40"><a href="stage-1-preparation-of-input-data.html#cb43-40" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">crop</span>(PET,AOI)</span>
<span id="cb43-41"><a href="stage-1-preparation-of-input-data.html#cb43-41" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">resample</span>(PET_AOI,SOC_MAP_AOI)</span>
<span id="cb43-42"><a href="stage-1-preparation-of-input-data.html#cb43-42" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">mask</span>(PET_AOI,AOI)</span>
<span id="cb43-43"><a href="stage-1-preparation-of-input-data.html#cb43-43" aria-hidden="true" tabindex="-1"></a>PET_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(PET_AOI)</span>
<span id="cb43-44"><a href="stage-1-preparation-of-input-data.html#cb43-44" aria-hidden="true" tabindex="-1"></a>Then, we will open the land use <span class="fu">layer</span> (latest available year) created <span class="cf">in</span> script number <span class="fl">10.</span></span>
<span id="cb43-45"><a href="stage-1-preparation-of-input-data.html#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_LU)</span>
<span id="cb43-46"><a href="stage-1-preparation-of-input-data.html#cb43-46" aria-hidden="true" tabindex="-1"></a>LU_AOI<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span>
<span id="cb43-47"><a href="stage-1-preparation-of-input-data.html#cb43-47" aria-hidden="true" tabindex="-1"></a>Then, we will open the vegetation cover layer created <span class="cf">in</span> script number <span class="fl">7.</span></span>
<span id="cb43-48"><a href="stage-1-preparation-of-input-data.html#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Vegetation Cover </span></span>
<span id="cb43-49"><a href="stage-1-preparation-of-input-data.html#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_COV)</span>
<span id="cb43-50"><a href="stage-1-preparation-of-input-data.html#cb43-50" aria-hidden="true" tabindex="-1"></a>Cov_AOI<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span>
<span id="cb43-51"><a href="stage-1-preparation-of-input-data.html#cb43-51" aria-hidden="true" tabindex="-1"></a>As <span class="cf">in</span> the previous scripts, this script creates a DR <span class="fu">layer</span> (DPM<span class="sc">/</span>RPM ratio), assigning default DPM<span class="sc">/</span>RPM ratios to each FAO land cover <span class="fu">class</span> (See Table <span class="fl">9.13</span>). Users can modify these ratios according to local expertise and available local information. </span>
<span id="cb43-52"><a href="stage-1-preparation-of-input-data.html#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Land use layer and convert it to DR layer (mod 12 , 14 classes)</span></span>
<span id="cb43-53"><a href="stage-1-preparation-of-input-data.html#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="co">#DPM/RPM (decomplosable vs resistant plant material...como se divide los C inputs)</span></span>
<span id="cb43-54"><a href="stage-1-preparation-of-input-data.html#cb43-54" aria-hidden="true" tabindex="-1"></a><span class="co">#(1) Most agricultural crops and improved grassland or tree crops 1.44 </span></span>
<span id="cb43-55"><a href="stage-1-preparation-of-input-data.html#cb43-55" aria-hidden="true" tabindex="-1"></a><span class="co">#(2) Unimproved grassland and schrub 0.67</span></span>
<span id="cb43-56"><a href="stage-1-preparation-of-input-data.html#cb43-56" aria-hidden="true" tabindex="-1"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb43-57"><a href="stage-1-preparation-of-input-data.html#cb43-57" aria-hidden="true" tabindex="-1"></a>DR<span class="ot">&lt;-</span>(LU_AOI<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">12</span><span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">13</span>)<span class="sc">*</span><span class="fl">1.44</span><span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">4</span>)<span class="sc">*</span><span class="fl">0.25</span> <span class="sc">+</span> (LU_AOI<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">5</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">6</span> <span class="sc">|</span> LU_AOI<span class="sc">==</span><span class="dv">8</span>)<span class="sc">*</span><span class="fl">0.67</span></span></code></pre></div>
<p>We will create a stack for the forward modelling phase. We will have to define the filename and save the output stack.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="stage-1-preparation-of-input-data.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># STACK all layers</span></span>
<span id="cb44-2"><a href="stage-1-preparation-of-input-data.html#cb44-2" aria-hidden="true" tabindex="-1"></a>Stack_Set_AR<span class="ot">&lt;-</span><span class="fu">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,TEMP_AOI,PREC_AOI,PET_AOI,DR,LU_AOI,Cov_AOI)</span>
<span id="cb44-3"><a href="stage-1-preparation-of-input-data.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(WD_STACK)</span>
<span id="cb44-4"><a href="stage-1-preparation-of-input-data.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(Stack_Set_AR,<span class="at">filename=</span>(<span class="st">&quot;Stack_Set_FOWARD.tif&quot;</span>),<span class="at">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="defining-target-points-to-run-the-model" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Defining target points to run the model</h2>
<p>At this point we have three raster stacks for the different modelling phases. We need to create the points where those simulations will be run in order to accelerate the modelling process. These points will be the center of the pixels of the master layer (GSOCmap layer, script number 7). Later, we will convert the points containing the modelling output values back to a raster layer format.</p>
<div id="qgis-procedure-number-1-model" class="section level3" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> QGIS Procedure number 1 (model)</h3>
<p>We will need the land use data of each pixel (we already corregistered the land use layer with the master layer at script number 7). Then we will use the land use layer of the country to generate the points. For this, we can use a QGIS model to create target points.</p>
<p><strong>Table 9.13</strong> <em>QGis procedure number 1. Create target points to run the model. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.12.png" /></p>
<p>We will open the Qgis, then go to the processing toolbox and click on the “open existing model” button. We will have to search for the model in the provided folder, called “4_Points_country”. We will have to load the model called “Qgis_Procedure_number_1.model3”. Once this is done, we can run the model from the processing toolbox.</p>
<div class="figure">
<img src="images/Figure_9.4.png" alt="" />
<p class="caption"><strong>Figure 9.4</strong> <em>Processing toolbox in Qgis</em></p>
</div>
<p>We will click the Empty_Points button and a window will pop up. We will select the Land use layer created in script number 10 (already resampled to match the extent and pixel size of the GSOCmap), set the path and the name of the output file, and click on the Execute button.</p>
<div class="figure">
<img src="images/Figure_9.5.png" alt="" />
<p class="caption"><strong>Figure 9.5</strong> <em>Qgis Window to edit the points generated.</em></p>
</div>
<p>This process will create vector points. Each point will be created in the centroid of each pixel of the land use layer. This vector will contain no fields. The scripts to run the model for each phase (SPIN_UP, WARM_UP, forward) will attach all the necessary data from the stacks (scripts number 10, 11 and 12) to each point.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="running-the-scripts-overview.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stage-2-running-the-model-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/FAO-GSP/SOC-Mapping-Cookbook/edit/master/09.Stage1_Preparation_of_input_data.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SOCMapping.pdf", "SOCMapping.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
