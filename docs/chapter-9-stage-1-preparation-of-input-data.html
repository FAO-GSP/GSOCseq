<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Chapter 9| Stage 1: preparation of input data | GSOCseq - Global Soil Organic Carbon Sequestration Potential Map Technical Manual</title>
  <meta name="description" content="The GSOCseq Technical Manual" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Chapter 9| Stage 1: preparation of input data | GSOCseq - Global Soil Organic Carbon Sequestration Potential Map Technical Manual" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="The GSOCseq Technical Manual" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Chapter 9| Stage 1: preparation of input data | GSOCseq - Global Soil Organic Carbon Sequestration Potential Map Technical Manual" />
  
  <meta name="twitter:description" content="The GSOCseq Technical Manual" />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Food and Agriculture Organization of the United Nations, Rome, 2020" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-8-running-the-scripts-overview.html"/>
<link rel="next" href="chapter-10-stage-2-running-the-model.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>List of contributors</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributers-and-reviewers"><i class="fa fa-check"></i>Contributers and Reviewers</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#special-advisor"><i class="fa fa-check"></i>Special Advisor</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="chapter-1-presentation.html"><a href="chapter-1-presentation.html"><i class="fa fa-check"></i><b>1</b> Chapter 1| Presentation</a><ul>
<li class="chapter" data-level="1.1" data-path="chapter-1-presentation.html"><a href="chapter-1-presentation.html#how-to-use-this-book"><i class="fa fa-check"></i><b>1.1</b> 1.1 How to use this book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-2-soil-organic-carbon-soc-sequestration.html"><a href="chapter-2-soil-organic-carbon-soc-sequestration.html"><i class="fa fa-check"></i><b>2</b> Chapter 2| Soil Organic Carbon (SOC) sequestration</a><ul>
<li class="chapter" data-level="2.1" data-path="chapter-2-soil-organic-carbon-soc-sequestration.html"><a href="chapter-2-soil-organic-carbon-soc-sequestration.html#soil-carbon"><i class="fa fa-check"></i><b>2.1</b> 2.1 Soil carbon</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-2-soil-organic-carbon-soc-sequestration.html"><a href="chapter-2-soil-organic-carbon-soc-sequestration.html#soc-sequestration"><i class="fa fa-check"></i><b>2.2</b> 2.2 SOC sequestration</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-2-soil-organic-carbon-soc-sequestration.html"><a href="chapter-2-soil-organic-carbon-soc-sequestration.html#factors-affecting-soc-sequestration"><i class="fa fa-check"></i><b>2.3</b> 2.3 Factors affecting SOC sequestration</a></li>
<li class="chapter" data-level="2.4" data-path="chapter-2-soil-organic-carbon-soc-sequestration.html"><a href="chapter-2-soil-organic-carbon-soc-sequestration.html#estimating-soc-sequestration-potential"><i class="fa fa-check"></i><b>2.4</b> 2.4 Estimating SOC sequestration potential</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-3-soc-modelling.html"><a href="chapter-3-soc-modelling.html"><i class="fa fa-check"></i><b>3</b> Chapter 3| SOC Modelling</a><ul>
<li class="chapter" data-level="3.1" data-path="chapter-3-soc-modelling.html"><a href="chapter-3-soc-modelling.html#process-oriented-models"><i class="fa fa-check"></i><b>3.1</b> 3.1 Process-oriented models</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-3-soc-modelling.html"><a href="chapter-3-soc-modelling.html#examples-of-process-oriented-models"><i class="fa fa-check"></i><b>3.2</b> 3.2 Examples of process-oriented models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-4-the-rothc-model.html"><a href="chapter-4-the-rothc-model.html"><i class="fa fa-check"></i><b>4</b> Chapter 4| The RothC model</a><ul>
<li class="chapter" data-level="4.1" data-path="chapter-4-the-rothc-model.html"><a href="chapter-4-the-rothc-model.html#model-description"><i class="fa fa-check"></i><b>4.1</b> 4.1 Model description</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-4-the-rothc-model.html"><a href="chapter-4-the-rothc-model.html#rothc-general-data-requirements"><i class="fa fa-check"></i><b>4.2</b> 4.2 RothC general data requirements</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-5-modelling-approach-for-the-gsocseq.html"><a href="chapter-5-modelling-approach-for-the-gsocseq.html"><i class="fa fa-check"></i><b>5</b> Chapter 5| Modelling approach for the GSOCseq</a><ul>
<li class="chapter" data-level="5.1" data-path="chapter-5-modelling-approach-for-the-gsocseq.html"><a href="chapter-5-modelling-approach-for-the-gsocseq.html#general-framework"><i class="fa fa-check"></i><b>5.1</b> 5.1 General framework</a></li>
<li class="chapter" data-level="5.2" data-path="chapter-5-modelling-approach-for-the-gsocseq.html"><a href="chapter-5-modelling-approach-for-the-gsocseq.html#potential-soc-sequestration-estimates-after-the-implementation-of-ssm-practices"><i class="fa fa-check"></i><b>5.2</b> 5.2 Potential SOC sequestration estimates after the implementation of SSM practices</a></li>
<li class="chapter" data-level="5.3" data-path="chapter-5-modelling-approach-for-the-gsocseq.html"><a href="chapter-5-modelling-approach-for-the-gsocseq.html#business-as-usual-and-sustainable-soil-management-scenarios"><i class="fa fa-check"></i><b>5.3</b> 5.3 Business as usual and sustainable soil management scenarios</a></li>
<li class="chapter" data-level="5.4" data-path="chapter-5-modelling-approach-for-the-gsocseq.html"><a href="chapter-5-modelling-approach-for-the-gsocseq.html#general-modeling-procedures"><i class="fa fa-check"></i><b>5.4</b> 5.4 General modeling procedures</a><ul>
<li class="chapter" data-level="5.4.1" data-path="chapter-5-modelling-approach-for-the-gsocseq.html"><a href="chapter-5-modelling-approach-for-the-gsocseq.html#initialization-long-spin-up"><i class="fa fa-check"></i><b>5.4.1</b> 5.4.1 Initialization: Long spin-up</a></li>
<li class="chapter" data-level="5.4.2" data-path="chapter-5-modelling-approach-for-the-gsocseq.html"><a href="chapter-5-modelling-approach-for-the-gsocseq.html#short-spin-up"><i class="fa fa-check"></i><b>5.4.2</b> 5.4.2 Short spin-up</a></li>
<li class="chapter" data-level="5.4.3" data-path="chapter-5-modelling-approach-for-the-gsocseq.html"><a href="chapter-5-modelling-approach-for-the-gsocseq.html#forward-runs"><i class="fa fa-check"></i><b>5.4.3</b> 5.4.2 Forward runs</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="chapter-5-modelling-approach-for-the-gsocseq.html"><a href="chapter-5-modelling-approach-for-the-gsocseq.html#summary"><i class="fa fa-check"></i><b>5.5</b> 5.5 Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html"><i class="fa fa-check"></i><b>6</b> Chapter 6| Datasets and inputs</a><ul>
<li class="chapter" data-level="6.1" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#climate-datasets"><i class="fa fa-check"></i><b>6.1</b> 6.1 Climate datasets</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#soil-datasets"><i class="fa fa-check"></i><b>6.2</b> 6.2 Soil datasets</a><ul>
<li class="chapter" data-level="6.2.1" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#initial-total-soc-stocks"><i class="fa fa-check"></i><b>6.2.1</b> 6.2.1 Initial total SOC stocks</a></li>
<li class="chapter" data-level="6.2.2" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#initial-c-pools"><i class="fa fa-check"></i><b>6.2.2</b> 6.2.2 Initial C pools</a></li>
<li class="chapter" data-level="6.2.3" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#soil-texture-clay-content"><i class="fa fa-check"></i><b>6.2.3</b> 6.2.3 Soil texture: clay content</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#land-cover-datasets"><i class="fa fa-check"></i><b>6.3</b> 6.3 Land cover datasets</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#monthly-vegetation-cover"><i class="fa fa-check"></i><b>6.4</b> 6.4 Monthly vegetation cover</a></li>
<li class="chapter" data-level="6.5" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#monthly-carbon-inputs"><i class="fa fa-check"></i><b>6.5</b> 6.5 Monthly carbon inputs:</a><ul>
<li class="chapter" data-level="6.5.1" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#c-inputs-under-bau-practices"><i class="fa fa-check"></i><b>6.5.1</b> 6.5.1 C inputs under BAU practices:</a></li>
<li class="chapter" data-level="6.5.2" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#c-inputs-under-ssm-practices"><i class="fa fa-check"></i><b>6.5.2</b> 6.5.2 C inputs under SSM practices:</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#residue-decomposability-decomposable-to-resistant-plant-material-ratio-dpmrpm"><i class="fa fa-check"></i><b>6.6</b> 6.6 Residue decomposability: decomposable to resistant plant material ratio (DPM/RPM)</a></li>
<li class="chapter" data-level="6.7" data-path="chapter-6-datasets-and-inputs.html"><a href="chapter-6-datasets-and-inputs.html#required-datasets-and-global-data-sources.-summary"><i class="fa fa-check"></i><b>6.7</b> 6.7 Required datasets and global data sources. Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-7-software-environment.html"><a href="chapter-7-software-environment.html"><i class="fa fa-check"></i><b>7</b> Chapter 7| Software environment</a><ul>
<li class="chapter" data-level="7.1" data-path="chapter-7-software-environment.html"><a href="chapter-7-software-environment.html#setting-up-the-software-environment-r-rstudio-and-r-packages"><i class="fa fa-check"></i><b>7.1</b> 7.1 Setting up the software environment: R, RStudio and R Packages</a><ul>
<li class="chapter" data-level="7.1.1" data-path="chapter-7-software-environment.html"><a href="chapter-7-software-environment.html#obtaining-and-installing-r"><i class="fa fa-check"></i><b>7.1.1</b> 7.1.1 Obtaining and installing R</a></li>
<li class="chapter" data-level="7.1.2" data-path="chapter-7-software-environment.html"><a href="chapter-7-software-environment.html#obtaining-and-installing-rstudio"><i class="fa fa-check"></i><b>7.1.2</b> 7.1.2 Obtaining and installing RStudio</a></li>
<li class="chapter" data-level="7.1.3" data-path="chapter-7-software-environment.html"><a href="chapter-7-software-environment.html#getting-started-with-r"><i class="fa fa-check"></i><b>7.1.3</b> 7.1.3 Getting started with R</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="chapter-7-software-environment.html"><a href="chapter-7-software-environment.html#r-packages"><i class="fa fa-check"></i><b>7.2</b> 7.2 R packages</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-7-software-environment.html"><a href="chapter-7-software-environment.html#finding-r-packages"><i class="fa fa-check"></i><b>7.2.1</b> 7.2.1 Finding R packages</a></li>
<li class="chapter" data-level="7.2.2" data-path="chapter-7-software-environment.html"><a href="chapter-7-software-environment.html#some-useful-r-packages-for-the-socseq-maps"><i class="fa fa-check"></i><b>7.2.2</b> 7.2.2 Some useful R-packages for the SOCseq maps</a></li>
<li class="chapter" data-level="7.2.3" data-path="chapter-7-software-environment.html"><a href="chapter-7-software-environment.html#installation-of-r-packages-used-in-this-technical-manual"><i class="fa fa-check"></i><b>7.2.3</b> 7.2.3 Installation of R-Packages used in this technical manual</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-7-software-environment.html"><a href="chapter-7-software-environment.html#considerations-when-using-r"><i class="fa fa-check"></i><b>7.3</b> 7.3 Considerations when using R</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-8-running-the-scripts-overview.html"><a href="chapter-8-running-the-scripts-overview.html"><i class="fa fa-check"></i><b>8</b> Chapter 8| Running the scripts: overview</a><ul>
<li class="chapter" data-level="8.1" data-path="chapter-8-running-the-scripts-overview.html"><a href="chapter-8-running-the-scripts-overview.html#stage-1-preparation-of-data"><i class="fa fa-check"></i><b>8.1</b> 8.2 Stage 1: Preparation of data</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-8-running-the-scripts-overview.html"><a href="chapter-8-running-the-scripts-overview.html#stage-2-running-the-model"><i class="fa fa-check"></i><b>8.2</b> 8.3. Stage 2: Running the model</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-8-running-the-scripts-overview.html"><a href="chapter-8-running-the-scripts-overview.html#stage-3-map-generation"><i class="fa fa-check"></i><b>8.3</b> 8.4. Stage 3: Map generation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html"><i class="fa fa-check"></i><b>9</b> Chapter 9| Stage 1: preparation of input data</a><ul>
<li class="chapter" data-level="9.1" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#preparation-of-soc-layer"><i class="fa fa-check"></i><b>9.1</b> 9.1 Preparation of SOC layer</a><ul>
<li class="chapter" data-level="9.1.1" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-0.soc_map_aoi.r"><i class="fa fa-check"></i><b>9.1.1</b> 9.1.1 Script Number 0.“SOC_MAP_AOI.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#preparation-of-climate-layers"><i class="fa fa-check"></i><b>9.2</b> 9.2 Preparation of climate Layers</a><ul>
<li class="chapter" data-level="9.2.1" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-1.cru_variables_spin_up.r"><i class="fa fa-check"></i><b>9.2.1</b> 9.2.1 Script Number 1.“CRU_variables_SPIN_UP.R”</a></li>
<li class="chapter" data-level="9.2.2" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-2.-cru_variables_warm_up.r"><i class="fa fa-check"></i><b>9.2.2</b> 9.2.2 Script Number 2. “CRU_variables_WARM_UP.R”</a></li>
<li class="chapter" data-level="9.2.3" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-3.-preparation-of-cru-files-to-estimate-npp-1981-2000"><i class="fa fa-check"></i><b>9.2.3</b> 9.3.1 Script Number 3. Preparation of CRU files to estimate NPP 1981-2000</a></li>
<li class="chapter" data-level="9.2.4" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-5.-miami-model-npp-mean-1981-2000"><i class="fa fa-check"></i><b>9.2.4</b> 9.3.2 Script Number 5. MIAMI model NPP mean 1981-2000</a></li>
<li class="chapter" data-level="9.2.5" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-6.-monthly_vegetation_cover-vegetation-cover-from-google-earth-engine."><i class="fa fa-check"></i><b>9.2.5</b> 9.4.1 Script Number 6. “Monthly_vegetation_cover” vegetation cover from Google Earth Engine.</a></li>
<li class="chapter" data-level="9.2.6" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-7.-vegetation_cover_stack.r"><i class="fa fa-check"></i><b>9.2.6</b> 9.4.2 Script Number 7. “Vegetation_Cover_stack.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#preparing-the-land-use-layer"><i class="fa fa-check"></i><b>9.3</b> 9.6 Preparing the land use layer</a><ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-9-land_use_esa_to_fao_classes.r"><i class="fa fa-check"></i><b>9.3.1</b> 9.6.1 Script Number 9 “Land_Use_ESA_to_FAO_classes.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#harmonization-of-soil-climate-and-vegetation-layers."><i class="fa fa-check"></i><b>9.4</b> 9.7 Harmonization of soil, climate and vegetation layers.</a><ul>
<li class="chapter" data-level="9.4.1" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-10.-spin_up_stack.v3.r"><i class="fa fa-check"></i><b>9.4.1</b> 9.7.1 Script Number 10. “SPIN_UP_STACK.v3.R”</a></li>
<li class="chapter" data-level="9.4.2" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-11.-warm_up_stack_v5.r"><i class="fa fa-check"></i><b>9.4.2</b> 9.7.2 Script Number 11. “WARM_UP_STACK_V5.R”</a></li>
<li class="chapter" data-level="9.4.3" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#script-number-12.-forward_stack.r"><i class="fa fa-check"></i><b>9.4.3</b> 9.7.3 Script Number 12. “FORWARD_STACK.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#defining-target-points-to-run-the-model"><i class="fa fa-check"></i><b>9.5</b> 9.8 Defining target points to run the model</a><ul>
<li class="chapter" data-level="9.5.1" data-path="chapter-9-stage-1-preparation-of-input-data.html"><a href="chapter-9-stage-1-preparation-of-input-data.html#qgis-procedure-number-1-model"><i class="fa fa-check"></i><b>9.5.1</b> 9.8.1 QGIS Procedure number 1 (model)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-10-stage-2-running-the-model.html"><a href="chapter-10-stage-2-running-the-model.html"><i class="fa fa-check"></i><b>10</b> Chapter 10| Stage 2: running the model</a><ul>
<li class="chapter" data-level="10.1" data-path="chapter-10-stage-2-running-the-model.html"><a href="chapter-10-stage-2-running-the-model.html#script-number-13.-roth_c_spin_up_v2.r"><i class="fa fa-check"></i><b>10.1</b> 10.1 Script Number 13. “ROTH_C_SPIN_UP_v2.R”</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-10-stage-2-running-the-model.html"><a href="chapter-10-stage-2-running-the-model.html#script-number-14.-roth_c_warm_up_v4.r"><i class="fa fa-check"></i><b>10.2</b> 10.2 Script Number 14. “ROTH_C_WARM_UP_v4.R”</a><ul>
<li class="chapter" data-level="10.2.1" data-path="chapter-10-stage-2-running-the-model.html"><a href="chapter-10-stage-2-running-the-model.html#script-number-15.-roth_c_forward_v2.r"><i class="fa fa-check"></i><b>10.2.1</b> 10.3 Script Number 15. “ROTH_C_forward_v2.R”</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter-11-stage-3-map-generation.html"><a href="chapter-11-stage-3-map-generation.html"><i class="fa fa-check"></i><b>11</b> Chapter 11| Stage 3: map generation</a><ul>
<li class="chapter" data-level="11.1" data-path="chapter-11-stage-3-map-generation.html"><a href="chapter-11-stage-3-map-generation.html#script-number-16-points_to_raster.r"><i class="fa fa-check"></i><b>11.1</b> 11.1 Script Number 16: “Points_to_Raster.R”</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="chapter-12-uncertainty-and-validation.html"><a href="chapter-12-uncertainty-and-validation.html"><i class="fa fa-check"></i><b>12</b> Chapter 12| Uncertainty and validation</a></li>
<li class="chapter" data-level="13" data-path="chapter-13-data-sharing.html"><a href="chapter-13-data-sharing.html"><i class="fa fa-check"></i><b>13</b> Chapter 13| Data sharing</a><ul>
<li class="chapter" data-level="13.1" data-path="chapter-13-data-sharing.html"><a href="chapter-13-data-sharing.html#general-principles"><i class="fa fa-check"></i><b>13.1</b> 13.1 General principles</a></li>
<li class="chapter" data-level="13.2" data-path="chapter-13-data-sharing.html"><a href="chapter-13-data-sharing.html#data-formats-and-integrity"><i class="fa fa-check"></i><b>13.2</b> 13.2 Data formats and integrity</a></li>
<li class="chapter" data-level="13.3" data-path="chapter-13-data-sharing.html"><a href="chapter-13-data-sharing.html#data-correctness"><i class="fa fa-check"></i><b>13.3</b> 13.3 Data correctness</a></li>
<li class="chapter" data-level="13.4" data-path="chapter-13-data-sharing.html"><a href="chapter-13-data-sharing.html#data-completeness"><i class="fa fa-check"></i><b>13.4</b> 13.4 Data completeness</a></li>
<li class="chapter" data-level="13.5" data-path="chapter-13-data-sharing.html"><a href="chapter-13-data-sharing.html#other-modes-of-data-sharing"><i class="fa fa-check"></i><b>13.5</b> 13.5 Other modes of data sharing</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="chapter-14-limitations-knowledge-gaps-and-way-forward.html"><a href="chapter-14-limitations-knowledge-gaps-and-way-forward.html"><i class="fa fa-check"></i><b>14</b> Chapter 14| Limitations, knowledge gaps and way forward</a></li>
<li class="chapter" data-level="15" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>15</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GSOCseq - Global Soil Organic Carbon Sequestration Potential Map Technical Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-9-stage-1-preparation-of-input-data" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Chapter 9| Stage 1: preparation of input data</h1>
<p>This stage is aimed at:</p>
<ul>
<li>preparing, organizing and harmonizing all the required input data layers to run the model in the different phases;</li>
<li>creating supplementary input data layers;</li>
<li>creating target points for land use classes of interests.</li>
</ul>
<p>During this stage we will need to arrange and prepare climate datasets for the different modelling phases, generate NPP estimates for each phase, generate vegetation cover data, prepare clay content data layers, and harmonize and stack all layers for each modelling phase. Finally, we will have to create target points to run the model. This stage requires the most effort and is the most time consuming of the entire process. Eleven R scripts, one QGIS script and one Google earth engine script are provided to complete these tasks.</p>
<div id="preparation-of-soc-layer" class="section level2">
<h2><span class="header-section-number">9.1</span> 9.1 Preparation of SOC layer</h2>
<p>As a default option, users are invited to use the GSOCmap to retrieve their SOC data for their area of interest (AOI). This can be achieved easily, by clipping the GSOCmap to the extent of a shapefile making up the borders of the chosen study area or country.</p>
<div id="script-number-0.soc_map_aoi.r" class="section level3">
<h3><span class="header-section-number">9.1.1</span> 9.1.1 Script Number 0.“SOC_MAP_AOI.R”</h3>
<p><img src="tables/Table_9.0.png" /></p>
<p>First, open the scrip SOC_MAP_AOI.R in RStudio. Then create two user-defined variables containing the paths to the two working directories:
* “WD_AOI” which contains the vector polygon of the AOI;
* “WD_GSOC”, which contains the GSOCmap raster layer</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-1"></a><span class="co"># Set the path to GSOCmap and Area of interest (AOI) vector.</span></span>
<span id="cb3-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-2"></a><span class="kw">library</span>(raster)</span>
<span id="cb3-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-3"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb3-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-4"></a>WD_AOI&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb3-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-5"></a>WD_GSOC&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb3-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-6"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb3-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-7"></a><span class="kw">setwd</span>(WD_AOI)</span>
<span id="cb3-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-8"></a>AOI&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb3-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-9"></a><span class="co">#Open FAO GSOC MAP </span></span>
<span id="cb3-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-10"></a><span class="kw">setwd</span>(WD_GSOC)</span>
<span id="cb3-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb3-11"></a>SOC_MAP&lt;-<span class="kw">raster</span>(<span class="st">&quot;GSOCmap_1.6.1.tif&quot;</span>)</span></code></pre></div>
<p>Finally, we clip the SOC layer with the vector polygon of the AOI and save the result to the WD_SOC folder. This layer will become the master layer of the process.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb4-1"></a>SOC_MAP_AOI&lt;-<span class="kw">crop</span>(SOC_MAP,AOI)</span>
<span id="cb4-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb4-2"></a>SOC_MAP_AOI&lt;-<span class="kw">mask</span>(SOC_MAP_AOI,AOI)</span>
<span id="cb4-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb4-3"></a><span class="kw">writeRaster</span>(SOC_MAP_AOI,<span class="dt">filename=</span><span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>,<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="preparation-of-climate-layers" class="section level2">
<h2><span class="header-section-number">9.2</span> 9.2 Preparation of climate Layers</h2>
<p>The climate variables needed for the three modeling phases are:
1. Monthly rainfall (mm/month);<br />
2. Monthly Evapotranspiration (mm/month);
3. Average monthly mean air temperature (average <span class="math inline">\(^\circ\)</span>C/month).</p>
<p>We will need to arrange these climatic variables into three datasets:</p>
<ul>
<li>1980-2000 (monthly average values for the complete series)</li>
<li>2001-2020 (year to year monthly values)</li>
<li>2001-2020 (monthly average values for the complete series)</li>
</ul>
<p>Gridded climate data shall be obtained from either National Sources or regional or global datasets when national gridded historical climate datasets are not available. The recommended global data source of these layers is the one provided by the Climate Research Unit (<a href="http://www.cru.uea.ac.uk/" class="uri">http://www.cru.uea.ac.uk/</a>).
We will present two scripts to obtain the reformatted climate spatial layers to run the three modelling phases, using the CRU datasets. Users can prepare the necessary input climate datasets using other data sources. However, this script may still be helpful to guide the preparation process of other datasets, and as a guide of the required outputs that will be needed as inputs for the different modeling phases.</p>
<div id="script-number-1.cru_variables_spin_up.r" class="section level3">
<h3><span class="header-section-number">9.2.1</span> 9.2.1 Script Number 1.“CRU_variables_SPIN_UP.R”</h3>
<p>For each modelling phase we will need a different selection of climate layers. For phase 1 (“Long Spin up”), we will need to stack 12 spatial layers (the output file will be a multiband raster layer) for each climate variable mentioned above (temperature, precipitation and evapotranspiration). The time series for this initial phase goes from 1981 to 2000. The script number 1 will transform the downloaded CRU files to geotiff raster files and obtain monthly averages (temperature, precipitation, evapotranspiration) for the 1981-2000 series, ready to be used in the spin up modelling phase.</p>
<p><strong>Table 9.1</strong> <em>Script Number 1. Preparation of CRU datasets for the “Long Spin Up phase”. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.1.png" /></p>
<p>Open the script CRU_variables_SPIN_UP.R in RStudio.<br />
The first lines begin with “#”, which indicates that these lines are commented. From line 7 to line 10, the script loads the required packages into R.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb5-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb5-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb5-2"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb5-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb5-3"></a><span class="kw">library</span>(ncdf4)</span>
<span id="cb5-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb5-4"></a><span class="kw">library</span>(abind)</span></code></pre></div>
<p>From line 15 to line 48 the script opens two nc files (1981-1990 and 1991-2000 periods), from a local directory to be defined with the setwd function and converts them into an internal variable called “tmp”. Here we will have to set the path to the local directory of the two temperature files downloaded from the CRU site. Remember to unzip the CRU files.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-1"></a><span class="co">#Set working directory</span></span>
<span id="cb6-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-2"></a><span class="co">#Set working directory</span></span>
<span id="cb6-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-3"></a>WD&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb6-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-4"></a><span class="kw">setwd</span>(WD)</span>
<span id="cb6-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-5"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb6-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-6"></a><span class="co"># Open nc temperature file 1981-1990 unzip the cru files</span></span>
<span id="cb6-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-7"></a>nc_temp_<span class="dv">81</span>_<span class="dv">90</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.tmp.dat.nc&quot;</span>)</span>
<span id="cb6-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-8"></a>lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb6-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-9"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb6-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-10"></a>t_<span class="dv">81</span>_<span class="dv">90</span> &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb6-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-11"></a>tmp_<span class="dv">81</span>_<span class="dv">90</span>&lt;-<span class="kw">ncvar_get</span>(nc_temp_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb6-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-12"></a><span class="co">#close de nc temperature file</span></span>
<span id="cb6-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-13"></a><span class="kw">nc_close</span>(nc_temp_<span class="dv">81</span>_<span class="dv">90</span>) </span>
<span id="cb6-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-14"></a><span class="co"># Open nc temperature file 1991-2000</span></span>
<span id="cb6-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-15"></a>nc_temp_<span class="dv">91</span>_<span class="dv">00</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.tmp.dat.nc&quot;</span>)</span>
<span id="cb6-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-16"></a>lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb6-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-17"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb6-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-18"></a>t_<span class="dv">91</span>_<span class="dv">00</span> &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb6-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-19"></a>tmp_<span class="dv">91</span>_<span class="dv">00</span>&lt;-<span class="kw">ncvar_get</span>(nc_temp_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb6-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-20"></a><span class="co">#close de nc temperature file</span></span>
<span id="cb6-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-21"></a><span class="kw">nc_close</span>(nc_temp_<span class="dv">91</span>_<span class="dv">00</span>) </span>
<span id="cb6-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-22"></a><span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb6-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb6-23"></a>tmp&lt;-<span class="kw">abind</span>(tmp_<span class="dv">81</span>_<span class="dv">90</span>,tmp_<span class="dv">91</span>_<span class="dv">00</span>)</span></code></pre></div>
<p>Then the script generates a variable to be used later on called “tmp_Jan_1”:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb7-1"></a><span class="co"># Get one month temperature ( January)</span></span>
<span id="cb7-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb7-2"></a> tmp_Jan_<span class="dv">1</span>&lt;-tmp[,,<span class="dv">1</span>]</span>
<span id="cb7-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb7-3"></a> <span class="kw">dim</span>(tmp_Jan_<span class="dv">1</span>)</span></code></pre></div>
<p>Now, all the settings for this part of the script are done. The user just has to go on running the rest of the script until the “Precipitation” code begins where “Precipitation” files will be needed.
The code below will generate one temperature file, consisting of a stack of 12 raster files with an average of 20 years for each month. Each raster corresponds to a month.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-1"></a><span class="co"># Create empty list</span></span>
<span id="cb8-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-2"></a>r&lt;-<span class="kw">raster</span>(<span class="dt">ncol=</span><span class="dv">3</span>,<span class="dt">nrow=</span><span class="dv">3</span>)</span>
<span id="cb8-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-3"></a>Rlist&lt;-<span class="kw">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb8-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-4"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb8-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-5"></a><span class="co">######for loop starts#######</span></span>
<span id="cb8-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-6"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) { </span>
<span id="cb8-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-7"></a>var_sum&lt;-tmp_Jan_<span class="dv">1</span><span class="op">*</span><span class="dv">0</span></span>
<span id="cb8-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-8"></a>k&lt;-i</span>
<span id="cb8-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-9"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>) {</span>
<span id="cb8-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-10"></a><span class="kw">print</span>(k)</span>
<span id="cb8-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-11"></a>var_sum&lt;-(var_sum <span class="op">+</span><span class="st"> </span>tmp[,,k])</span>
<span id="cb8-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-12"></a> k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb8-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-13"></a> }</span>
<span id="cb8-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-14"></a><span class="co">#Save each month average. </span></span>
<span id="cb8-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-15"></a> var_avg&lt;-var_sum<span class="op">/</span><span class="dv">20</span></span>
<span id="cb8-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-16"></a>name&lt;-<span class="kw">paste0</span>(<span class="st">&#39;Temp_1981_2000_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb8-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-17"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb8-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-18"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var_avg), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb8-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-19"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb8-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-20"></a><span class="kw">writeRaster</span>(ra,<span class="dt">filename=</span>name, <span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb8-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-21"></a>Rlist[[i]]&lt;-ra</span>
<span id="cb8-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-22"></a>}</span>
<span id="cb8-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-23"></a><span class="co">######for loop ends#######</span></span>
<span id="cb8-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-24"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb8-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-25"></a> Temp_Stack&lt;-<span class="kw">stack</span>(Rlist)</span>
<span id="cb8-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb8-26"></a><span class="kw">writeRaster</span>(Temp_Stack,<span class="dt">filename=</span><span class="st">&#39;Temp_Stack_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>The first line of the “Precipitation” code block will delete all the variables that have been created until that moment. This will free up memory and increase the execution speed of the rest of the script running.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb9-1"></a> <span class="co">#######################################################################################</span></span>
<span id="cb9-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb9-2"></a><span class="co">#PRECIPITATION</span></span>
<span id="cb9-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb9-3"></a> <span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb9-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb9-4"></a>WD&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb9-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb9-5"></a><span class="kw">setwd</span>(WD)</span></code></pre></div>
<p>From line 106 to line 144, the script operates in the same way as for the initial “Temperature” code block. We must define the path to the CRU precipitation files and run the rest of the code:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-1"></a> <span class="co"># Open nc precipitation file 1981-1990</span></span>
<span id="cb10-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-2"></a>nc_pre_<span class="dv">81</span>_<span class="dv">90</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.pre.dat.nc&quot;</span>)</span>
<span id="cb10-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-3"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb10-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-4"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb10-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-5"></a>t &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb10-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-6"></a> pre_<span class="dv">81</span>_<span class="dv">90</span>&lt;-<span class="kw">ncvar_get</span>(nc_pre_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb10-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-7"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb10-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-8"></a> <span class="kw">nc_close</span>(nc_pre_<span class="dv">81</span>_<span class="dv">90</span>) </span>
<span id="cb10-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-9"></a><span class="co"># Open nc precipitation file 1991-2000</span></span>
<span id="cb10-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-10"></a>nc_pre_<span class="dv">91</span>_<span class="dv">00</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.pre.dat.nc&quot;</span>)</span>
<span id="cb10-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-11"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb10-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-12"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb10-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-13"></a>t &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb10-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-14"></a> pre_<span class="dv">91</span>_<span class="dv">00</span>&lt;-<span class="kw">ncvar_get</span>(nc_pre_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb10-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-15"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb10-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-16"></a> <span class="kw">nc_close</span>(nc_pre_<span class="dv">91</span>_<span class="dv">00</span>) </span>
<span id="cb10-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-17"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb10-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-18"></a> pre_<span class="dv">81</span>_<span class="dv">00</span>&lt;-<span class="kw">abind</span>(pre_<span class="dv">81</span>_<span class="dv">90</span>,pre_<span class="dv">91</span>_<span class="dv">00</span>)</span>
<span id="cb10-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-19"></a><span class="co"># Have one month Precipitation ( January)</span></span>
<span id="cb10-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-20"></a> pre_Jan_<span class="dv">1</span>&lt;-pre_<span class="dv">81</span>_<span class="dv">00</span>[,,<span class="dv">1</span>]</span>
<span id="cb10-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb10-21"></a> <span class="kw">dim</span>(pre_Jan_<span class="dv">1</span>)</span></code></pre></div>
<p>The following code block is very similar to the one used to create the temperature files, but instead of creating an annual average, the script saves the average of the monthly sum.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-1"></a> <span class="co"># Create empty list</span></span>
<span id="cb11-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-2"></a>r&lt;-<span class="kw">raster</span>(<span class="dt">ncol=</span><span class="dv">3</span>,<span class="dt">nrow=</span><span class="dv">3</span>)</span>
<span id="cb11-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-3"></a>Rlist&lt;-<span class="kw">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb11-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-4"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb11-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-5"></a><span class="co">######for loop starts#######</span></span>
<span id="cb11-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-6"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) { </span>
<span id="cb11-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-7"></a>var_sum&lt;-pre_Jan_<span class="dv">1</span><span class="op">*</span><span class="dv">0</span></span>
<span id="cb11-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-8"></a>k&lt;-i</span>
<span id="cb11-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-9"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>) {</span>
<span id="cb11-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-10"></a><span class="kw">print</span>(k)</span>
<span id="cb11-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-11"></a>var_sum&lt;-(var_sum <span class="op">+</span><span class="st"> </span>pre_<span class="dv">81</span>_<span class="dv">00</span>[,,k])</span>
<span id="cb11-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-12"></a> k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb11-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-13"></a> }</span>
<span id="cb11-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-14"></a><span class="co">#Save each month average. </span></span>
<span id="cb11-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-15"></a> var_avg&lt;-var_sum<span class="op">/</span><span class="dv">20</span></span>
<span id="cb11-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-16"></a>name&lt;-<span class="kw">paste0</span>(<span class="st">&#39;Prec_1981_2000_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb11-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-17"></a> <span class="co"># Make a raster r from the each average</span></span>
<span id="cb11-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-18"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var_avg), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb11-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-19"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb11-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-20"></a><span class="kw">writeRaster</span>(ra,<span class="dt">filename=</span>name, <span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb11-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-21"></a>Rlist[[i]]&lt;-ra</span>
<span id="cb11-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-22"></a>}</span>
<span id="cb11-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-23"></a><span class="co">######for loop ends#######</span></span>
<span id="cb11-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-24"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb11-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-25"></a>Prec_Stack&lt;-<span class="kw">stack</span>(Rlist)</span>
<span id="cb11-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb11-26"></a><span class="kw">writeRaster</span>(Prec_Stack,<span class="dt">filename=</span><span class="st">&#39;Prec_Stack_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>Finally, we must run the “Potential Evapotranspiration” block of the script. First, as we did before, we should delete the variables created in the “Precipitation” code block.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-1"></a><span class="co">########################################################################</span></span>
<span id="cb12-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-2"></a><span class="co"># POTENTIAL EVAPOTRANSPIRATION </span></span>
<span id="cb12-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-3"></a> <span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb12-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-4"></a>WD&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb12-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-5"></a><span class="kw">setwd</span>(WD)</span>
<span id="cb12-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-6"></a>The same commands are repeated as the ones executed <span class="cf">for</span> the previous code blocks<span class="op">:</span><span class="st"> &quot;Temperature&quot;</span> and <span class="st">&quot;Precipitation&quot;</span>. </span>
<span id="cb12-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-7"></a><span class="co"># Open nc temperature file 81 - 90</span></span>
<span id="cb12-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-8"></a>nc_pet_<span class="dv">81</span>_<span class="dv">90</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.pet.dat.nc&quot;</span>)</span>
<span id="cb12-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-9"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb12-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-10"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb12-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-11"></a>t &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb12-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-12"></a> pet_<span class="dv">81</span>_<span class="dv">90</span>&lt;-<span class="kw">ncvar_get</span>(nc_pet_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb12-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-13"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb12-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-14"></a> <span class="kw">nc_close</span>(nc_pet_<span class="dv">81</span>_<span class="dv">90</span>) </span>
<span id="cb12-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-15"></a> <span class="co"># Open nc temperature file 91 - 00</span></span>
<span id="cb12-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-16"></a> nc_pet_<span class="dv">91</span>_<span class="dv">00</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.pet.dat.nc&quot;</span>)</span>
<span id="cb12-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-17"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb12-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-18"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb12-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-19"></a>t &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb12-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-20"></a> pet_<span class="dv">91</span>_<span class="dv">00</span>&lt;-<span class="kw">ncvar_get</span>(nc_pet_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb12-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-21"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb12-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-22"></a> <span class="kw">nc_close</span>(nc_pet_<span class="dv">91</span>_<span class="dv">00</span>) </span>
<span id="cb12-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-23"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb12-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-24"></a> pet_<span class="dv">81</span>_<span class="dv">00</span>&lt;-<span class="kw">abind</span>(pet_<span class="dv">81</span>_<span class="dv">90</span>,pet_<span class="dv">91</span>_<span class="dv">00</span>)</span>
<span id="cb12-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-25"></a><span class="co"># Have one month ETP ( January)</span></span>
<span id="cb12-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-26"></a> pet_Jan_<span class="dv">1</span>&lt;-pet_<span class="dv">81</span>_<span class="dv">90</span>[,,<span class="dv">1</span>]</span>
<span id="cb12-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-27"></a> <span class="kw">dim</span>(pet_Jan_<span class="dv">1</span>) </span>
<span id="cb12-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-28"></a> <span class="co"># Create empty list</span></span>
<span id="cb12-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-29"></a>r&lt;-<span class="kw">raster</span>(<span class="dt">ncol=</span><span class="dv">3</span>,<span class="dt">nrow=</span><span class="dv">3</span>)</span>
<span id="cb12-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-30"></a>Rlist&lt;-<span class="kw">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb12-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-31"></a> <span class="co"># Average of 8 years (j)  and 12 months (i) </span></span>
<span id="cb12-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-32"></a><span class="co">######for loop starts#######</span></span>
<span id="cb12-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-33"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) { </span>
<span id="cb12-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-34"></a>var_sum&lt;-pet_Jan_<span class="dv">1</span><span class="op">*</span><span class="dv">0</span></span>
<span id="cb12-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-35"></a>k&lt;-i</span>
<span id="cb12-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-36"></a> </span>
<span id="cb12-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-37"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>) {</span>
<span id="cb12-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-38"></a><span class="kw">print</span>(k)</span>
<span id="cb12-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-39"></a>var_sum&lt;-(var_sum <span class="op">+</span><span class="st"> </span>pet_<span class="dv">81</span>_<span class="dv">00</span>[,,k])</span>
<span id="cb12-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-40"></a> k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb12-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-41"></a> }</span>
<span id="cb12-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-42"></a><span class="co">#Save each month average. </span></span>
<span id="cb12-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-43"></a> var_avg&lt;-var_sum<span class="op">*</span><span class="dv">30</span><span class="op">/</span><span class="dv">20</span></span>
<span id="cb12-44"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-44"></a>name&lt;-<span class="kw">paste0</span>(<span class="st">&#39;PET_1981_2000_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb12-45"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-45"></a> <span class="co"># Make a raster r from the each average</span></span>
<span id="cb12-46"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-46"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var_avg), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb12-47"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-47"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb12-48"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-48"></a><span class="kw">writeRaster</span>(ra,<span class="dt">filename=</span>name, <span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb12-49"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-49"></a>Rlist[[i]]&lt;-ra</span>
<span id="cb12-50"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-50"></a>}</span>
<span id="cb12-51"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-51"></a><span class="co">######for loop ends#######</span></span>
<span id="cb12-52"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-52"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb12-53"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-53"></a> PET_Stack&lt;-<span class="kw">stack</span>(Rlist)</span>
<span id="cb12-54"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb12-54"></a><span class="kw">writeRaster</span>(PET_Stack,<span class="dt">filename=</span><span class="st">&#39;PET_Stack_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span></code></pre></div>
<p>Script number 1 is completed. The user should have created two files for the Temperature variable, two for the Precipitation variable and one for ETP variable. All these files will be used to create a raster stack of all layers needed to run the “long spin up” phase.</p>
</div>
<div id="script-number-2.-cru_variables_warm_up.r" class="section level3">
<h3><span class="header-section-number">9.2.2</span> 9.2.2 Script Number 2. “CRU_variables_WARM_UP.R”</h3>
<p>The purpose of the “Warm up” phase is to adjust the initial SOC stock and initial pools for the “forward” phase. Once the input climate layers have been harmonized, the model will run for each year from 2001 to 2018/20, using the monthly climate data of each year of the series (for 216/240 values for each month of the time series). The script number 2 is prepared to arrange the necessary CRU climate files for this phase. We will need to generate one raster stack of 216/240 spatial layers for each climate variable mentioned above (216 spatial layers if we use just 18 years period instead of a 20 year period; from 2001 to 2018, depending on the available climate data). Each stack will have one layer for each month from 2001 to 2018/2020.
For phase number 3, the “Forward” phase, we will need monthly averages of the time series 2001-2018/20. We will use the same arrangement as used in phase number one (one stack of 12 bands for each variable) but instead of using the averages of the 1981-2000 period we will use the climatic data of the 2001-2018/20 period. We will assume that there is no climate change in the next 20 years. Thus, script number 2 will also prepare the climate files for the “forward phase”.</p>
<p><strong>Table 9.2</strong> <em>Overview of the input and output files in script number 2 used for the files for Warm Up and Forward Phases.</em></p>
<p><img src="tables/Table_9.2.png" /></p>
<p>First, we must load the required R packages.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb13-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb13-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb13-2"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb13-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb13-3"></a><span class="kw">library</span>(ncdf4)</span>
<span id="cb13-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb13-4"></a><span class="kw">library</span>(abind)</span></code></pre></div>
<p>Then we will have to define the path directory to the CRU files.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb14-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-2"></a>WD&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb14-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-3"></a><span class="kw">setwd</span>(WD)</span>
<span id="cb14-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-4"></a> <span class="co"># Open nc temperature file 2001-2010</span></span>
<span id="cb14-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-5"></a>nc_temp_<span class="dv">01</span>_<span class="dv">10</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.2001.2010.tmp.dat.nc&quot;</span>)</span>
<span id="cb14-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-6"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb14-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-7"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb14-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-8"></a>t_<span class="dv">01</span>_<span class="dv">10</span> &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb14-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-9"></a> tmp_<span class="dv">01</span>_<span class="dv">10</span>&lt;-<span class="kw">ncvar_get</span>(nc_temp_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb14-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-10"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb14-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-11"></a> <span class="kw">nc_close</span>(nc_temp_<span class="dv">01</span>_<span class="dv">10</span>) </span>
<span id="cb14-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-12"></a> <span class="co"># Open nc temperature file 2010-2018</span></span>
<span id="cb14-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-13"></a>nc_temp_<span class="dv">11</span>_<span class="dv">18</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.2011.2018.tmp.dat.nc&quot;</span>)</span>
<span id="cb14-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-14"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb14-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-15"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb14-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-16"></a>t_<span class="dv">11</span>_<span class="dv">18</span> &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb14-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-17"></a> tmp_<span class="dv">11</span>_<span class="dv">18</span>&lt;-<span class="kw">ncvar_get</span>(nc_temp_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb14-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-18"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb14-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-19"></a> <span class="kw">nc_close</span>(nc_temp_<span class="dv">11</span>_<span class="dv">18</span>) </span>
<span id="cb14-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-20"></a> <span class="co"># Merge 2001-2010 and 2011-2018 data </span></span>
<span id="cb14-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-21"></a> tmp&lt;-<span class="kw">abind</span>(tmp_<span class="dv">01</span>_<span class="dv">10</span>,tmp_<span class="dv">11</span>_<span class="dv">18</span>)</span>
<span id="cb14-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-22"></a> <span class="co"># Have one month temperature ( January)</span></span>
<span id="cb14-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-23"></a> tmp_Jan_<span class="dv">1</span>&lt;-tmp[,,<span class="dv">1</span>]</span>
<span id="cb14-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb14-24"></a> <span class="kw">dim</span>(tmp_Jan_<span class="dv">1</span>)</span></code></pre></div>
<p>The next code block will create two raster stacks: a temperature monthly average for the 18/20 year period, and a file with one layer per month per year, summarizing 216 layers in the stack.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-1"></a><span class="co"># Create empty list</span></span>
<span id="cb15-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-2"></a>r&lt;-<span class="kw">raster</span>(<span class="dt">ncol=</span><span class="dv">3</span>,<span class="dt">nrow=</span><span class="dv">3</span>)</span>
<span id="cb15-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-3"></a>Rlist&lt;-<span class="kw">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb15-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-4"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb15-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-5"></a><span class="co">##########for loop starts###############</span></span>
<span id="cb15-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-6"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) { </span>
<span id="cb15-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-7"></a>var_sum&lt;-tmp_Jan_<span class="dv">1</span><span class="op">*</span><span class="dv">0</span></span>
<span id="cb15-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-8"></a>k&lt;-i</span>
<span id="cb15-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-9"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">dim</span>(tmp)[<span class="dv">3</span>]<span class="op">/</span><span class="dv">12</span>)) {</span>
<span id="cb15-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-10"></a><span class="kw">print</span>(k)</span>
<span id="cb15-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-11"></a>var_sum&lt;-(var_sum <span class="op">+</span><span class="st"> </span>tmp[,,k])</span>
<span id="cb15-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-12"></a> k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb15-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-13"></a> }</span>
<span id="cb15-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-14"></a><span class="co">#Save each month average. </span></span>
<span id="cb15-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-15"></a> var_avg&lt;-var_sum<span class="op">/</span>(<span class="kw">dim</span>(tmp)[<span class="dv">3</span>]<span class="op">/</span><span class="dv">12</span>)</span>
<span id="cb15-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-16"></a>name&lt;-<span class="kw">paste0</span>(<span class="st">&#39;Temp_2001_2018_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb15-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-17"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb15-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-18"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var_avg), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb15-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-19"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb15-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-20"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb15-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-21"></a>Rlist[[i]]&lt;-ra</span>
<span id="cb15-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-22"></a>}</span>
<span id="cb15-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-23"></a><span class="co">##########for loop ends###############</span></span>
<span id="cb15-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-24"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb15-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-25"></a> Temp_Stack&lt;-<span class="kw">stack</span>(Rlist)</span>
<span id="cb15-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-26"></a><span class="kw">writeRaster</span>(Temp_Stack,<span class="dt">filename=</span><span class="st">&#39;Temp_Stack_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb15-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-27"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb15-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-28"></a> Rlist2<span class="op">-</span>Rlist</span>
<span id="cb15-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-29"></a><span class="co">##########for loop starts###############</span></span>
<span id="cb15-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-30"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">dim</span>(tmp)[<span class="dv">3</span>])) {</span>
<span id="cb15-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-31"></a><span class="kw">print</span>(q)</span>
<span id="cb15-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-32"></a>var&lt;-(tmp[,,q])</span>
<span id="cb15-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-33"></a> <span class="co">#Save each month average. </span></span>
<span id="cb15-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-34"></a> name&lt;-<span class="kw">paste0</span>(<span class="st">&#39;Temp_2001-2018&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb15-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-35"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb15-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-36"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb15-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-37"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb15-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-38"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb15-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-39"></a>Rlist2[[q]]&lt;-ra</span>
<span id="cb15-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-40"></a>}</span>
<span id="cb15-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-41"></a><span class="co">##########for loop ends###############</span></span>
<span id="cb15-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-42"></a></span>
<span id="cb15-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-43"></a>Temp_Stack_<span class="dv">2</span>&lt;-<span class="kw">stack</span>(Rlist2)</span>
<span id="cb15-44"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-44"></a><span class="kw">writeRaster</span>(Temp_Stack_<span class="dv">2</span>,<span class="dt">filename=</span><span class="st">&#39;Temp_Stack_216_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span>
<span id="cb15-45"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-45"></a> <span class="co">#PRECIPITATION</span></span>
<span id="cb15-46"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-46"></a> <span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb15-47"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-47"></a>WD&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb15-48"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-48"></a><span class="kw">setwd</span>(WD)</span>
<span id="cb15-49"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-49"></a> <span class="co"># Open nc precipitation file 2001-2010</span></span>
<span id="cb15-50"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-50"></a>nc_pre_<span class="dv">01</span>_<span class="dv">10</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.2001.2010.pre.dat.nc&quot;</span>)</span>
<span id="cb15-51"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-51"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb15-52"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-52"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb15-53"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-53"></a>t &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb15-54"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-54"></a> pre_<span class="dv">01</span>_<span class="dv">10</span>&lt;-<span class="kw">ncvar_get</span>(nc_pre_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb15-55"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-55"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb15-56"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-56"></a> <span class="kw">nc_close</span>(nc_pre_<span class="dv">01</span>_<span class="dv">10</span>) </span>
<span id="cb15-57"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-57"></a> <span class="co"># Open nc precipitation file 2011-2018</span></span>
<span id="cb15-58"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-58"></a>nc_pre_<span class="dv">11</span>_<span class="dv">18</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.2011.2018.pre.dat.nc&quot;</span>)</span>
<span id="cb15-59"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-59"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb15-60"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-60"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb15-61"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-61"></a>t &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb15-62"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-62"></a> pre_<span class="dv">11</span>_<span class="dv">18</span>&lt;-<span class="kw">ncvar_get</span>(nc_pre_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb15-63"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-63"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb15-64"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-64"></a> <span class="kw">nc_close</span>(nc_pre_<span class="dv">11</span>_<span class="dv">18</span>) </span>
<span id="cb15-65"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-65"></a> <span class="co"># Merge 2001-2010 and 2011-2018 data </span></span>
<span id="cb15-66"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-66"></a> pre_<span class="dv">01</span>_<span class="dv">18</span>&lt;-<span class="kw">abind</span>(pre_<span class="dv">01</span>_<span class="dv">10</span>,pre_<span class="dv">11</span>_<span class="dv">18</span>)</span>
<span id="cb15-67"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-67"></a><span class="co"># Have one month Precipitation ( January)</span></span>
<span id="cb15-68"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-68"></a> pre_Jan_<span class="dv">1</span>&lt;-pre_<span class="dv">01</span>_<span class="dv">18</span>[,,<span class="dv">1</span>]</span>
<span id="cb15-69"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-69"></a> <span class="kw">dim</span>(pre_Jan_<span class="dv">1</span>)  </span>
<span id="cb15-70"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-70"></a> Continue running until the end of the block<span class="op">:</span></span>
<span id="cb15-71"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-71"></a><span class="st"> </span><span class="co"># Create empty list</span></span>
<span id="cb15-72"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-72"></a>r&lt;-<span class="kw">raster</span>(<span class="dt">ncol=</span><span class="dv">3</span>,<span class="dt">nrow=</span><span class="dv">3</span>)</span>
<span id="cb15-73"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-73"></a>Rlist&lt;-<span class="kw">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb15-74"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-74"></a>Rlist2&lt;-Rlist</span>
<span id="cb15-75"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-75"></a> <span class="co"># Average of 20 years (j)  and 12 months (i) </span></span>
<span id="cb15-76"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-76"></a><span class="co">#########for loop starts############</span></span>
<span id="cb15-77"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-77"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) { </span>
<span id="cb15-78"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-78"></a>var_sum&lt;-pre_Jan_<span class="dv">1</span><span class="op">*</span><span class="dv">0</span></span>
<span id="cb15-79"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-79"></a>k&lt;-i</span>
<span id="cb15-80"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-80"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">dim</span>(pre_<span class="dv">01</span>_<span class="dv">18</span>)[<span class="dv">3</span>]<span class="op">/</span><span class="dv">12</span>)) {</span>
<span id="cb15-81"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-81"></a><span class="kw">print</span>(k)</span>
<span id="cb15-82"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-82"></a>var_sum&lt;-(var_sum <span class="op">+</span><span class="st"> </span>pre_<span class="dv">01</span>_<span class="dv">18</span>[,,k])</span>
<span id="cb15-83"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-83"></a> k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb15-84"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-84"></a> }</span>
<span id="cb15-85"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-85"></a><span class="co">#Save each month average. </span></span>
<span id="cb15-86"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-86"></a> var_avg&lt;-var_sum<span class="op">/</span>(<span class="kw">dim</span>(pre_<span class="dv">01</span>_<span class="dv">18</span>)[<span class="dv">3</span>]<span class="op">/</span><span class="dv">12</span>)</span>
<span id="cb15-87"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-87"></a> name&lt;-<span class="kw">paste0</span>(<span class="st">&#39;Prec_2001_2018_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb15-88"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-88"></a> <span class="co"># Make a raster r from  each average</span></span>
<span id="cb15-89"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-89"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var_avg), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb15-90"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-90"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb15-91"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-91"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb15-92"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-92"></a>Rlist[[i]]&lt;-ra</span>
<span id="cb15-93"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-93"></a>}</span>
<span id="cb15-94"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-94"></a><span class="co">#########for loop ends############</span></span>
<span id="cb15-95"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-95"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb15-96"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-96"></a> Prec_Stack&lt;-<span class="kw">stack</span>(Rlist)</span>
<span id="cb15-97"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-97"></a><span class="kw">writeRaster</span>(Prec_Stack,<span class="dt">filename=</span><span class="st">&#39;Prec_Stack_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb15-98"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-98"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb15-99"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-99"></a><span class="co">#########for loop starts############</span></span>
<span id="cb15-100"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-100"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">dim</span>(pre_<span class="dv">01</span>_<span class="dv">18</span>)[<span class="dv">3</span>])) {</span>
<span id="cb15-101"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-101"></a><span class="kw">print</span>(q)</span>
<span id="cb15-102"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-102"></a>var&lt;-(pre_<span class="dv">01</span>_<span class="dv">18</span>[,,q])</span>
<span id="cb15-103"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-103"></a> <span class="co">#Save each month average. </span></span>
<span id="cb15-104"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-104"></a> name&lt;-<span class="kw">paste0</span>(<span class="st">&#39;Prec_2001-2018&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb15-105"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-105"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb15-106"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-106"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb15-107"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-107"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb15-108"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-108"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb15-109"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-109"></a>Rlist2[[q]]&lt;-ra</span>
<span id="cb15-110"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-110"></a>}</span>
<span id="cb15-111"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-111"></a><span class="co">#########for loop ends############</span></span>
<span id="cb15-112"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-112"></a>Prec_Stack_<span class="dv">2</span>&lt;-<span class="kw">stack</span>(Rlist2)</span>
<span id="cb15-113"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb15-113"></a><span class="kw">writeRaster</span>(Prec_Stack_<span class="dv">2</span>,<span class="dt">filename=</span><span class="st">&#39;Prec_Stack_216_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span></code></pre></div>
<p>Now we must run the PET block. We will then run the rest of the code to create the necessary tif files.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-1"></a> <span class="co">########################################################################</span></span>
<span id="cb16-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-2"></a> <span class="co"># POTENTIAL EVAPOTRANSPIRATION </span></span>
<span id="cb16-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-3"></a> <span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb16-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-4"></a>WD&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb16-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-5"></a><span class="kw">setwd</span>(WD)</span>
<span id="cb16-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-6"></a> <span class="co"># Open nc temperature file 01 - 10</span></span>
<span id="cb16-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-7"></a>nc_pet_<span class="dv">01</span>_<span class="dv">10</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.2001.2010.pet.dat.nc&quot;</span>)</span>
<span id="cb16-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-8"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb16-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-9"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb16-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-10"></a>t &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb16-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-11"></a> pet_<span class="dv">01</span>_<span class="dv">10</span>&lt;-<span class="kw">ncvar_get</span>(nc_pet_<span class="dv">01</span>_<span class="dv">10</span>, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb16-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-12"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb16-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-13"></a> <span class="kw">nc_close</span>(nc_pet_<span class="dv">01</span>_<span class="dv">10</span>) </span>
<span id="cb16-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-14"></a> <span class="co"># Open nc temperature file 11 - 18 nc_pet_11_18&lt;-nc_open(&quot;cru_ts4.03.2011.2018.pet.dat.nc&quot;)</span></span>
<span id="cb16-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-15"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb16-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-16"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb16-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-17"></a>t &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pet_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb16-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-18"></a> pet_<span class="dv">11</span>_<span class="dv">18</span>&lt;-<span class="kw">ncvar_get</span>(nc_pet_<span class="dv">11</span>_<span class="dv">18</span>, <span class="st">&quot;pet&quot;</span>)</span>
<span id="cb16-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-19"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb16-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-20"></a> <span class="kw">nc_close</span>(nc_pet_<span class="dv">11</span>_<span class="dv">18</span>) </span>
<span id="cb16-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-21"></a> <span class="co"># Merge 2001-2010 and 2011-2018 data </span></span>
<span id="cb16-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-22"></a> pet_<span class="dv">01</span>_<span class="dv">18</span>&lt;-<span class="kw">abind</span>(pet_<span class="dv">01</span>_<span class="dv">10</span>,pet_<span class="dv">11</span>_<span class="dv">18</span>)</span>
<span id="cb16-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-23"></a><span class="co"># get one month ETP ( January)</span></span>
<span id="cb16-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-24"></a> pet_Jan_<span class="dv">1</span>&lt;-pet_<span class="dv">01</span>_<span class="dv">18</span>[,,<span class="dv">1</span>]</span>
<span id="cb16-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-25"></a> <span class="kw">dim</span>(pet_Jan_<span class="dv">1</span>)</span>
<span id="cb16-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-26"></a> <span class="co"># Create empty list</span></span>
<span id="cb16-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-27"></a>r&lt;-<span class="kw">raster</span>(<span class="dt">ncol=</span><span class="dv">3</span>,<span class="dt">nrow=</span><span class="dv">3</span>)</span>
<span id="cb16-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-28"></a>Rlist&lt;-<span class="kw">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb16-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-29"></a>Rlist2&lt;-Rlist</span>
<span id="cb16-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-30"></a> <span class="co"># Average of 18 years (j)  and 12 months (i) </span></span>
<span id="cb16-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-31"></a><span class="co">############for loop starts##############</span></span>
<span id="cb16-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-32"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) { </span>
<span id="cb16-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-33"></a>var_sum&lt;-pet_Jan_<span class="dv">1</span><span class="op">*</span><span class="dv">0</span></span>
<span id="cb16-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-34"></a>k&lt;-i</span>
<span id="cb16-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-35"></a> <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">dim</span>(pet_<span class="dv">01</span>_<span class="dv">18</span>)[<span class="dv">3</span>]<span class="op">/</span><span class="dv">12</span>)) {</span>
<span id="cb16-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-36"></a><span class="kw">print</span>(k)</span>
<span id="cb16-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-37"></a>var_sum&lt;-(var_sum <span class="op">+</span><span class="st"> </span>pet_<span class="dv">01</span>_<span class="dv">18</span>[,,k])</span>
<span id="cb16-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-38"></a> k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb16-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-39"></a> }</span>
<span id="cb16-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-40"></a><span class="co">#Save each month average. </span></span>
<span id="cb16-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-41"></a> var_avg&lt;-var_sum<span class="op">*</span><span class="dv">30</span><span class="op">/</span>(<span class="kw">dim</span>(pet_<span class="dv">01</span>_<span class="dv">18</span>)[<span class="dv">3</span>]<span class="op">/</span><span class="dv">12</span>)</span>
<span id="cb16-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-42"></a>name&lt;-<span class="kw">paste0</span>(<span class="st">&#39;PET_2001_2018_years_avg_&#39;</span>,i,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb16-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-43"></a> <span class="co"># Make a raster r from the each average</span></span>
<span id="cb16-44"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-44"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var_avg), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb16-45"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-45"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb16-46"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-46"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb16-47"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-47"></a>Rlist[[i]]&lt;-ra</span>
<span id="cb16-48"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-48"></a>}</span>
<span id="cb16-49"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-49"></a><span class="co">############for loop ends##############</span></span>
<span id="cb16-50"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-50"></a> <span class="co">#save a stack of months averages</span></span>
<span id="cb16-51"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-51"></a> PET_Stack&lt;-<span class="kw">stack</span>(Rlist)</span>
<span id="cb16-52"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-52"></a><span class="kw">writeRaster</span>(PET_Stack,<span class="dt">filename=</span><span class="st">&#39;PET_Stack_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb16-53"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-53"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb16-54"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-54"></a><span class="co">############for loop starts##############</span></span>
<span id="cb16-55"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-55"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">dim</span>(pet_<span class="dv">01</span>_<span class="dv">18</span>)[<span class="dv">3</span>])) {</span>
<span id="cb16-56"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-56"></a><span class="kw">print</span>(q)</span>
<span id="cb16-57"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-57"></a>var&lt;-(pet_<span class="dv">01</span>_<span class="dv">18</span>[,,q])<span class="op">*</span><span class="dv">30</span></span>
<span id="cb16-58"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-58"></a> <span class="co">#Save each month average. </span></span>
<span id="cb16-59"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-59"></a> name&lt;-<span class="kw">paste0</span>(<span class="st">&#39;PET_2001-2018&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb16-60"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-60"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb16-61"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-61"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb16-62"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-62"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb16-63"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-63"></a><span class="kw">writeRaster</span>(ra,<span class="dt">filename=</span>name, <span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb16-64"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-64"></a>Rlist2[[q]]&lt;-ra</span>
<span id="cb16-65"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-65"></a>}</span>
<span id="cb16-66"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-66"></a><span class="co">############for loop starts##############</span></span>
<span id="cb16-67"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-67"></a>PET_Stack_<span class="dv">2</span>&lt;-<span class="kw">stack</span>(Rlist2)</span>
<span id="cb16-68"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb16-68"></a><span class="kw">writeRaster</span>(PET_Stack_<span class="dv">2</span>,<span class="dt">filename=</span><span class="st">&#39;PET_Stack_216_01-18_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>) </span></code></pre></div>
</div>
<div id="script-number-3.-preparation-of-cru-files-to-estimate-npp-1981-2000" class="section level3">
<h3><span class="header-section-number">9.2.3</span> 9.3.1 Script Number 3. Preparation of CRU files to estimate NPP 1981-2000</h3>
<p>We will need to convert the CRU monthly climate data 1981-2000 into annual data to estimate annual NPP 1981-2000.The script number 3 will process the CRU files from the 1981-2000 series to generate the climate inputs files required to estimate NPP by the MIAMI model.</p>
<p><strong>Table 9.3.</strong> <em>Script Number 3. CRU files for MIAMI MODEL. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.3.png" /></p>
<p>We will first open the R file: “CRU_variables_for_NPP_MIAMI_MEAN_81-00.R” and load the required packages:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb17-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb17-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb17-2"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb17-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb17-3"></a><span class="kw">library</span>(ncdf4)</span>
<span id="cb17-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb17-4"></a><span class="kw">library</span>(abind)</span></code></pre></div>
<p>The first block is the “temperature” block. We must set the path to the CRU files.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-1"></a><span class="co"># TEMPERATURE</span></span>
<span id="cb18-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-2"></a>WD&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb18-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-3"></a><span class="kw">setwd</span>(WD)</span>
<span id="cb18-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-4"></a> <span class="co"># Open nc temperature file 1981-1990</span></span>
<span id="cb18-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-5"></a>nc_temp_<span class="dv">81</span>_<span class="dv">90</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.tmp.dat.nc&quot;</span>)</span>
<span id="cb18-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-6"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb18-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-7"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb18-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-8"></a>t_<span class="dv">81</span>_<span class="dv">90</span> &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb18-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-9"></a> tmp_<span class="dv">81</span>_<span class="dv">90</span>&lt;-<span class="kw">ncvar_get</span>(nc_temp_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb18-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-10"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb18-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-11"></a> <span class="kw">nc_close</span>(nc_temp_<span class="dv">81</span>_<span class="dv">90</span>) </span>
<span id="cb18-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-12"></a> <span class="co"># Open nc temperature file 1991-2000</span></span>
<span id="cb18-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-13"></a>nc_temp_<span class="dv">91</span>_<span class="dv">00</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.tmp.dat.nc&quot;</span>)</span>
<span id="cb18-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-14"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb18-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-15"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb18-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-16"></a>t_<span class="dv">91</span>_<span class="dv">00</span> &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_temp_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb18-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-17"></a> tmp_<span class="dv">91</span>_<span class="dv">00</span>&lt;-<span class="kw">ncvar_get</span>(nc_temp_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb18-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-18"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb18-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-19"></a> <span class="kw">nc_close</span>(nc_temp_<span class="dv">91</span>_<span class="dv">00</span>) </span>
<span id="cb18-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-20"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb18-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-21"></a> tmp&lt;-<span class="kw">abind</span>(tmp_<span class="dv">81</span>_<span class="dv">90</span>,tmp_<span class="dv">91</span>_<span class="dv">00</span>)</span>
<span id="cb18-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-22"></a> <span class="co"># Get one month temperature ( January)</span></span>
<span id="cb18-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-23"></a> </span>
<span id="cb18-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-24"></a>tmp_Jan_<span class="dv">1</span>&lt;-tmp[,,<span class="dv">1</span>]</span>
<span id="cb18-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-25"></a> <span class="kw">dim</span>(tmp_Jan_<span class="dv">1</span>)</span>
<span id="cb18-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-26"></a><span class="co"># Create empty list</span></span>
<span id="cb18-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-27"></a>r&lt;-<span class="kw">raster</span>(<span class="dt">ncol=</span><span class="dv">3</span>,<span class="dt">nrow=</span><span class="dv">3</span>)</span>
<span id="cb18-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-28"></a>Rlist&lt;-<span class="kw">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb18-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-29"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb18-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-30"></a> Rlist2&lt;-Rlist</span>
<span id="cb18-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-31"></a><span class="co">############for loop starts###########</span></span>
<span id="cb18-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-32"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">dim</span>(tmp)[<span class="dv">3</span>])) {</span>
<span id="cb18-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-33"></a>var&lt;-(tmp[,,q])</span>
<span id="cb18-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-34"></a> <span class="co">#Save each month average. </span></span>
<span id="cb18-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-35"></a> name&lt;-<span class="kw">paste0</span>(<span class="st">&#39;Temp_1981-2000&#39;</span>,q,<span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb18-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-36"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb18-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-37"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb18-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-38"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb18-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-39"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb18-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-40"></a>Rlist2[[q]]&lt;-ra</span>
<span id="cb18-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-41"></a>}</span>
<span id="cb18-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-42"></a><span class="co">############for loop ends###########</span></span>
<span id="cb18-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-43"></a>Temp_Stack_<span class="dv">2</span>&lt;-<span class="kw">stack</span>(Rlist2)</span>
<span id="cb18-44"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb18-44"></a><span class="kw">writeRaster</span>(Temp_Stack_<span class="dv">2</span>,<span class="dt">filename=</span><span class="st">&#39;Temp_Stack_240_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>After that, the “precipitation” block begins.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-1"></a> <span class="co">#PRECIPITATION</span></span>
<span id="cb19-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-2"></a> <span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb19-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-3"></a>WD&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb19-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-4"></a><span class="kw">setwd</span>(WD)</span>
<span id="cb19-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-5"></a> <span class="co"># Open nc precipitation file 1981-1990</span></span>
<span id="cb19-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-6"></a>nc_pre_<span class="dv">81</span>_<span class="dv">90</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.1981.1990.pre.dat.nc&quot;</span>)</span>
<span id="cb19-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-7"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb19-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-8"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb19-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-9"></a>t &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb19-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-10"></a> pre_<span class="dv">81</span>_<span class="dv">90</span>&lt;-<span class="kw">ncvar_get</span>(nc_pre_<span class="dv">81</span>_<span class="dv">90</span>, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb19-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-11"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb19-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-12"></a> <span class="kw">nc_close</span>(nc_pre_<span class="dv">81</span>_<span class="dv">90</span>) </span>
<span id="cb19-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-13"></a> <span class="co"># Open nc precipitation file 1991-2000</span></span>
<span id="cb19-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-14"></a>nc_pre_<span class="dv">91</span>_<span class="dv">00</span>&lt;-<span class="kw">nc_open</span>(<span class="st">&quot;cru_ts4.03.1991.2000.pre.dat.nc&quot;</span>)</span>
<span id="cb19-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-15"></a> lon &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb19-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-16"></a>lat &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;lat&quot;</span>, <span class="dt">verbose =</span> F)</span>
<span id="cb19-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-17"></a>t &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(nc_pre_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb19-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-18"></a>pre_<span class="dv">91</span>_<span class="dv">00</span>&lt;-<span class="kw">ncvar_get</span>(nc_pre_<span class="dv">91</span>_<span class="dv">00</span>, <span class="st">&quot;pre&quot;</span>)</span>
<span id="cb19-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-19"></a> <span class="co">#close de nc temperature file</span></span>
<span id="cb19-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-20"></a> <span class="kw">nc_close</span>(nc_pre_<span class="dv">91</span>_<span class="dv">00</span>) </span>
<span id="cb19-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-21"></a> <span class="co"># Merge 1981-1990 and 1991-2000 data </span></span>
<span id="cb19-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-22"></a> pre_<span class="dv">81</span>_<span class="dv">00</span>&lt;-<span class="kw">abind</span>(pre_<span class="dv">81</span>_<span class="dv">90</span>,pre_<span class="dv">91</span>_<span class="dv">00</span>) </span>
<span id="cb19-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-23"></a> <span class="co"># Create empty list</span></span>
<span id="cb19-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-24"></a>r&lt;-<span class="kw">raster</span>(<span class="dt">ncol=</span><span class="dv">3</span>,<span class="dt">nrow=</span><span class="dv">3</span>)</span>
<span id="cb19-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-25"></a>Rlist&lt;-<span class="kw">list</span>(r,r,r,r,r,r,r,r,r,r,r,r)</span>
<span id="cb19-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-26"></a>Rlist2&lt;-Rlist</span>
<span id="cb19-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-27"></a> <span class="co"># SAVE 1 layer per month per year</span></span>
<span id="cb19-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-28"></a><span class="co">##############for loop starts############</span></span>
<span id="cb19-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-29"></a> <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">dim</span>(pre_<span class="dv">81</span>_<span class="dv">00</span>)[<span class="dv">3</span>])) {</span>
<span id="cb19-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-30"></a>var&lt;-(pre_<span class="dv">81</span>_<span class="dv">00</span>[,,q])</span>
<span id="cb19-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-31"></a> <span class="co">#Save each month average. </span></span>
<span id="cb19-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-32"></a> <span class="co">#name&lt;-paste0(&#39;Prec_2001-2018&#39;,q,&#39;.tif&#39;)</span></span>
<span id="cb19-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-33"></a> <span class="co"># Make a raster r from each average</span></span>
<span id="cb19-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-34"></a>ra&lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(var), <span class="dt">xmn=</span><span class="kw">min</span>(lon), <span class="dt">xmx=</span><span class="kw">max</span>(lon), <span class="dt">ymn=</span><span class="kw">min</span>(lat), <span class="dt">ymx=</span><span class="kw">max</span>(lat), <span class="dt">crs=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span>))</span>
<span id="cb19-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-35"></a>ra&lt;-<span class="kw">flip</span>(ra, <span class="dt">direction=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb19-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-36"></a><span class="co">#writeRaster(ra,filename=name, format=&quot;GTiff&quot;)</span></span>
<span id="cb19-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-37"></a>Rlist2[[q]]&lt;-ra</span>
<span id="cb19-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-38"></a>}</span>
<span id="cb19-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-39"></a><span class="co">##############for loop ends############</span></span>
<span id="cb19-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-40"></a>Prec_Stack_<span class="dv">2</span>&lt;-<span class="kw">stack</span>(Rlist2)</span>
<span id="cb19-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb19-41"></a><span class="kw">writeRaster</span>(Prec_Stack_<span class="dv">2</span>,<span class="dt">filename=</span><span class="st">&#39;Prec_Stack_240_81-00_CRU.tif&#39;</span>,<span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-5.-miami-model-npp-mean-1981-2000" class="section level3">
<h3><span class="header-section-number">9.2.4</span> 9.3.2 Script Number 5. MIAMI model NPP mean 1981-2000</h3>
<p>To adjust yearly C inputs during the warm up phase according to annual NPP values, we will need to estimate an average annual NPP 1981-2000, that will be used as the starting point to adjust C inputs during the “warm up” phase (See chapter 6). Script number 5 uses the climate raster outputs from script number 3 and estimates an annual NPP mean 1981-2000 value.</p>
<p><strong>Table 9.4</strong> <em>Script Number 5. Miami Model 81-00 Mean. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.4.png" /></p>
<p>First, we will need to open the R script: “MIAMI_MODEL_NPP_MIAMI_MEAN_81-00.R”
Analogously to the previous scripts, the first lines load the required packages into R and set the working directories. Then the annual precipitation and annual temperature stacks (1981-2000) that were created in script number 3 are opened:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb20-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-2"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb20-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-3"></a>WD_NPP&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/NPP&quot;</span>)</span>
<span id="cb20-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-4"></a></span>
<span id="cb20-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-5"></a>WD_AOI&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb20-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-6"></a>WD_GSOC&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb20-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-7"></a>WD_CRU_LAYERS&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb20-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-8"></a><span class="kw">setwd</span>(WD_CRU_LAYERS)</span>
<span id="cb20-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-9"></a><span class="co"># Open Annual Precipitation (mm) and Mean Annual Temperature (degree C) stacks</span></span>
<span id="cb20-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-10"></a>Temp&lt;-<span class="kw">stack</span>(<span class="st">&quot;Temp_Stack_240_81-00_CRU.tif&quot;</span>)</span>
<span id="cb20-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb20-11"></a>Prec&lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="st">&quot;Prec_Stack_240_81-00_CRU.tif&quot;</span>)</span></code></pre></div>
<p>At line 73 the user must set the output directory to save the output files.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-1"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb21-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-2"></a>k&lt;-<span class="dv">1</span></span>
<span id="cb21-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-3"></a>TempList&lt;-<span class="kw">list</span>()</span>
<span id="cb21-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-4"></a><span class="co">#######loop for starts#########</span></span>
<span id="cb21-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>){</span>
<span id="cb21-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-6"></a>Temp1&lt;-<span class="kw">mean</span>(Temp[[k<span class="op">:</span>(k<span class="op">+</span><span class="dv">11</span>)]])</span>
<span id="cb21-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-7"></a>TempList[i]&lt;-Temp1</span>
<span id="cb21-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-8"></a>k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb21-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-9"></a>}</span>
<span id="cb21-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-10"></a><span class="co">#######loop for ends##########</span></span>
<span id="cb21-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-11"></a>TempStack&lt;-<span class="kw">stack</span>(TempList)</span>
<span id="cb21-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-12"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb21-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-13"></a></span>
<span id="cb21-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-14"></a>k&lt;-<span class="dv">1</span></span>
<span id="cb21-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-15"></a>PrecList&lt;-<span class="kw">list</span>()</span>
<span id="cb21-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-16"></a><span class="co">########loop for starts#######</span></span>
<span id="cb21-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-17"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>){</span>
<span id="cb21-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-18"></a>Prec1&lt;-<span class="kw">sum</span>(Prec[[k<span class="op">:</span>(k<span class="op">+</span><span class="dv">11</span>)]])</span>
<span id="cb21-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-19"></a>PrecList[i]&lt;-Prec1</span>
<span id="cb21-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-20"></a>k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb21-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-21"></a>}</span>
<span id="cb21-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-22"></a><span class="co">########loop for ends#######</span></span>
<span id="cb21-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-23"></a>PrecStack&lt;-<span class="kw">stack</span>(PrecList)</span>
<span id="cb21-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-24"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-25"></a>NPP_Prec&lt;-<span class="dv">3000</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.000664</span><span class="op">*</span>PrecStack))</span>
<span id="cb21-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-26"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-27"></a>NPP_temp&lt;-<span class="dv">3000</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(<span class="fl">1.315-0.119</span><span class="op">*</span>TempStack))</span>
<span id="cb21-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-28"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb21-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-29"></a>NPP_MIAMI_List&lt;-<span class="kw">list</span>()</span>
<span id="cb21-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-30"></a><span class="co">########loop for starts#######</span></span>
<span id="cb21-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-31"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>){</span>
<span id="cb21-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-32"></a>NPP_MIAMI_List[i]&lt;-<span class="kw">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb21-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-33"></a>}</span>
<span id="cb21-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-34"></a><span class="co">########loop for ends#######</span></span>
<span id="cb21-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-35"></a>NPP_MIAMI&lt;-<span class="kw">stack</span>(NPP_MIAMI_List)</span>
<span id="cb21-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-36"></a></span>
<span id="cb21-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-37"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb21-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-38"></a>NPP_MIAMI_tnDM_Ha_Year&lt;-NPP_MIAMI<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb21-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-39"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb21-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-40"></a>NPP_MIAMI_tnC_Ha_Year&lt;-NPP_MIAMI_tnDM_Ha_Year<span class="op">*</span><span class="fl">0.5</span></span>
<span id="cb21-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-41"></a><span class="co"># Save WORLD NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb21-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-42"></a><span class="kw">setwd</span>(WD_NPP)</span>
<span id="cb21-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-43"></a><span class="kw">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="dt">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00.tif&quot;</span>,<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb21-44"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-44"></a><span class="co"># NPP MEAN</span></span>
<span id="cb21-45"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-45"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>&lt;-<span class="kw">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb21-46"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-46"></a></span>
<span id="cb21-47"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-47"></a>Then we will need to open the country polygon vector and the latest version of the FAO GSOCmap.</span>
<span id="cb21-48"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-48"></a><span class="co">## Open the shapefile of the region/country</span></span>
<span id="cb21-49"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-49"></a><span class="kw">setwd</span>(WD_AOI)</span>
<span id="cb21-50"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-50"></a>AOI&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb21-51"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-51"></a><span class="co">#Open FAO GSOC MAP </span></span>
<span id="cb21-52"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-52"></a><span class="kw">setwd</span>(WD_GSOC)</span>
<span id="cb21-53"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-53"></a>SOC_MAP_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb21-54"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-54"></a><span class="co"># Crop &amp; mask</span></span>
<span id="cb21-55"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-55"></a><span class="kw">setwd</span>(WD_NPP)</span>
<span id="cb21-56"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-56"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI&lt;-<span class="kw">crop</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>,AOI)</span>
<span id="cb21-57"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-57"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI&lt;-<span class="kw">resample</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI,SOC_MAP_AOI)</span>
<span id="cb21-58"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-58"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI&lt;-<span class="kw">mask</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI,AOI)</span>
<span id="cb21-59"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-59"></a></span>
<span id="cb21-60"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb21-60"></a><span class="kw">writeRaster</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI,<span class="dt">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI.tif&quot;</span>,<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>In order to estimate the uncertainty of our predictions, we will create two additional layers, but this time using a minimum and maximum combination of precipitation and temperature variables to generate minimum and maximum NPP layers (See Chapter 12).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-1"></a><span class="co">#UNCERTAINTIES MINIMUM TEMP , PREC</span></span>
<span id="cb22-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-2"></a>Temp_min&lt;-Temp<span class="op">*</span><span class="fl">1.02</span></span>
<span id="cb22-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-3"></a>Prec_min&lt;-Prec<span class="op">*</span><span class="fl">0.95</span></span>
<span id="cb22-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-4"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb22-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-5"></a>k&lt;-<span class="dv">1</span></span>
<span id="cb22-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-6"></a>TempList&lt;-<span class="kw">list</span>()</span>
<span id="cb22-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-7"></a><span class="co">########loop for starts#######</span></span>
<span id="cb22-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-8"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>){</span>
<span id="cb22-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-9"></a>Temp1&lt;-<span class="kw">mean</span>(Temp_min[[k<span class="op">:</span>(k<span class="op">+</span><span class="dv">11</span>)]])</span>
<span id="cb22-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-10"></a>TempList[i]&lt;-Temp1</span>
<span id="cb22-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-11"></a>k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb22-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-12"></a>}</span>
<span id="cb22-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-13"></a><span class="co">########loop for ends#######</span></span>
<span id="cb22-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-14"></a>TempStack&lt;-<span class="kw">stack</span>(TempList)</span>
<span id="cb22-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-15"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb22-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-16"></a>k&lt;-<span class="dv">1</span></span>
<span id="cb22-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-17"></a>PrecList&lt;-<span class="kw">list</span>()</span>
<span id="cb22-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-18"></a><span class="co">########loop for starts#######</span></span>
<span id="cb22-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-19"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>){</span>
<span id="cb22-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-20"></a>Prec1&lt;-<span class="kw">sum</span>(Prec_min[[k<span class="op">:</span>(k<span class="op">+</span><span class="dv">11</span>)]])</span>
<span id="cb22-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-21"></a>PrecList[i]&lt;-Prec1</span>
<span id="cb22-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-22"></a>k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb22-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-23"></a>}</span>
<span id="cb22-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-24"></a><span class="co">########loop for ends#######</span></span>
<span id="cb22-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-25"></a>PrecStack&lt;-<span class="kw">stack</span>(PrecList)</span>
<span id="cb22-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-26"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-27"></a>NPP_Prec&lt;-<span class="dv">3000</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.000664</span><span class="op">*</span>PrecStack))</span>
<span id="cb22-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-28"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-29"></a>NPP_temp&lt;-<span class="dv">3000</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(<span class="fl">1.315-0.119</span><span class="op">*</span>TempStack))</span>
<span id="cb22-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-30"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-31"></a>NPP_MIAMI_List&lt;-<span class="kw">list</span>()</span>
<span id="cb22-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-32"></a><span class="co">########loop for starts#######</span></span>
<span id="cb22-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-33"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>){</span>
<span id="cb22-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-34"></a>NPP_MIAMI_List[i]&lt;-<span class="kw">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb22-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-35"></a>}</span>
<span id="cb22-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-36"></a><span class="co">########loop for ends#######</span></span>
<span id="cb22-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-37"></a>NPP_MIAMI&lt;-<span class="kw">stack</span>(NPP_MIAMI_List)</span>
<span id="cb22-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-38"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb22-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-39"></a>NPP_MIAMI_tnDM_Ha_Year&lt;-NPP_MIAMI<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb22-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-40"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb22-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-41"></a></span>
<span id="cb22-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-42"></a>NPP_MIAMI_tnC_Ha_Year&lt;-NPP_MIAMI_tnDM_Ha_Year<span class="op">*</span><span class="fl">0.5</span></span>
<span id="cb22-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-43"></a><span class="co"># Save WORLD NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb22-44"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-44"></a><span class="kw">setwd</span>(WD_NPP)</span>
<span id="cb22-45"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-45"></a><span class="kw">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="dt">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00_MIN.tif&quot;</span>,<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb22-46"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-46"></a><span class="co"># NPP MEAN</span></span>
<span id="cb22-47"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-47"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>&lt;-<span class="kw">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb22-48"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-48"></a><span class="co"># Crop &amp; and mask</span></span>
<span id="cb22-49"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-49"></a><span class="kw">setwd</span>(WD_NPP)</span>
<span id="cb22-50"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-50"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI&lt;-<span class="kw">crop</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>,AOI)</span>
<span id="cb22-51"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-51"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI&lt;-<span class="kw">resample</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI,SOC_MAP_AOI)</span>
<span id="cb22-52"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-52"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI&lt;-<span class="kw">mask</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI,AOI)</span>
<span id="cb22-53"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-53"></a><span class="kw">writeRaster</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI,<span class="dt">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI_MIN.tif&quot;</span>,<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb22-54"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-54"></a><span class="co">#UNCERTAINTIES MAXIMUM TEMP , PREC</span></span>
<span id="cb22-55"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-55"></a><span class="co"># Open Anual Precipitation (mm) and Mean Anual Temperature (grades C) stacks</span></span>
<span id="cb22-56"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-56"></a>Temp_max&lt;-Temp<span class="op">*</span><span class="fl">0.98</span></span>
<span id="cb22-57"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-57"></a>Prec_max&lt;-Prec<span class="op">*</span><span class="fl">1.05</span></span>
<span id="cb22-58"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-58"></a><span class="co"># Temperature Annual Mean </span></span>
<span id="cb22-59"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-59"></a>k&lt;-<span class="dv">1</span></span>
<span id="cb22-60"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-60"></a>TempList&lt;-<span class="kw">list</span>()</span>
<span id="cb22-61"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-61"></a><span class="co">########loop for starts#######</span></span>
<span id="cb22-62"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-62"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>){</span>
<span id="cb22-63"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-63"></a></span>
<span id="cb22-64"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-64"></a>Temp1&lt;-<span class="kw">mean</span>(Temp_max[[k<span class="op">:</span>(k<span class="op">+</span><span class="dv">11</span>)]])</span>
<span id="cb22-65"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-65"></a>TempList[i]&lt;-Temp1</span>
<span id="cb22-66"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-66"></a>k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb22-67"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-67"></a>}</span>
<span id="cb22-68"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-68"></a><span class="co">########loop for ends#######</span></span>
<span id="cb22-69"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-69"></a>TempStack&lt;-<span class="kw">stack</span>(TempList)</span>
<span id="cb22-70"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-70"></a><span class="co">#Annual Precipitation</span></span>
<span id="cb22-71"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-71"></a>k&lt;-<span class="dv">1</span></span>
<span id="cb22-72"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-72"></a>PrecList&lt;-<span class="kw">list</span>()</span>
<span id="cb22-73"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-73"></a><span class="co">########loop for starts#######</span></span>
<span id="cb22-74"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-74"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>){</span>
<span id="cb22-75"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-75"></a>Prec1&lt;-<span class="kw">sum</span>(Prec_max[[k<span class="op">:</span>(k<span class="op">+</span><span class="dv">11</span>)]])</span>
<span id="cb22-76"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-76"></a>PrecList[i]&lt;-Prec1</span>
<span id="cb22-77"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-77"></a>k&lt;-k<span class="op">+</span><span class="dv">12</span></span>
<span id="cb22-78"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-78"></a>}</span>
<span id="cb22-79"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-79"></a><span class="co">########loop for ends#######</span></span>
<span id="cb22-80"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-80"></a>PrecStack&lt;-<span class="kw">stack</span>(PrecList)</span>
<span id="cb22-81"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-81"></a><span class="co"># Calculate eq 1 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-82"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-82"></a>NPP_rain&lt;-<span class="dv">3000</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.000664</span><span class="op">*</span>PrecStack))</span>
<span id="cb22-83"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-83"></a><span class="co"># Calculate eq 2 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-84"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-84"></a>NPP_temp&lt;-<span class="dv">3000</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(<span class="fl">1.315-0.119</span><span class="op">*</span>TempStack))</span>
<span id="cb22-85"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-85"></a></span>
<span id="cb22-86"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-86"></a><span class="co"># Calculate eq 3 from MIAMI MODEL (g DM/m2/day)</span></span>
<span id="cb22-87"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-87"></a>NPP_MIAMI_List&lt;-<span class="kw">list</span>()</span>
<span id="cb22-88"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-88"></a><span class="co">########loop for starts#######</span></span>
<span id="cb22-89"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-89"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>){</span>
<span id="cb22-90"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-90"></a>NPP_MIAMI_List[i]&lt;-<span class="kw">min</span>(NPP_Prec[[i]],NPP_temp[[i]])</span>
<span id="cb22-91"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-91"></a>}</span>
<span id="cb22-92"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-92"></a><span class="co">########loop for ends#######</span></span>
<span id="cb22-93"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-93"></a>NPP_MIAMI&lt;-<span class="kw">stack</span>(NPP_MIAMI_List)</span>
<span id="cb22-94"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-94"></a><span class="co">#NPP_MIAMI gDM/m2/year To tn DM/ha/year</span></span>
<span id="cb22-95"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-95"></a>NPP_MIAMI_tnDM_Ha_Year&lt;-NPP_MIAMI<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb22-96"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-96"></a><span class="co">#NPP_MIAMI tn DM/ha/year To tn C/ha/year</span></span>
<span id="cb22-97"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-97"></a>NPP_MIAMI_tnC_Ha_Year&lt;-NPP_MIAMI_tnDM_Ha_Year<span class="op">*</span><span class="fl">0.5</span></span>
<span id="cb22-98"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-98"></a><span class="co"># Save NPP MIAMI MODEL tnC/ha/year</span></span>
<span id="cb22-99"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-99"></a><span class="kw">setwd</span>(WD_NPP)</span>
<span id="cb22-100"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-100"></a><span class="kw">writeRaster</span>(NPP_MIAMI_tnC_Ha_Year,<span class="dt">filename=</span><span class="st">&quot;NPP_MIAMI_tnC_Ha_Year_STACK_81-00_MAX.tif&quot;</span>,<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span>
<span id="cb22-101"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-101"></a><span class="co"># NPP MEAN</span></span>
<span id="cb22-102"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-102"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>&lt;-<span class="kw">mean</span>(NPP_MIAMI_tnC_Ha_Year)</span>
<span id="cb22-103"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-103"></a><span class="co"># Crop &amp; and mask</span></span>
<span id="cb22-104"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-104"></a><span class="kw">setwd</span>(WD_NPP)</span>
<span id="cb22-105"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-105"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI&lt;-<span class="kw">crop</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>,AOI)</span>
<span id="cb22-106"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-106"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI&lt;-<span class="kw">resample</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI,SOC_MAP_AOI)</span>
<span id="cb22-107"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-107"></a>NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI&lt;-<span class="kw">mask</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI,AOI)</span>
<span id="cb22-108"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-108"></a></span>
<span id="cb22-109"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb22-109"></a><span class="kw">writeRaster</span>(NPP_MIAMI_MEAN_<span class="dv">81</span>_<span class="dv">00</span>_AOI,<span class="dt">filename=</span><span class="st">&quot;NPP_MIAMI_MEAN_81-00_AOI_MAX.tif&quot;</span>,<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-6.-monthly_vegetation_cover-vegetation-cover-from-google-earth-engine." class="section level3">
<h3><span class="header-section-number">9.2.5</span> 9.4.1 Script Number 6. “Monthly_vegetation_cover” vegetation cover from Google Earth Engine.</h3>
<p>Script number 6 is a Google Earth Engine script. It is aimed at estimating an average vegetation cover status for each month of the year. Therefore, the script should be run twelve times, modifying the month number each time. It estimates, within a specified time series, the probability for each pixel to present NDVI values greater than a specified threshold, over which the soil is vegetated (for example NDVI &gt; 0.6). The result will vary between 0 and 1. Users may modify the time series and NDVI threshold as desired and according to local knowledge.</p>
<p><strong>Table 9.5.</strong> <em>Script Number 6.GEE Monthly Vegetation Cover. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.5.png" /></p>
<p>First, the user will need to activate a Google Earth Engine account. To run the Google Earth Engine (GEE) tool, the user will need to copy and paste the script (provided below) into the GEE code editor (central panel, Fig. 9.1).</p>
<div class="figure">
<img src="images/Figure_9.1.png" alt="" />
<p class="caption"><strong>Figure 9.1</strong> <em>Google Earth Engine code editor</em></p>
</div>
<p>The user will need to draw a polygon that includes the country that is being analyzed, by clicking on “+new layer”. The polygon will contain the country’s boundary or area of interest (Fig. 9.2)</p>
<div class="figure">
<img src="images/Figure_9.2.png" alt="" />
<p class="caption"><strong>Figure 9.2</strong> <em>Drawing a polygon in Google Earth Engine</em></p>
</div>
<p>The script shall be run twelve times, once for each month of the year. The user will need to specify the month, the name of the output folder and the name of the output raster each time the script is run. The following lines need to be edited:</p>
<ul>
<li>Line 10, the month number to be processed, (e.g. for January (1,1,‘month’);</li>
<li>Line 55, the name of the folder where the output raster file is to be saved (in the Google Drive Account);</li>
<li>Line 56, the name of the output raster which coincides with the month number that has been run.</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb23-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-1"></a><span class="co">//Google Earth Engine </span></span>
<span id="cb23-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-2"></a><span class="co">// Monthly Vegetation Cover for Roth C Model   </span></span>
<span id="cb23-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-3"></a> <span class="co">// Provide a polygon geometry</span></span>
<span id="cb23-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-4"></a> <span class="co">// Select the Modis dataset. MOD13A2 is an NDVI product. Modify the number of the month filter for each month from 1 to 12. </span></span>
<span id="cb23-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-5"></a> <span class="kw">var</span> dataset <span class="op">=</span> <span class="va">ee</span>.<span class="at">ImageCollection</span>(<span class="st">&#39;MODIS/006/MOD13A2&#39;</span>)</span>
<span id="cb23-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-6"></a>                  .<span class="at">filter</span>(<span class="va">ee</span>.<span class="va">Filter</span>.<span class="at">date</span>(<span class="st">&#39;2015-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2019-12-01&#39;</span>))</span>
<span id="cb23-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-7"></a>                  .<span class="at">filter</span>(<span class="va">ee</span>.<span class="va">Filter</span>.<span class="at">calendarRange</span>(<span class="dv">12</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="st">&#39;month&#39;</span>))<span class="op">;</span></span>
<span id="cb23-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-8"></a> <span class="kw">var</span> ndvi <span class="op">=</span> <span class="va">dataset</span>.<span class="at">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">;</span></span>
<span id="cb23-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-9"></a> <span class="co">// Masks every pixel greater than 0.6 NDVI</span></span>
<span id="cb23-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-10"></a><span class="kw">var</span> mask06<span class="op">=</span> <span class="kw">function</span>(image) <span class="op">{</span></span>
<span id="cb23-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-11"></a>    <span class="kw">var</span> mask <span class="op">=</span> <span class="va">image</span>.<span class="at">select</span>(<span class="st">&#39;NDVI&#39;</span>).<span class="at">gt</span>(<span class="dv">3000</span>)<span class="op">;</span></span>
<span id="cb23-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-12"></a>    <span class="cf">return</span> <span class="va">image</span>.<span class="at">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb23-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-13"></a>  <span class="op">};</span></span>
<span id="cb23-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-14"></a> <span class="co">// Apply the mask to the dataset (var ndvi)</span></span>
<span id="cb23-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-15"></a><span class="kw">var</span> ndvi_06<span class="op">=</span><span class="va">ndvi</span>.<span class="at">map</span>(mask06)<span class="op">;</span> </span>
<span id="cb23-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-16"></a> <span class="co">// Count the number of times a pixel has an NDVI value greater than 0.6</span></span>
<span id="cb23-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-17"></a><span class="kw">var</span> ndvi_06_nn<span class="op">=</span><span class="va">ndvi_06</span>.<span class="at">reduce</span>(<span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">count</span>())<span class="op">;</span></span>
<span id="cb23-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-18"></a> <span class="co">// Count the total number of values per pixel</span></span>
<span id="cb23-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-19"></a><span class="kw">var</span> ndvi_nn<span class="op">=</span><span class="va">ndvi</span>.<span class="at">reduce</span>(<span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">count</span>())<span class="op">;</span></span>
<span id="cb23-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-20"></a> <span class="co">// Calculate the proportion of times the NDVI value is greater than 0.6 per pixel</span></span>
<span id="cb23-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-21"></a><span class="kw">var</span> prop_cover<span class="op">=</span> <span class="va">ndvi_06_nn</span>.<span class="at">divide</span>(ndvi_nn)<span class="op">;</span></span>
<span id="cb23-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-22"></a> <span class="co">// Color palette</span></span>
<span id="cb23-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-23"></a><span class="kw">var</span> ndviVis <span class="op">=</span> <span class="op">{</span></span>
<span id="cb23-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-24"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb23-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-25"></a>  <span class="dt">max</span><span class="op">:</span> <span class="fl">1.0</span><span class="op">,</span></span>
<span id="cb23-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-26"></a>  <span class="dt">palette</span><span class="op">:</span> [</span>
<span id="cb23-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-27"></a>    <span class="st">&#39;FFFFFF&#39;</span><span class="op">,</span> <span class="st">&#39;CE7E45&#39;</span><span class="op">,</span> <span class="st">&#39;DF923D&#39;</span><span class="op">,</span> <span class="st">&#39;F1B555&#39;</span><span class="op">,</span> <span class="st">&#39;FCD163&#39;</span><span class="op">,</span> <span class="st">&#39;99B718&#39;</span><span class="op">,</span> <span class="st">&#39;74A901&#39;</span><span class="op">,</span></span>
<span id="cb23-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-28"></a>    <span class="st">&#39;66A000&#39;</span><span class="op">,</span> <span class="st">&#39;529400&#39;</span><span class="op">,</span> <span class="st">&#39;3E8601&#39;</span><span class="op">,</span> <span class="st">&#39;207401&#39;</span><span class="op">,</span> <span class="st">&#39;056201&#39;</span><span class="op">,</span> <span class="st">&#39;004C00&#39;</span><span class="op">,</span> <span class="st">&#39;023B01&#39;</span><span class="op">,</span></span>
<span id="cb23-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-29"></a>    <span class="st">&#39;012E01&#39;</span><span class="op">,</span> <span class="st">&#39;011D01&#39;</span><span class="op">,</span> <span class="st">&#39;011301&#39;</span></span>
<span id="cb23-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-30"></a> ]<span class="op">,</span></span>
<span id="cb23-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-31"></a><span class="op">};</span></span>
<span id="cb23-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-32"></a> <span class="co">// Clip the map with the country geometry</span></span>
<span id="cb23-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-33"></a><span class="kw">var</span> Recorte <span class="op">=</span> <span class="va">prop_cover</span>.<span class="at">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb23-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-34"></a> <span class="co">// Add the map to the visualization google earth engine panel</span></span>
<span id="cb23-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-35"></a><span class="va">Map</span>.<span class="at">addLayer</span>(Recorte<span class="op">,</span> ndviVis<span class="op">,</span> <span class="st">&#39;Country&#39;</span>)</span>
<span id="cb23-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-36"></a> <span class="co">// This code block needs to be modify for each month and allows the user to save the map into a Google drive account</span></span>
<span id="cb23-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-37"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="va">JSON</span>.<span class="at">stringify</span>(<span class="va">Recorte</span>.<span class="at">getInfo</span>())<span class="op">;</span></span>
<span id="cb23-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-38"></a><span class="va">Export</span>.<span class="va">image</span>.<span class="at">toDrive</span>(<span class="op">{</span></span>
<span id="cb23-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-39"></a>          <span class="dt">image</span><span class="op">:</span> <span class="va">Recorte</span>.<span class="at">select</span>(<span class="st">&quot;NDVI_count&quot;</span>)<span class="op">,</span></span>
<span id="cb23-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-40"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;MAPA_ROTH_C&quot;</span><span class="op">,</span></span>
<span id="cb23-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-41"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;NDVI_2015-2019_prop_gt_06_CR_MES_01&#39;</span><span class="op">,</span> </span>
<span id="cb23-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-42"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb23-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-43"></a>          <span class="dt">region</span><span class="op">:</span>geometry<span class="op">,</span></span>
<span id="cb23-44"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-44"></a>          <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span>     </span>
<span id="cb23-45"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb23-45"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>After running the script for each month, the layer must be saved to the Google Drive account. To accomplish this, the user will need to click on the “task” button and then click the “run” button (Fig. 9.3)</p>
<div class="figure">
<img src="images/Figure_9.3.png" alt="" />
<p class="caption"><strong>Figure 9.3</strong> <em>Saving the task in GEE.</em></p>
</div>
<p>Once the procedure is completed, the layers should be downloaded from the Google Drive and saved into a local folder</p>
</div>
<div id="script-number-7.-vegetation_cover_stack.r" class="section level3">
<h3><span class="header-section-number">9.2.6</span> 9.4.2 Script Number 7. “Vegetation_Cover_stack.R”</h3>
<p>The script number 7 is an R script that uses the monthly vegetation cover layers (0-1 values) created with the GEE script number 6 to create a raster stack. It also linearly rescales the values from “0 to 1” (proportion of vegetated pixels in a time series) to “1 to 0.6” (being 1 = bare soil and 0.6 = full vegetated pixel). This transformation will allow us to use the calculated values as modifying factors of the decomposition rates in the RothC model.</p>
<p>Table 9.6 Script Number 7. Vegetation Cover Stack. Inputs and Outputs.
<img src="tables/Table_9.6.png" /></p>
<p>Once the monthly vegetation cover layers are downloaded from Google Drive, we will generate a stack of those layers. We will first open script number 7 “Vegetation_Cover_stack.R” and the required packages. Then, we will need to open the country polygon vector and set the working directory for the input and the output layers.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb24-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-2"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb24-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-3"></a>WD_AOI&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb24-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-4"></a>WD_SOC&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb24-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-5"></a>WD_COV&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/INPUTS/COV&quot;</span>)</span>
<span id="cb24-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-6"></a></span>
<span id="cb24-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-7"></a></span>
<span id="cb24-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-8"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb24-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-9"></a><span class="kw">setwd</span>(WD_AOI)</span>
<span id="cb24-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-10"></a>AOI&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb24-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-11"></a><span class="co">#Open SOC MAP FAO</span></span>
<span id="cb24-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-12"></a><span class="kw">setwd</span>(WD_SOC)</span>
<span id="cb24-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-13"></a>SOC_MAP_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb24-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-14"></a><span class="co"># Open Vegetation Cover layer based only in proportion of NDVI pixels grater than 0.6 </span></span>
<span id="cb24-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-15"></a><span class="kw">setwd</span>(WD_COV)</span>
<span id="cb24-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-16"></a>Cov1&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M01.tif&quot;</span>)</span>
<span id="cb24-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-17"></a>Cov1[<span class="kw">is.na</span>(Cov1[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-18"></a>Cov1_crop&lt;-<span class="kw">crop</span>(Cov1,AOI)</span>
<span id="cb24-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-19"></a>Cov1_mask&lt;-<span class="kw">mask</span>(Cov1_crop,AOI)</span>
<span id="cb24-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-20"></a>Cov1_res&lt;-<span class="kw">resample</span>(Cov1_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-21"></a>Cov2&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M02.tif&quot;</span>)</span>
<span id="cb24-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-22"></a>Cov2[<span class="kw">is.na</span>(Cov2[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-23"></a>Cov2_crop&lt;-<span class="kw">crop</span>(Cov2,AOI)</span>
<span id="cb24-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-24"></a>Cov2_mask&lt;-<span class="kw">mask</span>(Cov2_crop,AOI)</span>
<span id="cb24-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-25"></a>Cov2_res&lt;-<span class="kw">resample</span>(Cov2_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-26"></a>Cov3&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M03.tif&quot;</span>)</span>
<span id="cb24-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-27"></a>Cov3[<span class="kw">is.na</span>(Cov3[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-28"></a>Cov3_crop&lt;-<span class="kw">crop</span>(Cov3,AOI)</span>
<span id="cb24-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-29"></a>Cov3_mask&lt;-<span class="kw">mask</span>(Cov3_crop,AOI)</span>
<span id="cb24-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-30"></a>Cov3_res&lt;-<span class="kw">resample</span>(Cov3_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-31"></a>Cov4&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M04.tif&quot;</span>)</span>
<span id="cb24-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-32"></a>Cov4[<span class="kw">is.na</span>(Cov4[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-33"></a>Cov4_crop&lt;-<span class="kw">crop</span>(Cov4,AOI)</span>
<span id="cb24-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-34"></a>Cov4_mask&lt;-<span class="kw">mask</span>(Cov4_crop,AOI)</span>
<span id="cb24-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-35"></a>Cov4_res&lt;-<span class="kw">resample</span>(Cov4_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-36"></a>Cov5&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M05.tif&quot;</span>)</span>
<span id="cb24-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-37"></a>Cov5[<span class="kw">is.na</span>(Cov5[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-38"></a>Cov5_crop&lt;-<span class="kw">crop</span>(Cov5,AOI)</span>
<span id="cb24-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-39"></a>Cov5_mask&lt;-<span class="kw">mask</span>(Cov5_crop,AOI)</span>
<span id="cb24-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-40"></a>Cov5_res&lt;-<span class="kw">resample</span>(Cov5_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-41"></a>Cov6&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M06.tif&quot;</span>)</span>
<span id="cb24-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-42"></a>Cov6[<span class="kw">is.na</span>(Cov6[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-43"></a>Cov6_crop&lt;-<span class="kw">crop</span>(Cov6,AOI)</span>
<span id="cb24-44"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-44"></a>Cov6_mask&lt;-<span class="kw">mask</span>(Cov6_crop,AOI)</span>
<span id="cb24-45"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-45"></a>Cov6_res&lt;-<span class="kw">resample</span>(Cov6_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-46"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-46"></a>Cov7&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M07.tif&quot;</span>)</span>
<span id="cb24-47"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-47"></a>Cov7[<span class="kw">is.na</span>(Cov7[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-48"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-48"></a>Cov7_crop&lt;-<span class="kw">crop</span>(Cov7,AOI)</span>
<span id="cb24-49"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-49"></a>Cov7_mask&lt;-<span class="kw">mask</span>(Cov7_crop,AOI)</span>
<span id="cb24-50"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-50"></a>Cov7_res&lt;-<span class="kw">resample</span>(Cov7_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-51"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-51"></a>Cov8&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M08.tif&quot;</span>)</span>
<span id="cb24-52"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-52"></a>Cov8[<span class="kw">is.na</span>(Cov8[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-53"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-53"></a>Cov8_crop&lt;-<span class="kw">crop</span>(Cov8,AOI)</span>
<span id="cb24-54"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-54"></a>Cov8_mask&lt;-<span class="kw">mask</span>(Cov8_crop,AOI)</span>
<span id="cb24-55"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-55"></a>Cov8_res&lt;-<span class="kw">resample</span>(Cov8_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-56"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-56"></a>Cov9&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M09.tif&quot;</span>)</span>
<span id="cb24-57"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-57"></a>Cov9[<span class="kw">is.na</span>(Cov9[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-58"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-58"></a>Cov9_crop&lt;-<span class="kw">crop</span>(Cov9,AOI)</span>
<span id="cb24-59"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-59"></a>Cov9_mask&lt;-<span class="kw">mask</span>(Cov9_crop,AOI)</span>
<span id="cb24-60"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-60"></a>Cov9_res&lt;-<span class="kw">resample</span>(Cov9_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-61"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-61"></a>Cov10&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M10.tif&quot;</span>)</span>
<span id="cb24-62"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-62"></a>Cov10[<span class="kw">is.na</span>(Cov10[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-63"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-63"></a>Cov10_crop&lt;-<span class="kw">crop</span>(Cov10,AOI)</span>
<span id="cb24-64"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-64"></a>Cov10_mask&lt;-<span class="kw">mask</span>(Cov10_crop,AOI)</span>
<span id="cb24-65"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-65"></a>Cov10_res&lt;-<span class="kw">resample</span>(Cov10_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-66"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-66"></a>Cov11&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M11.tif&quot;</span>)</span>
<span id="cb24-67"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-67"></a>Cov11[<span class="kw">is.na</span>(Cov11[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-68"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-68"></a>Cov11_crop&lt;-<span class="kw">crop</span>(Cov11,AOI)</span>
<span id="cb24-69"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-69"></a>Cov11_mask&lt;-<span class="kw">mask</span>(Cov11_crop,AOI)</span>
<span id="cb24-70"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-70"></a>Cov11_res&lt;-<span class="kw">resample</span>(Cov11_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-71"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-71"></a>Cov12&lt;-<span class="kw">raster</span>(<span class="st">&quot;NDVI_2015-2019_prop_gt03_M12.tif&quot;</span>)</span>
<span id="cb24-72"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-72"></a>Cov12[<span class="kw">is.na</span>(Cov12[])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb24-73"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-73"></a>Cov12_crop&lt;-<span class="kw">crop</span>(Cov12,AOI)</span>
<span id="cb24-74"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-74"></a>Cov12_mask&lt;-<span class="kw">mask</span>(Cov12_crop,AOI)</span>
<span id="cb24-75"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-75"></a>Cov12_res&lt;-<span class="kw">resample</span>(Cov12_mask,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb24-76"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-76"></a>Stack_Cov&lt;-<span class="kw">stack</span>(Cov1_res,Cov2_res,Cov3_res,Cov4_res,Cov5_res,Cov6_res,Cov7_res,Cov8_res,Cov9_res,Cov10_res,Cov11_res,Cov12_res)</span>
<span id="cb24-77"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-77"></a><span class="co"># rescale values to 1 if it is bare soil and 0.6 if it is vegetated.</span></span>
<span id="cb24-78"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-78"></a>Cov&lt;-((Stack_Cov)<span class="op">*</span>(<span class="op">-</span><span class="fl">0.4</span>))<span class="op">+</span><span class="dv">1</span></span>
<span id="cb24-79"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb24-79"></a><span class="kw">writeRaster</span>(Cov,<span class="dt">filename=</span><span class="st">&#39;Cov_stack_AOI.tif&#39;</span>,<span class="dt">format=</span><span class="st">&#39;GTiff&#39;</span>)</span></code></pre></div>
<p>Once the monthly vegetation cover layers are downloaded from Google Drive, we will generate a stack of those layers. We will first open script number 7 “Vegetation_Cover_stack.R” and the required packages. Then, we will need to open the country polygon vector and set the working directory for the input and the output layers.</p>
<p><strong>Table 9.7</strong> <em>Script Number 8. Clay Layer from ISRIC. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.7.png" /></p>
<p>ISRIC clay layers represent the clay content (0-2 micrometer; in g/100g; w%) at four standard depths (Sl1=0-1cm; Sl2=1-5; Sl3=5-15cm; Sl4=15-30 cm) at a 250m resolution. The objective of this script is to aggregate the different layers into one layer by estimating the weighted average of the four depths:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb25-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-2"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb25-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-3"></a></span>
<span id="cb25-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-4"></a>WD_AOI&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb25-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-5"></a>WD_ISRIC&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/INPUTS/CLAY&quot;</span>)</span>
<span id="cb25-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-6"></a>WD_CLAY&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CLAY&quot;</span>)</span>
<span id="cb25-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-7"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb25-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-8"></a><span class="kw">setwd</span>(WD_AOI)</span>
<span id="cb25-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-9"></a>AOI&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb25-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-10"></a><span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb25-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-11"></a><span class="kw">setwd</span>(WD_ISRIC)</span>
<span id="cb25-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-12"></a>Clay1&lt;-<span class="kw">raster</span>(<span class="st">&quot;CLYPPT_M_sl1_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb25-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-13"></a>Clay2&lt;-<span class="kw">raster</span>(<span class="st">&quot;CLYPPT_M_sl2_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb25-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-14"></a>Clay3&lt;-<span class="kw">raster</span>(<span class="st">&quot;CLYPPT_M_sl3_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb25-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-15"></a>Clay4&lt;-<span class="kw">raster</span>(<span class="st">&quot;CLYPPT_M_sl4_250m_ll_subs.tif&quot;</span>)</span>
<span id="cb25-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-16"></a>Clay1_AR&lt;-<span class="kw">crop</span>(Clay1,AOI)</span>
<span id="cb25-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-17"></a>Clay2_AR&lt;-<span class="kw">crop</span>(Clay2,AOI)</span>
<span id="cb25-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-18"></a>Clay3_AR&lt;-<span class="kw">crop</span>(Clay3,AOI)</span>
<span id="cb25-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-19"></a>Clay4_AR&lt;-<span class="kw">crop</span>(Clay4,AOI)</span>
<span id="cb25-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-20"></a><span class="co"># Average of four depths </span></span>
<span id="cb25-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-21"></a>WeightedAverage&lt;-<span class="cf">function</span>(r1,r2,r3,r4){<span class="kw">return</span>(r1<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">30</span>)<span class="op">+</span>r2<span class="op">*</span>(<span class="dv">4</span><span class="op">/</span><span class="dv">30</span>)<span class="op">+</span>r3<span class="op">*</span>(<span class="dv">10</span><span class="op">/</span><span class="dv">30</span>)<span class="op">+</span>r4<span class="op">*</span>(<span class="dv">15</span><span class="op">/</span><span class="dv">30</span>))}</span>
<span id="cb25-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-22"></a>Clay_WA&lt;-<span class="kw">overlay</span>(Clay1_AR,Clay2_AR,Clay3_AR,Clay4_AR,<span class="dt">fun=</span>WeightedAverage)</span>
<span id="cb25-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-23"></a>Clay_WA_AOI&lt;-<span class="kw">mask</span>(Clay_WA,AOI)</span>
<span id="cb25-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-24"></a><span class="kw">setwd</span>(WD_CLAY)</span>
<span id="cb25-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb25-25"></a><span class="kw">writeRaster</span>(Clay_WA_AOI,<span class="dt">filename=</span><span class="st">&quot;Clay_WA_AOI.tif&quot;</span>,<span class="dt">format=</span><span class="st">&#39;GTiff&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="preparing-the-land-use-layer" class="section level2">
<h2><span class="header-section-number">9.3</span> 9.6 Preparing the land use layer</h2>
<p>The land use layer is one of the most important layers in the process, as it defines the target areas and production systems to be modeled.
The land use layer will be needed:</p>
<ul>
<li>to account for major land use changes during the 2000-2020 period;</li>
<li>to obtain the DPM/RPM ratios required in the RothC model ( See Chapter 4);</li>
<li>to define the modeling units/target points where the model is to be run (agricultural lands in 2020).</li>
</ul>
<p>Each modeling phase will require specific land use layers. For the ‘spin-up’ phase, users should use a representative land use layer for the period 1980-2000 (e.g. land use layer as in year 2000), or best available land use layer. For the ‘warm-up’ phase, users can use year to year land use layers (2000 to 2020), or a representative land use layer for the period, depending on the available information. The ‘warm-up’ land use layer accounts for year to year changes in the land use during the period (for example a pixel that changes from forest to cropland). The script will need a stack of land use layers, one layer for each year of the warm up phase. If the user does not want to model changes in the land use layer over the warm up phase, or information is not available, the same land use layer for each year can be used over the warm-up phase. For the ‘forward’ phase, the latest best available land use layer should be used.
As a minimum, the last available land use data at 1x1 km resolution shall be defined. The predominant land use category in each cell of the 1x1 km grid shall be selected if finer resolutions are available.
The land use classes can be derived from land cover classes from different national, regional or global datasets which best correlate with national land use. The land use layers are used in the three modelling phases to generate a decomposition rate DR layer (generated through scripts 10, 11, and 12, See sections 9.8-9.10), that represents the above mentioned DPM/RPM ratios for the different land use classes. In scripts 10,11 and 12, default DPM/RPM values are assigned to each FAO Global Land Cover (GLC-SHARE) class (See Table 6.1 Chapter 6; Section 6.7; and scripts 10,11 and 12). For more information on this classification refer to FAO (2014) and to the FAO Land and Water site: <a href="http://www.fao.org/land-water/land/land-governance/land-resources-planning-toolbox/category/details/en/c/1036355/" class="uri">http://www.fao.org/land-water/land/land-governance/land-resources-planning-toolbox/category/details/en/c/1036355/</a>
Thus, land cover classes obtained from different datasets (e.g. European Space Agency - ESA) need to be re-classified into FAO land cover classes in a Geotiff format if the scripts 10,11 and 12 are to be run with the default land classes and DPM/RPM ratios provided with the training material.
In this section, we provide a script to transform ESA land use cover classes to FAO land use classes (script 9), which can be used as a model to convert and use classes from other datasets. Users can however modify the DPM/RPM default values (See Table 6.1, Chapter 6) based on local knowledge and available information, create additional land use classes or disaggregate the FAO land use classes, and assign DPM/RPM ratios to those new classes by modifying the provided scripts. Users are encouraged to leverage available local knowledge and data to produce the most accurate SOCseq maps possible. With this in mind, if more detailed land use maps, i.e. containing information about the types of cropping systems present, and local data on the DPM/RPM for the specific land use types are easily accessible, the provided script should be edited accordingly.<br />
Finally, the land use layer is also needed to define the target points where the three phases of the protocol will be run. In section 9.7 we provide a Qgis model to generate the target points from the land use layer. Defining the target points out of the land use layer will allow us to run the model just in the pixels with the land use classes of interest.</p>
<div id="script-number-9-land_use_esa_to_fao_classes.r" class="section level3">
<h3><span class="header-section-number">9.3.1</span> 9.6.1 Script Number 9 “Land_Use_ESA_to_FAO_classes.R”</h3>
<p>Script number 9 transforms the ESA (European Space Agency 2015; 300 m resolution; ESA CCI Land cover website) land cover classes to the FAO land use classes. This script can be modified to be used with any other land use dataset.</p>
<p><strong>Table 9.8</strong> <em>Script Number 9. ESA Land Use to FAO classes. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.8.png" /></p>
<p>First, we will need to open the R packages, open the shapefile of the region/country to be modelled, and open the land use/land cover data set to be re-classified into FAO land use classes:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb26-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-2"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb26-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-3"></a>WD_AOI&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb26-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-4"></a>WD_LU&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb26-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-5"></a>WD_SOC&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb26-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-6"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb26-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-7"></a><span class="kw">setwd</span>(WD_AOI)</span>
<span id="cb26-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-8"></a>AOI&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb26-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-9"></a><span class="co"># Open Land Use Layer (ESA)</span></span>
<span id="cb26-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-10"></a><span class="kw">setwd</span>(WD_LU)</span>
<span id="cb26-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-11"></a>ESA_LU&lt;-<span class="kw">raster</span>(<span class="st">&quot;ESACCI-LC-L4-LCCS-Map-300m-P1Y-2015-v2.0.7_subs.tif&quot;</span>)</span>
<span id="cb26-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-12"></a><span class="kw">plot</span>(ESA_LU)</span>
<span id="cb26-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-13"></a><span class="co"># Cut the LU layer by the country polygon</span></span>
<span id="cb26-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-14"></a>ESA_LU_AOI&lt;-<span class="kw">crop</span>(ESA_LU,AOI)</span>
<span id="cb26-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-15"></a><span class="kw">plot</span>(ESA_LU_AOI)</span>
<span id="cb26-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-16"></a><span class="co"># Reclassify ESA LAND USE to FAO LAND USE classes</span></span>
<span id="cb26-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-17"></a><span class="co">#     0 = 0   No Data</span></span>
<span id="cb26-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-18"></a><span class="co">#   190 = 1 Artificial</span></span>
<span id="cb26-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-19"></a><span class="co">#   10 11 20 30 40 = 2 Croplands</span></span>
<span id="cb26-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-20"></a><span class="co">#   130 = 3 Grassland</span></span>
<span id="cb26-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-21"></a><span class="co">#   50 60 61 62 70 71 72 80 81 82 90 100 110 = 4 Tree Covered</span></span>
<span id="cb26-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-22"></a><span class="co">#   120 121 122= 5 Shrubs Covered</span></span>
<span id="cb26-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-23"></a><span class="co">#   160 180 = 6 Herbaceous vegetation flooded</span></span>
<span id="cb26-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-24"></a><span class="co">#   170 = 7 Mangroves</span></span>
<span id="cb26-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-25"></a><span class="co">#   150 151 152 153= 8 Sparse Vegetation</span></span>
<span id="cb26-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-26"></a><span class="co">#   200 201 202 = 9 Baresoil</span></span>
<span id="cb26-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-27"></a><span class="co">#   220 = 10 Snow and Glaciers</span></span>
<span id="cb26-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-28"></a><span class="co">#   210 = 11 Waterbodies</span></span>
<span id="cb26-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-29"></a><span class="co">#   12 = 12 Treecrops</span></span>
<span id="cb26-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-30"></a><span class="co"># Reclassify matrix. &quot;Is&quot; to &quot;become&quot;</span></span>
<span id="cb26-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-31"></a>is&lt;-<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">190</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">130</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">61</span>,<span class="dv">62</span>,<span class="dv">70</span>,<span class="dv">71</span>,<span class="dv">72</span>,<span class="dv">80</span>,<span class="dv">81</span>,<span class="dv">82</span>,<span class="dv">90</span>,<span class="dv">100</span>,<span class="dv">110</span>,<span class="dv">120</span>,<span class="dv">121</span>,<span class="dv">122</span>,<span class="dv">160</span>,<span class="dv">180</span>,<span class="dv">170</span>,<span class="dv">150</span>,<span class="dv">151</span>,<span class="dv">152</span>,<span class="dv">153</span>,<span class="dv">200</span>,<span class="dv">201</span>,<span class="dv">202</span>,<span class="dv">220</span>,<span class="dv">210</span>,<span class="dv">12</span>)</span>
<span id="cb26-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-32"></a>become&lt;-<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>)</span>
<span id="cb26-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-33"></a>recMat&lt;-<span class="kw">matrix</span>(<span class="kw">c</span>(is,become),<span class="dt">ncol=</span><span class="dv">2</span>,<span class="dt">nrow=</span><span class="dv">37</span>)</span>
<span id="cb26-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-34"></a><span class="co"># Reclassify</span></span>
<span id="cb26-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-35"></a>ESA_FAO &lt;-<span class="st"> </span><span class="kw">reclassify</span>(ESA_LU_AOI, recMat)</span>
<span id="cb26-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-36"></a><span class="co"># Resample to SOC map layer extent and resolution</span></span>
<span id="cb26-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-37"></a><span class="kw">setwd</span>(WD_SOC)</span>
<span id="cb26-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-38"></a>SOC_MAP_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb26-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-39"></a>ESA_FAO_res&lt;-<span class="kw">resample</span>(ESA_FAO,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;ngb&#39;</span>) </span>
<span id="cb26-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-40"></a>ESA_FAO_mask&lt;-<span class="kw">mask</span>(ESA_FAO_res,SOC_MAP_AOI) </span>
<span id="cb26-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-41"></a><span class="co"># Save Land Use raster</span></span>
<span id="cb26-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-42"></a><span class="kw">setwd</span>(WD_LU)</span>
<span id="cb26-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb26-43"></a><span class="kw">writeRaster</span>(ESA_FAO_mask,<span class="dt">filename=</span><span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>,<span class="dt">format=</span><span class="st">&#39;GTiff&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="harmonization-of-soil-climate-and-vegetation-layers." class="section level2">
<h2><span class="header-section-number">9.4</span> 9.7 Harmonization of soil, climate and vegetation layers.</h2>
<p>Once all soil, climate, vegetation and land use layers are created, they need to be harmonized in order to run the model. The harmonization of layers consists of three steps. First, if the model is to be run for an entire country, layers need to be harmonized to the extents of the country boundaries (country polygon layer extents). Second, a resampling process is required in order to match the spatial resolution to the master layer (SOC FAO layer). Finally, a masking process is required to cut the layer with the vector polygon boundaries. After the harmonization of all layers, we will generate a raster stack of all layers needed to run the model. The harmonization/stacking process will be performed three times (scripts 10,11,12), one for each modelling phase.</p>
<div id="script-number-10.-spin_up_stack.v3.r" class="section level3">
<h3><span class="header-section-number">9.4.1</span> 9.7.1 Script Number 10. “SPIN_UP_STACK.v3.R”</h3>
<p>Script number 10 is intended to harmonize all layers needed to complete phase 1 (long spin-up) of the spatial RothC model. The result of this script is a simple raster stack which contains all the data to perform the spin-up phase. To generate the stack we will need the SOC FAO layer (master layer), the clay layer (from script number 8), the three climate stacks (from script number 1), the land use layer (from script number 9), and the vegetation cover stack (from script number 7).</p>
<p><strong>Table 9.9</strong> <em>Script Number 10. Stack Layers for SPIN UP phase. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.9.png" /></p>
<p>First, we will open the required R-packages and a shapefile (polygon) which represents the country boundary. In the script below we will be using an example but when running it (AR), the user will have to replace the file according to the target country. The user can also modify the names of the variables inside the script. However, as these variables will only exist inside the script, it is not necessary.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-1"></a><span class="co">#### Prepare the layers for the SPIN UP process of the Roth C Model. </span></span>
<span id="cb27-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-2"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb27-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-3"></a><span class="kw">library</span>(raster)</span>
<span id="cb27-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-4"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb27-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-5"></a>WD_AOI&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb27-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-6"></a>WD_SOC&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb27-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-7"></a>WD_CLAY&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CLAY&quot;</span>)</span>
<span id="cb27-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-8"></a>WD_CLIM&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb27-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-9"></a>WD_LU&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb27-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-10"></a>WD_COV&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/COV&quot;</span>)</span>
<span id="cb27-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-11"></a>WD_STACK&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/STACK&quot;</span>)</span>
<span id="cb27-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-12"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb27-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-13"></a><span class="kw">setwd</span>(WD_AOI)</span>
<span id="cb27-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-14"></a>AOI&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb27-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-15"></a></span>
<span id="cb27-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-16"></a>The second step is to load the latest version of FAO Soil Organic Carbon map <span class="kw">layer</span> (Master Layer), created <span class="cf">in</span> script number <span class="fl">0.</span> </span>
<span id="cb27-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-17"></a><span class="co">#Open SOC MAP FAO</span></span>
<span id="cb27-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-18"></a><span class="kw">setwd</span>(WD_SOC)</span>
<span id="cb27-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-19"></a>SOC_MAP_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb27-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-20"></a> Next, we will open the clay content <span class="kw">layer</span> (from script number <span class="dv">8</span>)<span class="op">:</span></span>
<span id="cb27-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-21"></a><span class="co"># Open Clay layer</span></span>
<span id="cb27-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-22"></a><span class="kw">setwd</span>(WD_CLAY)</span>
<span id="cb27-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-23"></a>Clay_WA_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb27-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-24"></a>Clay_WA_AOI_res&lt;-<span class="kw">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb27-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-25"></a>Clay_AR_Avg&lt;-<span class="kw">crop</span>(Clay_AR_Avg,AR)</span>
<span id="cb27-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-26"></a>Clay_AR_Avg&lt;-<span class="kw">mask</span>(Clay_AR_Avg,AR)</span>
<span id="cb27-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-27"></a>Clay_AR_Avg_res&lt;-<span class="kw">resample</span>(Clay_AR_Avg,SOC_MAP_AR,<span class="dt">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb27-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-28"></a>Next, we will open the climate raster <span class="kw">layers</span> (generated <span class="cf">in</span> script number <span class="dv">1</span>).  These layers come from the CRU database, but the user can choose local layers <span class="cf">if</span> desired, as long as they match the arrangement and format needed <span class="cf">for</span> running the model.</span>
<span id="cb27-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-29"></a><span class="co">#Open Precipitation layer </span></span>
<span id="cb27-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-30"></a><span class="kw">setwd</span>(WD_CLIM)</span>
<span id="cb27-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-31"></a>PREC&lt;-<span class="kw">stack</span>(<span class="st">&quot;Prec_Stack_81-00_CRU.tif&quot;</span>)</span>
<span id="cb27-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-32"></a>PREC_AOI&lt;-<span class="kw">crop</span>(PREC,AOI)</span>
<span id="cb27-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-33"></a>PREC_AOI&lt;-<span class="kw">resample</span>(PREC_AOI,SOC_MAP_AOI)</span>
<span id="cb27-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-34"></a>PREC_AOI&lt;-<span class="kw">mask</span>(PREC_AOI,AOI)</span>
<span id="cb27-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-35"></a>PREC_AOI&lt;-<span class="kw">stack</span>(PREC_AOI)</span>
<span id="cb27-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-36"></a><span class="co">#Open Temperatures layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb27-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-37"></a>TEMP&lt;-<span class="kw">stack</span>(<span class="st">&quot;Temp_Stack_81-00_CRU.tif&quot;</span>)</span>
<span id="cb27-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-38"></a>TEMP_AOI&lt;-<span class="kw">crop</span>(TEMP,AOI)</span>
<span id="cb27-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-39"></a>TEMP_AOI&lt;-<span class="kw">resample</span>(TEMP_AOI,SOC_MAP_AOI)</span>
<span id="cb27-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-40"></a>TEMP_AOI&lt;-<span class="kw">mask</span>(TEMP_AOI,AOI)</span>
<span id="cb27-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-41"></a>TEMP_AOI&lt;-<span class="kw">stack</span>(TEMP_AOI)</span>
<span id="cb27-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-42"></a><span class="co">#Open Potential Evapotranspiration layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb27-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-43"></a>PET&lt;-<span class="kw">stack</span>(<span class="st">&quot;PET_Stack_81-00_CRU.tif&quot;</span>)</span>
<span id="cb27-44"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-44"></a>PET_AOI&lt;-<span class="kw">crop</span>(PET,AOI)</span>
<span id="cb27-45"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-45"></a>PET_AOI&lt;-<span class="kw">resample</span>(PET_AOI,SOC_MAP_AOI)</span>
<span id="cb27-46"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-46"></a>PET_AOI&lt;-<span class="kw">mask</span>(PET_AOI,AOI)</span>
<span id="cb27-47"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-47"></a>PET_AOI&lt;-<span class="kw">stack</span>(PET_AOI)</span>
<span id="cb27-48"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-48"></a>Next, we will open, resample and mask the land use raster layer to be used <span class="cf">in</span> the spin up <span class="kw">phase</span> (representative <span class="dv">1980-2000</span> period).  In this example we will use the ESA land used reclassified into FAO land use <span class="kw">classes</span> (script <span class="dv">9</span>)</span>
<span id="cb27-49"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-49"></a><span class="co"># OPen Land Use layer reclassify to FAO classes </span></span>
<span id="cb27-50"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-50"></a><span class="co"># 0 No Data</span></span>
<span id="cb27-51"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-51"></a><span class="co"># 1 Artificial</span></span>
<span id="cb27-52"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-52"></a><span class="co"># 2 Croplands</span></span>
<span id="cb27-53"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-53"></a><span class="co"># 3 Grassland</span></span>
<span id="cb27-54"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-54"></a><span class="co"># 4 Tree Covered</span></span>
<span id="cb27-55"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-55"></a><span class="co"># 5 Shrubs Covered</span></span>
<span id="cb27-56"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-56"></a><span class="co"># 6 Herbaceous vegetation flooded</span></span>
<span id="cb27-57"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-57"></a><span class="co"># 7 Mangroves</span></span>
<span id="cb27-58"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-58"></a><span class="co"># 8 Sparse Vegetation</span></span>
<span id="cb27-59"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-59"></a><span class="co"># 9 Baresoil</span></span>
<span id="cb27-60"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-60"></a><span class="co"># 10 Snow and Glaciers</span></span>
<span id="cb27-61"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-61"></a><span class="co"># 11 Waterbodies</span></span>
<span id="cb27-62"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-62"></a><span class="co"># 12 TreeCrops</span></span>
<span id="cb27-63"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-63"></a><span class="kw">setwd</span>(WD_LU)</span>
<span id="cb27-64"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-64"></a>LU_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span>
<span id="cb27-65"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-65"></a>Then, we will open the vegetation cover <span class="kw">layers</span> (created <span class="cf">in</span> script number <span class="dv">7</span>)<span class="op">:</span></span>
<span id="cb27-66"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-66"></a><span class="co"># Open Vegetation Cover layer </span></span>
<span id="cb27-67"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-67"></a><span class="kw">setwd</span>(WD_COV)</span>
<span id="cb27-68"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb27-68"></a>Cov_AOI&lt;-<span class="kw">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span></code></pre></div>
<p>The script then creates a DR layer (DPM/RPM ratio). Here the DR layer is derived from the Land use layer, assigning default DPM/RPM ratios to each FAO land cover class (See Table 9.12). Users can modify these ratios according to local expertise and available local information.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-1"></a><span class="co"># Use Land use layer to convert it to DR layer </span></span>
<span id="cb28-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-2"></a><span class="co">#DPM/RPM (decomplosable vs resistant plant material)</span></span>
<span id="cb28-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-3"></a><span class="co">#(1) Most agricultural crops and improved grassland and tree crops 1.44 </span></span>
<span id="cb28-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-4"></a><span class="co">#(2) Unimproved grassland and schrub 0.67</span></span>
<span id="cb28-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-5"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb28-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-6"></a>DR&lt;-(LU_AOI<span class="op">==</span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">12</span>)<span class="op">*</span><span class="fl">1.44</span><span class="op">+</span><span class="st"> </span>(LU_AOI<span class="op">==</span><span class="dv">4</span>)<span class="op">*</span><span class="fl">0.25</span> <span class="op">+</span><span class="st"> </span>(LU_AOI<span class="op">==</span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">5</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">6</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">8</span>)<span class="op">*</span><span class="fl">0.67</span></span>
<span id="cb28-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-7"></a> Finally, we will create a stack with all the raster layers that have been prepared.</span>
<span id="cb28-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-8"></a> <span class="co"># STACK all layers</span></span>
<span id="cb28-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-9"></a>Stack_Set_AOI&lt;-<span class="kw">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,TEMP_AOI,PREC_AOI,PET_AOI,DR,LU_AOI,Cov_AOI)</span>
<span id="cb28-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-10"></a><span class="kw">setwd</span>(WD_STACK)</span>
<span id="cb28-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb28-11"></a><span class="kw">writeRaster</span>(Stack_Set_AOI,<span class="dt">filename=</span>(<span class="st">&quot;Stack_Set_SPIN_UP_AOI.tif&quot;</span>),<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-11.-warm_up_stack_v5.r" class="section level3">
<h3><span class="header-section-number">9.4.2</span> 9.7.2 Script Number 11. “WARM_UP_STACK_V5.R”</h3>
<p>Script number 11 is intended to harmonize all layers required to run the phase 2 (WARM UP) of the spatial RothC model. The result of this script is a simple raster stack which contains most of the layers needed for the warm-up phase. To generate the stack we will need the latest version of SOC FAO layer (master layer), the clay layer (from script number 8), land use layers (from script number 9), a land use stack (one land use layer per year), a vegetation cover stack (from script number 7) and the NPP stack (from script number 4). The climate layers and the NPP mean are additional layers that will be needed in the WARM UP phase but will not be part of this stack because of the final size of the output file.</p>
<p><strong>Table 9.10</strong> <em>Script Number 11. Stack layers for Warm Up phase. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.10.png" /></p>
<p>First, we will load the packages, set the number of years of the warmup phase and set the directories of each layer. Then we will open the country vector polygon boundaries:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-1"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb29-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-2"></a><span class="kw">library</span>(raster)</span>
<span id="cb29-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-3"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb29-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-4"></a><span class="co"># Set the number of years of the warm up</span></span>
<span id="cb29-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-5"></a>nWUP&lt;-<span class="dv">18</span></span>
<span id="cb29-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-6"></a>WD_AOI&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb29-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-7"></a></span>
<span id="cb29-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-8"></a>WD_SOC&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb29-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-9"></a>WD_CLAY&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/INPUTS/CLAY&quot;</span>)</span>
<span id="cb29-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-10"></a>WD_CLIM&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb29-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-11"></a>WD_LU&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb29-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-12"></a>WD_COV&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/COV&quot;</span>)</span>
<span id="cb29-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-13"></a>WD_STACK&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/STACK&quot;</span>)</span>
<span id="cb29-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-14"></a>WD_NPP&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/NPP&quot;</span>)</span>
<span id="cb29-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-15"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb29-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-16"></a><span class="kw">setwd</span>(WD_AOI)</span>
<span id="cb29-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb29-17"></a>AOI&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span></code></pre></div>
<p>Then, we will open the harmonized FAO GSOCmap of the country created in script number 0:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb30-1"></a><span class="co">#Open SOC MAP </span></span>
<span id="cb30-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb30-2"></a><span class="kw">setwd</span>(WD_SOC)</span>
<span id="cb30-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb30-3"></a>SOC_MAP_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb30-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb30-4"></a>Then we will open the clay layer created <span class="cf">in</span> script number <span class="dv">8</span><span class="op">:</span></span>
<span id="cb30-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb30-5"></a><span class="st"> </span><span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb30-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb30-6"></a><span class="kw">setwd</span>(WD_CLAY)</span>
<span id="cb30-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb30-7"></a>Clay_WA_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb30-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb30-8"></a>Clay_WA_AOI_res&lt;-<span class="kw">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;bilinear&#39;</span>) </span></code></pre></div>
<p>Then, we will open the Land Use layers required for the warm up phase (2000-2020). In this example we used the ESA land use (2015) reclassified into to the FAO land use classes.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb31-1"></a><span class="co"># OPen Land Use layer (ESA)</span></span>
<span id="cb31-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb31-2"></a><span class="kw">setwd</span>(WD_LU)</span>
<span id="cb31-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb31-3"></a>LU_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span></code></pre></div>
<p>We will then open the vegetation cover layer previously created in the script number 7:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb32-1"></a><span class="co"># Open Vegetation Cover layer </span></span>
<span id="cb32-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb32-2"></a><span class="kw">setwd</span>(WD_COV)</span>
<span id="cb32-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb32-3"></a>Cov_AOI&lt;-<span class="kw">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span></code></pre></div>
<p>If year to year land use layers are available for the warm up phase (2000-2020), we will open the Land Use stack of the annual land use layers. If annual land use layers are not available, we will just replicate a representative land use layer for the warm-up phase, as previously loaded.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb33-1"></a><span class="co"># Open Land Use Stack , One Land use layer for each year (in this example we use the same LU for the 18/20 year #period set previously in the nWUP variable</span></span>
<span id="cb33-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb33-2"></a> LU_Stack &lt;-<span class="kw">stack</span>(<span class="kw">replicate</span>(nWUP, LU_AOI))</span></code></pre></div>
<p>Then, we will create a “DR” stack layer, one DR layer per year of the WARM UP phase.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb34-1"></a><span class="co"># Create DR Layer from LU layer (ESA land use , 14 classes)</span></span>
<span id="cb34-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb34-2"></a><span class="co">#DPM/RPM (decomposable vs resistant plant material)</span></span>
<span id="cb34-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb34-3"></a><span class="co">#(1) Most agricultural crops and improved grassland or tree crops 1.44 </span></span>
<span id="cb34-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb34-4"></a><span class="co">#(2) Unimproved grassland and shrub 0.67</span></span>
<span id="cb34-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb34-5"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb34-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb34-6"></a>DR&lt;-(LU_AOI<span class="op">==</span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">12</span>)<span class="op">*</span><span class="fl">1.44</span><span class="op">+</span><span class="st"> </span>(LU_AOI<span class="op">==</span><span class="dv">4</span>)<span class="op">*</span><span class="fl">0.25</span> <span class="op">+</span><span class="st"> </span>(LU_AOI<span class="op">==</span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">5</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">6</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">8</span>)<span class="op">*</span><span class="fl">0.67</span></span>
<span id="cb34-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb34-7"></a>DR_Stack&lt;-LU_Stack</span>
<span id="cb34-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb34-8"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nlayers</span>(LU_Stack)){</span>
<span id="cb34-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb34-9"></a>DR_Stack[[i]]&lt;-(LU_Stack[[i]]<span class="op">==</span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span>LU_Stack[[i]]<span class="op">==</span><span class="dv">12</span>)<span class="op">*</span><span class="fl">1.44</span><span class="op">+</span><span class="st"> </span>(LU_Stack[[i]]<span class="op">==</span><span class="dv">4</span>)<span class="op">*</span><span class="fl">0.25</span> <span class="op">+</span><span class="st"> </span>(LU_Stack[[i]]<span class="op">==</span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>LU_Stack[[i]]<span class="op">==</span><span class="dv">5</span> <span class="op">|</span><span class="st"> </span>LU_Stack[[i]]<span class="op">==</span><span class="dv">6</span> <span class="op">|</span><span class="st"> </span>LU_Stack[[i]]<span class="op">==</span><span class="dv">8</span>)<span class="op">*</span><span class="fl">0.67</span></span>
<span id="cb34-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb34-10"></a>}</span></code></pre></div>
<p>Finally, we will run the rest of the code and save the raster stack containing all the necessary layers to run the ‘warm up’ phase.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb35-1"></a><span class="co"># STACK all layers</span></span>
<span id="cb35-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb35-2"></a>Stack_Set_AOI&lt;-<span class="kw">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,Cov_AOI,LU_Stack,DR_Stack)</span>
<span id="cb35-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb35-3"></a><span class="kw">setwd</span>(WD_STACK)</span>
<span id="cb35-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb35-4"></a><span class="kw">writeRaster</span>(Stack_Set_AOI,<span class="dt">filename=</span>(<span class="st">&quot;Stack_Set_WARM_UP_AOI.tif&quot;</span>),<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
<div id="script-number-12.-forward_stack.r" class="section level3">
<h3><span class="header-section-number">9.4.3</span> 9.7.3 Script Number 12. “FORWARD_STACK.R”</h3>
<p>Script number 12 harmonizes all layers needed to run phase 3 (forward) of the spatial Roth C model. The result of the script is a simple raster stack which contains the layers needed to perform the forward phase. To generate the stack we will need the SOC FAO layer (master layer), the clay layer (from script number 8), the three climate stacks required for the forward phase (from script number 2), the land use layer or the forward phase (from script number 9), and the vegetation cover stack (from script number 7).</p>
<p><strong>Table 9.11</strong> <em>Script Number 12. Stack layers for forward phase. Inputs and Outputs.</em></p>
<p><img src="tables/Table_9.11.png" /></p>
<p>First, we will load the packages, set path to the files directories and open the country vector polygon boundaries.</p>
<div id="prepare-the-layers-for-the-foward-mode-roth-c-model." class="section level4">
<h4><span class="header-section-number">9.4.3.1</span> Prepare the layers for the FOWARD Mode Roth C Model.</h4>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-1"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb36-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-2"></a><span class="kw">library</span>(raster)</span>
<span id="cb36-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-3"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb36-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-4"></a></span>
<span id="cb36-5"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-5"></a>WD_AOI&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/AOI_POLYGON&quot;</span>)</span>
<span id="cb36-6"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-6"></a>WD_SOC&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/SOC_MAP&quot;</span>)</span>
<span id="cb36-7"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-7"></a>WD_CLAY&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CLAY&quot;</span>)</span>
<span id="cb36-8"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-8"></a>WD_CLIM&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/CRU_LAYERS&quot;</span>)</span>
<span id="cb36-9"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-9"></a>WD_LU&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/LAND_USE&quot;</span>)</span>
<span id="cb36-10"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-10"></a>WD_COV&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/COV&quot;</span>)</span>
<span id="cb36-11"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-11"></a>WD_STACK&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/INPUTS/STACK&quot;</span>)</span>
<span id="cb36-12"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-12"></a><span class="co"># Open the shapefile of the region/country</span></span>
<span id="cb36-13"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-13"></a><span class="kw">setwd</span>(WD_AOI)</span>
<span id="cb36-14"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-14"></a>AOI&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;Departamento_Pergamino.shp&quot;</span>)</span>
<span id="cb36-15"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-15"></a>Then, we will open the SOC layer and the clay layer.</span>
<span id="cb36-16"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-16"></a><span class="co">#Open SOC MAP </span></span>
<span id="cb36-17"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-17"></a><span class="kw">setwd</span>(WD_SOC)</span>
<span id="cb36-18"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-18"></a>SOC_MAP_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;SOC_MAP_AOI.tif&quot;</span>)</span>
<span id="cb36-19"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-19"></a><span class="co"># Open Clay layers  (ISRIC)</span></span>
<span id="cb36-20"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-20"></a><span class="kw">setwd</span>(WD_CLAY)</span>
<span id="cb36-21"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-21"></a>Clay_WA_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;Clay_WA_AOI.tif&quot;</span>)</span>
<span id="cb36-22"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-22"></a>Clay_WA_AOI_res&lt;-<span class="kw">resample</span>(Clay_WA_AOI,SOC_MAP_AOI,<span class="dt">method=</span><span class="st">&#39;bilinear&#39;</span>) </span>
<span id="cb36-23"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-23"></a></span>
<span id="cb36-24"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-24"></a>Then we will open the <span class="dv">2000-2020</span> average climate layers <span class="kw">created</span> (as the one created <span class="cf">in</span> script number <span class="dv">2</span>)</span>
<span id="cb36-25"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-25"></a><span class="co">#Open Precipitation layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb36-26"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-26"></a><span class="kw">setwd</span>(WD_CLIM)</span>
<span id="cb36-27"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-27"></a>PREC&lt;-<span class="kw">stack</span>(<span class="st">&quot;Prec_Stack_01-18_CRU.tif&quot;</span>)</span>
<span id="cb36-28"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-28"></a>PREC_AOI&lt;-<span class="kw">crop</span>(PREC,AOI)</span>
<span id="cb36-29"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-29"></a>PREC_AOI&lt;-<span class="kw">resample</span>(PREC_AOI,SOC_MAP_AOI)</span>
<span id="cb36-30"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-30"></a>PREC_AOI&lt;-<span class="kw">mask</span>(PREC_AOI,AOI)</span>
<span id="cb36-31"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-31"></a>PREC_AOI&lt;-<span class="kw">stack</span>(PREC_AOI)</span>
<span id="cb36-32"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-32"></a><span class="co">#Open Temperatures layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb36-33"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-33"></a>TEMP&lt;-<span class="kw">stack</span>(<span class="st">&quot;Temp_Stack_01-18_CRU.tif&quot;</span>)</span>
<span id="cb36-34"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-34"></a>TEMP_AOI&lt;-<span class="kw">crop</span>(TEMP,AOI)</span>
<span id="cb36-35"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-35"></a>TEMP_AOI&lt;-<span class="kw">resample</span>(TEMP_AOI,SOC_MAP_AOI)</span>
<span id="cb36-36"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-36"></a>TEMP_AOI&lt;-<span class="kw">mask</span>(TEMP_AOI,AOI)</span>
<span id="cb36-37"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-37"></a>TEMP_AOI&lt;-<span class="kw">stack</span>(TEMP_AOI)</span>
<span id="cb36-38"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-38"></a><span class="co">#Open Potential Evapotranspiration layer (CRU https://crudata.uea.ac.uk/cru/data/hrg/)</span></span>
<span id="cb36-39"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-39"></a>PET&lt;-<span class="kw">stack</span>(<span class="st">&quot;PET_Stack_01-18_CRU.tif&quot;</span>)</span>
<span id="cb36-40"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-40"></a>PET_AOI&lt;-<span class="kw">crop</span>(PET,AOI)</span>
<span id="cb36-41"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-41"></a>PET_AOI&lt;-<span class="kw">resample</span>(PET_AOI,SOC_MAP_AOI)</span>
<span id="cb36-42"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-42"></a>PET_AOI&lt;-<span class="kw">mask</span>(PET_AOI,AOI)</span>
<span id="cb36-43"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-43"></a>PET_AOI&lt;-<span class="kw">stack</span>(PET_AOI)</span>
<span id="cb36-44"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-44"></a>Then, we will open the land use <span class="kw">layer</span> (latest available year) created <span class="cf">in</span> script number <span class="fl">10.</span></span>
<span id="cb36-45"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-45"></a><span class="kw">setwd</span>(WD_LU)</span>
<span id="cb36-46"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-46"></a>LU_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span>
<span id="cb36-47"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-47"></a>Then, we will open the vegetation cover layer created <span class="cf">in</span> script number <span class="fl">7.</span></span>
<span id="cb36-48"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-48"></a><span class="co"># Open Vegetation Cover </span></span>
<span id="cb36-49"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-49"></a><span class="kw">setwd</span>(WD_COV)</span>
<span id="cb36-50"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-50"></a>Cov_AOI&lt;-<span class="kw">stack</span>(<span class="st">&#39;Cov_stack_AOI.tif&#39;</span>)</span>
<span id="cb36-51"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-51"></a>As <span class="cf">in</span> the previous scripts, this script creates a DR <span class="kw">layer</span> (DPM<span class="op">/</span>RPM ratio), assigning default DPM<span class="op">/</span>RPM ratios to each FAO land cover <span class="kw">class</span> (See Table <span class="fl">9.12</span>). Users can modify these ratios according to local expertise and available local information. </span>
<span id="cb36-52"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-52"></a><span class="co"># Open Land use layer and convert it to DR layer (mod 12 , 14 classes)</span></span>
<span id="cb36-53"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-53"></a><span class="co">#DPM/RPM (decomplosable vs resistant plant material...como se divide los C inputs)</span></span>
<span id="cb36-54"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-54"></a><span class="co">#(1) Most agricultural crops and improved grassland or tree crops 1.44 </span></span>
<span id="cb36-55"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-55"></a><span class="co">#(2) Unimproved grassland and schrub 0.67</span></span>
<span id="cb36-56"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-56"></a><span class="co">#(3) Deciduous and tropical woodland 0.25    </span></span>
<span id="cb36-57"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb36-57"></a>DR&lt;-(LU_AOI<span class="op">==</span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">12</span>)<span class="op">*</span><span class="fl">1.44</span><span class="op">+</span><span class="st"> </span>(LU_AOI<span class="op">==</span><span class="dv">4</span>)<span class="op">*</span><span class="fl">0.25</span> <span class="op">+</span><span class="st"> </span>(LU_AOI<span class="op">==</span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">5</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">6</span> <span class="op">|</span><span class="st"> </span>LU_AOI<span class="op">==</span><span class="dv">8</span>)<span class="op">*</span><span class="fl">0.67</span></span></code></pre></div>
<p>We will create a stack for the forward modelling phase. We will have to define the filename and save the output stack.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb37-1"></a><span class="co"># STACK all layers</span></span>
<span id="cb37-2"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb37-2"></a>Stack_Set_AR&lt;-<span class="kw">stack</span>(SOC_MAP_AOI,Clay_WA_AOI_res,TEMP_AOI,PREC_AOI,PET_AOI,DR,LU_AOI,Cov_AOI)</span>
<span id="cb37-3"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb37-3"></a><span class="kw">setwd</span>(WD_STACK)</span>
<span id="cb37-4"><a href="chapter-9-stage-1-preparation-of-input-data.html#cb37-4"></a><span class="kw">writeRaster</span>(Stack_Set_AR,<span class="dt">filename=</span>(<span class="st">&quot;Stack_Set_FOWARD.tif&quot;</span>),<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="defining-target-points-to-run-the-model" class="section level2">
<h2><span class="header-section-number">9.5</span> 9.8 Defining target points to run the model</h2>
<p>At this point we have three raster stacks for the different modelling phases. We need to create the points where those simulations will be run in order to accelerate the modelling process. These points will be the center of the pixels of the master layer (GSOCmap layer, script number 7). Later, we will convert the points containing the modelling output values back to a raster layer format.</p>
<div id="qgis-procedure-number-1-model" class="section level3">
<h3><span class="header-section-number">9.5.1</span> 9.8.1 QGIS Procedure number 1 (model)</h3>
<p>We will need the land use data of each pixel (we already corregistered the land use layer with the master layer at script number 7). Then we will use the land use layer of the country to generate the points. For this, we can use a QGIS model to create target points.</p>
<p><strong>Table 9.12</strong> <em>QGis procedure number 1. Create target points to run the model. Inputs and Outputs</em></p>
<p><img src="tables/Table_9.12.png" /></p>
<p>We will open the Qgis, then go to the processing toolbox and click on the “open existing model” button. We will have to search for the model in the provided folder, called “4_Points_country”. We will have to load the model called “Qgis_Procedure_number_1.model3”. Once this is done, we can run the model from the processing toolbox.</p>
<div class="figure">
<img src="images/Figure_9.4.png" alt="" />
<p class="caption"><strong>Figure 9.4</strong> <em>Processing toolbox in Qgis</em></p>
</div>
<p>We will click the Empty_Points button and a window will pop up. We will select the Land use layer created in script number 10 (already resampled to match the extent and pixel size of the GSOCmap), set the path and the name of the output file, and click on the Execute button.</p>
<div class="figure">
<img src="images/Figure_9.5.png" alt="" />
<p class="caption"><strong>Figure 9.5</strong> <em>Qgis Window to edit the points generated.</em></p>
</div>
<p>This process will create vector points. Each point will be created in the centroid of each pixel of the land use layer. This vector will contain no fields. The scripts to run the model for each phase (SPIN_UP, WARM_UP, forward) will attach all the necessary data from the stacks (scripts number 10, 11 and 12) to each point.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-8-running-the-scripts-overview.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-10-stage-2-running-the-model.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/FAO-GSP/SOC-Mapping-Cookbook/edit/master/09.Stage1_Preparation_of_input_data.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SOCMapping.pdf", "SOCMapping.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
