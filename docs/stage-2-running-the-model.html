<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 | Stage 2: running the model | Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq</title>
  <meta name="description" content="The GSOCseq Technical Manual" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 | Stage 2: running the model | Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The GSOCseq Technical Manual" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 | Stage 2: running the model | Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq" />
  
  <meta name="twitter:description" content="The GSOCseq Technical Manual" />
  

<meta name="author" content="Food and Agriculture Organization of the United Nations, Rome, 2020" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="stage-1-preparation-of-input-data.html"/>
<link rel="next" href="stage-3-map-generation.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>List of contributors</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributers-and-reviewers"><i class="fa fa-check"></i>Contributers and Reviewers</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#special-advisor"><i class="fa fa-check"></i>Special Advisor</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="presentation.html"><a href="presentation.html"><i class="fa fa-check"></i><b>1</b> | Presentation</a><ul>
<li class="chapter" data-level="1.1" data-path="presentation.html"><a href="presentation.html#how-to-use-this-book"><i class="fa fa-check"></i><b>1.1</b> How to use this book</a></li>
<li class="chapter" data-level="1.2" data-path="presentation.html"><a href="presentation.html#the-sample-data-set"><i class="fa fa-check"></i><b>1.2</b> The sample data set</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="soil-organic-carbon-soc-sequestration.html"><a href="soil-organic-carbon-soc-sequestration.html"><i class="fa fa-check"></i><b>2</b> | Soil Organic Carbon (SOC) sequestration</a><ul>
<li class="chapter" data-level="2.1" data-path="soil-organic-carbon-soc-sequestration.html"><a href="soil-organic-carbon-soc-sequestration.html#soil-carbon"><i class="fa fa-check"></i><b>2.1</b> Soil carbon</a></li>
<li class="chapter" data-level="2.2" data-path="soil-organic-carbon-soc-sequestration.html"><a href="soil-organic-carbon-soc-sequestration.html#soc-sequestration"><i class="fa fa-check"></i><b>2.2</b> SOC sequestration</a></li>
<li class="chapter" data-level="2.3" data-path="soil-organic-carbon-soc-sequestration.html"><a href="soil-organic-carbon-soc-sequestration.html#factors-affecting-soc-sequestration"><i class="fa fa-check"></i><b>2.3</b> Factors affecting SOC sequestration</a></li>
<li class="chapter" data-level="2.4" data-path="soil-organic-carbon-soc-sequestration.html"><a href="soil-organic-carbon-soc-sequestration.html#estimating-soc-sequestration-potential"><i class="fa fa-check"></i><b>2.4</b> Estimating SOC sequestration potential</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="soc-modelling.html"><a href="soc-modelling.html"><i class="fa fa-check"></i><b>3</b> | SOC Modelling</a><ul>
<li class="chapter" data-level="3.1" data-path="soc-modelling.html"><a href="soc-modelling.html#process-oriented-models"><i class="fa fa-check"></i><b>3.1</b> Process-oriented models</a></li>
<li class="chapter" data-level="3.2" data-path="soc-modelling.html"><a href="soc-modelling.html#examples-of-process-oriented-models"><i class="fa fa-check"></i><b>3.2</b> Examples of process-oriented models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="the-rothc-model.html"><a href="the-rothc-model.html"><i class="fa fa-check"></i><b>4</b> | The RothC model</a><ul>
<li class="chapter" data-level="4.1" data-path="the-rothc-model.html"><a href="the-rothc-model.html#model-description"><i class="fa fa-check"></i><b>4.1</b> Model description</a></li>
<li class="chapter" data-level="4.2" data-path="the-rothc-model.html"><a href="the-rothc-model.html#rothc-general-data-requirements"><i class="fa fa-check"></i><b>4.2</b> RothC general data requirements</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html"><i class="fa fa-check"></i><b>5</b> | Modelling approach for the GSOCseq</a><ul>
<li class="chapter" data-level="5.1" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#general-framework"><i class="fa fa-check"></i><b>5.1</b> General framework</a></li>
<li class="chapter" data-level="5.2" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#potential-soc-sequestration-estimates-after-the-implementation-of-ssm-practices"><i class="fa fa-check"></i><b>5.2</b> Potential SOC sequestration estimates after the implementation of SSM practices</a></li>
<li class="chapter" data-level="5.3" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#business-as-usual-and-sustainable-soil-management-scenarios"><i class="fa fa-check"></i><b>5.3</b> Business as usual and sustainable soil management scenarios</a></li>
<li class="chapter" data-level="5.4" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#general-modeling-procedures"><i class="fa fa-check"></i><b>5.4</b> General modeling procedures</a><ul>
<li class="chapter" data-level="5.4.1" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#initialization-long-spin-up"><i class="fa fa-check"></i><b>5.4.1</b> Initialization: Long spin-up</a></li>
<li class="chapter" data-level="5.4.2" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#short-spin-up"><i class="fa fa-check"></i><b>5.4.2</b> Short spin-up</a></li>
<li class="chapter" data-level="5.4.3" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#forward-runs"><i class="fa fa-check"></i><b>5.4.3</b> Forward runs</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="modelling-approach-for-the-gsocseq.html"><a href="modelling-approach-for-the-gsocseq.html#summary"><i class="fa fa-check"></i><b>5.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html"><i class="fa fa-check"></i><b>6</b> | Datasets and inputs</a><ul>
<li class="chapter" data-level="6.1" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#climate-datasets"><i class="fa fa-check"></i><b>6.1</b> Climate datasets</a></li>
<li class="chapter" data-level="6.2" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#soil-datasets"><i class="fa fa-check"></i><b>6.2</b> Soil datasets</a><ul>
<li class="chapter" data-level="6.2.1" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#initial-total-soc-stocks"><i class="fa fa-check"></i><b>6.2.1</b> Initial total SOC stocks</a></li>
<li class="chapter" data-level="6.2.2" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#initial-c-pools"><i class="fa fa-check"></i><b>6.2.2</b> Initial C pools</a></li>
<li class="chapter" data-level="6.2.3" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#soil-texture-clay-content"><i class="fa fa-check"></i><b>6.2.3</b> Soil texture: clay content</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#land-cover-datasets"><i class="fa fa-check"></i><b>6.3</b> Land cover datasets</a></li>
<li class="chapter" data-level="6.4" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#monthly-vegetation-cover"><i class="fa fa-check"></i><b>6.4</b> Monthly vegetation cover</a></li>
<li class="chapter" data-level="6.5" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#monthly-carbon-inputs"><i class="fa fa-check"></i><b>6.5</b> Monthly carbon inputs:</a><ul>
<li class="chapter" data-level="6.5.1" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#c-inputs-under-bau-practices"><i class="fa fa-check"></i><b>6.5.1</b> C inputs under BAU practices:</a></li>
<li class="chapter" data-level="6.5.2" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#c-inputs-under-ssm-practices"><i class="fa fa-check"></i><b>6.5.2</b> C inputs under SSM practices:</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#residue-decomposability-decomposable-to-resistant-plant-material-ratio-dpmrpm"><i class="fa fa-check"></i><b>6.6</b> Residue decomposability: decomposable to resistant plant material ratio (DPM/RPM)</a></li>
<li class="chapter" data-level="6.7" data-path="datasets-and-inputs.html"><a href="datasets-and-inputs.html#required-datasets-and-global-data-sources.-summary"><i class="fa fa-check"></i><b>6.7</b> Required datasets and global data sources. Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="software-environment.html"><a href="software-environment.html"><i class="fa fa-check"></i><b>7</b> | Software environment</a><ul>
<li class="chapter" data-level="7.1" data-path="software-environment.html"><a href="software-environment.html#setting-up-the-software-environment-r-rstudio-and-r-packages"><i class="fa fa-check"></i><b>7.1</b> Setting up the software environment: R, RStudio and R Packages</a><ul>
<li class="chapter" data-level="7.1.1" data-path="software-environment.html"><a href="software-environment.html#obtaining-and-installing-r"><i class="fa fa-check"></i><b>7.1.1</b> Obtaining and installing R</a></li>
<li class="chapter" data-level="7.1.2" data-path="software-environment.html"><a href="software-environment.html#obtaining-and-installing-rstudio"><i class="fa fa-check"></i><b>7.1.2</b> Obtaining and installing RStudio</a></li>
<li class="chapter" data-level="7.1.3" data-path="software-environment.html"><a href="software-environment.html#getting-started-with-r"><i class="fa fa-check"></i><b>7.1.3</b> Getting started with R</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="software-environment.html"><a href="software-environment.html#r-packages"><i class="fa fa-check"></i><b>7.2</b> R packages</a><ul>
<li class="chapter" data-level="7.2.1" data-path="software-environment.html"><a href="software-environment.html#finding-r-packages"><i class="fa fa-check"></i><b>7.2.1</b> Finding R packages</a></li>
<li class="chapter" data-level="7.2.2" data-path="software-environment.html"><a href="software-environment.html#some-useful-r-packages-for-the-socseq-maps"><i class="fa fa-check"></i><b>7.2.2</b> Some useful R-packages for the SOCseq maps</a></li>
<li class="chapter" data-level="7.2.3" data-path="software-environment.html"><a href="software-environment.html#installation-of-r-packages-used-in-this-technical-manual"><i class="fa fa-check"></i><b>7.2.3</b> Installation of R-Packages used in this technical manual</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="software-environment.html"><a href="software-environment.html#considerations-when-using-r"><i class="fa fa-check"></i><b>7.3</b> Considerations when using R</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html"><i class="fa fa-check"></i><b>8</b> | Running the scripts: overview</a><ul>
<li class="chapter" data-level="8.1" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html#summary-of-steps-and-scripts"><i class="fa fa-check"></i><b>8.1</b> Summary of steps and scripts</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html#stage-1-preparation-of-data"><i class="fa fa-check"></i><b>8.2</b> Stage 1: Preparation of data</a></li>
<li class="chapter" data-level="8.3" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html#stage-2-running-the-model"><i class="fa fa-check"></i><b>8.3</b> Stage 2: Running the model</a></li>
<li class="chapter" data-level="8.4" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html#stage-3-generation-of-the-map"><i class="fa fa-check"></i><b>8.4</b> Stage 3: generation of the map</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html"><i class="fa fa-check"></i><b>9</b> | Stage 1: preparation of input data</a><ul>
<li class="chapter" data-level="9.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#preparation-of-soc-layer"><i class="fa fa-check"></i><b>9.1</b> Preparation of SOC layer</a><ul>
<li class="chapter" data-level="9.1.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-0.soc_map_aoi.r"><i class="fa fa-check"></i><b>9.1.1</b> Script Number 0.“SOC_MAP_AOI.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#preparation-of-climate-layers"><i class="fa fa-check"></i><b>9.2</b> Preparation of climate Layers</a><ul>
<li class="chapter" data-level="9.2.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-1.cru_variables_spin_up.r"><i class="fa fa-check"></i><b>9.2.1</b> Script Number 1.“CRU_variables_SPIN_UP.R”</a></li>
<li class="chapter" data-level="9.2.2" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-2.-cru_variables_warm_up.r"><i class="fa fa-check"></i><b>9.2.2</b> Script Number 2. “CRU_variables_WARM_UP.R”</a></li>
<li class="chapter" data-level="9.2.3" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-3.-preparation-of-cru-files-to-estimate-npp-1981-2000"><i class="fa fa-check"></i><b>9.2.3</b> Script Number 3. Preparation of CRU files to estimate NPP 1981-2000</a></li>
<li class="chapter" data-level="9.2.4" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-5.-miami-model-npp-mean-1981-2000"><i class="fa fa-check"></i><b>9.2.4</b> Script Number 5. MIAMI model NPP mean 1981-2000</a></li>
<li class="chapter" data-level="9.2.5" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-6.-monthly_vegetation_cover-vegetation-cover-from-google-earth-engine."><i class="fa fa-check"></i><b>9.2.5</b> Script Number 6. “Monthly_vegetation_cover” vegetation cover from Google Earth Engine.</a></li>
<li class="chapter" data-level="9.2.6" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-7.-vegetation_cover_stack.r"><i class="fa fa-check"></i><b>9.2.6</b> Script Number 7. “Vegetation_Cover_stack.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#preparing-the-land-use-layer"><i class="fa fa-check"></i><b>9.3</b> Preparing the land use layer</a><ul>
<li class="chapter" data-level="9.3.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-9-land_use_esa_to_fao_classes.r"><i class="fa fa-check"></i><b>9.3.1</b> Script Number 9 “Land_Use_ESA_to_FAO_classes.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#harmonization-of-soil-climate-and-vegetation-layers."><i class="fa fa-check"></i><b>9.4</b> Harmonization of soil, climate and vegetation layers.</a><ul>
<li class="chapter" data-level="9.4.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-10.-spin_up_stack.v3.r"><i class="fa fa-check"></i><b>9.4.1</b> Script Number 10. “SPIN_UP_STACK.v3.R”</a></li>
<li class="chapter" data-level="9.4.2" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-11.-warm_up_stack_v5.r"><i class="fa fa-check"></i><b>9.4.2</b> Script Number 11. “WARM_UP_STACK_V5.R”</a></li>
<li class="chapter" data-level="9.4.3" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#script-number-12.-forward_stack.r"><i class="fa fa-check"></i><b>9.4.3</b> Script Number 12. “FORWARD_STACK.R”</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#defining-target-points-to-run-the-model"><i class="fa fa-check"></i><b>9.5</b> Defining target points to run the model</a><ul>
<li class="chapter" data-level="9.5.1" data-path="stage-1-preparation-of-input-data.html"><a href="stage-1-preparation-of-input-data.html#qgis-procedure-number-1-model"><i class="fa fa-check"></i><b>9.5.1</b> QGIS Procedure number 1 (model)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="running-the-scripts-overview.html"><a href="running-the-scripts-overview.html#stage-2-running-the-model"><i class="fa fa-check"></i><b>10</b> | Stage 2: running the model</a><ul>
<li class="chapter" data-level="10.1" data-path="stage-2-running-the-model.html"><a href="stage-2-running-the-model.html"><i class="fa fa-check"></i><b>10.1</b> Script Number 13. “ROTH_C_SPIN_UP_v2.R”</a></li>
<li class="chapter" data-level="10.2" data-path="stage-2-running-the-model.html"><a href="stage-2-running-the-model.html#script-number-14.-roth_c_warm_up_v4.r"><i class="fa fa-check"></i><b>10.2</b> Script Number 14. “ROTH_C_WARM_UP_v4.R”</a><ul>
<li class="chapter" data-level="10.2.1" data-path="stage-2-running-the-model.html"><a href="stage-2-running-the-model.html#script-number-15.-roth_c_forward_v2.r"><i class="fa fa-check"></i><b>10.2.1</b> Script Number 15. “ROTH_C_forward_v2.R”</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="stage-3-map-generation.html"><a href="stage-3-map-generation.html"><i class="fa fa-check"></i><b>11</b> | Stage 3: Map generation</a><ul>
<li class="chapter" data-level="11.1" data-path="stage-3-map-generation.html"><a href="stage-3-map-generation.html#script-number-16-points_to_raster.r"><i class="fa fa-check"></i><b>11.1</b> Script Number 16: “Points_to_Raster.R”</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="uncertainty-and-validation.html"><a href="uncertainty-and-validation.html"><i class="fa fa-check"></i><b>12</b> | Uncertainty and validation</a></li>
<li class="chapter" data-level="13" data-path="data-sharing.html"><a href="data-sharing.html"><i class="fa fa-check"></i><b>13</b> | Data sharing</a><ul>
<li class="chapter" data-level="13.1" data-path="data-sharing.html"><a href="data-sharing.html#general-principles"><i class="fa fa-check"></i><b>13.1</b> General principles</a></li>
<li class="chapter" data-level="13.2" data-path="data-sharing.html"><a href="data-sharing.html#data-formats-and-integrity"><i class="fa fa-check"></i><b>13.2</b> Data formats and integrity</a></li>
<li class="chapter" data-level="13.3" data-path="data-sharing.html"><a href="data-sharing.html#data-correctness"><i class="fa fa-check"></i><b>13.3</b> Data correctness</a></li>
<li class="chapter" data-level="13.4" data-path="data-sharing.html"><a href="data-sharing.html#data-completeness"><i class="fa fa-check"></i><b>13.4</b> Data completeness</a></li>
<li class="chapter" data-level="13.5" data-path="data-sharing.html"><a href="data-sharing.html#other-modes-of-data-sharing"><i class="fa fa-check"></i><b>13.5</b> Other modes of data sharing</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="limitations-knowledge-gaps-and-way-forward.html"><a href="limitations-knowledge-gaps-and-way-forward.html"><i class="fa fa-check"></i><b>14</b> | Limitations, knowledge gaps and way forward</a></li>
<li class="chapter" data-level="15" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>15</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Technical Manual Global Soil Organic Carbon Sequestration Potential Map GSOCseq</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stage-2-running-the-model" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> | Stage 2: running the model</h1>
<p>Once all input layers are prepared, harmonized and stacked, we will run the three modeling phases. At this stage, we will run the model three times, once for each phase, so we will need three different scripts (scripts 13, 14 and 15), which use the same RothC function. For each script we will need the created raster stacks (in the case of the warm up phase we will also include the climate stacks), and the created target points. Each script will generate output vector points (containing the modeling results, i.e. SOC stocks of the different carbon pools of the RothC model). The output vector of each phase will be used as an input of the next modeling phase. Finally, after running the ‘forward’ phase, we will obtain an output vector file containing the SOC data for each projected scenario. This output vector will be used in the final script to generate the raster files to build the sequestration potential maps.</p>
<p>In each phase and script we will use the same RothC function. The RothC function is the core of the next three scripts and will be used to simulate the different C pools over the defined time periods. In the following a brief overview of the commands we will be running to perform the RothC calculations.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="stage-2-running-the-model.html#cb37-1"></a><span class="co"># ROTH C MODEL FUNCTION .</span></span>
<span id="cb37-2"><a href="stage-2-running-the-model.html#cb37-2"></a><span class="co">########## function set up starts############### </span></span>
<span id="cb37-3"><a href="stage-2-running-the-model.html#cb37-3"></a>Roth_C&lt;-<span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1){</span></code></pre></div>
<p>This function will calculate first the “Temperature factor per month” using a function from the SOILR package called “fT.RothC” :</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="stage-2-running-the-model.html#cb38-1"></a><span class="co">#Temperature factor per month</span></span>
<span id="cb38-2"><a href="stage-2-running-the-model.html#cb38-2"></a>fT=<span class="kw">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span></code></pre></div>
<p>Then the function will calculate the “Moisture factor per month” (this function was modified from the original SOILR moisture function, to include the soil cover effect, as in the original RothC model (See Chapter 4):</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="stage-2-running-the-model.html#cb39-1"></a><span class="co">#Moisture effects per month . </span></span>
<span id="cb39-2"><a href="stage-2-running-the-model.html#cb39-2"></a>fw1func&lt;-<span class="cf">function</span>(P, E, <span class="dt">S.Thick =</span> <span class="dv">30</span>, <span class="dt">pClay =</span> <span class="fl">32.0213</span>, <span class="dt">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb39-3"><a href="stage-2-running-the-model.html#cb39-3"></a>{</span>
<span id="cb39-4"><a href="stage-2-running-the-model.html#cb39-4"></a>   </span>
<span id="cb39-5"><a href="stage-2-running-the-model.html#cb39-5"></a>    M =<span class="st"> </span>P <span class="op">-</span><span class="st"> </span>E <span class="op">*</span><span class="st"> </span>pE</span>
<span id="cb39-6"><a href="stage-2-running-the-model.html#cb39-6"></a>    Acc.TSMD =<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb39-7"><a href="stage-2-running-the-model.html#cb39-7"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(M)) {</span>
<span id="cb39-8"><a href="stage-2-running-the-model.html#cb39-8"></a>    B =<span class="st"> </span><span class="kw">ifelse</span>(bare[i] <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb39-9"><a href="stage-2-running-the-model.html#cb39-9"></a>     Max.TSMD =<span class="st"> </span><span class="op">-</span>(<span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="fl">1.3</span> <span class="op">*</span><span class="st"> </span>pClay <span class="op">-</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">*</span><span class="st"> </span>(pClay<span class="op">^</span><span class="dv">2</span>)) <span class="op">*</span><span class="st"> </span>(S.Thick<span class="op">/</span><span class="dv">23</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>B)</span>
<span id="cb39-10"><a href="stage-2-running-the-model.html#cb39-10"></a>        Acc.TSMD[<span class="dv">1</span>] =<span class="st"> </span><span class="kw">ifelse</span>(M[<span class="dv">1</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb39-11"><a href="stage-2-running-the-model.html#cb39-11"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>M[i] <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb39-12"><a href="stage-2-running-the-model.html#cb39-12"></a>            Acc.TSMD[i] =<span class="st"> </span>Acc.TSMD[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>M[i]</span>
<span id="cb39-13"><a href="stage-2-running-the-model.html#cb39-13"></a>        }</span>
<span id="cb39-14"><a href="stage-2-running-the-model.html#cb39-14"></a>        <span class="cf">else</span> (Acc.TSMD[i] =<span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb39-15"><a href="stage-2-running-the-model.html#cb39-15"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="op">&lt;=</span><span class="st"> </span>Max.TSMD) {</span>
<span id="cb39-16"><a href="stage-2-running-the-model.html#cb39-16"></a>            Acc.TSMD[i] =<span class="st"> </span>Max.TSMD</span>
<span id="cb39-17"><a href="stage-2-running-the-model.html#cb39-17"></a>        }</span>
<span id="cb39-18"><a href="stage-2-running-the-model.html#cb39-18"></a>    }</span>
<span id="cb39-19"><a href="stage-2-running-the-model.html#cb39-19"></a>    b =<span class="st"> </span><span class="kw">ifelse</span>(Acc.TSMD <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.444</span> <span class="op">*</span><span class="st"> </span>Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span>((Max.TSMD <span class="op">-</span><span class="st"> </span></span>
<span id="cb39-20"><a href="stage-2-running-the-model.html#cb39-20"></a><span class="st">        </span>Acc.TSMD)<span class="op">/</span>(Max.TSMD <span class="op">-</span><span class="st"> </span><span class="fl">0.444</span> <span class="op">*</span><span class="st"> </span>Max.TSMD))))</span>
<span id="cb39-21"><a href="stage-2-running-the-model.html#cb39-21"></a>    b&lt;-<span class="kw">clamp</span>(b,<span class="dt">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb39-22"><a href="stage-2-running-the-model.html#cb39-22"></a>    <span class="kw">return</span>(<span class="kw">data.frame</span>(Acc.TSMD, b, Max.TSMD))</span>
<span id="cb39-23"><a href="stage-2-running-the-model.html#cb39-23"></a>}</span>
<span id="cb39-24"><a href="stage-2-running-the-model.html#cb39-24"></a></span>
<span id="cb39-25"><a href="stage-2-running-the-model.html#cb39-25"></a>fW_<span class="dv">2</span>&lt;-<span class="st"> </span><span class="kw">fw1func</span>(<span class="dt">P=</span>(Precip[,<span class="dv">2</span>]), <span class="dt">E=</span>(Evp[,<span class="dv">2</span>]), <span class="dt">S.Thick =</span> soil.thick, <span class="dt">pClay =</span> clay, <span class="dt">pE =</span> <span class="dv">1</span>, <span class="dt">bare=</span>bare1)<span class="op">$</span>b </span></code></pre></div>
<p>Then the function will calculate the “vegetation cover factor” effect:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="stage-2-running-the-model.html#cb40-1"></a><span class="co">#Vegetation Cover effects </span></span>
<span id="cb40-2"><a href="stage-2-running-the-model.html#cb40-2"></a>fC&lt;-Cov2[,<span class="dv">2</span>]</span></code></pre></div>
<p>In each script, we will need to set the factor frame to run the model (500 years for spin up, 18/20 years for the warm-up, 20 years for the forward), and run the model. We will have two options: one from the SoilR package (using “lsoda” function to solve the differential equations) and one from the soilassessment package that allows to change the differential equation solver, by default we will use the “euler” method, which is faster.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="stage-2-running-the-model.html#cb41-1"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb41-2"><a href="stage-2-running-the-model.html#cb41-2"></a>xi.frame=<span class="kw">data.frame</span>(years,<span class="kw">rep</span>(fT<span class="op">*</span>fW_<span class="dv">2</span><span class="op">*</span>fC<span class="op">*</span>fPR,<span class="dt">length.out=</span><span class="kw">length</span>(years)))</span>
<span id="cb41-3"><a href="stage-2-running-the-model.html#cb41-3"></a></span>
<span id="cb41-4"><a href="stage-2-running-the-model.html#cb41-4"></a></span>
<span id="cb41-5"><a href="stage-2-running-the-model.html#cb41-5"></a><span class="co"># RUN THE MODEL from soilassessment</span></span>
<span id="cb41-6"><a href="stage-2-running-the-model.html#cb41-6"></a><span class="co">#Roth C soilassesment</span></span>
<span id="cb41-7"><a href="stage-2-running-the-model.html#cb41-7"></a>Model3_spin=<span class="kw">carbonTurnover</span>(<span class="dt">tt=</span>years,<span class="dt">C0=</span><span class="kw">c</span>(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),<span class="dt">In=</span>Cinputs,<span class="dt">Dr=</span>DR,<span class="dt">clay=</span>clay,<span class="dt">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb41-8"><a href="stage-2-running-the-model.html#cb41-8"></a>Ct3_spin=Model3_spin[,<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>]</span>
<span id="cb41-9"><a href="stage-2-running-the-model.html#cb41-9"></a></span>
<span id="cb41-10"><a href="stage-2-running-the-model.html#cb41-10"></a><span class="co"># RUN THE MODEL FROM SOILR</span></span>
<span id="cb41-11"><a href="stage-2-running-the-model.html#cb41-11"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb41-12"><a href="stage-2-running-the-model.html#cb41-12"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb41-13"><a href="stage-2-running-the-model.html#cb41-13"></a></span>
<span id="cb41-14"><a href="stage-2-running-the-model.html#cb41-14"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb41-15"><a href="stage-2-running-the-model.html#cb41-15"></a>poolSize3_spin=<span class="kw">as.numeric</span>(<span class="kw">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb41-16"><a href="stage-2-running-the-model.html#cb41-16"></a></span>
<span id="cb41-17"><a href="stage-2-running-the-model.html#cb41-17"></a><span class="kw">return</span>(poolSize3_spin)</span>
<span id="cb41-18"><a href="stage-2-running-the-model.html#cb41-18"></a><span class="er">}</span></span>
<span id="cb41-19"><a href="stage-2-running-the-model.html#cb41-19"></a><span class="co">########## function set up ends###############</span></span></code></pre></div>
<div id="script-number-13.-roth_c_spin_up_v2.r" class="section level2">
<h2><span class="header-section-number">10.1</span> Script Number 13. “ROTH_C_SPIN_UP_v2.R”</h2>
<p>Script number 13 implements the first modeling phase (long spin up phase). In this script we will load the stack generated in script number 10 and the target points (Section 9.7, QGIS model number 1). We will obtain an output vector containing our target points. This script runs the RothC model for 500 years to calculate the equilibrium carbon inputs (the carbon inputs needed to reach the 2001 SOC stocks) and the SOC stocks for the different pools. It first runs using a standard C input of 1 tC ha<sup>-1</sup> yr<sup>-1</sup>, and then equilibrium inputs are estimated from the obtained results and GSOCmap stocks (See Chapters 5 and 6). In this script we will use pedotransfer functions to estimate the SOC stocks of the different pools from the total SOC stock (Weiherm&amp;uuller et al., 2013) to accelerate the spin up process. All that information will be saved to the output vector (shapefile file).
Table 10.1 Script Number 13. Spin Up phase. Inputs and Outputs.</p>
<p>The SPIN UP Phase will allow us to calculate two outputs that will be saved to a point vector layer called “C_INPUT_EQ.shp”: equilibrium carbon inputs (Ceq) and the carbon stocks of the different soil C pools to run the
second phase (WARM UP phase).
First, the following packages are loaded into R:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="stage-2-running-the-model.html#cb42-1"></a><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>()) </span>
<span id="cb42-2"><a href="stage-2-running-the-model.html#cb42-2"></a><span class="kw">library</span>(SoilR)</span>
<span id="cb42-3"><a href="stage-2-running-the-model.html#cb42-3"></a><span class="kw">library</span>(raster)</span>
<span id="cb42-4"><a href="stage-2-running-the-model.html#cb42-4"></a><span class="kw">library</span>(rgdal)</span></code></pre></div>
<p>Then we will set the working directory.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="stage-2-running-the-model.html#cb43-1"></a>WD_FOLDER&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020&quot;</span>)</span></code></pre></div>
<p>Then, we need to load the target points created in the “qgis procedure number 1”.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="stage-2-running-the-model.html#cb44-1"></a><span class="co"># Vector must be an empty points vector. </span></span>
<span id="cb44-2"><a href="stage-2-running-the-model.html#cb44-2"></a><span class="kw">setwd</span>(WD_FOLDER)</span>
<span id="cb44-3"><a href="stage-2-running-the-model.html#cb44-3"></a>Vector&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;INPUTS/TARGET_POINTS/Target_Points_sub.shp&quot;</span>)</span></code></pre></div>
<p>Then we need to open the stack with all the spin-up variables to run the model (from script number 7).</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="stage-2-running-the-model.html#cb45-1"></a><span class="co"># Stack_Set_1 is a stack that contains the spatial variables </span></span>
<span id="cb45-2"><a href="stage-2-running-the-model.html#cb45-2"></a>Stack_Set_<span class="dv">1</span>&lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="st">&quot;INPUTS/STACK/Stack_Set_SPIN_UP_AOI.tif&quot;</span>)</span></code></pre></div>
<p>We will run the next lines of the code and create an empty vector variable to save the outputs results of the model and the pedotransfer functions:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="stage-2-running-the-model.html#cb46-1"></a><span class="co"># Create A vector to save the results</span></span>
<span id="cb46-2"><a href="stage-2-running-the-model.html#cb46-2"></a>C_INPUT_EQ&lt;-Vector</span></code></pre></div>
<p>Now, we need to extract the input variables from the raster stack to the target points (now called “Vector”). This step will allow us to continue working with a “dataframe” instead of a raster stack layer.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="stage-2-running-the-model.html#cb47-1"></a><span class="co"># extract variables to points</span></span>
<span id="cb47-2"><a href="stage-2-running-the-model.html#cb47-2"></a>Vector_variables&lt;-<span class="kw">extract</span>(Stack_Set_<span class="dv">1</span>,Vector,<span class="dt">df=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p>The next lines will define the different variables from the Vector_variables pool. We need to individualize them in separate variables. The last line of this block will set the number of years to run the RothC function.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="stage-2-running-the-model.html#cb48-1"></a><span class="co"># Extract the layers from the Vector</span></span>
<span id="cb48-2"><a href="stage-2-running-the-model.html#cb48-2"></a>SOC_im&lt;-Vector_variables[[<span class="dv">2</span>]] <span class="co"># first band of the stack is the second column of the vector</span></span>
<span id="cb48-3"><a href="stage-2-running-the-model.html#cb48-3"></a>clay_im&lt;-Vector_variables[[<span class="dv">3</span>]]</span>
<span id="cb48-4"><a href="stage-2-running-the-model.html#cb48-4"></a>DR_im&lt;-Vector_variables[[<span class="dv">40</span>]]</span>
<span id="cb48-5"><a href="stage-2-running-the-model.html#cb48-5"></a>LU_im&lt;-Vector_variables[[<span class="dv">41</span>]]</span>
<span id="cb48-6"><a href="stage-2-running-the-model.html#cb48-6"></a><span class="co"># Define Years for Cinputs calculations</span></span>
<span id="cb48-7"><a href="stage-2-running-the-model.html#cb48-7"></a>years=<span class="kw">seq</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">12</span>,<span class="dv">500</span>,<span class="dt">by=</span><span class="dv">1</span><span class="op">/</span><span class="dv">12</span>)</span></code></pre></div>
<p>Once we have defined the variables and time frame, we can start using the the RothC function.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="stage-2-running-the-model.html#cb49-1"></a><span class="co"># ROTH C MODEL FUNCTION .</span></span>
<span id="cb49-2"><a href="stage-2-running-the-model.html#cb49-2"></a><span class="co">########## function set up starts###############</span></span>
<span id="cb49-3"><a href="stage-2-running-the-model.html#cb49-3"></a>Roth_C&lt;-<span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1,LU)</span>
<span id="cb49-4"><a href="stage-2-running-the-model.html#cb49-4"></a></span>
<span id="cb49-5"><a href="stage-2-running-the-model.html#cb49-5"></a>{</span>
<span id="cb49-6"><a href="stage-2-running-the-model.html#cb49-6"></a></span>
<span id="cb49-7"><a href="stage-2-running-the-model.html#cb49-7"></a><span class="co"># Paddy fields coefficent fPR = 0.4 if the target point is class = 13 , else fPR=1</span></span>
<span id="cb49-8"><a href="stage-2-running-the-model.html#cb49-8"></a><span class="co"># From Shirato and Yukozawa 2004</span></span>
<span id="cb49-9"><a href="stage-2-running-the-model.html#cb49-9"></a></span>
<span id="cb49-10"><a href="stage-2-running-the-model.html#cb49-10"></a>fPR=(LU <span class="op">==</span><span class="st"> </span><span class="dv">13</span>)<span class="op">*</span><span class="fl">0.4</span> <span class="op">+</span><span class="st"> </span>(LU<span class="op">!=</span><span class="dv">13</span>)<span class="op">*</span><span class="dv">1</span></span>
<span id="cb49-11"><a href="stage-2-running-the-model.html#cb49-11"></a></span>
<span id="cb49-12"><a href="stage-2-running-the-model.html#cb49-12"></a><span class="co">#Temperature effects per month</span></span>
<span id="cb49-13"><a href="stage-2-running-the-model.html#cb49-13"></a>fT=<span class="kw">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span>
<span id="cb49-14"><a href="stage-2-running-the-model.html#cb49-14"></a></span>
<span id="cb49-15"><a href="stage-2-running-the-model.html#cb49-15"></a><span class="co">#Moisture effects per month . </span></span>
<span id="cb49-16"><a href="stage-2-running-the-model.html#cb49-16"></a></span>
<span id="cb49-17"><a href="stage-2-running-the-model.html#cb49-17"></a>fw1func&lt;-<span class="cf">function</span>(P, E, <span class="dt">S.Thick =</span> <span class="dv">30</span>, <span class="dt">pClay =</span> <span class="fl">32.0213</span>, <span class="dt">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb49-18"><a href="stage-2-running-the-model.html#cb49-18"></a>{</span>
<span id="cb49-19"><a href="stage-2-running-the-model.html#cb49-19"></a>   </span>
<span id="cb49-20"><a href="stage-2-running-the-model.html#cb49-20"></a>    M =<span class="st"> </span>P <span class="op">-</span><span class="st"> </span>E <span class="op">*</span><span class="st"> </span>pE</span>
<span id="cb49-21"><a href="stage-2-running-the-model.html#cb49-21"></a>    Acc.TSMD =<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb49-22"><a href="stage-2-running-the-model.html#cb49-22"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(M)) {</span>
<span id="cb49-23"><a href="stage-2-running-the-model.html#cb49-23"></a> 	B =<span class="st"> </span><span class="kw">ifelse</span>(bare[i] <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb49-24"><a href="stage-2-running-the-model.html#cb49-24"></a>	 Max.TSMD =<span class="st"> </span><span class="op">-</span>(<span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="fl">1.3</span> <span class="op">*</span><span class="st"> </span>pClay <span class="op">-</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">*</span><span class="st"> </span>(pClay<span class="op">^</span><span class="dv">2</span>)) <span class="op">*</span><span class="st"> </span>(S.Thick<span class="op">/</span><span class="dv">23</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>B)</span>
<span id="cb49-25"><a href="stage-2-running-the-model.html#cb49-25"></a>        Acc.TSMD[<span class="dv">1</span>] =<span class="st"> </span><span class="kw">ifelse</span>(M[<span class="dv">1</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb49-26"><a href="stage-2-running-the-model.html#cb49-26"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>M[i] <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb49-27"><a href="stage-2-running-the-model.html#cb49-27"></a>            Acc.TSMD[i] =<span class="st"> </span>Acc.TSMD[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>M[i]</span>
<span id="cb49-28"><a href="stage-2-running-the-model.html#cb49-28"></a>        }</span>
<span id="cb49-29"><a href="stage-2-running-the-model.html#cb49-29"></a>        <span class="cf">else</span> (Acc.TSMD[i] =<span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb49-30"><a href="stage-2-running-the-model.html#cb49-30"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="op">&lt;=</span><span class="st"> </span>Max.TSMD) {</span>
<span id="cb49-31"><a href="stage-2-running-the-model.html#cb49-31"></a>            Acc.TSMD[i] =<span class="st"> </span>Max.TSMD</span>
<span id="cb49-32"><a href="stage-2-running-the-model.html#cb49-32"></a>        }</span>
<span id="cb49-33"><a href="stage-2-running-the-model.html#cb49-33"></a>    }</span>
<span id="cb49-34"><a href="stage-2-running-the-model.html#cb49-34"></a>    b =<span class="st"> </span><span class="kw">ifelse</span>(Acc.TSMD <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.444</span> <span class="op">*</span><span class="st"> </span>Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span>((Max.TSMD <span class="op">-</span><span class="st"> </span></span>
<span id="cb49-35"><a href="stage-2-running-the-model.html#cb49-35"></a><span class="st">        </span>Acc.TSMD)<span class="op">/</span>(Max.TSMD <span class="op">-</span><span class="st"> </span><span class="fl">0.444</span> <span class="op">*</span><span class="st"> </span>Max.TSMD))))</span>
<span id="cb49-36"><a href="stage-2-running-the-model.html#cb49-36"></a>	b&lt;-<span class="kw">clamp</span>(b,<span class="dt">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb49-37"><a href="stage-2-running-the-model.html#cb49-37"></a>    <span class="kw">return</span>(<span class="kw">data.frame</span>(b))	</span>
<span id="cb49-38"><a href="stage-2-running-the-model.html#cb49-38"></a>}</span>
<span id="cb49-39"><a href="stage-2-running-the-model.html#cb49-39"></a></span>
<span id="cb49-40"><a href="stage-2-running-the-model.html#cb49-40"></a>fW_<span class="dv">2</span>&lt;-<span class="st"> </span><span class="kw">fw1func</span>(<span class="dt">P=</span>(Precip[,<span class="dv">2</span>]), <span class="dt">E=</span>(Evp[,<span class="dv">2</span>]), <span class="dt">S.Thick =</span> soil.thick, <span class="dt">pClay =</span> clay, <span class="dt">pE =</span> <span class="dv">1</span>, <span class="dt">bare=</span>bare1)<span class="op">$</span>b </span>
<span id="cb49-41"><a href="stage-2-running-the-model.html#cb49-41"></a></span>
<span id="cb49-42"><a href="stage-2-running-the-model.html#cb49-42"></a><span class="co">#Vegetation Cover effects </span></span>
<span id="cb49-43"><a href="stage-2-running-the-model.html#cb49-43"></a></span>
<span id="cb49-44"><a href="stage-2-running-the-model.html#cb49-44"></a>fC&lt;-Cov2[,<span class="dv">2</span>]</span>
<span id="cb49-45"><a href="stage-2-running-the-model.html#cb49-45"></a></span>
<span id="cb49-46"><a href="stage-2-running-the-model.html#cb49-46"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb49-47"><a href="stage-2-running-the-model.html#cb49-47"></a></span>
<span id="cb49-48"><a href="stage-2-running-the-model.html#cb49-48"></a>xi.frame=<span class="kw">data.frame</span>(years,<span class="kw">rep</span>(fT<span class="op">*</span>fW_<span class="dv">2</span><span class="op">*</span>fC<span class="op">*</span>fPR,<span class="dt">length.out=</span><span class="kw">length</span>(years)))</span>
<span id="cb49-49"><a href="stage-2-running-the-model.html#cb49-49"></a></span>
<span id="cb49-50"><a href="stage-2-running-the-model.html#cb49-50"></a><span class="co"># RUN THE MODEL from soilassessment</span></span>
<span id="cb49-51"><a href="stage-2-running-the-model.html#cb49-51"></a><span class="co">#Roth C soilassesment</span></span>
<span id="cb49-52"><a href="stage-2-running-the-model.html#cb49-52"></a>Model3_spin=<span class="kw">carbonTurnover</span>(<span class="dt">tt=</span>years,<span class="dt">C0=</span><span class="kw">c</span>(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),<span class="dt">In=</span>Cinputs,<span class="dt">Dr=</span>DR,<span class="dt">clay=</span>clay,<span class="dt">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb49-53"><a href="stage-2-running-the-model.html#cb49-53"></a>Ct3_spin=Model3_spin[,<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>]</span>
<span id="cb49-54"><a href="stage-2-running-the-model.html#cb49-54"></a></span>
<span id="cb49-55"><a href="stage-2-running-the-model.html#cb49-55"></a><span class="co"># RUN THE MODEL FROM SOILR</span></span>
<span id="cb49-56"><a href="stage-2-running-the-model.html#cb49-56"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb49-57"><a href="stage-2-running-the-model.html#cb49-57"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb49-58"><a href="stage-2-running-the-model.html#cb49-58"></a></span>
<span id="cb49-59"><a href="stage-2-running-the-model.html#cb49-59"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb49-60"><a href="stage-2-running-the-model.html#cb49-60"></a>poolSize3_spin=<span class="kw">as.numeric</span>(<span class="kw">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb49-61"><a href="stage-2-running-the-model.html#cb49-61"></a></span>
<span id="cb49-62"><a href="stage-2-running-the-model.html#cb49-62"></a><span class="kw">return</span>(poolSize3_spin)</span>
<span id="cb49-63"><a href="stage-2-running-the-model.html#cb49-63"></a>}</span>
<span id="cb49-64"><a href="stage-2-running-the-model.html#cb49-64"></a><span class="co">########## function set up ends###############</span></span></code></pre></div>
<p>After setting the RothC function we will iterate it over each one of the target points.<br />
For each target point we extract the climate variables and the monthly vegetation cover values. Each variable will be assigned to an R variable.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="stage-2-running-the-model.html#cb50-1"></a><span class="co"># Iterates over the area of interest</span></span>
<span id="cb50-2"><a href="stage-2-running-the-model.html#cb50-2"></a><span class="co">########for loop starts###############</span></span>
<span id="cb50-3"><a href="stage-2-running-the-model.html#cb50-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">dim</span>(Vector_variables)[<span class="dv">1</span>]) {</span>
<span id="cb50-4"><a href="stage-2-running-the-model.html#cb50-4"></a><span class="co"># Extract the variables </span></span>
<span id="cb50-5"><a href="stage-2-running-the-model.html#cb50-5"></a>Vect&lt;-<span class="kw">as.data.frame</span>(Vector_variables[i,])</span>
<span id="cb50-6"><a href="stage-2-running-the-model.html#cb50-6"></a>Temp&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[<span class="dv">4</span><span class="op">:</span><span class="dv">15</span>]))</span>
<span id="cb50-7"><a href="stage-2-running-the-model.html#cb50-7"></a>Temp&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Temp=</span>Temp[,<span class="dv">1</span>])</span>
<span id="cb50-8"><a href="stage-2-running-the-model.html#cb50-8"></a>Precip&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[<span class="dv">16</span><span class="op">:</span><span class="dv">27</span>]))</span>
<span id="cb50-9"><a href="stage-2-running-the-model.html#cb50-9"></a>Precip&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Precip=</span>Precip[,<span class="dv">1</span>])</span>
<span id="cb50-10"><a href="stage-2-running-the-model.html#cb50-10"></a>Evp&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[<span class="dv">28</span><span class="op">:</span><span class="dv">39</span>]))</span>
<span id="cb50-11"><a href="stage-2-running-the-model.html#cb50-11"></a>Evp&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Evp=</span>Evp[,<span class="dv">1</span>])</span>
<span id="cb50-12"><a href="stage-2-running-the-model.html#cb50-12"></a>Cov&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[<span class="dv">42</span><span class="op">:</span><span class="dv">53</span>]))</span>
<span id="cb50-13"><a href="stage-2-running-the-model.html#cb50-13"></a>Cov1&lt;-<span class="kw">data.frame</span>(<span class="dt">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb50-14"><a href="stage-2-running-the-model.html#cb50-14"></a>Cov2&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Cov=</span>Cov[,<span class="dv">1</span>])</span></code></pre></div>
<p>The next line will avoid running the model over points with unreliable data, that may contain missing values or unrealistic values.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="stage-2-running-the-model.html#cb51-1"></a><span class="co">#Avoid calculus over Na values </span></span>
<span id="cb51-2"><a href="stage-2-running-the-model.html#cb51-2"></a><span class="cf">if</span> (<span class="kw">any</span>(<span class="kw">is.na</span>(Evp[,<span class="dv">2</span>])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(Temp[,<span class="dv">2</span>])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(SOC_im[i])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(clay_im[i])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(Precip[,<span class="dv">2</span>]))  <span class="op">|</span><span class="st">  </span><span class="kw">any</span>(<span class="kw">is.na</span>(Cov2[,<span class="dv">2</span>]))  <span class="op">|</span><span class="st">  </span><span class="kw">any</span>(<span class="kw">is.na</span>(Cov1[,<span class="dv">1</span>]))  <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(DR_im[i])) <span class="op">|</span><span class="st">  </span>(SOC_im[i]<span class="op">&lt;</span><span class="dv">0</span>) <span class="op">|</span><span class="st"> </span>(clay_im[i]<span class="op">&lt;</span><span class="dv">0</span>) ) {C_INPUT_EQ[i,<span class="dv">2</span>]&lt;-<span class="dv">0</span>}<span class="cf">else</span>{</span></code></pre></div>
<p>Now we will set the value of each variable (SOC, Clay, DR, and Land Use) needed to run the model. The bare1 variable is used to derive the moisture factor.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="stage-2-running-the-model.html#cb52-1"></a><span class="co"># Set the variables from the images</span></span>
<span id="cb52-2"><a href="stage-2-running-the-model.html#cb52-2"></a>soil.thick=<span class="dv">30</span>  <span class="co">#Soil thickness (organic layer topsoil), in cm</span></span>
<span id="cb52-3"><a href="stage-2-running-the-model.html#cb52-3"></a>SOC&lt;-SOC_im[i]      <span class="co">#Soil organic carbon in Mg/ha </span></span>
<span id="cb52-4"><a href="stage-2-running-the-model.html#cb52-4"></a>clay&lt;-clay_im[i]        <span class="co">#Percent clay %</span></span>
<span id="cb52-5"><a href="stage-2-running-the-model.html#cb52-5"></a>DR&lt;-DR_im[i]              <span class="co"># DPM/RPM (decomplosable vs resistant plant material.)</span></span>
<span id="cb52-6"><a href="stage-2-running-the-model.html#cb52-6"></a>bare1&lt;-(Cov1<span class="op">&gt;</span><span class="fl">0.8</span>)           <span class="co"># If the surface is bare or vegetated</span></span>
<span id="cb52-7"><a href="stage-2-running-the-model.html#cb52-7"></a>LU&lt;-LU_im[i]</span></code></pre></div>
<p>The next line will calculate the IOM fraction of the SOC, from the SOC value:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="stage-2-running-the-model.html#cb53-1"></a><span class="co">#IOM using Falloon method</span></span>
<span id="cb53-2"><a href="stage-2-running-the-model.html#cb53-2"></a>FallIOM=<span class="fl">0.049</span><span class="op">*</span>SOC<span class="op">^</span>(<span class="fl">1.139</span>) </span></code></pre></div>
<p>Now there are two options to calculate the uncertainties. One is to use your own SOC uncertainty layer: by loading it into R with the following lines of code:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="stage-2-running-the-model.html#cb54-1"></a><span class="co"># If you use a SOC uncertainty layer turn on this. First open the layer SOC_UNC </span></span>
<span id="cb54-2"><a href="stage-2-running-the-model.html#cb54-2"></a><span class="co">#(it must have the same extent and resolution of the SOC layer)</span></span>
<span id="cb54-3"><a href="stage-2-running-the-model.html#cb54-3"></a><span class="co">#SOC_min&lt;-(1-(SOC_UNC/100))*SOC</span></span>
<span id="cb54-4"><a href="stage-2-running-the-model.html#cb54-4"></a><span class="co">#SOC_max&lt;-(1+(SOC_UNC/100))*SOC</span></span>
<span id="cb54-5"><a href="stage-2-running-the-model.html#cb54-5"></a><span class="co"># Define SOC min, max Clay min and max. </span></span>
<span id="cb54-6"><a href="stage-2-running-the-model.html#cb54-6"></a>SOC_min&lt;-SOC<span class="op">*</span><span class="fl">0.8</span></span>
<span id="cb54-7"><a href="stage-2-running-the-model.html#cb54-7"></a>SOC_max&lt;-SOC<span class="op">*</span><span class="fl">1.2</span></span>
<span id="cb54-8"><a href="stage-2-running-the-model.html#cb54-8"></a>clay_min&lt;-clay<span class="op">*</span><span class="fl">0.9</span></span>
<span id="cb54-9"><a href="stage-2-running-the-model.html#cb54-9"></a>clay_max&lt;-clay<span class="op">*</span><span class="fl">1.1</span></span></code></pre></div>
<p>The script then uses the RothC function with the parameters listed below. We want to estimate the annual Carbon inputs needed to reach the actual GSOCmap value (equilibrium C inputs). We will first run the model assuming “Cinputs” equal 1. We can assume that SOC stock values when there are no C inputs (“Cinputs” equal to 0) will be equal to the inert organic carbon stocks (SOC=FallIOM). We can then build a simple linear model to estimate the “Cinputs” value needed to reach SOC FAO actual value (equilibrium C inputs, See modeling approach, Chapter 5 and 6).
b&lt;-1</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="stage-2-running-the-model.html#cb55-1"></a><span class="co"># C input equilibrium. (Ceq)</span></span>
<span id="cb55-2"><a href="stage-2-running-the-model.html#cb55-2"></a>fb&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>b,<span class="dt">years=</span>years,<span class="dt">DPMptf=</span><span class="dv">0</span>, <span class="dt">RPMptf=</span><span class="dv">0</span>, <span class="dt">BIOptf=</span><span class="dv">0</span>, <span class="dt">HUMptf=</span><span class="dv">0</span>, <span class="dt">FallIOM=</span>FallIOM,<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1)</span>
<span id="cb55-3"><a href="stage-2-running-the-model.html#cb55-3"></a>fb_t&lt;-fb[<span class="dv">1</span>]<span class="op">+</span>fb[<span class="dv">2</span>]<span class="op">+</span>fb[<span class="dv">3</span>]<span class="op">+</span>fb[<span class="dv">4</span>]<span class="op">+</span>fb[<span class="dv">5</span>]</span>
<span id="cb55-4"><a href="stage-2-running-the-model.html#cb55-4"></a>m&lt;-(fb_t<span class="op">-</span>FallIOM)<span class="op">/</span>(b)</span>
<span id="cb55-5"><a href="stage-2-running-the-model.html#cb55-5"></a>Ceq&lt;-(SOC<span class="op">-</span>FallIOM)<span class="op">/</span>m</span></code></pre></div>
<p>We will repeat the “C input eq. code” to calculate minimum and maximum carbon inputs at equilibrium, using the combination of environmental variables listed in chapter 12 (Uncertainties).</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="stage-2-running-the-model.html#cb56-1"></a><span class="co"># UNCERTAINTIES C input equilibrium (MINIMUM)</span></span>
<span id="cb56-2"><a href="stage-2-running-the-model.html#cb56-2"></a>FallIOM_min=<span class="fl">0.049</span><span class="op">*</span>SOC_min<span class="op">^</span>(<span class="fl">1.139</span>) </span>
<span id="cb56-3"><a href="stage-2-running-the-model.html#cb56-3"></a>fb_min&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>b,<span class="dt">years=</span>years,<span class="dt">DPMptf=</span><span class="dv">0</span>, <span class="dt">RPMptf=</span><span class="dv">0</span>, <span class="dt">BIOptf=</span><span class="dv">0</span>, <span class="dt">HUMptf=</span><span class="dv">0</span>, <span class="dt">FallIOM=</span>FallIOM,<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">1.02</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">0.95</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC_min,<span class="dt">clay=</span>clay_min,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1)</span>
<span id="cb56-4"><a href="stage-2-running-the-model.html#cb56-4"></a>fb_t_MIN&lt;-fb_min[<span class="dv">1</span>]<span class="op">+</span>fb_min[<span class="dv">2</span>]<span class="op">+</span>fb_min[<span class="dv">3</span>]<span class="op">+</span>fb_min[<span class="dv">4</span>]<span class="op">+</span>fb_min[<span class="dv">5</span>]</span>
<span id="cb56-5"><a href="stage-2-running-the-model.html#cb56-5"></a>m&lt;-(fb_t_MIN<span class="op">-</span>FallIOM_min)<span class="op">/</span>(b)</span>
<span id="cb56-6"><a href="stage-2-running-the-model.html#cb56-6"></a>Ceq_MIN&lt;-(SOC_min<span class="op">-</span>FallIOM_min)<span class="op">/</span>m</span>
<span id="cb56-7"><a href="stage-2-running-the-model.html#cb56-7"></a><span class="co"># UNCERTAINTIES C input equilibrium (MAXIMUM)</span></span>
<span id="cb56-8"><a href="stage-2-running-the-model.html#cb56-8"></a>FallIOM_max=<span class="fl">0.049</span><span class="op">*</span>SOC_max<span class="op">^</span>(<span class="fl">1.139</span>) </span>
<span id="cb56-9"><a href="stage-2-running-the-model.html#cb56-9"></a>fb_max&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>b,<span class="dt">years=</span>years,<span class="dt">DPMptf=</span><span class="dv">0</span>, <span class="dt">RPMptf=</span><span class="dv">0</span>, <span class="dt">BIOptf=</span><span class="dv">0</span>, <span class="dt">HUMptf=</span><span class="dv">0</span>, <span class="dt">FallIOM=</span>FallIOM,<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">0.98</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">1.05</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC_max,<span class="dt">clay=</span>clay_max,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1)</span>
<span id="cb56-10"><a href="stage-2-running-the-model.html#cb56-10"></a>fb_t_MAX&lt;-fb_max[<span class="dv">1</span>]<span class="op">+</span>fb_max[<span class="dv">2</span>]<span class="op">+</span>fb_max[<span class="dv">3</span>]<span class="op">+</span>fb_max[<span class="dv">4</span>]<span class="op">+</span>fb_max[<span class="dv">5</span>]</span>
<span id="cb56-11"><a href="stage-2-running-the-model.html#cb56-11"></a>m&lt;-(fb_t_MAX<span class="op">-</span>FallIOM_max)<span class="op">/</span>(b)</span>
<span id="cb56-12"><a href="stage-2-running-the-model.html#cb56-12"></a>Ceq_MAX&lt;-(SOC_max<span class="op">-</span>FallIOM_max)<span class="op">/</span>m </span></code></pre></div>
<p>Now for each land use, we will run the “pedotransfer functions” (Weiherm&amp;uuller et al., 2013) to estimate the values of the SOC pools. Here is the example for the croplands land use. Then the same code will be executed for the rest of the land use classes.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="stage-2-running-the-model.html#cb57-1"></a><span class="co"># SOC POOLS AFTER 500 YEARS RUN WITH C INPUT EQUILIBRIUM</span></span>
<span id="cb57-2"><a href="stage-2-running-the-model.html#cb57-2"></a><span class="cf">if</span> (LU<span class="op">==</span><span class="dv">2</span>){</span>
<span id="cb57-3"><a href="stage-2-running-the-model.html#cb57-3"></a>RPM_p_<span class="dv">2</span>&lt;-((<span class="fl">0.184</span><span class="op">*</span>SOC <span class="op">+</span><span class="st"> </span><span class="fl">0.1555</span>)<span class="op">*</span>(clay <span class="op">+</span><span class="st"> </span><span class="fl">1.275</span>)<span class="op">^</span>(<span class="op">-</span><span class="fl">0.1158</span>))<span class="op">*</span><span class="fl">0.9902+0.4788</span></span>
<span id="cb57-4"><a href="stage-2-running-the-model.html#cb57-4"></a>BIO_p_<span class="dv">2</span>&lt;-((<span class="fl">0.014</span><span class="op">*</span>SOC <span class="op">+</span><span class="st"> </span><span class="fl">0.0075</span>)<span class="op">*</span>(clay <span class="op">+</span><span class="st"> </span><span class="fl">8.8473</span>)<span class="op">^</span>(<span class="fl">0.0567</span>))<span class="op">*</span><span class="fl">1.09038+0.04055</span></span>
<span id="cb57-5"><a href="stage-2-running-the-model.html#cb57-5"></a>HUM_p_<span class="dv">2</span>&lt;-((<span class="fl">0.7148</span><span class="op">*</span>SOC <span class="op">+</span><span class="st"> </span><span class="fl">0.5069</span>)<span class="op">*</span>(clay <span class="op">+</span><span class="st"> </span><span class="fl">0.3421</span>)<span class="op">^</span>(<span class="fl">0.0184</span>))<span class="op">*</span><span class="fl">0.9878-0.3818</span></span>
<span id="cb57-6"><a href="stage-2-running-the-model.html#cb57-6"></a>DPM_p_<span class="dv">2</span>&lt;-SOC<span class="op">-</span>FallIOM<span class="op">-</span>RPM_p_<span class="dv">2</span><span class="op">-</span>HUM_p_<span class="dv">2</span><span class="op">-</span>BIO_p_<span class="dv">2</span></span>
<span id="cb57-7"><a href="stage-2-running-the-model.html#cb57-7"></a>feq_t&lt;-RPM_p_<span class="dv">2</span><span class="op">+</span>BIO_p_<span class="dv">2</span><span class="op">+</span>HUM_p_<span class="dv">2</span><span class="op">+</span>DPM_p_<span class="dv">2</span><span class="op">+</span>FallIOM</span>
<span id="cb57-8"><a href="stage-2-running-the-model.html#cb57-8"></a><span class="co">#uncertainties  MIN</span></span>
<span id="cb57-9"><a href="stage-2-running-the-model.html#cb57-9"></a>RPM_p_<span class="dv">2</span>_min&lt;-((<span class="fl">0.184</span><span class="op">*</span>SOC_min <span class="op">+</span><span class="st"> </span><span class="fl">0.1555</span>)<span class="op">*</span>(clay_min <span class="op">+</span><span class="st"> </span><span class="fl">1.275</span>)<span class="op">^</span>(<span class="op">-</span><span class="fl">0.1158</span>))<span class="op">*</span><span class="fl">0.9902+0.4788</span></span>
<span id="cb57-10"><a href="stage-2-running-the-model.html#cb57-10"></a>BIO_p_<span class="dv">2</span>_min&lt;-((<span class="fl">0.014</span><span class="op">*</span>SOC_min <span class="op">+</span><span class="st"> </span><span class="fl">0.0075</span>)<span class="op">*</span>(clay_min <span class="op">+</span><span class="st"> </span><span class="fl">8.8473</span>)<span class="op">^</span>(<span class="fl">0.0567</span>))<span class="op">*</span><span class="fl">1.09038+0.04055</span></span>
<span id="cb57-11"><a href="stage-2-running-the-model.html#cb57-11"></a>HUM_p_<span class="dv">2</span>_min&lt;-((<span class="fl">0.7148</span><span class="op">*</span>SOC_min <span class="op">+</span><span class="st"> </span><span class="fl">0.5069</span>)<span class="op">*</span>(clay_min <span class="op">+</span><span class="st"> </span><span class="fl">0.3421</span>)<span class="op">^</span>(<span class="fl">0.0184</span>))<span class="op">*</span><span class="fl">0.9878-0.3818</span></span>
<span id="cb57-12"><a href="stage-2-running-the-model.html#cb57-12"></a>DPM_p_<span class="dv">2</span>_min&lt;-SOC_min<span class="op">-</span>FallIOM_min<span class="op">-</span>RPM_p_<span class="dv">2</span>_min<span class="op">-</span>HUM_p_<span class="dv">2</span>_min<span class="op">-</span>BIO_p_<span class="dv">2</span>_min</span>
<span id="cb57-13"><a href="stage-2-running-the-model.html#cb57-13"></a>feq_t_min&lt;-RPM_p_<span class="dv">2</span>_min<span class="op">+</span>BIO_p_<span class="dv">2</span>_min<span class="op">+</span>HUM_p_<span class="dv">2</span>_min<span class="op">+</span>DPM_p_<span class="dv">2</span>_min<span class="op">+</span>FallIOM_min</span>
<span id="cb57-14"><a href="stage-2-running-the-model.html#cb57-14"></a><span class="co">#uncertainties  MAX</span></span>
<span id="cb57-15"><a href="stage-2-running-the-model.html#cb57-15"></a>RPM_p_<span class="dv">2</span>_max&lt;-((<span class="fl">0.184</span><span class="op">*</span>SOC_max <span class="op">+</span><span class="st"> </span><span class="fl">0.1555</span>)<span class="op">*</span>(clay_max <span class="op">+</span><span class="st"> </span><span class="fl">1.275</span>)<span class="op">^</span>(<span class="op">-</span><span class="fl">0.1158</span>))<span class="op">*</span><span class="fl">0.9902+0.4788</span></span>
<span id="cb57-16"><a href="stage-2-running-the-model.html#cb57-16"></a>BIO_p_<span class="dv">2</span>_max&lt;-((<span class="fl">0.014</span><span class="op">*</span>SOC_max <span class="op">+</span><span class="st"> </span><span class="fl">0.0075</span>)<span class="op">*</span>(clay_max <span class="op">+</span><span class="st"> </span><span class="fl">8.8473</span>)<span class="op">^</span>(<span class="fl">0.0567</span>))<span class="op">*</span><span class="fl">1.09038+0.04055</span></span>
<span id="cb57-17"><a href="stage-2-running-the-model.html#cb57-17"></a>HUM_p_<span class="dv">2</span>_max&lt;-((<span class="fl">0.7148</span><span class="op">*</span>SOC_max <span class="op">+</span><span class="st"> </span><span class="fl">0.5069</span>)<span class="op">*</span>(clay_max <span class="op">+</span><span class="st"> </span><span class="fl">0.3421</span>)<span class="op">^</span>(<span class="fl">0.0184</span>))<span class="op">*</span><span class="fl">0.9878-0.3818</span></span>
<span id="cb57-18"><a href="stage-2-running-the-model.html#cb57-18"></a>DPM_p_<span class="dv">2</span>_max&lt;-SOC_max<span class="op">-</span>FallIOM_max<span class="op">-</span>RPM_p_<span class="dv">2</span>_max<span class="op">-</span>HUM_p_<span class="dv">2</span>_max<span class="op">-</span>BIO_p_<span class="dv">2</span>_max</span>
<span id="cb57-19"><a href="stage-2-running-the-model.html#cb57-19"></a>feq_t_max&lt;-RPM_p_<span class="dv">2</span>_max<span class="op">+</span>BIO_p_<span class="dv">2</span>_max<span class="op">+</span>HUM_p_<span class="dv">2</span>_max<span class="op">+</span>DPM_p_<span class="dv">2</span>_max<span class="op">+</span>FallIOM_max</span></code></pre></div>
<p>Finally, we will save the outputs pools to the variables C_INPUT_EQ :</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="stage-2-running-the-model.html#cb58-1"></a>C_INPUT_EQ[i,<span class="dv">2</span>]&lt;-SOC</span>
<span id="cb58-2"><a href="stage-2-running-the-model.html#cb58-2"></a>C_INPUT_EQ[i,<span class="dv">3</span>]&lt;-Ceq</span>
<span id="cb58-3"><a href="stage-2-running-the-model.html#cb58-3"></a>C_INPUT_EQ[i,<span class="dv">4</span>]&lt;-feq_t</span>
<span id="cb58-4"><a href="stage-2-running-the-model.html#cb58-4"></a>C_INPUT_EQ[i,<span class="dv">5</span>]&lt;-DPM_p_<span class="dv">2</span></span>
<span id="cb58-5"><a href="stage-2-running-the-model.html#cb58-5"></a>C_INPUT_EQ[i,<span class="dv">6</span>]&lt;-RPM_p_<span class="dv">2</span></span>
<span id="cb58-6"><a href="stage-2-running-the-model.html#cb58-6"></a>C_INPUT_EQ[i,<span class="dv">7</span>]&lt;-BIO_p_<span class="dv">2</span></span>
<span id="cb58-7"><a href="stage-2-running-the-model.html#cb58-7"></a>C_INPUT_EQ[i,<span class="dv">8</span>]&lt;-HUM_p_<span class="dv">2</span></span>
<span id="cb58-8"><a href="stage-2-running-the-model.html#cb58-8"></a>C_INPUT_EQ[i,<span class="dv">9</span>]&lt;-FallIOM</span>
<span id="cb58-9"><a href="stage-2-running-the-model.html#cb58-9"></a>C_INPUT_EQ[i,<span class="dv">10</span>]&lt;-Ceq_MIN</span>
<span id="cb58-10"><a href="stage-2-running-the-model.html#cb58-10"></a>C_INPUT_EQ[i,<span class="dv">11</span>]&lt;-Ceq_MAX</span>
<span id="cb58-11"><a href="stage-2-running-the-model.html#cb58-11"></a>C_INPUT_EQ[i,<span class="dv">12</span>]&lt;-feq_t_min</span>
<span id="cb58-12"><a href="stage-2-running-the-model.html#cb58-12"></a>C_INPUT_EQ[i,<span class="dv">13</span>]&lt;-DPM_p_<span class="dv">2</span>_min</span>
<span id="cb58-13"><a href="stage-2-running-the-model.html#cb58-13"></a>C_INPUT_EQ[i,<span class="dv">14</span>]&lt;-RPM_p_<span class="dv">2</span>_min</span>
<span id="cb58-14"><a href="stage-2-running-the-model.html#cb58-14"></a>C_INPUT_EQ[i,<span class="dv">15</span>]&lt;-BIO_p_<span class="dv">2</span>_min</span>
<span id="cb58-15"><a href="stage-2-running-the-model.html#cb58-15"></a>C_INPUT_EQ[i,<span class="dv">16</span>]&lt;-HUM_p_<span class="dv">2</span>_min</span>
<span id="cb58-16"><a href="stage-2-running-the-model.html#cb58-16"></a>C_INPUT_EQ[i,<span class="dv">17</span>]&lt;-FallIOM_min</span>
<span id="cb58-17"><a href="stage-2-running-the-model.html#cb58-17"></a>C_INPUT_EQ[i,<span class="dv">18</span>]&lt;-feq_t_max</span>
<span id="cb58-18"><a href="stage-2-running-the-model.html#cb58-18"></a>C_INPUT_EQ[i,<span class="dv">19</span>]&lt;-DPM_p_<span class="dv">2</span>_max</span>
<span id="cb58-19"><a href="stage-2-running-the-model.html#cb58-19"></a>C_INPUT_EQ[i,<span class="dv">20</span>]&lt;-RPM_p_<span class="dv">2</span>_max</span>
<span id="cb58-20"><a href="stage-2-running-the-model.html#cb58-20"></a>C_INPUT_EQ[i,<span class="dv">21</span>]&lt;-BIO_p_<span class="dv">2</span>_max</span>
<span id="cb58-21"><a href="stage-2-running-the-model.html#cb58-21"></a>C_INPUT_EQ[i,<span class="dv">22</span>]&lt;-HUM_p_<span class="dv">2</span>_max</span>
<span id="cb58-22"><a href="stage-2-running-the-model.html#cb58-22"></a>C_INPUT_EQ[i,<span class="dv">23</span>]&lt;-FallIOM_max</span></code></pre></div>
<p>In order to properly save the output vector, we will change the names of the fields:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="stage-2-running-the-model.html#cb59-1"></a><span class="co">#rename de columns</span></span>
<span id="cb59-2"><a href="stage-2-running-the-model.html#cb59-2"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">2</span>]=<span class="st">&quot;SOC_FAO&quot;</span></span>
<span id="cb59-3"><a href="stage-2-running-the-model.html#cb59-3"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">3</span>]=<span class="st">&quot;Cinput_EQ&quot;</span></span>
<span id="cb59-4"><a href="stage-2-running-the-model.html#cb59-4"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">4</span>]=<span class="st">&quot;SOC_pedotransfer&quot;</span></span>
<span id="cb59-5"><a href="stage-2-running-the-model.html#cb59-5"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">5</span>]=<span class="st">&quot;DPM_pedotransfer&quot;</span></span>
<span id="cb59-6"><a href="stage-2-running-the-model.html#cb59-6"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">6</span>]=<span class="st">&quot;RPM_pedotransfer&quot;</span></span>
<span id="cb59-7"><a href="stage-2-running-the-model.html#cb59-7"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">7</span>]=<span class="st">&quot;BIO_pedotransfer&quot;</span></span>
<span id="cb59-8"><a href="stage-2-running-the-model.html#cb59-8"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">8</span>]=<span class="st">&quot;HUM_pedotransfer&quot;</span></span>
<span id="cb59-9"><a href="stage-2-running-the-model.html#cb59-9"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">9</span>]=<span class="st">&quot;IOM_pedotransfer&quot;</span></span>
<span id="cb59-10"><a href="stage-2-running-the-model.html#cb59-10"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">10</span>]=<span class="st">&quot;CIneq_min&quot;</span></span>
<span id="cb59-11"><a href="stage-2-running-the-model.html#cb59-11"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">11</span>]=<span class="st">&quot;CIneq_max&quot;</span></span>
<span id="cb59-12"><a href="stage-2-running-the-model.html#cb59-12"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">12</span>]=<span class="st">&quot;SOC_min&quot;</span></span>
<span id="cb59-13"><a href="stage-2-running-the-model.html#cb59-13"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">13</span>]=<span class="st">&quot;DPM_min&quot;</span></span>
<span id="cb59-14"><a href="stage-2-running-the-model.html#cb59-14"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">14</span>]=<span class="st">&quot;RPM_min&quot;</span></span>
<span id="cb59-15"><a href="stage-2-running-the-model.html#cb59-15"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">15</span>]=<span class="st">&quot;BIO_min&quot;</span></span>
<span id="cb59-16"><a href="stage-2-running-the-model.html#cb59-16"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">16</span>]=<span class="st">&quot;HUM_min&quot;</span></span>
<span id="cb59-17"><a href="stage-2-running-the-model.html#cb59-17"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">17</span>]=<span class="st">&quot;IOM_min&quot;</span></span>
<span id="cb59-18"><a href="stage-2-running-the-model.html#cb59-18"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">18</span>]=<span class="st">&quot;SOC_max&quot;</span></span>
<span id="cb59-19"><a href="stage-2-running-the-model.html#cb59-19"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">19</span>]=<span class="st">&quot;DPM_max&quot;</span></span>
<span id="cb59-20"><a href="stage-2-running-the-model.html#cb59-20"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">20</span>]=<span class="st">&quot;RPM_max&quot;</span></span>
<span id="cb59-21"><a href="stage-2-running-the-model.html#cb59-21"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">21</span>]=<span class="st">&quot;BIO_max&quot;</span></span>
<span id="cb59-22"><a href="stage-2-running-the-model.html#cb59-22"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">22</span>]=<span class="st">&quot;HUM_max&quot;</span></span>
<span id="cb59-23"><a href="stage-2-running-the-model.html#cb59-23"></a><span class="kw">colnames</span>(C_INPUT_EQ<span class="op">@</span>data)[<span class="dv">23</span>]=<span class="st">&quot;IOM_max&quot;</span></span></code></pre></div>
<p>Finally, we will set the output directory and save the output vector:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="stage-2-running-the-model.html#cb60-1"></a> <span class="co"># SAVE the Points (shapefile)</span></span>
<span id="cb60-2"><a href="stage-2-running-the-model.html#cb60-2"></a><span class="kw">writeOGR</span>(C_INPUT_EQ, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;OUTPUTS/1_SPIN_UP/SPIN_UP_County_AOI&quot;</span>, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>) </span></code></pre></div>
</div>
<div id="script-number-14.-roth_c_warm_up_v4.r" class="section level2">
<h2><span class="header-section-number">10.2</span> Script Number 14. “ROTH_C_WARM_UP_v4.R”</h2>
<p>Script number 14 implements the second modeling phase (“Warm up” phase). In this script we will load the stack of different layers generated in script number 11 and the target points. We also will load the output vector of the phase 1 (spin up), the climate layers from script number 2, the NPP layer from script number 5, and the land use layer stack from script number 9. This script runs the Roth C model for 18 years (2000-2018) with the possibility to be modified to 20 years if data is available (2000-2020). The final outputs are SOC stocks of the five C pools of the RothC model (DPM, RPM, BIO, HUM and IOM), and the total SOC stock. This information will be saved to a shapefile vector.</p>
<p><strong>Table 10.2</strong> <em>Script Number 14. Warm Up phase. Inputs and Outputs</em></p>
<p><img src="tables/Table_10.2.png" /></p>
<p>This script runs the spatial RothC model for the warm-up period (from 2001 to 2018). We will provide the script the target points (empty vector layer from Qgis procedure number 1), the Stack layer (from script number 11), the three NPP layers (from script number 5) and the three climate layers generated in script number 2. The output vector layer from script number 13 (Spin up phase) will also be needed.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="stage-2-running-the-model.html#cb61-1"></a><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>()) </span>
<span id="cb61-2"><a href="stage-2-running-the-model.html#cb61-2"></a><span class="kw">library</span>(SoilR)</span>
<span id="cb61-3"><a href="stage-2-running-the-model.html#cb61-3"></a><span class="kw">library</span>(raster)</span>
<span id="cb61-4"><a href="stage-2-running-the-model.html#cb61-4"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb61-5"><a href="stage-2-running-the-model.html#cb61-5"></a><span class="kw">library</span>(soilassessment)</span>
<span id="cb61-6"><a href="stage-2-running-the-model.html#cb61-6"></a>working_dir&lt;-<span class="kw">setwd</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020&quot;</span>)</span>
<span id="cb61-7"><a href="stage-2-running-the-model.html#cb61-7"></a><span class="co">#Open empty vector</span></span>
<span id="cb61-8"><a href="stage-2-running-the-model.html#cb61-8"></a>Vector&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;INPUTS/TARGET_POINTS/target_points_sub.shp&quot;</span>)</span>
<span id="cb61-9"><a href="stage-2-running-the-model.html#cb61-9"></a><span class="co">#Open Warm Up Stack</span></span>
<span id="cb61-10"><a href="stage-2-running-the-model.html#cb61-10"></a>Stack_Set_warmup&lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="st">&quot;INPUTS/STACK/Stack_Set_WARM_UP_AOI.tif&quot;</span>)</span>
<span id="cb61-11"><a href="stage-2-running-the-model.html#cb61-11"></a><span class="co"># Open Result from SPIN UP PROCESS. A vector with 5 columns , one for each pool</span></span>
<span id="cb61-12"><a href="stage-2-running-the-model.html#cb61-12"></a>Spin_up&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;OUTPUTS/1_SPIN_UP/SPIN_UP_County_AOI.shp&quot;</span>)</span>
<span id="cb61-13"><a href="stage-2-running-the-model.html#cb61-13"></a>Spin_up&lt;-<span class="kw">as.data.frame</span>(Spin_up)</span>
<span id="cb61-14"><a href="stage-2-running-the-model.html#cb61-14"></a><span class="co"># Open Precipitation , temperature, and EVapotranspiration file 20 anios x 12 = 240 layers x 3</span></span>
<span id="cb61-15"><a href="stage-2-running-the-model.html#cb61-15"></a>PREC&lt;-<span class="kw">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/Prec_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb61-16"><a href="stage-2-running-the-model.html#cb61-16"></a>TEMP&lt;-<span class="kw">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/Temp_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb61-17"><a href="stage-2-running-the-model.html#cb61-17"></a>PET&lt;-<span class="kw">stack</span>(<span class="st">&quot;INPUTS/CRU_LAYERS/PET_Stack_216_01-18_CRU.tif&quot;</span>)</span>
<span id="cb61-18"><a href="stage-2-running-the-model.html#cb61-18"></a><span class="co">#Open Mean NPP MIAMI 1981 - 2000</span></span>
<span id="cb61-19"><a href="stage-2-running-the-model.html#cb61-19"></a>NPP&lt;-<span class="kw">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI.tif&quot;</span>)</span>
<span id="cb61-20"><a href="stage-2-running-the-model.html#cb61-20"></a>NPP_MEAN_MIN&lt;-<span class="kw">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI_MIN.tif&quot;</span>)</span>
<span id="cb61-21"><a href="stage-2-running-the-model.html#cb61-21"></a>NPP_MEAN_MAX&lt;-<span class="kw">raster</span>(<span class="st">&quot;INPUTS/NPP/NPP_MIAMI_MEAN_81-00_AOI_MAX.tif&quot;</span>)</span>
<span id="cb61-22"><a href="stage-2-running-the-model.html#cb61-22"></a><span class="co">#Open LU layer (year 2000).</span></span>
<span id="cb61-23"><a href="stage-2-running-the-model.html#cb61-23"></a>LU_AOI&lt;-<span class="kw">raster</span>(<span class="st">&quot;INPUTS/LAND_USE/ESA_Land_Cover_12clases_FAO_AOI.tif&quot;</span>)</span></code></pre></div>
<p>As we did in the “spin up” script, we will extract all variables to the target points and create an empty variable to save the results of the “warm up” process.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="stage-2-running-the-model.html#cb62-1"></a><span class="co"># Extract variables to points</span></span>
<span id="cb62-2"><a href="stage-2-running-the-model.html#cb62-2"></a>Vector_points&lt;-<span class="kw">extract</span>(Stack_Set_warmup,Vector,<span class="dt">sp=</span><span class="ot">TRUE</span>)</span>
<span id="cb62-3"><a href="stage-2-running-the-model.html#cb62-3"></a>Vector_points&lt;-<span class="kw">extract</span>(TEMP,Vector_points,<span class="dt">sp=</span><span class="ot">TRUE</span>)</span>
<span id="cb62-4"><a href="stage-2-running-the-model.html#cb62-4"></a>Vector_points&lt;-<span class="kw">extract</span>(PREC,Vector_points,<span class="dt">sp=</span><span class="ot">TRUE</span>)</span>
<span id="cb62-5"><a href="stage-2-running-the-model.html#cb62-5"></a>Vector_points&lt;-<span class="kw">extract</span>(PET,Vector_points,<span class="dt">sp=</span><span class="ot">TRUE</span>)</span>
<span id="cb62-6"><a href="stage-2-running-the-model.html#cb62-6"></a>Vector_points&lt;-<span class="kw">extract</span>(NPP,Vector_points,<span class="dt">sp=</span><span class="ot">TRUE</span>)</span>
<span id="cb62-7"><a href="stage-2-running-the-model.html#cb62-7"></a>Vector_points&lt;-<span class="kw">extract</span>(NPP_MEAN_MIN,Vector_points,<span class="dt">sp=</span><span class="ot">TRUE</span>)</span>
<span id="cb62-8"><a href="stage-2-running-the-model.html#cb62-8"></a>Vector_points&lt;-<span class="kw">extract</span>(NPP_MEAN_MAX,Vector_points,<span class="dt">sp=</span><span class="ot">TRUE</span>)</span>
<span id="cb62-9"><a href="stage-2-running-the-model.html#cb62-9"></a>WARM_UP&lt;-Vector</span></code></pre></div>
<p>Now, we will set some variables in order to run the model for the number of years according to those set for the climate layers. In this example we are running 18 years, but it can be run for less or more years.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="stage-2-running-the-model.html#cb63-1"></a><span class="co"># Warm Up number of years simulation </span></span>
<span id="cb63-2"><a href="stage-2-running-the-model.html#cb63-2"></a>yearsSimulation&lt;-<span class="kw">dim</span>(TEMP)[<span class="dv">3</span>]<span class="op">/</span><span class="dv">12</span></span>
<span id="cb63-3"><a href="stage-2-running-the-model.html#cb63-3"></a>clim_layers&lt;-yearsSimulation<span class="op">*</span><span class="dv">12</span></span>
<span id="cb63-4"><a href="stage-2-running-the-model.html#cb63-4"></a>nppBand&lt;-<span class="kw">nlayers</span>(Stack_Set_warmup)<span class="op">+</span>clim_layers<span class="op">*</span><span class="dv">3</span><span class="op">+</span><span class="dv">2</span></span>
<span id="cb63-5"><a href="stage-2-running-the-model.html#cb63-5"></a>firstClimLayer&lt;-<span class="kw">nlayers</span>(Stack_Set_warmup)<span class="op">+</span><span class="dv">2</span></span>
<span id="cb63-6"><a href="stage-2-running-the-model.html#cb63-6"></a>nppBand_min&lt;-nppBand<span class="op">+</span><span class="dv">1</span></span>
<span id="cb63-7"><a href="stage-2-running-the-model.html#cb63-7"></a>nppBand_max&lt;-nppBand<span class="op">+</span><span class="dv">2</span></span>
<span id="cb63-8"><a href="stage-2-running-the-model.html#cb63-8"></a>nDR_beg&lt;-(<span class="dv">16</span><span class="op">+</span>yearsSimulation)</span>
<span id="cb63-9"><a href="stage-2-running-the-model.html#cb63-9"></a>nDR_end&lt;-nDR_beg<span class="op">+</span>(yearsSimulation<span class="dv">-1</span>)</span></code></pre></div>
<p>Then we will set the variables in separate R variables:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="stage-2-running-the-model.html#cb64-1"></a><span class="co"># Extract the layers from the Vector</span></span>
<span id="cb64-2"><a href="stage-2-running-the-model.html#cb64-2"></a>SOC_im&lt;-Vector_points[[<span class="dv">2</span>]] </span>
<span id="cb64-3"><a href="stage-2-running-the-model.html#cb64-3"></a>clay_im&lt;-Vector_points[[<span class="dv">3</span>]] </span>
<span id="cb64-4"><a href="stage-2-running-the-model.html#cb64-4"></a>LU_im&lt;-Vector_points[[<span class="dv">16</span>]]</span>
<span id="cb64-5"><a href="stage-2-running-the-model.html#cb64-5"></a>NPP_im&lt;-Vector_points[[nppBand]]</span>
<span id="cb64-6"><a href="stage-2-running-the-model.html#cb64-6"></a>NPP_im_MIN&lt;-Vector_points[[nppBand_min]]</span>
<span id="cb64-7"><a href="stage-2-running-the-model.html#cb64-7"></a>NPP_im_MAX&lt;-Vector_points[[nppBand_max]]</span></code></pre></div>
<p>We need to define the years of the “warm up” phase. Remember that we will run one year at a time with different pools of data for each year.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="stage-2-running-the-model.html#cb65-1"></a><span class="co"># Define Year </span></span>
<span id="cb65-2"><a href="stage-2-running-the-model.html#cb65-2"></a>year=<span class="kw">seq</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">12</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="dv">1</span><span class="op">/</span><span class="dv">12</span>)</span></code></pre></div>
<p>We will need to set the RothC function to be ready to be used in the “Warm Up” process.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="stage-2-running-the-model.html#cb66-1"></a><span class="co">###########function set up starts################</span></span>
<span id="cb66-2"><a href="stage-2-running-the-model.html#cb66-2"></a>Roth_C&lt;-<span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1,LU)</span>
<span id="cb66-3"><a href="stage-2-running-the-model.html#cb66-3"></a></span>
<span id="cb66-4"><a href="stage-2-running-the-model.html#cb66-4"></a>{</span>
<span id="cb66-5"><a href="stage-2-running-the-model.html#cb66-5"></a></span>
<span id="cb66-6"><a href="stage-2-running-the-model.html#cb66-6"></a><span class="co"># Paddy fields coefficent fPR = 0.4 if the target point is class = 13 , else fPR=1</span></span>
<span id="cb66-7"><a href="stage-2-running-the-model.html#cb66-7"></a><span class="co"># From Shirato and Yukozawa 2004</span></span>
<span id="cb66-8"><a href="stage-2-running-the-model.html#cb66-8"></a></span>
<span id="cb66-9"><a href="stage-2-running-the-model.html#cb66-9"></a>fPR=(LU <span class="op">==</span><span class="st"> </span><span class="dv">13</span>)<span class="op">*</span><span class="fl">0.4</span> <span class="op">+</span><span class="st"> </span>(LU<span class="op">!=</span><span class="dv">13</span>)<span class="op">*</span><span class="dv">1</span></span>
<span id="cb66-10"><a href="stage-2-running-the-model.html#cb66-10"></a></span>
<span id="cb66-11"><a href="stage-2-running-the-model.html#cb66-11"></a><span class="co">#Temperature effects per month</span></span>
<span id="cb66-12"><a href="stage-2-running-the-model.html#cb66-12"></a>fT=<span class="kw">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span>
<span id="cb66-13"><a href="stage-2-running-the-model.html#cb66-13"></a></span>
<span id="cb66-14"><a href="stage-2-running-the-model.html#cb66-14"></a><span class="co">#Moisture effects per month . Si se usa evapotranspiracion pE=1</span></span>
<span id="cb66-15"><a href="stage-2-running-the-model.html#cb66-15"></a></span>
<span id="cb66-16"><a href="stage-2-running-the-model.html#cb66-16"></a>fw1func&lt;-<span class="cf">function</span>(P, E, <span class="dt">S.Thick =</span> <span class="dv">30</span>, <span class="dt">pClay =</span> <span class="fl">32.0213</span>, <span class="dt">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb66-17"><a href="stage-2-running-the-model.html#cb66-17"></a>{</span>
<span id="cb66-18"><a href="stage-2-running-the-model.html#cb66-18"></a>   </span>
<span id="cb66-19"><a href="stage-2-running-the-model.html#cb66-19"></a>    M =<span class="st"> </span>P <span class="op">-</span><span class="st"> </span>E <span class="op">*</span><span class="st"> </span>pE</span>
<span id="cb66-20"><a href="stage-2-running-the-model.html#cb66-20"></a>    Acc.TSMD =<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb66-21"><a href="stage-2-running-the-model.html#cb66-21"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(M)) {</span>
<span id="cb66-22"><a href="stage-2-running-the-model.html#cb66-22"></a> 	B =<span class="st"> </span><span class="kw">ifelse</span>(bare[i] <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb66-23"><a href="stage-2-running-the-model.html#cb66-23"></a>	 Max.TSMD =<span class="st"> </span><span class="op">-</span>(<span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="fl">1.3</span> <span class="op">*</span><span class="st"> </span>pClay <span class="op">-</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">*</span><span class="st"> </span>(pClay<span class="op">^</span><span class="dv">2</span>)) <span class="op">*</span><span class="st"> </span>(S.Thick<span class="op">/</span><span class="dv">23</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>B)</span>
<span id="cb66-24"><a href="stage-2-running-the-model.html#cb66-24"></a>        Acc.TSMD[<span class="dv">1</span>] =<span class="st"> </span><span class="kw">ifelse</span>(M[<span class="dv">1</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb66-25"><a href="stage-2-running-the-model.html#cb66-25"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>M[i] <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb66-26"><a href="stage-2-running-the-model.html#cb66-26"></a>            Acc.TSMD[i] =<span class="st"> </span>Acc.TSMD[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>M[i]</span>
<span id="cb66-27"><a href="stage-2-running-the-model.html#cb66-27"></a>        }</span>
<span id="cb66-28"><a href="stage-2-running-the-model.html#cb66-28"></a>        <span class="cf">else</span> (Acc.TSMD[i] =<span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb66-29"><a href="stage-2-running-the-model.html#cb66-29"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="op">&lt;=</span><span class="st"> </span>Max.TSMD) {</span>
<span id="cb66-30"><a href="stage-2-running-the-model.html#cb66-30"></a>            Acc.TSMD[i] =<span class="st"> </span>Max.TSMD</span>
<span id="cb66-31"><a href="stage-2-running-the-model.html#cb66-31"></a>        }</span>
<span id="cb66-32"><a href="stage-2-running-the-model.html#cb66-32"></a>    }</span>
<span id="cb66-33"><a href="stage-2-running-the-model.html#cb66-33"></a>    b =<span class="st"> </span><span class="kw">ifelse</span>(Acc.TSMD <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.444</span> <span class="op">*</span><span class="st"> </span>Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span>((Max.TSMD <span class="op">-</span><span class="st"> </span></span>
<span id="cb66-34"><a href="stage-2-running-the-model.html#cb66-34"></a><span class="st">        </span>Acc.TSMD)<span class="op">/</span>(Max.TSMD <span class="op">-</span><span class="st"> </span><span class="fl">0.444</span> <span class="op">*</span><span class="st"> </span>Max.TSMD))))</span>
<span id="cb66-35"><a href="stage-2-running-the-model.html#cb66-35"></a>	b&lt;-<span class="kw">clamp</span>(b,<span class="dt">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb66-36"><a href="stage-2-running-the-model.html#cb66-36"></a>    <span class="kw">return</span>(<span class="kw">data.frame</span>(b))</span>
<span id="cb66-37"><a href="stage-2-running-the-model.html#cb66-37"></a>}</span>
<span id="cb66-38"><a href="stage-2-running-the-model.html#cb66-38"></a></span>
<span id="cb66-39"><a href="stage-2-running-the-model.html#cb66-39"></a></span>
<span id="cb66-40"><a href="stage-2-running-the-model.html#cb66-40"></a>fW_<span class="dv">2</span>&lt;-<span class="st"> </span><span class="kw">fw1func</span>(<span class="dt">P=</span>(Precip[,<span class="dv">2</span>]), <span class="dt">E=</span>(Evp[,<span class="dv">2</span>]), <span class="dt">S.Thick =</span> soil.thick, <span class="dt">pClay =</span> clay, <span class="dt">pE =</span> <span class="dv">1</span>, <span class="dt">bare=</span>bare1)<span class="op">$</span>b </span>
<span id="cb66-41"><a href="stage-2-running-the-model.html#cb66-41"></a></span>
<span id="cb66-42"><a href="stage-2-running-the-model.html#cb66-42"></a><span class="co">#Vegetation Cover effects  C1: No till Agriculture, C2: Conventional Agriculture, C3: Grasslands and Forests, C4 bareland and Urban</span></span>
<span id="cb66-43"><a href="stage-2-running-the-model.html#cb66-43"></a></span>
<span id="cb66-44"><a href="stage-2-running-the-model.html#cb66-44"></a>fC&lt;-Cov2[,<span class="dv">2</span>]</span>
<span id="cb66-45"><a href="stage-2-running-the-model.html#cb66-45"></a></span>
<span id="cb66-46"><a href="stage-2-running-the-model.html#cb66-46"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb66-47"><a href="stage-2-running-the-model.html#cb66-47"></a></span>
<span id="cb66-48"><a href="stage-2-running-the-model.html#cb66-48"></a>xi.frame=<span class="kw">data.frame</span>(years,<span class="kw">rep</span>(fT<span class="op">*</span>fW_<span class="dv">2</span><span class="op">*</span>fC<span class="op">*</span>fPR,<span class="dt">length.out=</span><span class="kw">length</span>(years)))</span>
<span id="cb66-49"><a href="stage-2-running-the-model.html#cb66-49"></a></span>
<span id="cb66-50"><a href="stage-2-running-the-model.html#cb66-50"></a><span class="co"># RUN THE MODEL from SoilR</span></span>
<span id="cb66-51"><a href="stage-2-running-the-model.html#cb66-51"></a><span class="co">#Loads the model Si pass=TRUE genera calcula el modelo aunque sea invalido. </span></span>
<span id="cb66-52"><a href="stage-2-running-the-model.html#cb66-52"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb66-53"><a href="stage-2-running-the-model.html#cb66-53"></a><span class="co">#Calculates stocks for each pool per month</span></span>
<span id="cb66-54"><a href="stage-2-running-the-model.html#cb66-54"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb66-55"><a href="stage-2-running-the-model.html#cb66-55"></a></span>
<span id="cb66-56"><a href="stage-2-running-the-model.html#cb66-56"></a><span class="co"># RUN THE MODEL from soilassesment</span></span>
<span id="cb66-57"><a href="stage-2-running-the-model.html#cb66-57"></a></span>
<span id="cb66-58"><a href="stage-2-running-the-model.html#cb66-58"></a>Model3_spin=<span class="kw">carbonTurnover</span>(<span class="dt">tt=</span>years,<span class="dt">C0=</span><span class="kw">c</span>(DPMptf, RPMptf, BIOptf, HUMptf, FallIOM),<span class="dt">In=</span>Cinputs,<span class="dt">Dr=</span>DR,<span class="dt">clay=</span>clay,<span class="dt">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb66-59"><a href="stage-2-running-the-model.html#cb66-59"></a></span>
<span id="cb66-60"><a href="stage-2-running-the-model.html#cb66-60"></a>Ct3_spin=Model3_spin[,<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>]</span>
<span id="cb66-61"><a href="stage-2-running-the-model.html#cb66-61"></a></span>
<span id="cb66-62"><a href="stage-2-running-the-model.html#cb66-62"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb66-63"><a href="stage-2-running-the-model.html#cb66-63"></a></span>
<span id="cb66-64"><a href="stage-2-running-the-model.html#cb66-64"></a>poolSize3_spin=<span class="kw">as.numeric</span>(<span class="kw">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb66-65"><a href="stage-2-running-the-model.html#cb66-65"></a></span>
<span id="cb66-66"><a href="stage-2-running-the-model.html#cb66-66"></a><span class="kw">return</span>(poolSize3_spin)</span>
<span id="cb66-67"><a href="stage-2-running-the-model.html#cb66-67"></a></span>
<span id="cb66-68"><a href="stage-2-running-the-model.html#cb66-68"></a>}</span>
<span id="cb66-69"><a href="stage-2-running-the-model.html#cb66-69"></a><span class="co">##############funtion set up ends##########</span></span></code></pre></div>
<p>Then, we will apply the function for each target point 18/20 times according to the number of years of the “warm up” process. We will also create empty variables called “Cinputs”,“Cinputs_min”, “Cinputs_max”,“NPP_M”,</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="stage-2-running-the-model.html#cb67-1"></a><span class="st">&quot;NPP_M_MIN&quot;</span>,<span class="st">&quot;NPP_M_MAX&quot;</span>.</span>
<span id="cb67-2"><a href="stage-2-running-the-model.html#cb67-2"></a>Cinputs&lt;-<span class="kw">c</span>()</span>
<span id="cb67-3"><a href="stage-2-running-the-model.html#cb67-3"></a>Cinputs_min&lt;-<span class="kw">c</span>()</span>
<span id="cb67-4"><a href="stage-2-running-the-model.html#cb67-4"></a>Cinputs_max&lt;-<span class="kw">c</span>()</span>
<span id="cb67-5"><a href="stage-2-running-the-model.html#cb67-5"></a>NPP_M_MIN&lt;-<span class="kw">c</span>()</span>
<span id="cb67-6"><a href="stage-2-running-the-model.html#cb67-6"></a>NPP_M_MAX&lt;-<span class="kw">c</span>()</span>
<span id="cb67-7"><a href="stage-2-running-the-model.html#cb67-7"></a>NPP_M&lt;-<span class="kw">c</span>()</span>
<span id="cb67-8"><a href="stage-2-running-the-model.html#cb67-8"></a><span class="co"># Iterates over the area of interest and over 18 years </span></span>
<span id="cb67-9"><a href="stage-2-running-the-model.html#cb67-9"></a><span class="co">###########for loop starts################</span></span>
<span id="cb67-10"><a href="stage-2-running-the-model.html#cb67-10"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(Vector_points))) {</span></code></pre></div>
<p>At his step, the iteration over the number of years of the warm up process is started:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="stage-2-running-the-model.html#cb68-1"></a>gt&lt;-firstClimLayer</span>
<span id="cb68-2"><a href="stage-2-running-the-model.html#cb68-2"></a>gp&lt;-gt<span class="op">+</span>clim_layers</span>
<span id="cb68-3"><a href="stage-2-running-the-model.html#cb68-3"></a>gevp&lt;-gp<span class="op">+</span>clim_layers</span>
<span id="cb68-4"><a href="stage-2-running-the-model.html#cb68-4"></a><span class="cf">for</span> (w <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">dim</span>(TEMP)[<span class="dv">3</span>]<span class="op">/</span><span class="dv">12</span>)) {</span>
<span id="cb68-5"><a href="stage-2-running-the-model.html#cb68-5"></a><span class="co">#print(c(&quot;year:&quot;,w))</span></span>
<span id="cb68-6"><a href="stage-2-running-the-model.html#cb68-6"></a><span class="co"># Extract the variables </span></span>
<span id="cb68-7"><a href="stage-2-running-the-model.html#cb68-7"></a>Vect&lt;-<span class="kw">as.data.frame</span>(Vector_points[i,])</span>
<span id="cb68-8"><a href="stage-2-running-the-model.html#cb68-8"></a>Temp&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[gt<span class="op">:</span>(gt<span class="op">+</span><span class="dv">11</span>)]))</span>
<span id="cb68-9"><a href="stage-2-running-the-model.html#cb68-9"></a>Temp&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Temp=</span>Temp[,<span class="dv">1</span>])</span>
<span id="cb68-10"><a href="stage-2-running-the-model.html#cb68-10"></a>Precip&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[gp<span class="op">:</span>(gp<span class="op">+</span><span class="dv">11</span>)]))</span>
<span id="cb68-11"><a href="stage-2-running-the-model.html#cb68-11"></a>Precip&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Precip=</span>Precip[,<span class="dv">1</span>])</span>
<span id="cb68-12"><a href="stage-2-running-the-model.html#cb68-12"></a>Evp&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[gevp<span class="op">:</span>(gevp<span class="op">+</span><span class="dv">11</span>)]))</span>
<span id="cb68-13"><a href="stage-2-running-the-model.html#cb68-13"></a>Evp&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Evp=</span>Evp[,<span class="dv">1</span>])</span>
<span id="cb68-14"><a href="stage-2-running-the-model.html#cb68-14"></a>Cov&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[<span class="dv">4</span><span class="op">:</span><span class="dv">15</span>]))</span>
<span id="cb68-15"><a href="stage-2-running-the-model.html#cb68-15"></a>Cov1&lt;-<span class="kw">data.frame</span>(<span class="dt">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb68-16"><a href="stage-2-running-the-model.html#cb68-16"></a>Cov2&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb68-17"><a href="stage-2-running-the-model.html#cb68-17"></a>DR_im&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[nDR_beg<span class="op">:</span>nDR_end])) <span class="co"># DR one per year according to LU</span></span>
<span id="cb68-18"><a href="stage-2-running-the-model.html#cb68-18"></a>DR_im&lt;-<span class="kw">data.frame</span>(<span class="dt">DR_im=</span>DR_im[,<span class="dv">1</span>])</span>
<span id="cb68-19"><a href="stage-2-running-the-model.html#cb68-19"></a>gt&lt;-gt<span class="op">+</span><span class="dv">12</span></span>
<span id="cb68-20"><a href="stage-2-running-the-model.html#cb68-20"></a>gp&lt;-gp<span class="op">+</span><span class="dv">12</span></span>
<span id="cb68-21"><a href="stage-2-running-the-model.html#cb68-21"></a>gevp&lt;-gevp<span class="op">+</span><span class="dv">12</span></span></code></pre></div>
<p>This line will avoid running the model over points with unreliable values:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="stage-2-running-the-model.html#cb69-1"></a><span class="co">#Avoid calculus over Na values </span></span>
<span id="cb69-2"><a href="stage-2-running-the-model.html#cb69-2"></a><span class="cf">if</span> (<span class="kw">any</span>(<span class="kw">is.na</span>(Evp[,<span class="dv">2</span>])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(Temp[,<span class="dv">2</span>])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(SOC_im[i])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(clay_im[i])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(Spin_up[i,<span class="dv">3</span>]))  <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(NPP_im[i])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(Precip[,<span class="dv">2</span>]))  <span class="op">|</span><span class="st">  </span><span class="kw">any</span>(<span class="kw">is.na</span>(Cov2[,<span class="dv">2</span>]))  <span class="op">|</span><span class="st">  </span><span class="kw">any</span>(<span class="kw">is.na</span>(Cov1[,<span class="dv">1</span>]))  <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(DR_im[,<span class="dv">1</span>]))  <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(NPP_M[,<span class="dv">1</span>]))  <span class="op">|</span><span class="st">  </span>(SOC_im[i]<span class="op">&lt;</span><span class="dv">0</span>) <span class="op">|</span><span class="st"> </span>(clay_im[i]<span class="op">&lt;</span><span class="dv">0</span>) <span class="op">|</span><span class="st"> </span>(Spin_up[i,<span class="dv">3</span>]<span class="op">&lt;=</span><span class="dv">0</span>) ) {WARM_UP[i,<span class="dv">2</span>]&lt;-<span class="dv">0</span>}<span class="cf">else</span>{</span>
<span id="cb69-3"><a href="stage-2-running-the-model.html#cb69-3"></a>We will set the rest of the variables <span class="cf">for</span> each target point i and year w<span class="op">:</span><span class="st"> </span></span>
<span id="cb69-4"><a href="stage-2-running-the-model.html#cb69-4"></a><span class="co"># Get the variables from the vector</span></span>
<span id="cb69-5"><a href="stage-2-running-the-model.html#cb69-5"></a>soil.thick=<span class="dv">30</span>  <span class="co">#Soil thickness (organic layer topsoil), in cm</span></span>
<span id="cb69-6"><a href="stage-2-running-the-model.html#cb69-6"></a>SOC&lt;-SOC_im[i]      <span class="co">#Soil organic carbon in Mg/ha </span></span>
<span id="cb69-7"><a href="stage-2-running-the-model.html#cb69-7"></a>clay&lt;-clay_im[i]        <span class="co">#Percent clay %</span></span>
<span id="cb69-8"><a href="stage-2-running-the-model.html#cb69-8"></a>DR&lt;-DR_im[w,<span class="dv">1</span>]              <span class="co"># DPM/RPM (decomposable vs resistant plant material.)</span></span>
<span id="cb69-9"><a href="stage-2-running-the-model.html#cb69-9"></a>bare1&lt;-(Cov1<span class="op">&gt;</span><span class="fl">0.8</span>)           <span class="co"># If the surface is bare or vegetated</span></span>
<span id="cb69-10"><a href="stage-2-running-the-model.html#cb69-10"></a>NPP_<span class="dv">81</span>_<span class="dv">00</span>&lt;-NPP_im[i]</span>
<span id="cb69-11"><a href="stage-2-running-the-model.html#cb69-11"></a>NPP_<span class="dv">81</span>_<span class="dv">00</span>_MIN&lt;-NPP_im_MIN[i]</span>
<span id="cb69-12"><a href="stage-2-running-the-model.html#cb69-12"></a>NPP_<span class="dv">81</span>_<span class="dv">00</span>_MAX&lt;-NPP_im_MAX[i]</span></code></pre></div>
<p>We will calculate the NPP MIAMI value for each point and each year , and adjust the carbon inputs with the NPP values. The first Cinput value corresponds to the Cinput of equilibrium calculated in the Spin Up phase (Spin_up[i,3]).</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="stage-2-running-the-model.html#cb70-1"></a><span class="co"># Cinputs </span></span>
<span id="cb70-2"><a href="stage-2-running-the-model.html#cb70-2"></a>T&lt;-<span class="kw">mean</span>(Temp[,<span class="dv">2</span>])</span>
<span id="cb70-3"><a href="stage-2-running-the-model.html#cb70-3"></a>P&lt;-<span class="kw">sum</span>(Precip[,<span class="dv">2</span>])</span>
<span id="cb70-4"><a href="stage-2-running-the-model.html#cb70-4"></a>NPP_M[w]&lt;-<span class="kw">NPPmodel</span>(P,T,<span class="st">&quot;miami&quot;</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">100</span>)<span class="op">*</span><span class="fl">0.5</span></span>
<span id="cb70-5"><a href="stage-2-running-the-model.html#cb70-5"></a>NPP_M[w]&lt;-(LU_im[i]<span class="op">==</span><span class="dv">2</span>)<span class="op">*</span>NPP_M[w]<span class="op">*</span><span class="fl">0.53</span><span class="op">+</span><span class="st"> </span>(LU_im[i]<span class="op">==</span><span class="dv">4</span>)<span class="op">*</span>NPP_M[w]<span class="op">*</span><span class="fl">0.88</span> <span class="op">+</span><span class="st"> </span>(LU_im[i]<span class="op">==</span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>LU_im[i]<span class="op">==</span><span class="dv">5</span> <span class="op">|</span><span class="st"> </span>LU_im[i]<span class="op">==</span><span class="dv">6</span> <span class="op">|</span><span class="st"> </span>LU_im[i]<span class="op">==</span><span class="dv">8</span>)<span class="op">*</span>NPP_M[w]<span class="op">*</span><span class="fl">0.72</span></span>
<span id="cb70-6"><a href="stage-2-running-the-model.html#cb70-6"></a><span class="cf">if</span> (w<span class="op">==</span><span class="dv">1</span>) {Cinputs[w]&lt;-(Spin_up[i,<span class="dv">3</span>]<span class="op">/</span>NPP_<span class="dv">81</span>_<span class="dv">00</span>)<span class="op">*</span>NPP_M[w]} <span class="cf">else</span> {Cinputs[w]&lt;-(Cinputs[[w<span class="dv">-1</span>]]<span class="op">/</span><span class="st"> </span>NPP_M[w<span class="dv">-1</span>]) <span class="op">*</span><span class="st"> </span>NPP_M[w]} </span></code></pre></div>
<p>Then we will repeat the same code but this time changing the environmental variables to match the maximum and minimum values.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="stage-2-running-the-model.html#cb71-1"></a><span class="co"># Cinputs MIN</span></span>
<span id="cb71-2"><a href="stage-2-running-the-model.html#cb71-2"></a>Tmin&lt;-<span class="kw">mean</span>(Temp[,<span class="dv">2</span>]<span class="op">*</span><span class="fl">1.02</span>)</span>
<span id="cb71-3"><a href="stage-2-running-the-model.html#cb71-3"></a>Pmin&lt;-<span class="kw">sum</span>(Precip[,<span class="dv">2</span>]<span class="op">*</span><span class="fl">0.95</span>)</span>
<span id="cb71-4"><a href="stage-2-running-the-model.html#cb71-4"></a>NPP_M_MIN[w]&lt;-<span class="kw">NPPmodel</span>(Pmin,Tmin,<span class="st">&quot;miami&quot;</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">100</span>)<span class="op">*</span><span class="fl">0.5</span></span>
<span id="cb71-5"><a href="stage-2-running-the-model.html#cb71-5"></a>NPP_M_MIN[w]&lt;-(LU_im[i]<span class="op">==</span><span class="dv">2</span>)<span class="op">*</span>NPP_M_MIN[w]<span class="op">*</span><span class="fl">0.53</span><span class="op">+</span><span class="st"> </span>(LU_im[i]<span class="op">==</span><span class="dv">4</span>)<span class="op">*</span>NPP_M_MIN[w]<span class="op">*</span><span class="fl">0.88</span> <span class="op">+</span><span class="st"> </span>(LU_im[i]<span class="op">==</span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>LU_im[i]<span class="op">==</span><span class="dv">5</span> <span class="op">|</span><span class="st"> </span>LU_im[i]<span class="op">==</span><span class="dv">6</span> <span class="op">|</span><span class="st"> </span>LU_im[i]<span class="op">==</span><span class="dv">8</span>)<span class="op">*</span>NPP_M_MIN[w]<span class="op">*</span><span class="fl">0.72</span></span>
<span id="cb71-6"><a href="stage-2-running-the-model.html#cb71-6"></a><span class="cf">if</span> (w<span class="op">==</span><span class="dv">1</span>) {Cinputs_min[w]&lt;-(Spin_up[i,<span class="dv">10</span>]<span class="op">/</span>NPP_<span class="dv">81</span>_<span class="dv">00</span>)<span class="op">*</span>NPP_M_MIN[w]} <span class="cf">else</span> {Cinputs_min[w]&lt;-(Cinputs_min[[w<span class="dv">-1</span>]]<span class="op">/</span><span class="st"> </span>NPP_M_MIN[w<span class="dv">-1</span>]) <span class="op">*</span><span class="st"> </span>NPP_M_MIN[w]} </span>
<span id="cb71-7"><a href="stage-2-running-the-model.html#cb71-7"></a><span class="co"># Cinputs MAX</span></span>
<span id="cb71-8"><a href="stage-2-running-the-model.html#cb71-8"></a>Tmax&lt;-<span class="kw">mean</span>(Temp[,<span class="dv">2</span>]<span class="op">*</span><span class="fl">0.98</span>)</span>
<span id="cb71-9"><a href="stage-2-running-the-model.html#cb71-9"></a>Pmax&lt;-<span class="kw">sum</span>(Precip[,<span class="dv">2</span>]<span class="op">*</span><span class="fl">1.05</span>)</span>
<span id="cb71-10"><a href="stage-2-running-the-model.html#cb71-10"></a>NPP_M_MAX[w]&lt;-<span class="kw">NPPmodel</span>(Pmax,Tmax,<span class="st">&quot;miami&quot;</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">100</span>)<span class="op">*</span><span class="fl">0.5</span></span>
<span id="cb71-11"><a href="stage-2-running-the-model.html#cb71-11"></a>NPP_M_MAX[w]&lt;-(LU_im[i]<span class="op">==</span><span class="dv">2</span>)<span class="op">*</span>NPP_M_MAX[w]<span class="op">*</span><span class="fl">0.53</span><span class="op">+</span><span class="st"> </span>(LU_im[i]<span class="op">==</span><span class="dv">4</span>)<span class="op">*</span>NPP_M_MAX[w]<span class="op">*</span><span class="fl">0.88</span> <span class="op">+</span><span class="st"> </span>(LU_im[i]<span class="op">==</span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>LU_im[i]<span class="op">==</span><span class="dv">5</span> <span class="op">|</span><span class="st"> </span>LU_im[i]<span class="op">==</span><span class="dv">6</span> <span class="op">|</span><span class="st"> </span>LU_im[i]<span class="op">==</span><span class="dv">8</span>)<span class="op">*</span>NPP_M_MAX[w]<span class="op">*</span><span class="fl">0.72</span></span>
<span id="cb71-12"><a href="stage-2-running-the-model.html#cb71-12"></a><span class="cf">if</span> (w<span class="op">==</span><span class="dv">1</span>) {Cinputs_max[w]&lt;-(Spin_up[i,<span class="dv">11</span>]<span class="op">/</span>NPP_<span class="dv">81</span>_<span class="dv">00</span>)<span class="op">*</span>NPP_M_MAX[w]} <span class="cf">else</span> {Cinputs_max[w]&lt;-(Cinputs_max[[w<span class="dv">-1</span>]]<span class="op">/</span><span class="st"> </span>NPP_M_MAX[w<span class="dv">-1</span>]) <span class="op">*</span><span class="st"> </span>NPP_M_MAX[w]} </span></code></pre></div>
<p>We will then run the RothC function for each point and each year. The first year we will use the equilibrium Cinputs, and the carbon pools obtained from the Spin Up phase. Then we will use the yearly adjusted Cinputs (using NPP) and the pools calculated from the previous iteration.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="stage-2-running-the-model.html#cb72-1"></a><span class="co"># Run the model for 2001-2018 </span></span>
<span id="cb72-2"><a href="stage-2-running-the-model.html#cb72-2"></a><span class="cf">if</span> (w<span class="op">==</span><span class="dv">1</span>) {</span>
<span id="cb72-3"><a href="stage-2-running-the-model.html#cb72-3"></a>f_wp&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>Cinputs[<span class="dv">1</span>],<span class="dt">years=</span>year,<span class="dt">DPMptf=</span>Spin_up[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>Spin_up[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>Spin_up[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>Spin_up[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>Spin_up[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1)</span>
<span id="cb72-4"><a href="stage-2-running-the-model.html#cb72-4"></a>} <span class="cf">else</span> {</span>
<span id="cb72-5"><a href="stage-2-running-the-model.html#cb72-5"></a>f_wp&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>Cinputs[w],<span class="dt">years=</span>year,<span class="dt">DPMptf=</span>f_wp[<span class="dv">1</span>], <span class="dt">RPMptf=</span>f_wp[<span class="dv">2</span>], <span class="dt">BIOptf=</span>f_wp[<span class="dv">3</span>], <span class="dt">HUMptf=</span>f_wp[<span class="dv">4</span>], <span class="dt">FallIOM=</span>f_wp[<span class="dv">5</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1)</span>
<span id="cb72-6"><a href="stage-2-running-the-model.html#cb72-6"></a>}</span>
<span id="cb72-7"><a href="stage-2-running-the-model.html#cb72-7"></a>f_wp_t&lt;-f_wp[<span class="dv">1</span>]<span class="op">+</span>f_wp[<span class="dv">2</span>]<span class="op">+</span>f_wp[<span class="dv">3</span>]<span class="op">+</span>f_wp[<span class="dv">4</span>]<span class="op">+</span>f_wp[<span class="dv">5</span>]</span>
<span id="cb72-8"><a href="stage-2-running-the-model.html#cb72-8"></a><span class="co"># Run the model for minimum values</span></span>
<span id="cb72-9"><a href="stage-2-running-the-model.html#cb72-9"></a><span class="cf">if</span> (w<span class="op">==</span><span class="dv">1</span>) {</span>
<span id="cb72-10"><a href="stage-2-running-the-model.html#cb72-10"></a>f_wp_min&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>Cinputs_min[<span class="dv">1</span>],<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>Spin_up[i,<span class="dv">13</span>], <span class="dt">RPMptf=</span>Spin_up[i,<span class="dv">14</span>], <span class="dt">BIOptf=</span>Spin_up[i,<span class="dv">15</span>], <span class="dt">HUMptf=</span>Spin_up[i,<span class="dv">16</span>], <span class="dt">FallIOM=</span>Spin_up[i,<span class="dv">17</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">1.02</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">0.95</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">0.8</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">0.9</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1)</span>
<span id="cb72-11"><a href="stage-2-running-the-model.html#cb72-11"></a>} <span class="cf">else</span> {</span>
<span id="cb72-12"><a href="stage-2-running-the-model.html#cb72-12"></a>f_wp_min&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>Cinputs_min[w],<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>f_wp_min[<span class="dv">1</span>], <span class="dt">RPMptf=</span>f_wp_min[<span class="dv">2</span>], <span class="dt">BIOptf=</span>f_wp_min[<span class="dv">3</span>], <span class="dt">HUMptf=</span>f_wp_min[<span class="dv">4</span>], <span class="dt">FallIOM=</span>f_wp_min[<span class="dv">5</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">1.02</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">0.95</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">0.8</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">0.9</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1)</span>
<span id="cb72-13"><a href="stage-2-running-the-model.html#cb72-13"></a>}</span>
<span id="cb72-14"><a href="stage-2-running-the-model.html#cb72-14"></a>f_wp_t_min&lt;-f_wp_min[<span class="dv">1</span>]<span class="op">+</span>f_wp_min[<span class="dv">2</span>]<span class="op">+</span>f_wp_min[<span class="dv">3</span>]<span class="op">+</span>f_wp_min[<span class="dv">4</span>]<span class="op">+</span>f_wp_min[<span class="dv">5</span>]</span>
<span id="cb72-15"><a href="stage-2-running-the-model.html#cb72-15"></a><span class="co"># Run the model for maximum values</span></span>
<span id="cb72-16"><a href="stage-2-running-the-model.html#cb72-16"></a><span class="cf">if</span> (w<span class="op">==</span><span class="dv">1</span>) {</span>
<span id="cb72-17"><a href="stage-2-running-the-model.html#cb72-17"></a>f_wp_max&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>Cinputs_max[<span class="dv">1</span>],<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>Spin_up[i,<span class="dv">19</span>], <span class="dt">RPMptf=</span>Spin_up[i,<span class="dv">20</span>], <span class="dt">BIOptf=</span>Spin_up[i,<span class="dv">21</span>], <span class="dt">HUMptf=</span>Spin_up[i,<span class="dv">22</span>], <span class="dt">FallIOM=</span>Spin_up[i,<span class="dv">23</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">0.98</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">1.05</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">1.2</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">1.1</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1)</span>
<span id="cb72-18"><a href="stage-2-running-the-model.html#cb72-18"></a>} <span class="cf">else</span> {</span>
<span id="cb72-19"><a href="stage-2-running-the-model.html#cb72-19"></a>f_wp_max&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>Cinputs_max[w],<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>f_wp_max[<span class="dv">1</span>], <span class="dt">RPMptf=</span>f_wp_max[<span class="dv">2</span>], <span class="dt">BIOptf=</span>f_wp_max[<span class="dv">3</span>], <span class="dt">HUMptf=</span>f_wp_max[<span class="dv">4</span>], <span class="dt">FallIOM=</span>f_wp_max[<span class="dv">5</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">0.98</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">1.05</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">1.2</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">1.1</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1)</span>
<span id="cb72-20"><a href="stage-2-running-the-model.html#cb72-20"></a>}</span>
<span id="cb72-21"><a href="stage-2-running-the-model.html#cb72-21"></a>f_wp_t_max&lt;-f_wp_max[<span class="dv">1</span>]<span class="op">+</span>f_wp_max[<span class="dv">2</span>]<span class="op">+</span>f_wp_max[<span class="dv">3</span>]<span class="op">+</span>f_wp_max[<span class="dv">4</span>]<span class="op">+</span>f_wp_max[<span class="dv">5</span>]</span>
<span id="cb72-22"><a href="stage-2-running-the-model.html#cb72-22"></a><span class="kw">print</span>(w)</span>
<span id="cb72-23"><a href="stage-2-running-the-model.html#cb72-23"></a><span class="kw">print</span>(<span class="kw">c</span>(i,SOC,Spin_up[i,<span class="dv">3</span>],NPP_<span class="dv">81</span>_<span class="dv">00</span>,NPP_M[w,<span class="dv">1</span>],Cinputs[w],f_wp_t,DR_im[w,<span class="dv">1</span>]))</span>
<span id="cb72-24"><a href="stage-2-running-the-model.html#cb72-24"></a><span class="er">}</span></span>
<span id="cb72-25"><a href="stage-2-running-the-model.html#cb72-25"></a><span class="er">}</span></span></code></pre></div>
<p>We will save the results from the iteration of the last year to the empty vector. We will also calculate an average of all the Cinputs used in the warm up phase and save it. We will need this “CinputFOWARD” variable in the next phase (Forward) and script (script number 15).</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="stage-2-running-the-model.html#cb73-1"></a><span class="cf">if</span> (<span class="kw">is.na</span>(<span class="kw">mean</span>(Cinputs))){ CinputFOWARD&lt;-<span class="ot">NA</span>} <span class="cf">else</span> { </span>
<span id="cb73-2"><a href="stage-2-running-the-model.html#cb73-2"></a>CinputFOWARD&lt;-<span class="kw">mean</span>(Cinputs)</span>
<span id="cb73-3"><a href="stage-2-running-the-model.html#cb73-3"></a>CinputFOWARD_min&lt;-<span class="kw">mean</span>(Cinputs_min)</span>
<span id="cb73-4"><a href="stage-2-running-the-model.html#cb73-4"></a>CinputFOWARD_max&lt;-<span class="kw">mean</span>(Cinputs_max)</span>
<span id="cb73-5"><a href="stage-2-running-the-model.html#cb73-5"></a>WARM_UP[i,<span class="dv">2</span>]&lt;-SOC</span>
<span id="cb73-6"><a href="stage-2-running-the-model.html#cb73-6"></a>WARM_UP[i,<span class="dv">3</span>]&lt;-Cinputs[<span class="dv">18</span>]</span>
<span id="cb73-7"><a href="stage-2-running-the-model.html#cb73-7"></a>WARM_UP[i,<span class="dv">4</span>]&lt;-f_wp_t</span>
<span id="cb73-8"><a href="stage-2-running-the-model.html#cb73-8"></a>WARM_UP[i,<span class="dv">5</span>]&lt;-f_wp[<span class="dv">1</span>]</span>
<span id="cb73-9"><a href="stage-2-running-the-model.html#cb73-9"></a>WARM_UP[i,<span class="dv">6</span>]&lt;-f_wp[<span class="dv">2</span>]</span>
<span id="cb73-10"><a href="stage-2-running-the-model.html#cb73-10"></a>WARM_UP[i,<span class="dv">7</span>]&lt;-f_wp[<span class="dv">3</span>]</span>
<span id="cb73-11"><a href="stage-2-running-the-model.html#cb73-11"></a>WARM_UP[i,<span class="dv">8</span>]&lt;-f_wp[<span class="dv">4</span>]</span>
<span id="cb73-12"><a href="stage-2-running-the-model.html#cb73-12"></a>WARM_UP[i,<span class="dv">9</span>]&lt;-f_wp[<span class="dv">5</span>]</span>
<span id="cb73-13"><a href="stage-2-running-the-model.html#cb73-13"></a>WARM_UP[i,<span class="dv">10</span>]&lt;-CinputFOWARD</span>
<span id="cb73-14"><a href="stage-2-running-the-model.html#cb73-14"></a>WARM_UP[i,<span class="dv">11</span>]&lt;-f_wp_t_min</span>
<span id="cb73-15"><a href="stage-2-running-the-model.html#cb73-15"></a>WARM_UP[i,<span class="dv">12</span>]&lt;-f_wp_min[<span class="dv">1</span>]</span>
<span id="cb73-16"><a href="stage-2-running-the-model.html#cb73-16"></a>WARM_UP[i,<span class="dv">13</span>]&lt;-f_wp_min[<span class="dv">2</span>]</span>
<span id="cb73-17"><a href="stage-2-running-the-model.html#cb73-17"></a>WARM_UP[i,<span class="dv">14</span>]&lt;-f_wp_min[<span class="dv">3</span>]</span>
<span id="cb73-18"><a href="stage-2-running-the-model.html#cb73-18"></a>WARM_UP[i,<span class="dv">15</span>]&lt;-f_wp_min[<span class="dv">4</span>]</span>
<span id="cb73-19"><a href="stage-2-running-the-model.html#cb73-19"></a>WARM_UP[i,<span class="dv">16</span>]&lt;-f_wp_min[<span class="dv">5</span>]</span>
<span id="cb73-20"><a href="stage-2-running-the-model.html#cb73-20"></a>WARM_UP[i,<span class="dv">17</span>]&lt;-f_wp_t_max</span>
<span id="cb73-21"><a href="stage-2-running-the-model.html#cb73-21"></a>WARM_UP[i,<span class="dv">18</span>]&lt;-f_wp_max[<span class="dv">1</span>]</span>
<span id="cb73-22"><a href="stage-2-running-the-model.html#cb73-22"></a>WARM_UP[i,<span class="dv">19</span>]&lt;-f_wp_max[<span class="dv">2</span>]</span>
<span id="cb73-23"><a href="stage-2-running-the-model.html#cb73-23"></a>WARM_UP[i,<span class="dv">20</span>]&lt;-f_wp_max[<span class="dv">3</span>]</span>
<span id="cb73-24"><a href="stage-2-running-the-model.html#cb73-24"></a>WARM_UP[i,<span class="dv">21</span>]&lt;-f_wp_max[<span class="dv">4</span>]</span>
<span id="cb73-25"><a href="stage-2-running-the-model.html#cb73-25"></a>WARM_UP[i,<span class="dv">22</span>]&lt;-f_wp_max[<span class="dv">5</span>]</span>
<span id="cb73-26"><a href="stage-2-running-the-model.html#cb73-26"></a>WARM_UP[i,<span class="dv">23</span>]&lt;-CinputFOWARD_min</span>
<span id="cb73-27"><a href="stage-2-running-the-model.html#cb73-27"></a>WARM_UP[i,<span class="dv">24</span>]&lt;-CinputFOWARD_max</span>
<span id="cb73-28"><a href="stage-2-running-the-model.html#cb73-28"></a>Cinputs&lt;-<span class="kw">c</span>()</span>
<span id="cb73-29"><a href="stage-2-running-the-model.html#cb73-29"></a>Cinputs_min&lt;-<span class="kw">c</span>()</span>
<span id="cb73-30"><a href="stage-2-running-the-model.html#cb73-30"></a>Cinputs_max&lt;-<span class="kw">c</span>()</span>
<span id="cb73-31"><a href="stage-2-running-the-model.html#cb73-31"></a>}</span>
<span id="cb73-32"><a href="stage-2-running-the-model.html#cb73-32"></a><span class="kw">print</span>(i)</span>
<span id="cb73-33"><a href="stage-2-running-the-model.html#cb73-33"></a><span class="er">}</span></span>
<span id="cb73-34"><a href="stage-2-running-the-model.html#cb73-34"></a><span class="co">###########for loop ends################</span></span></code></pre></div>
<p>We will then run the last code block to change the names to the fields of the vector’s table.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="stage-2-running-the-model.html#cb74-1"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">2</span>]=<span class="st">&quot;SOC_FAO&quot;</span></span>
<span id="cb74-2"><a href="stage-2-running-the-model.html#cb74-2"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">3</span>]=<span class="st">&quot;Cin_2018&quot;</span></span>
<span id="cb74-3"><a href="stage-2-running-the-model.html#cb74-3"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">4</span>]=<span class="st">&quot;SOC_2018&quot;</span></span>
<span id="cb74-4"><a href="stage-2-running-the-model.html#cb74-4"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">5</span>]=<span class="st">&quot;DPM_w_up&quot;</span></span>
<span id="cb74-5"><a href="stage-2-running-the-model.html#cb74-5"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">6</span>]=<span class="st">&quot;RPM_w_up&quot;</span></span>
<span id="cb74-6"><a href="stage-2-running-the-model.html#cb74-6"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">7</span>]=<span class="st">&quot;BIO_w_up&quot;</span></span>
<span id="cb74-7"><a href="stage-2-running-the-model.html#cb74-7"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">8</span>]=<span class="st">&quot;HUM_w_up&quot;</span></span>
<span id="cb74-8"><a href="stage-2-running-the-model.html#cb74-8"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">9</span>]=<span class="st">&quot;IOM_w_up&quot;</span></span>
<span id="cb74-9"><a href="stage-2-running-the-model.html#cb74-9"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">10</span>]=<span class="st">&quot;Cin_mean&quot;</span></span>
<span id="cb74-10"><a href="stage-2-running-the-model.html#cb74-10"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">11</span>]=<span class="st">&quot;SOC_18min&quot;</span></span>
<span id="cb74-11"><a href="stage-2-running-the-model.html#cb74-11"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">12</span>]=<span class="st">&quot;DPM_w_min&quot;</span></span>
<span id="cb74-12"><a href="stage-2-running-the-model.html#cb74-12"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">13</span>]=<span class="st">&quot;RPM_w_min&quot;</span></span>
<span id="cb74-13"><a href="stage-2-running-the-model.html#cb74-13"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">14</span>]=<span class="st">&quot;BIO_w_min&quot;</span></span>
<span id="cb74-14"><a href="stage-2-running-the-model.html#cb74-14"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">15</span>]=<span class="st">&quot;HUM_w_min&quot;</span></span>
<span id="cb74-15"><a href="stage-2-running-the-model.html#cb74-15"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">16</span>]=<span class="st">&quot;IOM_w_min&quot;</span></span>
<span id="cb74-16"><a href="stage-2-running-the-model.html#cb74-16"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">17</span>]=<span class="st">&quot;SOC_18max&quot;</span></span>
<span id="cb74-17"><a href="stage-2-running-the-model.html#cb74-17"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">18</span>]=<span class="st">&quot;DPM_w_max&quot;</span></span>
<span id="cb74-18"><a href="stage-2-running-the-model.html#cb74-18"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">19</span>]=<span class="st">&quot;RPM_w_max&quot;</span></span>
<span id="cb74-19"><a href="stage-2-running-the-model.html#cb74-19"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">20</span>]=<span class="st">&quot;BIO_w_max&quot;</span></span>
<span id="cb74-20"><a href="stage-2-running-the-model.html#cb74-20"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">21</span>]=<span class="st">&quot;HUM_w_max&quot;</span></span>
<span id="cb74-21"><a href="stage-2-running-the-model.html#cb74-21"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">22</span>]=<span class="st">&quot;IOM_w_max&quot;</span></span>
<span id="cb74-22"><a href="stage-2-running-the-model.html#cb74-22"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">23</span>]=<span class="st">&quot;Cin_min&quot;</span></span>
<span id="cb74-23"><a href="stage-2-running-the-model.html#cb74-23"></a><span class="kw">colnames</span>(WARM_UP<span class="op">@</span>data)[<span class="dv">24</span>]=<span class="st">&quot;Cin_max&quot;</span></span></code></pre></div>
<p>Finally, we will have to save the output vector and the name of that vector.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="stage-2-running-the-model.html#cb75-1"></a> <span class="co"># SAVE the Points (shapefile) </span></span>
<span id="cb75-2"><a href="stage-2-running-the-model.html#cb75-2"></a><span class="kw">writeOGR</span>(WARM_UP,<span class="st">&quot;.&quot;</span>, <span class="st">&quot;OUTPUTS/2_WARM_UP/WARM_UP_County_AOI&quot;</span>, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>)</span></code></pre></div>
<div id="script-number-15.-roth_c_forward_v2.r" class="section level3">
<h3><span class="header-section-number">10.2.1</span> Script Number 15. “ROTH_C_forward_v2.R”</h3>
<p>Script number 15 implements the third modeling phase (“forward” phase). We will need to load the stack of layers generated in script number 12 and the target points. We will also need to load the output vector of the phase 2 (“warm up”) as an input. This script will run the Roth C model for 20 years, projecting SOC stocks for the 2020-2040 period under different management scenarios (“BAU” scenario and the three SSM scenarios: low, medium and high input carbon). C inputs will vary according to the SSM scenarios. Standard default values of 5-10-20% increase in C inputs are defined for the three SSM scenarios (low, medium, high, respectively). Users can modify these inputs based on local expertise and available information, and generate alternative maps using this data. The final outputs will be the final SOC stocks after 20 years for the different scenarios. This information will be saved to a shapefile.</p>
<p><strong>Table 10.3</strong> <em>Script Number 15. forward phase. Inputs and Outputs</em></p>
<p><img src="tables/Table_10.3.png" /></p>
<p>The ‘Forward’ modeling phase requires (as in the previous phases) the target points (generated from the Qgis procedure number 1), the stack of layers (from script number 12), and the output vector from the previous phase (warm up). We will need to load the R packages, the target points, the stack for this phase (Stack_Set_forward_[country_code].tif), and vector from the ‘Warm up’ phase (WARM_UP.shp).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="stage-2-running-the-model.html#cb76-1"></a><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>()) </span>
<span id="cb76-2"><a href="stage-2-running-the-model.html#cb76-2"></a><span class="kw">library</span>(SoilR)</span>
<span id="cb76-3"><a href="stage-2-running-the-model.html#cb76-3"></a><span class="kw">library</span>(raster)</span>
<span id="cb76-4"><a href="stage-2-running-the-model.html#cb76-4"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb76-5"><a href="stage-2-running-the-model.html#cb76-5"></a><span class="kw">library</span>(soilassessment)</span>
<span id="cb76-6"><a href="stage-2-running-the-model.html#cb76-6"></a>WD_OUT&lt;-(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020/OUTPUTS/3_FOWARD&quot;</span>)</span>
<span id="cb76-7"><a href="stage-2-running-the-model.html#cb76-7"></a>working_dir&lt;-<span class="kw">setwd</span>(<span class="st">&quot;C:/TRAINING_MATERIALS_GSOCseq_MAPS_28-09-2020&quot;</span>)</span>
<span id="cb76-8"><a href="stage-2-running-the-model.html#cb76-8"></a><span class="co"># OPEN THE VECTOR OF POINTS</span></span>
<span id="cb76-9"><a href="stage-2-running-the-model.html#cb76-9"></a>Vector&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;INPUTS/TARGET_POINTS/target_points_sub.shp&quot;</span>)</span>
<span id="cb76-10"><a href="stage-2-running-the-model.html#cb76-10"></a><span class="co"># OPEN THE RESULT VECTOR FROM THE WARM UP PROCESS</span></span>
<span id="cb76-11"><a href="stage-2-running-the-model.html#cb76-11"></a>WARM_UP&lt;-<span class="kw">readOGR</span>(<span class="st">&quot;OUTPUTS/2_WARM_UP/WARM_UP_County_AOI.shp&quot;</span>)</span>
<span id="cb76-12"><a href="stage-2-running-the-model.html#cb76-12"></a><span class="co"># OPEN THE STACK WITH THE VARIABLES FOR THE FOWARD PROCESS</span></span>
<span id="cb76-13"><a href="stage-2-running-the-model.html#cb76-13"></a>Stack_Set_<span class="dv">1</span>&lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="st">&quot;INPUTS/STACK/Stack_Set_FOWARD.tif&quot;</span>)</span></code></pre></div>
<p>We can set the SSM carbon input increment of each land use class.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="stage-2-running-the-model.html#cb77-1"></a><span class="co"># Set the increase in Carbon input for each land use and each scenario</span></span>
<span id="cb77-2"><a href="stage-2-running-the-model.html#cb77-2"></a><span class="co">#Crops and Crop trees</span></span>
<span id="cb77-3"><a href="stage-2-running-the-model.html#cb77-3"></a>Low_Crops&lt;-<span class="fl">1.05</span></span>
<span id="cb77-4"><a href="stage-2-running-the-model.html#cb77-4"></a>Med_Crops&lt;-<span class="fl">1.10</span></span>
<span id="cb77-5"><a href="stage-2-running-the-model.html#cb77-5"></a>High_Crops&lt;-<span class="fl">1.2</span></span>
<span id="cb77-6"><a href="stage-2-running-the-model.html#cb77-6"></a><span class="co">#Shrublands, Grasslands , Herbaceous vegetation flooded &amp; Sparse Vegetation</span></span>
<span id="cb77-7"><a href="stage-2-running-the-model.html#cb77-7"></a>Low_Grass&lt;-<span class="fl">1.05</span></span>
<span id="cb77-8"><a href="stage-2-running-the-model.html#cb77-8"></a>Med_Grass&lt;-<span class="fl">1.10</span></span>
<span id="cb77-9"><a href="stage-2-running-the-model.html#cb77-9"></a>High_Grass&lt;-<span class="fl">1.2</span></span>
<span id="cb77-10"><a href="stage-2-running-the-model.html#cb77-10"></a><span class="co">#Forest</span></span>
<span id="cb77-11"><a href="stage-2-running-the-model.html#cb77-11"></a>Low_Forest&lt;-<span class="fl">1.05</span></span>
<span id="cb77-12"><a href="stage-2-running-the-model.html#cb77-12"></a>Med_Forest&lt;-<span class="fl">1.10</span></span>
<span id="cb77-13"><a href="stage-2-running-the-model.html#cb77-13"></a>High_Forest&lt;-<span class="fl">1.2</span></span>
<span id="cb77-14"><a href="stage-2-running-the-model.html#cb77-14"></a><span class="co">#Paddy Fields</span></span>
<span id="cb77-15"><a href="stage-2-running-the-model.html#cb77-15"></a>Low_PaddyFields&lt;-<span class="fl">1.05</span></span>
<span id="cb77-16"><a href="stage-2-running-the-model.html#cb77-16"></a>Med_PaddyFields&lt;-<span class="fl">1.10</span></span>
<span id="cb77-17"><a href="stage-2-running-the-model.html#cb77-17"></a>High_PaddyFields&lt;-<span class="fl">1.2</span></span></code></pre></div>
<p>Next, we will extract the variables contained in the stack to the target points.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="stage-2-running-the-model.html#cb78-1"></a><span class="co"># extract variables to points</span></span>
<span id="cb78-2"><a href="stage-2-running-the-model.html#cb78-2"></a>Variables&lt;-<span class="kw">extract</span>(Stack_Set_<span class="dv">1</span>,Vector,<span class="dt">sp=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p>Then we will create a variable to save the results from the simulations.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="stage-2-running-the-model.html#cb79-1"></a><span class="co"># Creates an empty vector</span></span>
<span id="cb79-2"><a href="stage-2-running-the-model.html#cb79-2"></a>FOWARD&lt;-Vector</span></code></pre></div>
<p>We will extract some of the variables needed in the model to individual variables .</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="stage-2-running-the-model.html#cb80-1"></a><span class="co"># Extract the layers from the Vector</span></span>
<span id="cb80-2"><a href="stage-2-running-the-model.html#cb80-2"></a>SOC_im&lt;-WARM_UP[[<span class="dv">4</span>]]</span>
<span id="cb80-3"><a href="stage-2-running-the-model.html#cb80-3"></a>clay_im&lt;-Variables[[<span class="dv">3</span>]] </span>
<span id="cb80-4"><a href="stage-2-running-the-model.html#cb80-4"></a>Cinputs_im&lt;-WARM_UP[[<span class="dv">10</span>]] </span>
<span id="cb80-5"><a href="stage-2-running-the-model.html#cb80-5"></a>DR_im&lt;-Variables[[<span class="dv">40</span>]]</span>
<span id="cb80-6"><a href="stage-2-running-the-model.html#cb80-6"></a>LU_im&lt;-Variables[[<span class="dv">41</span>]]</span></code></pre></div>
<p>Next, we will define the number of years for the modeling runs.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="stage-2-running-the-model.html#cb81-1"></a><span class="co"># Define the years to run the model</span></span>
<span id="cb81-2"><a href="stage-2-running-the-model.html#cb81-2"></a>years=<span class="kw">seq</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">12</span>,<span class="dv">20</span>,<span class="dt">by=</span><span class="dv">1</span><span class="op">/</span><span class="dv">12</span>)</span></code></pre></div>
<p>Then, we will set the RothC function as we did for the previous modeling phases.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="stage-2-running-the-model.html#cb82-1"></a><span class="co">#############function set up starts###############</span></span>
<span id="cb82-2"><a href="stage-2-running-the-model.html#cb82-2"></a>Roth_C&lt;-<span class="cf">function</span>(Cinputs,years,DPMptf, RPMptf, BIOptf, HUMptf, FallIOM,Temp,Precip,Evp,Cov,Cov1,Cov2,soil.thick,SOC,clay,DR,bare1,LU)</span>
<span id="cb82-3"><a href="stage-2-running-the-model.html#cb82-3"></a>{</span>
<span id="cb82-4"><a href="stage-2-running-the-model.html#cb82-4"></a><span class="co"># Paddy Fields coefficent fPR = 0.4 if the target point is class = 13 , else fPR=1</span></span>
<span id="cb82-5"><a href="stage-2-running-the-model.html#cb82-5"></a><span class="co"># From Shirato and Yukozawa 2004</span></span>
<span id="cb82-6"><a href="stage-2-running-the-model.html#cb82-6"></a></span>
<span id="cb82-7"><a href="stage-2-running-the-model.html#cb82-7"></a>fPR=(LU <span class="op">==</span><span class="st"> </span><span class="dv">13</span>)<span class="op">*</span><span class="fl">0.4</span> <span class="op">+</span><span class="st"> </span>(LU<span class="op">!=</span><span class="dv">13</span>)<span class="op">*</span><span class="dv">1</span></span>
<span id="cb82-8"><a href="stage-2-running-the-model.html#cb82-8"></a></span>
<span id="cb82-9"><a href="stage-2-running-the-model.html#cb82-9"></a><span class="co">#Temperature effects per month</span></span>
<span id="cb82-10"><a href="stage-2-running-the-model.html#cb82-10"></a>fT=<span class="kw">fT.RothC</span>(Temp[,<span class="dv">2</span>]) </span>
<span id="cb82-11"><a href="stage-2-running-the-model.html#cb82-11"></a></span>
<span id="cb82-12"><a href="stage-2-running-the-model.html#cb82-12"></a><span class="co">#Moisture effects per month . </span></span>
<span id="cb82-13"><a href="stage-2-running-the-model.html#cb82-13"></a></span>
<span id="cb82-14"><a href="stage-2-running-the-model.html#cb82-14"></a>fw1func&lt;-<span class="cf">function</span>(P, E, <span class="dt">S.Thick =</span> <span class="dv">30</span>, <span class="dt">pClay =</span> <span class="fl">32.0213</span>, <span class="dt">pE =</span> <span class="dv">1</span>, bare) </span>
<span id="cb82-15"><a href="stage-2-running-the-model.html#cb82-15"></a>{</span>
<span id="cb82-16"><a href="stage-2-running-the-model.html#cb82-16"></a>   </span>
<span id="cb82-17"><a href="stage-2-running-the-model.html#cb82-17"></a>    M =<span class="st"> </span>P <span class="op">-</span><span class="st"> </span>E <span class="op">*</span><span class="st"> </span>pE</span>
<span id="cb82-18"><a href="stage-2-running-the-model.html#cb82-18"></a>    Acc.TSMD =<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb82-19"><a href="stage-2-running-the-model.html#cb82-19"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(M)) {</span>
<span id="cb82-20"><a href="stage-2-running-the-model.html#cb82-20"></a> 	B =<span class="st"> </span><span class="kw">ifelse</span>(bare[i] <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>, <span class="dv">1</span>, <span class="fl">1.8</span>)</span>
<span id="cb82-21"><a href="stage-2-running-the-model.html#cb82-21"></a>	 Max.TSMD =<span class="st"> </span><span class="op">-</span>(<span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="fl">1.3</span> <span class="op">*</span><span class="st"> </span>pClay <span class="op">-</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">*</span><span class="st"> </span>(pClay<span class="op">^</span><span class="dv">2</span>)) <span class="op">*</span><span class="st"> </span>(S.Thick<span class="op">/</span><span class="dv">23</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>B)</span>
<span id="cb82-22"><a href="stage-2-running-the-model.html#cb82-22"></a>        Acc.TSMD[<span class="dv">1</span>] =<span class="st"> </span><span class="kw">ifelse</span>(M[<span class="dv">1</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">0</span>, M[<span class="dv">1</span>])</span>
<span id="cb82-23"><a href="stage-2-running-the-model.html#cb82-23"></a>        <span class="cf">if</span> (Acc.TSMD[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>M[i] <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb82-24"><a href="stage-2-running-the-model.html#cb82-24"></a>            Acc.TSMD[i] =<span class="st"> </span>Acc.TSMD[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>M[i]</span>
<span id="cb82-25"><a href="stage-2-running-the-model.html#cb82-25"></a>        }</span>
<span id="cb82-26"><a href="stage-2-running-the-model.html#cb82-26"></a>        <span class="cf">else</span> (Acc.TSMD[i] =<span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb82-27"><a href="stage-2-running-the-model.html#cb82-27"></a>        <span class="cf">if</span> (Acc.TSMD[i] <span class="op">&lt;=</span><span class="st"> </span>Max.TSMD) {</span>
<span id="cb82-28"><a href="stage-2-running-the-model.html#cb82-28"></a>            Acc.TSMD[i] =<span class="st"> </span>Max.TSMD</span>
<span id="cb82-29"><a href="stage-2-running-the-model.html#cb82-29"></a>        }</span>
<span id="cb82-30"><a href="stage-2-running-the-model.html#cb82-30"></a>    }</span>
<span id="cb82-31"><a href="stage-2-running-the-model.html#cb82-31"></a>    b =<span class="st"> </span><span class="kw">ifelse</span>(Acc.TSMD <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.444</span> <span class="op">*</span><span class="st"> </span>Max.TSMD, <span class="dv">1</span>, (<span class="fl">0.2</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span>((Max.TSMD <span class="op">-</span><span class="st"> </span></span>
<span id="cb82-32"><a href="stage-2-running-the-model.html#cb82-32"></a><span class="st">        </span>Acc.TSMD)<span class="op">/</span>(Max.TSMD <span class="op">-</span><span class="st"> </span><span class="fl">0.444</span> <span class="op">*</span><span class="st"> </span>Max.TSMD))))</span>
<span id="cb82-33"><a href="stage-2-running-the-model.html#cb82-33"></a>	b&lt;-<span class="kw">clamp</span>(b,<span class="dt">lower=</span><span class="fl">0.2</span>)</span>
<span id="cb82-34"><a href="stage-2-running-the-model.html#cb82-34"></a>    <span class="kw">return</span>(<span class="kw">data.frame</span>(b))</span>
<span id="cb82-35"><a href="stage-2-running-the-model.html#cb82-35"></a>}</span>
<span id="cb82-36"><a href="stage-2-running-the-model.html#cb82-36"></a></span>
<span id="cb82-37"><a href="stage-2-running-the-model.html#cb82-37"></a>fW_<span class="dv">2</span>&lt;-<span class="st"> </span><span class="kw">fw1func</span>(<span class="dt">P=</span>(Precip[,<span class="dv">2</span>]), <span class="dt">E=</span>(Evp[,<span class="dv">2</span>]), <span class="dt">S.Thick =</span> soil.thick, <span class="dt">pClay =</span> clay, <span class="dt">pE =</span> <span class="dv">1</span>, <span class="dt">bare=</span>bare1)<span class="op">$</span>b </span>
<span id="cb82-38"><a href="stage-2-running-the-model.html#cb82-38"></a></span>
<span id="cb82-39"><a href="stage-2-running-the-model.html#cb82-39"></a><span class="co">#Vegetation Cover effects  </span></span>
<span id="cb82-40"><a href="stage-2-running-the-model.html#cb82-40"></a></span>
<span id="cb82-41"><a href="stage-2-running-the-model.html#cb82-41"></a>fC&lt;-Cov2[,<span class="dv">2</span>]</span>
<span id="cb82-42"><a href="stage-2-running-the-model.html#cb82-42"></a></span>
<span id="cb82-43"><a href="stage-2-running-the-model.html#cb82-43"></a><span class="co"># Set the factors frame for Model calculations</span></span>
<span id="cb82-44"><a href="stage-2-running-the-model.html#cb82-44"></a></span>
<span id="cb82-45"><a href="stage-2-running-the-model.html#cb82-45"></a>xi.frame=<span class="kw">data.frame</span>(years,<span class="kw">rep</span>(fT<span class="op">*</span>fW_<span class="dv">2</span><span class="op">*</span>fC<span class="op">*</span>fPR,<span class="dt">length.out=</span><span class="kw">length</span>(years)))</span>
<span id="cb82-46"><a href="stage-2-running-the-model.html#cb82-46"></a></span>
<span id="cb82-47"><a href="stage-2-running-the-model.html#cb82-47"></a><span class="co"># RUN THE MODEL from SoilR</span></span>
<span id="cb82-48"><a href="stage-2-running-the-model.html#cb82-48"></a><span class="co">#Loads the model </span></span>
<span id="cb82-49"><a href="stage-2-running-the-model.html#cb82-49"></a><span class="co">#Model3_spin=RothCModel(t=years,C0=c(DPMptf[[1]], RPMptf[[1]], BIOptf[[1]], HUMptf[[1]], FallIOM[[1]]),In=Cinputs,DR=DR,clay=clay,xi=xi.frame, pass=TRUE) </span></span>
<span id="cb82-50"><a href="stage-2-running-the-model.html#cb82-50"></a><span class="co">#Ct3_spin=getC(Model3_spin)</span></span>
<span id="cb82-51"><a href="stage-2-running-the-model.html#cb82-51"></a></span>
<span id="cb82-52"><a href="stage-2-running-the-model.html#cb82-52"></a><span class="co"># RUN THE MODEL from soilassesment</span></span>
<span id="cb82-53"><a href="stage-2-running-the-model.html#cb82-53"></a></span>
<span id="cb82-54"><a href="stage-2-running-the-model.html#cb82-54"></a>Model3_spin=<span class="kw">carbonTurnover</span>(<span class="dt">tt=</span>years,<span class="dt">C0=</span><span class="kw">c</span>(DPMptf[[<span class="dv">1</span>]], RPMptf[[<span class="dv">1</span>]], BIOptf[[<span class="dv">1</span>]], HUMptf[[<span class="dv">1</span>]], FallIOM[[<span class="dv">1</span>]]),<span class="dt">In=</span>Cinputs,<span class="dt">Dr=</span>DR,<span class="dt">clay=</span>clay,<span class="dt">effcts=</span>xi.frame, <span class="st">&quot;euler&quot;</span>) </span>
<span id="cb82-55"><a href="stage-2-running-the-model.html#cb82-55"></a></span>
<span id="cb82-56"><a href="stage-2-running-the-model.html#cb82-56"></a>Ct3_spin=Model3_spin[,<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>]</span>
<span id="cb82-57"><a href="stage-2-running-the-model.html#cb82-57"></a></span>
<span id="cb82-58"><a href="stage-2-running-the-model.html#cb82-58"></a><span class="co"># Get the final pools of the time series</span></span>
<span id="cb82-59"><a href="stage-2-running-the-model.html#cb82-59"></a></span>
<span id="cb82-60"><a href="stage-2-running-the-model.html#cb82-60"></a>poolSize3_spin=<span class="kw">as.numeric</span>(<span class="kw">tail</span>(Ct3_spin,<span class="dv">1</span>))</span>
<span id="cb82-61"><a href="stage-2-running-the-model.html#cb82-61"></a></span>
<span id="cb82-62"><a href="stage-2-running-the-model.html#cb82-62"></a><span class="kw">return</span>(poolSize3_spin)</span>
<span id="cb82-63"><a href="stage-2-running-the-model.html#cb82-63"></a>}</span>
<span id="cb82-64"><a href="stage-2-running-the-model.html#cb82-64"></a><span class="co">################function set up ends#############</span></span></code></pre></div>
<p>Then we can iterate over the vector variable, running the model for each target point.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="stage-2-running-the-model.html#cb83-1"></a><span class="co"># Iterates over the area of interest</span></span>
<span id="cb83-2"><a href="stage-2-running-the-model.html#cb83-2"></a><span class="co">##################for loop starts###############</span></span>
<span id="cb83-3"><a href="stage-2-running-the-model.html#cb83-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">dim</span>(Variables)[<span class="dv">1</span>]) {</span>
<span id="cb83-4"><a href="stage-2-running-the-model.html#cb83-4"></a><span class="co"># Extract the variables </span></span>
<span id="cb83-5"><a href="stage-2-running-the-model.html#cb83-5"></a>Vect&lt;-<span class="kw">as.data.frame</span>(Variables[i,])</span>
<span id="cb83-6"><a href="stage-2-running-the-model.html#cb83-6"></a>Temp&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[<span class="dv">4</span><span class="op">:</span><span class="dv">15</span>]))</span>
<span id="cb83-7"><a href="stage-2-running-the-model.html#cb83-7"></a>Temp&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Temp=</span>Temp[,<span class="dv">1</span>])</span>
<span id="cb83-8"><a href="stage-2-running-the-model.html#cb83-8"></a>Precip&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[<span class="dv">16</span><span class="op">:</span><span class="dv">27</span>]))</span>
<span id="cb83-9"><a href="stage-2-running-the-model.html#cb83-9"></a>Precip&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Precip=</span>Precip[,<span class="dv">1</span>])</span>
<span id="cb83-10"><a href="stage-2-running-the-model.html#cb83-10"></a>Evp&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[<span class="dv">28</span><span class="op">:</span><span class="dv">39</span>]))</span>
<span id="cb83-11"><a href="stage-2-running-the-model.html#cb83-11"></a>Evp&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Evp=</span>Evp[,<span class="dv">1</span>])</span>
<span id="cb83-12"><a href="stage-2-running-the-model.html#cb83-12"></a>Cov&lt;-<span class="kw">as.data.frame</span>(<span class="kw">t</span>(Vect[<span class="dv">42</span><span class="op">:</span><span class="dv">53</span>]))</span>
<span id="cb83-13"><a href="stage-2-running-the-model.html#cb83-13"></a>Cov1&lt;-<span class="kw">data.frame</span>(<span class="dt">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb83-14"><a href="stage-2-running-the-model.html#cb83-14"></a>Cov2&lt;-<span class="kw">data.frame</span>(<span class="dt">Month=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">Cov=</span>Cov[,<span class="dv">1</span>])</span>
<span id="cb83-15"><a href="stage-2-running-the-model.html#cb83-15"></a><span class="co">#Avoid calculus over Na values </span></span>
<span id="cb83-16"><a href="stage-2-running-the-model.html#cb83-16"></a><span class="cf">if</span> (<span class="kw">any</span>(<span class="kw">is.na</span>(Evp[,<span class="dv">2</span>])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(Temp[,<span class="dv">2</span>])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(SOC_im[i])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(clay_im[i])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(Precip[,<span class="dv">2</span>]))  <span class="op">|</span><span class="st">  </span><span class="kw">any</span>(<span class="kw">is.na</span>(Cov2[,<span class="dv">2</span>]))  <span class="op">|</span><span class="st">  </span><span class="kw">any</span>(<span class="kw">is.na</span>(Cov1[,<span class="dv">1</span>])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(Cinputs_im[i])) <span class="op">|</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(DR_im[i])) <span class="op">|</span><span class="st"> </span>(Cinputs_im[i]<span class="op">&lt;</span><span class="dv">0</span>) <span class="op">|</span><span class="st">  </span>(SOC_im[i]<span class="op">&lt;</span><span class="dv">0</span>) <span class="op">|</span><span class="st"> </span>(clay_im[i]<span class="op">&lt;</span><span class="dv">0</span>) ) {FOWARD[i,<span class="dv">2</span>]&lt;-<span class="dv">0</span>}<span class="cf">else</span>{</span>
<span id="cb83-17"><a href="stage-2-running-the-model.html#cb83-17"></a><span class="co"># Set the variables from the images</span></span>
<span id="cb83-18"><a href="stage-2-running-the-model.html#cb83-18"></a>soil.thick=<span class="dv">30</span>  <span class="co">#Soil thickness (organic layer topsoil), in cm</span></span>
<span id="cb83-19"><a href="stage-2-running-the-model.html#cb83-19"></a>SOC&lt;-SOC_im[i]      <span class="co">#Soil organic carbon in Mg/ha </span></span>
<span id="cb83-20"><a href="stage-2-running-the-model.html#cb83-20"></a>clay&lt;-clay_im[i]        <span class="co">#Percent clay %</span></span>
<span id="cb83-21"><a href="stage-2-running-the-model.html#cb83-21"></a>Cinputs&lt;-Cinputs_im[i]    <span class="co">#Annual C inputs to soil in Mg/ha/yr</span></span>
<span id="cb83-22"><a href="stage-2-running-the-model.html#cb83-22"></a>DR&lt;-DR_im[i]              <span class="co"># DPM/RPM (decomplosable vs resistant plant material.)</span></span>
<span id="cb83-23"><a href="stage-2-running-the-model.html#cb83-23"></a>bare1&lt;-(Cov1<span class="op">&gt;</span><span class="fl">0.8</span>)           <span class="co"># If the surface is bare or vegetated</span></span>
<span id="cb83-24"><a href="stage-2-running-the-model.html#cb83-24"></a>LU&lt;-LU_im[i]</span></code></pre></div>
<p>Now we can run the model for the business as usual (BAU) scenario. The “f_bau_t” variable will save the result of the model in each iteration.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="stage-2-running-the-model.html#cb84-1"></a><span class="co"># Final calculation of SOC  20 years in the future  (Business as usual)</span></span>
<span id="cb84-2"><a href="stage-2-running-the-model.html#cb84-2"></a></span>
<span id="cb84-3"><a href="stage-2-running-the-model.html#cb84-3"></a>f_bau&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>Cinputs,<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-4"><a href="stage-2-running-the-model.html#cb84-4"></a>f_bau_t&lt;-f_bau[<span class="dv">1</span>]<span class="op">+</span>f_bau[<span class="dv">2</span>]<span class="op">+</span>f_bau[<span class="dv">3</span>]<span class="op">+</span>f_bau[<span class="dv">4</span>]<span class="op">+</span>f_bau[<span class="dv">5</span>]</span>
<span id="cb84-5"><a href="stage-2-running-the-model.html#cb84-5"></a></span>
<span id="cb84-6"><a href="stage-2-running-the-model.html#cb84-6"></a><span class="co">#Unc BAU minimum </span></span>
<span id="cb84-7"><a href="stage-2-running-the-model.html#cb84-7"></a>Cinputs_min&lt;-WARM_UP<span class="op">@</span>data[i,<span class="dv">23</span>]</span>
<span id="cb84-8"><a href="stage-2-running-the-model.html#cb84-8"></a>Cinputs_max&lt;-WARM_UP<span class="op">@</span>data[i,<span class="dv">24</span>]</span>
<span id="cb84-9"><a href="stage-2-running-the-model.html#cb84-9"></a>SOC_t0_min&lt;-WARM_UP<span class="op">@</span>data[i,<span class="dv">11</span>]</span>
<span id="cb84-10"><a href="stage-2-running-the-model.html#cb84-10"></a>SOC_t0_max&lt;-WARM_UP<span class="op">@</span>data[i,<span class="dv">17</span>]</span>
<span id="cb84-11"><a href="stage-2-running-the-model.html#cb84-11"></a></span>
<span id="cb84-12"><a href="stage-2-running-the-model.html#cb84-12"></a>f_bau_min&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>Cinputs_min,<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">1.02</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">0.95</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">0.8</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">0.9</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-13"><a href="stage-2-running-the-model.html#cb84-13"></a>f_bau_t_min&lt;-f_bau_min[<span class="dv">1</span>]<span class="op">+</span>f_bau_min[<span class="dv">2</span>]<span class="op">+</span>f_bau_min[<span class="dv">3</span>]<span class="op">+</span>f_bau_min[<span class="dv">4</span>]<span class="op">+</span>f_bau_min[<span class="dv">5</span>]</span>
<span id="cb84-14"><a href="stage-2-running-the-model.html#cb84-14"></a></span>
<span id="cb84-15"><a href="stage-2-running-the-model.html#cb84-15"></a><span class="co">#Unc BAU maximum</span></span>
<span id="cb84-16"><a href="stage-2-running-the-model.html#cb84-16"></a></span>
<span id="cb84-17"><a href="stage-2-running-the-model.html#cb84-17"></a>f_bau_max&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>Cinputs_max,<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">0.98</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">1.05</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">1.2</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">1.1</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-18"><a href="stage-2-running-the-model.html#cb84-18"></a>f_bau_t_max&lt;-f_bau_max[<span class="dv">1</span>]<span class="op">+</span>f_bau_max[<span class="dv">2</span>]<span class="op">+</span>f_bau_max[<span class="dv">3</span>]<span class="op">+</span>f_bau_max[<span class="dv">4</span>]<span class="op">+</span>f_bau_max[<span class="dv">5</span>]</span>
<span id="cb84-19"><a href="stage-2-running-the-model.html#cb84-19"></a></span>
<span id="cb84-20"><a href="stage-2-running-the-model.html#cb84-20"></a><span class="co"># Crops and Tree crops</span></span>
<span id="cb84-21"><a href="stage-2-running-the-model.html#cb84-21"></a><span class="cf">if</span> (LU<span class="op">==</span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span>LU<span class="op">==</span><span class="dv">12</span>){</span>
<span id="cb84-22"><a href="stage-2-running-the-model.html#cb84-22"></a>f_low&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs<span class="op">*</span>Low_Crops),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-23"><a href="stage-2-running-the-model.html#cb84-23"></a>f_low_t&lt;-f_low[<span class="dv">1</span>]<span class="op">+</span>f_low[<span class="dv">2</span>]<span class="op">+</span>f_low[<span class="dv">3</span>]<span class="op">+</span>f_low[<span class="dv">4</span>]<span class="op">+</span>f_low[<span class="dv">5</span>]</span>
<span id="cb84-24"><a href="stage-2-running-the-model.html#cb84-24"></a></span>
<span id="cb84-25"><a href="stage-2-running-the-model.html#cb84-25"></a>f_med&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs<span class="op">*</span>Med_Crops),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-26"><a href="stage-2-running-the-model.html#cb84-26"></a>f_med_t&lt;-f_med[<span class="dv">1</span>]<span class="op">+</span>f_med[<span class="dv">2</span>]<span class="op">+</span>f_med[<span class="dv">3</span>]<span class="op">+</span>f_med[<span class="dv">4</span>]<span class="op">+</span>f_med[<span class="dv">5</span>]</span>
<span id="cb84-27"><a href="stage-2-running-the-model.html#cb84-27"></a></span>
<span id="cb84-28"><a href="stage-2-running-the-model.html#cb84-28"></a>f_high&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs<span class="op">*</span>High_Crops),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-29"><a href="stage-2-running-the-model.html#cb84-29"></a>f_high_t&lt;-f_high[<span class="dv">1</span>]<span class="op">+</span>f_high[<span class="dv">2</span>]<span class="op">+</span>f_high[<span class="dv">3</span>]<span class="op">+</span>f_high[<span class="dv">4</span>]<span class="op">+</span>f_high[<span class="dv">5</span>]</span>
<span id="cb84-30"><a href="stage-2-running-the-model.html#cb84-30"></a></span>
<span id="cb84-31"><a href="stage-2-running-the-model.html#cb84-31"></a><span class="co"># SSM croplands unc min</span></span>
<span id="cb84-32"><a href="stage-2-running-the-model.html#cb84-32"></a></span>
<span id="cb84-33"><a href="stage-2-running-the-model.html#cb84-33"></a>f_med_min&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs_min<span class="op">*</span>(Med_Crops<span class="fl">-0.15</span>)),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">1.02</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">0.95</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">0.8</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">0.9</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-34"><a href="stage-2-running-the-model.html#cb84-34"></a>f_med_t_min&lt;-f_med_min[<span class="dv">1</span>]<span class="op">+</span>f_med_min[<span class="dv">2</span>]<span class="op">+</span>f_med_min[<span class="dv">3</span>]<span class="op">+</span>f_med_min[<span class="dv">4</span>]<span class="op">+</span>f_med_min[<span class="dv">5</span>]</span>
<span id="cb84-35"><a href="stage-2-running-the-model.html#cb84-35"></a></span>
<span id="cb84-36"><a href="stage-2-running-the-model.html#cb84-36"></a><span class="co"># SSM croplands unc max</span></span>
<span id="cb84-37"><a href="stage-2-running-the-model.html#cb84-37"></a></span>
<span id="cb84-38"><a href="stage-2-running-the-model.html#cb84-38"></a>f_med_max&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs_max<span class="op">*</span>(Med_Crops<span class="fl">+0.15</span>)),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">0.98</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">1.05</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">1.2</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">1.1</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-39"><a href="stage-2-running-the-model.html#cb84-39"></a>f_med_t_max&lt;-f_med_max[<span class="dv">1</span>]<span class="op">+</span>f_med_max[<span class="dv">2</span>]<span class="op">+</span>f_med_max[<span class="dv">3</span>]<span class="op">+</span>f_med_max[<span class="dv">4</span>]<span class="op">+</span>f_med_max[<span class="dv">5</span>]</span>
<span id="cb84-40"><a href="stage-2-running-the-model.html#cb84-40"></a></span>
<span id="cb84-41"><a href="stage-2-running-the-model.html#cb84-41"></a>}</span>
<span id="cb84-42"><a href="stage-2-running-the-model.html#cb84-42"></a><span class="co">#Shrublands, grasslands, and sparce vegetation</span></span>
<span id="cb84-43"><a href="stage-2-running-the-model.html#cb84-43"></a><span class="cf">else</span> <span class="cf">if</span> (LU<span class="op">==</span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>LU<span class="op">==</span><span class="dv">5</span> <span class="op">|</span><span class="st"> </span>LU<span class="op">==</span><span class="dv">6</span> <span class="op">|</span><span class="st"> </span>LU<span class="op">==</span><span class="dv">8</span>) {</span>
<span id="cb84-44"><a href="stage-2-running-the-model.html#cb84-44"></a>f_low&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs<span class="op">*</span>Low_Grass),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-45"><a href="stage-2-running-the-model.html#cb84-45"></a>f_low_t&lt;-f_low[<span class="dv">1</span>]<span class="op">+</span>f_low[<span class="dv">2</span>]<span class="op">+</span>f_low[<span class="dv">3</span>]<span class="op">+</span>f_low[<span class="dv">4</span>]<span class="op">+</span>f_low[<span class="dv">5</span>]</span>
<span id="cb84-46"><a href="stage-2-running-the-model.html#cb84-46"></a></span>
<span id="cb84-47"><a href="stage-2-running-the-model.html#cb84-47"></a>f_med&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs<span class="op">*</span>Med_Grass),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-48"><a href="stage-2-running-the-model.html#cb84-48"></a>f_med_t&lt;-f_med[<span class="dv">1</span>]<span class="op">+</span>f_med[<span class="dv">2</span>]<span class="op">+</span>f_med[<span class="dv">3</span>]<span class="op">+</span>f_med[<span class="dv">4</span>]<span class="op">+</span>f_med[<span class="dv">5</span>]</span>
<span id="cb84-49"><a href="stage-2-running-the-model.html#cb84-49"></a></span>
<span id="cb84-50"><a href="stage-2-running-the-model.html#cb84-50"></a>f_high&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs<span class="op">*</span>High_Grass),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-51"><a href="stage-2-running-the-model.html#cb84-51"></a>f_high_t&lt;-f_high[<span class="dv">1</span>]<span class="op">+</span>f_high[<span class="dv">2</span>]<span class="op">+</span>f_high[<span class="dv">3</span>]<span class="op">+</span>f_high[<span class="dv">4</span>]<span class="op">+</span>f_high[<span class="dv">5</span>]</span>
<span id="cb84-52"><a href="stage-2-running-the-model.html#cb84-52"></a></span>
<span id="cb84-53"><a href="stage-2-running-the-model.html#cb84-53"></a><span class="co">#SSM Shrublands unc min</span></span>
<span id="cb84-54"><a href="stage-2-running-the-model.html#cb84-54"></a></span>
<span id="cb84-55"><a href="stage-2-running-the-model.html#cb84-55"></a>f_med_min&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs_min<span class="op">*</span>(Med_Grass<span class="fl">-0.15</span>)),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">1.02</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">0.95</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">0.8</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">0.9</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-56"><a href="stage-2-running-the-model.html#cb84-56"></a>f_med_t_min&lt;-f_med_min[<span class="dv">1</span>]<span class="op">+</span>f_med_min[<span class="dv">2</span>]<span class="op">+</span>f_med_min[<span class="dv">3</span>]<span class="op">+</span>f_med_min[<span class="dv">4</span>]<span class="op">+</span>f_med_min[<span class="dv">5</span>]</span>
<span id="cb84-57"><a href="stage-2-running-the-model.html#cb84-57"></a></span>
<span id="cb84-58"><a href="stage-2-running-the-model.html#cb84-58"></a><span class="co">#SSM Shrublands unc max</span></span>
<span id="cb84-59"><a href="stage-2-running-the-model.html#cb84-59"></a></span>
<span id="cb84-60"><a href="stage-2-running-the-model.html#cb84-60"></a>f_med_max&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs_max<span class="op">*</span>(Med_Grass<span class="fl">+0.15</span>)),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">0.98</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">1.05</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">1.2</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">1.1</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-61"><a href="stage-2-running-the-model.html#cb84-61"></a>f_med_t_max&lt;-f_med_max[<span class="dv">1</span>]<span class="op">+</span>f_med_max[<span class="dv">2</span>]<span class="op">+</span>f_med_max[<span class="dv">3</span>]<span class="op">+</span>f_med_max[<span class="dv">4</span>]<span class="op">+</span>f_med_max[<span class="dv">5</span>]</span>
<span id="cb84-62"><a href="stage-2-running-the-model.html#cb84-62"></a></span>
<span id="cb84-63"><a href="stage-2-running-the-model.html#cb84-63"></a>}</span>
<span id="cb84-64"><a href="stage-2-running-the-model.html#cb84-64"></a><span class="co"># Paddy Fields </span></span>
<span id="cb84-65"><a href="stage-2-running-the-model.html#cb84-65"></a><span class="cf">else</span> <span class="cf">if</span> (LU<span class="op">==</span><span class="dv">13</span>) {</span>
<span id="cb84-66"><a href="stage-2-running-the-model.html#cb84-66"></a>f_low&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs<span class="op">*</span>Low_PaddyFields),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-67"><a href="stage-2-running-the-model.html#cb84-67"></a>f_low_t&lt;-f_low[<span class="dv">1</span>]<span class="op">+</span>f_low[<span class="dv">2</span>]<span class="op">+</span>f_low[<span class="dv">3</span>]<span class="op">+</span>f_low[<span class="dv">4</span>]<span class="op">+</span>f_low[<span class="dv">5</span>]</span>
<span id="cb84-68"><a href="stage-2-running-the-model.html#cb84-68"></a></span>
<span id="cb84-69"><a href="stage-2-running-the-model.html#cb84-69"></a>f_med&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs<span class="op">*</span>Med_PaddyFields),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-70"><a href="stage-2-running-the-model.html#cb84-70"></a>f_med_t&lt;-f_med[<span class="dv">1</span>]<span class="op">+</span>f_med[<span class="dv">2</span>]<span class="op">+</span>f_med[<span class="dv">3</span>]<span class="op">+</span>f_med[<span class="dv">4</span>]<span class="op">+</span>f_med[<span class="dv">5</span>]</span>
<span id="cb84-71"><a href="stage-2-running-the-model.html#cb84-71"></a></span>
<span id="cb84-72"><a href="stage-2-running-the-model.html#cb84-72"></a>f_high&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs<span class="op">*</span>High_PaddyFields),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">5</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">6</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">7</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">8</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">9</span>],<span class="dt">Temp=</span>Temp,<span class="dt">Precip=</span>Precip,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC,<span class="dt">clay=</span>clay,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-73"><a href="stage-2-running-the-model.html#cb84-73"></a>f_high_t&lt;-f_high[<span class="dv">1</span>]<span class="op">+</span>f_high[<span class="dv">2</span>]<span class="op">+</span>f_high[<span class="dv">3</span>]<span class="op">+</span>f_high[<span class="dv">4</span>]<span class="op">+</span>f_high[<span class="dv">5</span>]</span>
<span id="cb84-74"><a href="stage-2-running-the-model.html#cb84-74"></a></span>
<span id="cb84-75"><a href="stage-2-running-the-model.html#cb84-75"></a><span class="co">#SSM Forest unc min</span></span>
<span id="cb84-76"><a href="stage-2-running-the-model.html#cb84-76"></a></span>
<span id="cb84-77"><a href="stage-2-running-the-model.html#cb84-77"></a>f_med_min&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs_min<span class="op">*</span>(Med_PaddyFields<span class="fl">-0.15</span>)),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">12</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">13</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">14</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">15</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">16</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">1.02</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">0.95</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">0.8</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">0.9</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-78"><a href="stage-2-running-the-model.html#cb84-78"></a>f_med_t_min&lt;-f_med_min[<span class="dv">1</span>]<span class="op">+</span>f_med_min[<span class="dv">2</span>]<span class="op">+</span>f_med_min[<span class="dv">3</span>]<span class="op">+</span>f_med_min[<span class="dv">4</span>]<span class="op">+</span>f_med_min[<span class="dv">5</span>]</span>
<span id="cb84-79"><a href="stage-2-running-the-model.html#cb84-79"></a></span>
<span id="cb84-80"><a href="stage-2-running-the-model.html#cb84-80"></a><span class="co">#SSM Forest unc max</span></span>
<span id="cb84-81"><a href="stage-2-running-the-model.html#cb84-81"></a></span>
<span id="cb84-82"><a href="stage-2-running-the-model.html#cb84-82"></a>f_med_max&lt;-<span class="kw">Roth_C</span>(<span class="dt">Cinputs=</span>(Cinputs_max<span class="op">*</span>(Med_PaddyFields<span class="fl">+0.15</span>)),<span class="dt">years=</span>years,<span class="dt">DPMptf=</span>WARM_UP[i,<span class="dv">18</span>], <span class="dt">RPMptf=</span>WARM_UP[i,<span class="dv">19</span>], <span class="dt">BIOptf=</span>WARM_UP[i,<span class="dv">20</span>], <span class="dt">HUMptf=</span>WARM_UP[i,<span class="dv">21</span>], <span class="dt">FallIOM=</span>WARM_UP[i,<span class="dv">22</span>],<span class="dt">Temp=</span>Temp<span class="op">*</span><span class="fl">0.98</span>,<span class="dt">Precip=</span>Precip<span class="op">*</span><span class="fl">1.05</span>,<span class="dt">Evp=</span>Evp,<span class="dt">Cov=</span>Cov,<span class="dt">Cov1=</span>Cov1,<span class="dt">Cov2=</span>Cov2,<span class="dt">soil.thick=</span>soil.thick,<span class="dt">SOC=</span>SOC<span class="op">*</span><span class="fl">1.2</span>,<span class="dt">clay=</span>clay<span class="op">*</span><span class="fl">1.1</span>,<span class="dt">DR=</span>DR,<span class="dt">bare1=</span>bare1,<span class="dt">LU=</span>LU)</span>
<span id="cb84-83"><a href="stage-2-running-the-model.html#cb84-83"></a>f_med_t_max&lt;-f_med_max[<span class="dv">1</span>]<span class="op">+</span>f_med_max[<span class="dv">2</span>]<span class="op">+</span>f_med_max[<span class="dv">3</span>]<span class="op">+</span>f_med_max[<span class="dv">4</span>]<span class="op">+</span>f_med_max[<span class="dv">5</span>]</span>
<span id="cb84-84"><a href="stage-2-running-the-model.html#cb84-84"></a></span>
<span id="cb84-85"><a href="stage-2-running-the-model.html#cb84-85"></a>}</span>
<span id="cb84-86"><a href="stage-2-running-the-model.html#cb84-86"></a></span>
<span id="cb84-87"><a href="stage-2-running-the-model.html#cb84-87"></a><span class="cf">else</span>{</span>
<span id="cb84-88"><a href="stage-2-running-the-model.html#cb84-88"></a>f_bau_t&lt;-<span class="dv">0</span></span>
<span id="cb84-89"><a href="stage-2-running-the-model.html#cb84-89"></a>f_low_t&lt;-<span class="dv">0</span></span>
<span id="cb84-90"><a href="stage-2-running-the-model.html#cb84-90"></a>f_med_t&lt;-<span class="dv">0</span></span>
<span id="cb84-91"><a href="stage-2-running-the-model.html#cb84-91"></a>f_high_t&lt;-<span class="dv">0</span></span>
<span id="cb84-92"><a href="stage-2-running-the-model.html#cb84-92"></a>f_bau_t_min&lt;-<span class="dv">0</span></span>
<span id="cb84-93"><a href="stage-2-running-the-model.html#cb84-93"></a>f_bau_t_max&lt;-<span class="dv">0</span></span>
<span id="cb84-94"><a href="stage-2-running-the-model.html#cb84-94"></a>f_med_t_min&lt;-<span class="dv">0</span></span>
<span id="cb84-95"><a href="stage-2-running-the-model.html#cb84-95"></a>f_med_t_max&lt;-<span class="dv">0</span></span>
<span id="cb84-96"><a href="stage-2-running-the-model.html#cb84-96"></a>SOC_t0_min&lt;-<span class="dv">0</span></span>
<span id="cb84-97"><a href="stage-2-running-the-model.html#cb84-97"></a>SOC_t0_max&lt;-<span class="dv">0</span></span>
<span id="cb84-98"><a href="stage-2-running-the-model.html#cb84-98"></a></span>
<span id="cb84-99"><a href="stage-2-running-the-model.html#cb84-99"></a>}</span>
<span id="cb84-100"><a href="stage-2-running-the-model.html#cb84-100"></a></span>
<span id="cb84-101"><a href="stage-2-running-the-model.html#cb84-101"></a></span>
<span id="cb84-102"><a href="stage-2-running-the-model.html#cb84-102"></a>FOWARD[i,<span class="dv">2</span>]&lt;-SOC</span>
<span id="cb84-103"><a href="stage-2-running-the-model.html#cb84-103"></a>FOWARD[i,<span class="dv">3</span>]&lt;-f_bau_t</span>
<span id="cb84-104"><a href="stage-2-running-the-model.html#cb84-104"></a>FOWARD[i,<span class="dv">4</span>]&lt;-f_bau[<span class="dv">1</span>]</span>
<span id="cb84-105"><a href="stage-2-running-the-model.html#cb84-105"></a>FOWARD[i,<span class="dv">5</span>]&lt;-f_bau[<span class="dv">2</span>]</span>
<span id="cb84-106"><a href="stage-2-running-the-model.html#cb84-106"></a>FOWARD[i,<span class="dv">6</span>]&lt;-f_bau[<span class="dv">3</span>]</span>
<span id="cb84-107"><a href="stage-2-running-the-model.html#cb84-107"></a>FOWARD[i,<span class="dv">7</span>]&lt;-f_bau[<span class="dv">4</span>]</span>
<span id="cb84-108"><a href="stage-2-running-the-model.html#cb84-108"></a>FOWARD[i,<span class="dv">8</span>]&lt;-f_bau[<span class="dv">5</span>]</span>
<span id="cb84-109"><a href="stage-2-running-the-model.html#cb84-109"></a>FOWARD[i,<span class="dv">9</span>]&lt;-LU</span>
<span id="cb84-110"><a href="stage-2-running-the-model.html#cb84-110"></a>FOWARD[i,<span class="dv">10</span>]&lt;-f_low_t</span>
<span id="cb84-111"><a href="stage-2-running-the-model.html#cb84-111"></a>FOWARD[i,<span class="dv">11</span>]&lt;-f_med_t</span>
<span id="cb84-112"><a href="stage-2-running-the-model.html#cb84-112"></a>FOWARD[i,<span class="dv">12</span>]&lt;-f_high_t</span>
<span id="cb84-113"><a href="stage-2-running-the-model.html#cb84-113"></a>FOWARD[i,<span class="dv">13</span>]&lt;-f_bau_t_min</span>
<span id="cb84-114"><a href="stage-2-running-the-model.html#cb84-114"></a>FOWARD[i,<span class="dv">14</span>]&lt;-f_bau_t_max</span>
<span id="cb84-115"><a href="stage-2-running-the-model.html#cb84-115"></a>FOWARD[i,<span class="dv">15</span>]&lt;-f_med_t_min</span>
<span id="cb84-116"><a href="stage-2-running-the-model.html#cb84-116"></a>FOWARD[i,<span class="dv">16</span>]&lt;-f_med_t_max</span>
<span id="cb84-117"><a href="stage-2-running-the-model.html#cb84-117"></a>FOWARD[i,<span class="dv">17</span>]&lt;-SOC_t0_min</span>
<span id="cb84-118"><a href="stage-2-running-the-model.html#cb84-118"></a>FOWARD[i,<span class="dv">18</span>]&lt;-SOC_t0_max</span>
<span id="cb84-119"><a href="stage-2-running-the-model.html#cb84-119"></a></span>
<span id="cb84-120"><a href="stage-2-running-the-model.html#cb84-120"></a></span>
<span id="cb84-121"><a href="stage-2-running-the-model.html#cb84-121"></a></span>
<span id="cb84-122"><a href="stage-2-running-the-model.html#cb84-122"></a><span class="kw">print</span>(<span class="kw">c</span>(i,SOC,f_bau_t,f_low_t,f_med_t,f_high_t,f_bau_t_min,f_bau_t_max))</span>
<span id="cb84-123"><a href="stage-2-running-the-model.html#cb84-123"></a></span>
<span id="cb84-124"><a href="stage-2-running-the-model.html#cb84-124"></a><span class="er">}</span></span>
<span id="cb84-125"><a href="stage-2-running-the-model.html#cb84-125"></a><span class="er">}</span></span>
<span id="cb84-126"><a href="stage-2-running-the-model.html#cb84-126"></a></span>
<span id="cb84-127"><a href="stage-2-running-the-model.html#cb84-127"></a><span class="co">############for loop ends##############</span></span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="stage-2-running-the-model.html#cb85-1"></a>Next , we will change the names of the fields <span class="cf">in</span> the output vector layer.</span>
<span id="cb85-2"><a href="stage-2-running-the-model.html#cb85-2"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">2</span>]=<span class="st">&quot;SOC_t0&quot;</span></span>
<span id="cb85-3"><a href="stage-2-running-the-model.html#cb85-3"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">3</span>]=<span class="st">&quot;SOC_BAU_20&quot;</span></span>
<span id="cb85-4"><a href="stage-2-running-the-model.html#cb85-4"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">4</span>]=<span class="st">&quot;DPM_BAU_20&quot;</span></span>
<span id="cb85-5"><a href="stage-2-running-the-model.html#cb85-5"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">5</span>]=<span class="st">&quot;RPM_BAU_20&quot;</span></span>
<span id="cb85-6"><a href="stage-2-running-the-model.html#cb85-6"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">6</span>]=<span class="st">&quot;BIO_BAU_20&quot;</span></span>
<span id="cb85-7"><a href="stage-2-running-the-model.html#cb85-7"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">7</span>]=<span class="st">&quot;HUM_BAU_20&quot;</span></span>
<span id="cb85-8"><a href="stage-2-running-the-model.html#cb85-8"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">8</span>]=<span class="st">&quot;IOM_BAU_20&quot;</span></span>
<span id="cb85-9"><a href="stage-2-running-the-model.html#cb85-9"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">9</span>]=<span class="st">&quot;LandUse&quot;</span></span>
<span id="cb85-10"><a href="stage-2-running-the-model.html#cb85-10"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">10</span>]=<span class="st">&quot;Low_Scenario&quot;</span></span>
<span id="cb85-11"><a href="stage-2-running-the-model.html#cb85-11"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">11</span>]=<span class="st">&quot;Med_Scenario&quot;</span></span>
<span id="cb85-12"><a href="stage-2-running-the-model.html#cb85-12"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">12</span>]=<span class="st">&quot;High_Scenario&quot;</span></span>
<span id="cb85-13"><a href="stage-2-running-the-model.html#cb85-13"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">13</span>]=<span class="st">&quot;SOC_BAU_20_min&quot;</span></span>
<span id="cb85-14"><a href="stage-2-running-the-model.html#cb85-14"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">14</span>]=<span class="st">&quot;SOC_BAU_20_max&quot;</span></span>
<span id="cb85-15"><a href="stage-2-running-the-model.html#cb85-15"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">15</span>]=<span class="st">&quot;Med_Scen_min&quot;</span></span>
<span id="cb85-16"><a href="stage-2-running-the-model.html#cb85-16"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">16</span>]=<span class="st">&quot;Med_Scen_max&quot;</span></span>
<span id="cb85-17"><a href="stage-2-running-the-model.html#cb85-17"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">17</span>]=<span class="st">&quot;SOC_t0_min&quot;</span></span>
<span id="cb85-18"><a href="stage-2-running-the-model.html#cb85-18"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">18</span>]=<span class="st">&quot;SOC_t0_max&quot;</span></span></code></pre></div>
<p>The ‘euler’ method can give some out of range results in some points, under specific combinations of climatic, soil and NPP variables. To avoid including those points in the maps we will remove any “out of range” value.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="stage-2-running-the-model.html#cb86-1"></a><span class="co"># Eliminate  values out of range</span></span>
<span id="cb86-2"><a href="stage-2-running-the-model.html#cb86-2"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>SOC_BAU_<span class="dv">20</span>[FOWARD<span class="op">@</span>data<span class="op">$</span>SOC_BAU_<span class="dv">20</span><span class="op">&lt;</span><span class="dv">0</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-3"><a href="stage-2-running-the-model.html#cb86-3"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>Low_Scenario[FOWARD<span class="op">@</span>data<span class="op">$</span>Low_Scenario<span class="op">&lt;</span><span class="dv">0</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-4"><a href="stage-2-running-the-model.html#cb86-4"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scenario[FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scenario<span class="op">&lt;</span><span class="dv">0</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-5"><a href="stage-2-running-the-model.html#cb86-5"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>High_Scenario[FOWARD<span class="op">@</span>data<span class="op">$</span>High_Scenario<span class="op">&lt;</span><span class="dv">0</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-6"><a href="stage-2-running-the-model.html#cb86-6"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scen_min[FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scen_min<span class="op">&lt;</span><span class="dv">0</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-7"><a href="stage-2-running-the-model.html#cb86-7"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scen_max[FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scen_max<span class="op">&lt;</span><span class="dv">0</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-8"><a href="stage-2-running-the-model.html#cb86-8"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>SOC_BAU_<span class="dv">20</span>[FOWARD<span class="op">@</span>data<span class="op">$</span>SOC_BAU_<span class="dv">20</span><span class="op">&gt;</span><span class="dv">300</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-9"><a href="stage-2-running-the-model.html#cb86-9"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>Low_Scenario[FOWARD<span class="op">@</span>data<span class="op">$</span>Low_Scenario<span class="op">&gt;</span><span class="dv">300</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-10"><a href="stage-2-running-the-model.html#cb86-10"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scenario[FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scenario<span class="op">&gt;</span><span class="dv">300</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-11"><a href="stage-2-running-the-model.html#cb86-11"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>High_Scenario[FOWARD<span class="op">@</span>data<span class="op">$</span>High_Scenario<span class="op">&gt;</span><span class="dv">300</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-12"><a href="stage-2-running-the-model.html#cb86-12"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scen_min[FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scen_min<span class="op">&gt;</span><span class="dv">300</span>]&lt;-<span class="ot">NA</span></span>
<span id="cb86-13"><a href="stage-2-running-the-model.html#cb86-13"></a>FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scen_max[FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scen_max<span class="op">&gt;</span><span class="dv">300</span>]&lt;-<span class="ot">NA</span></span></code></pre></div>
<p>Then, we will run the rest of the script, set the working directory, calculate the uncertainties and set the name of the output vector layer.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="stage-2-running-the-model.html#cb87-1"></a> <span class="co"># Set the working directory </span></span>
<span id="cb87-2"><a href="stage-2-running-the-model.html#cb87-2"></a><span class="kw">setwd</span>(WD_OUT)</span>
<span id="cb87-3"><a href="stage-2-running-the-model.html#cb87-3"></a><span class="co"># UNCERTAINTIES</span></span>
<span id="cb87-4"><a href="stage-2-running-the-model.html#cb87-4"></a>UNC_SOC&lt;-((FOWARD<span class="op">@</span>data<span class="op">$</span>SOC_BAU_<span class="dv">20</span>_max<span class="op">-</span>FOWARD<span class="op">@</span>data<span class="op">$</span>SOC_BAU_<span class="dv">20</span>_min)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>FOWARD<span class="op">@</span>data<span class="op">$</span>SOC_BAU_<span class="dv">20</span>))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb87-5"><a href="stage-2-running-the-model.html#cb87-5"></a>UNC_<span class="dv">2018</span>&lt;-((FOWARD<span class="op">@</span>data<span class="op">$</span>SOC_<span class="dv">2018</span>_max<span class="op">-</span>FOWARD<span class="op">@</span>data<span class="op">$</span>SOC_<span class="dv">2018</span>_min)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>FOWARD<span class="op">@</span>data<span class="op">$</span>SOC_i_<span class="dv">2018</span>))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb87-6"><a href="stage-2-running-the-model.html#cb87-6"></a>UNC_SSM&lt;-((FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scen_max<span class="op">-</span>FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scen_min)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>FOWARD<span class="op">@</span>data<span class="op">$</span>Med_Scenario))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb87-7"><a href="stage-2-running-the-model.html#cb87-7"></a>FOWARD[[<span class="dv">19</span>]]&lt;-UNC_SOC</span>
<span id="cb87-8"><a href="stage-2-running-the-model.html#cb87-8"></a>FOWARD[[<span class="dv">20</span>]]&lt;-UNC_<span class="dv">2018</span></span>
<span id="cb87-9"><a href="stage-2-running-the-model.html#cb87-9"></a>FOWARD[[<span class="dv">21</span>]]&lt;-UNC_SSM</span>
<span id="cb87-10"><a href="stage-2-running-the-model.html#cb87-10"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">19</span>]=<span class="st">&quot;UNC_BAU&quot;</span></span>
<span id="cb87-11"><a href="stage-2-running-the-model.html#cb87-11"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">20</span>]=<span class="st">&quot;UNC_2018&quot;</span></span>
<span id="cb87-12"><a href="stage-2-running-the-model.html#cb87-12"></a><span class="kw">colnames</span>(FOWARD<span class="op">@</span>data)[<span class="dv">21</span>]=<span class="st">&quot;UNC_SSM&quot;</span></span>
<span id="cb87-13"><a href="stage-2-running-the-model.html#cb87-13"></a></span>
<span id="cb87-14"><a href="stage-2-running-the-model.html#cb87-14"></a><span class="co"># SAVE the Points (shapefile)</span></span>
<span id="cb87-15"><a href="stage-2-running-the-model.html#cb87-15"></a> <span class="kw">writeOGR</span>(FOWARD, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;FOWARD_County_AOI&quot;</span>, <span class="dt">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>) </span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="stage-1-preparation-of-input-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stage-3-map-generation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/FAO-GSP/SOC-Mapping-Cookbook/edit/master/10.Stage_2_running_the_model.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SOCMapping.pdf", "SOCMapping.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
